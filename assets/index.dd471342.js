var Re=Object.defineProperty,Be=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var se=(o,e,n)=>e in o?Re(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,O=(o,e)=>{for(var n in e||(e={}))ze.call(e,n)&&se(o,n,e[n]);if($e)for(var n of $e(e))We.call(e,n)&&se(o,n,e[n]);return o},F=(o,e)=>Be(o,Fe(e));var Z=(o,e,n)=>(se(o,typeof e!="symbol"?e+"":e,n),n);import{w as writable,S as SvelteComponent,i as init,s as safe_not_equal,e as element,a as space,b as attr,c as append,d as insert,n as noop,f as detach,g as component_subscribe,o as onMount,t,h as binding_callbacks,j as toggle_class,k as empty,l as group_outros,m as transition_out,p as check_outros,q as transition_in,r as text,u as set_data,v as create_slot,x as listen,y as update_slot_base,z as get_all_dirty_from_scope,A as get_slot_changes,B as createEventDispatcher,C as set_custom_element_data,D as create_component,E as mount_component,F as destroy_component,G as shortid,H as set_style,I as destroy_each,J as add_render_callback,K as create_bidirectional_transition,L as scale,M as fade,N as get_spread_update,O as get_spread_object,P as assign,T as Texture,Q as SvelteComponentDev,R as slide,U as update_keyed_each,V as backInOut,W as outro_and_destroy_block,X as flush,Y as svg_element,Z as run_all,_ as monotoneCubicSpline,$ as set_input_value,a0 as to_number,a1 as subtract,a2 as normalize,a3 as cross$1,a4 as dot,a5 as identity,a6 as rotate,a7 as mul,a8 as transformMat4,a9 as add,aa as mod,ab as Vec3,ac as Geometry,ad as storage,ae as wrap,af as Transform,ag as Renderer$1,ah as Camera,ai as Orbit,aj as Program,ak as Mesh,al as Box,am as stop_propagation,an as ResizeObserver_1,ao as add_flush_callback,ap as bind,aq as set_store_value,ar as Plane,as as Color,at as HtmlTag,au as Src,av as bubble,aw as handle_promise,ax as update_await_block_branch,ay as subscribe}from"./vendor.30885a5b.js";const p=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};p();var global="";const dark_shadow="0px 0px 2px rgba(0, 0, 0, 0.7)",light_shadow="0px 0px 5px rgba(0, 0, 0, 0.144)";var styles={"dark_background-color":"#1a1a1a","dark_foreground-color":"#303030","dark_outline-color":"#212121","dark_text-color":"#ffffff",dark_shadow,"light_background-color":"#d0d0d0","light_foreground-color":"white","light_outline-color":"#b9b9b9","light_text-color":"#484848",light_shadow};function stylesToJSON(o){const e={};return Object.entries(o).forEach(([n,s])=>{const[i,r]=n.split("_");i in e?e[i][r]=s:e[i]={[r]:s}}),e}const themes=stylesToJSON(styles),themeNames=Object.keys(themes);let activeTheme="theme"in localStorage?localStorage.getItem("theme"):themeNames[0];themeNames.includes(activeTheme)||(activeTheme=themeNames[0]);const store$4=writable(themes[activeTheme]),setTheme=o=>{themeNames.includes(o)&&(store$4.set(themes[o]),localStorage.setItem("theme",o))};function create_fragment$t(o){let e,n;return{c(){e=element("style"),n=space(),attr(e,"type","text/css")},m(s,i){append(document.head,e),o[3](e),insert(s,n,i)},p:noop,i:noop,o:noop,d(s){detach(e),o[3](null),s&&detach(n)}}}function instance$q(o,e,n){let s,i;component_subscribe(o,store$4,d=>n(2,i=d));let r,a=!1;function u(){a||!r||(a=!0,n(0,r.innerHTML="* {transition: color 0.2s ease, background-color 0.2s ease, outline 0.2s ease !important;}",r),setTimeout(()=>{n(0,r.innerHTML=`* {transition: color 0.2s ease, background-color 0.2s ease, outline 0.2s ease !important;} :root{${s}}`,r),setTimeout(()=>{n(0,r.innerHTML=`:root{${s}}`,r),a=!1},200)},1))}onMount(()=>{n(0,r.innerHTML=`:root{${s}}`,r)});function c(d){binding_callbacks[d?"unshift":"push"](()=>{r=d,n(0,r)})}return o.$$.update=()=>{o.$$.dirty&4&&n(1,s=t(i)),o.$$.dirty&2&&s&&u()},[r,s,i,c]}class ThemeProvider extends SvelteComponent{constructor(e){super();init(this,e,instance$q,create_fragment$t,safe_not_equal,{})}}function getBrowser$1(){try{const browser=typeof eval("window")!="undefined";return browser}catch(o){return!1}}const isBrowser=getBrowser$1();var arrow=`<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.2" baseProfile="tiny" id="Ebene_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
</svg>
`,branch=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>branch</title>
  <path class="cls-1" d="M49.59,57.35,72.15,38.69"/>
  <path class="cls-1" d="M51.58,29.45,38,11.21"/>
  <path class="cls-1" d="M53.14,82.61,21.78,55.74"/>
  <path class="cls-1" d="M33.46,47.91l4,21"/>
  <polyline class="cls-1" points="56 97 50 58 51 28 56 16"/>
</svg>`,checkmark='<svg id="e7691b6e-31fa-49a4-aaec-be19b623d191" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><style>.b50603dd-20d5-40a2-a0ce-2fdf3b92ec21{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:5px;}</style></defs><title>checkmark</title><path class="b50603dd-20d5-40a2-a0ce-2fdf3b92ec21" d="M75.5,30,40.43,72.47a2,2,0,0,1-3.08,0L24.5,57"/></svg>',cog=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
<defs>
	<style>
		circle, path{
			fill:none;
			stroke: var(--text, white);
			stroke-width: 5px;
		}
	</style>
</defs>
	<circle class="cls-1" cx="50.37" cy="50.5" r="17.23"/>
  <path class="cls-1" d="M38.07,20.49,32.17,8.05,50.83,4.41l.61,13.8,12.13,2.28L68.73,8.05l14,10.16-9,10L81.17,38.7l12-5.47,3.34,17.3H81.93L80.57,63l12.59,6.37L82.7,83.62l-9-9.86L63.58,81.19l5.15,11.23-17.9,3.64V82.71L38.08,81.19,32.77,92.42,17.44,82.71l10.17-8.35L19.11,63,8.19,69.36,4.4,50.56H17.45l1.67-13.81L8.2,30.84l9.25-13.2,11.08,8.81Z"/>
</svg>
`,cross=`<svg
  xmlns="http://www.w3.org/2000/svg"
	viewBox="0 0 100 100">
  <line fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" x1="27.836" y1="72.164" x2="72.164" y2="27.836"/>
  <line fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" x1="27.836" y1="27.988" x2="72.164" y2="72.012"/>
</svg>
`,exclamation=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M50.552 59.3295L39.0695 13.7056H60.2078L50.552 59.3295Z" stroke="white" stroke-width="5" stroke-linejoin="round"/>
<path d="M58.4305 77.2411C58.4305 80.8276 55.4725 83.7944 51.7497 83.7944C48.0269 83.7944 45.0688 80.8276 45.0688 77.2411C45.0688 73.6546 48.0269 70.6878 51.7497 70.6878C55.4725 70.6878 58.4305 73.6546 58.4305 77.2411Z" stroke="white" stroke-width="5"/>
</svg>
`,folder=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">

<defs>
	<style>
		path{
			stroke: white;
			stroke-width: 5px;
		}
	</style>
</defs>

<path d="M23.5167 72.9513V32.1483H82.1056L87.6855 37.0307V76.09L82.1056 78.5312H29.4453L23.5167 72.9513Z" />
<path d="M23.2747 73.6489L12.3145 30.0463L15.8885 21.4688H71.8808L75.693 32.9055" />
<path d="M25.488 43.9781H86.7394" />
</svg>
`,hand=`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M70.5 26.5L77.5 23.5L82 32V69L77.5 82L64.5 92.5H47L32 82L18 46L21 40H27L35 57.5V15.5L39.5 11L45.5 13.5M70.5 26.5L69 15.5L58.5 14M70.5 26.5V57.5M58.5 14L55 8L45.5 13.5M58.5 14V49M45.5 13.5V49" stroke-width="5"/>
</svg>
`,leaf$1=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>leaf</title>
  <path class="cls-1" d="M50.69,96.21,72.86,72.33,77,47,65.91,21.7,50.66,4.5"/>
  <path class="cls-1" d="M53.37,96.21,31.2,72.33,27.07,47,38.15,21.7,53.4,4.5"/>
</svg>`,pointing=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M30.2312 46.4809V15.6962L33.3006 8H40.8035L44.3844 11.0785V29.7203H52.9104L55.9798 33.8249H65.0173L68.0867 38.9557L76.2717 40.1529L79 56.0583L73.7139 72.9899L66.8931 93H36.5405L30.2312 75.5553L20 60.334L21.7052 50.2435L30.2312 46.4809ZM30.2312 46.4809V58.1107M44.3844 29.3783V46.3099M56.4913 34.5091V46.3099M68.7688 39.2978V50.4145" stroke="white" stroke-width="5"/>
</svg>
`,stem=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>stem</title>
  <path class="cls-1" d="M49,95.5l8.66-23.19L43.24,46.07l10.59-21L43.24,4.5"/>
</svg>`,triangle=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" xml:space="preserve">
  <polygon fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" points="33.5,73.759 33.5,26.241 67.441,50 "/>
</svg>
`,warning=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M54.7631 15.1799L91.7944 79.3201C93.9114 82.9867 91.2652 87.5701 87.0313 87.5701H12.9687C8.73476 87.5701 6.08857 82.9867 8.20552 79.3201L45.2368 15.1799C47.3538 11.5133 52.6462 11.5133 54.7631 15.1799Z" stroke="white" stroke-width="5" stroke-linejoin="round"/>
<ellipse cx="50.0578" cy="73.7787" rx="5.98166" ry="5.89858" fill="white"/>
<path d="M52.9755 60.2707C52.5275 63.7615 47.4723 63.7615 47.0243 60.2707L43.5981 33.5748C43.3678 31.781 44.7652 30.1929 46.5736 30.1929L53.4261 30.1929C55.2346 30.1929 56.6319 31.781 56.4017 33.5748L52.9755 60.2707Z" fill="white"/>
</svg>
`,question=`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M32.7792 25.4477L45.6598 15.6472L61.6205 20.4075L67.2208 32.728L54.3402 46.4486L50.9801 59.3291V63.9218" stroke-width="8"/>
<path d="M47.3642 83.3434L44.983 79.0169L46.821 74.3331L51.3861 73.0881L55.5363 75.0446L56.307 80.8548L52.3347 84.3528L47.3642 83.3434Z" />
</svg>

`,icons=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",arrow,branch,checkmark,cog,cross,exclamation,folder,hand,leaf:leaf$1,pointing,stem,triangle,warning,question}),Icon_svelte_svelte_type_style_lang="";function create_fragment$s(o){let e;return{c(){e=element("div"),attr(e,"class","icon-wrapper svelte-1ho94ty"),toggle_class(e,"active",o[0]),toggle_class(e,"dark",o[1]),toggle_class(e,"circle",o[2])},m(n,s){insert(n,e,s),e.innerHTML=o[3]},p(n,[s]){s&8&&(e.innerHTML=n[3]),s&1&&toggle_class(e,"active",n[0]),s&2&&toggle_class(e,"dark",n[1]),s&4&&toggle_class(e,"circle",n[2])},i:noop,o:noop,d(n){n&&detach(e)}}}function instance$p(o,e,n){let s,{name:i="triangle"}=e,{active:r=!1}=e,{dark:a=!1}=e,{circle:u=!1}=e;return o.$$set=c=>{"name"in c&&n(4,i=c.name),"active"in c&&n(0,r=c.active),"dark"in c&&n(1,a=c.dark),"circle"in c&&n(2,u=c.circle)},o.$$.update=()=>{o.$$.dirty&16&&n(3,s=i in icons?icons[i]:i.toString()+" icon not found")},[r,a,u,s,i]}class Icon extends SvelteComponent{constructor(e){super();init(this,e,instance$p,create_fragment$s,safe_not_equal,{name:4,active:0,dark:1,circle:2})}}var Button_svelte_svelte_type_style_lang="";function create_if_block_1$9(o){let e,n,s,i;const r=[create_if_block_2$6,create_else_block$7],a=[];function u(c,d){return c[6]?0:1}return e=u(o),n=a[e]=r[e](o),{c(){n.c(),s=empty()},m(c,d){a[e].m(c,d),insert(c,s,d),i=!0},p(c,d){let f=e;e=u(c),e===f?a[e].p(c,d):(group_outros(),transition_out(a[f],1,1,()=>{a[f]=null}),check_outros(),n=a[e],n?n.p(c,d):(n=a[e]=r[e](c),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(c){i||(transition_in(n),i=!0)},o(c){transition_out(n),i=!1},d(c){a[e].d(c),c&&detach(s)}}}function create_else_block$7(o){let e;return{c(){e=element("plant-icon"),set_custom_element_data(e,"name",o[1]),set_custom_element_data(e,"active",o[0]),set_custom_element_data(e,"class","svelte-1shy69e")},m(n,s){insert(n,e,s)},p(n,s){s&2&&set_custom_element_data(e,"name",n[1]),s&1&&set_custom_element_data(e,"active",n[0])},i:noop,o:noop,d(n){n&&detach(e)}}}function create_if_block_2$6(o){let e,n;return e=new Icon({props:{name:o[1],active:o[0]}}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&2&&(r.name=s[1]),i&1&&(r.active=s[0]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_if_block$e(o){let e,n;return{c(){e=element("p"),n=text(o[2]),attr(e,"class","svelte-1shy69e")},m(s,i){insert(s,e,i),append(e,n)},p(s,i){i&4&&set_data(n,s[2])},d(s){s&&detach(e)}}}function create_fragment$r(o){let e,n,s,i,r,a,u,c=o[1]&&create_if_block_1$9(o),d=o[2]&&create_if_block$e(o);const f=o[9].default,h=create_slot(f,o,o[8],null);return{c(){e=element("button"),c&&c.c(),n=space(),d&&d.c(),s=space(),i=element("div"),h&&h.c(),attr(i,"class","content svelte-1shy69e"),e.disabled=o[4],attr(e,"class","svelte-1shy69e"),toggle_class(e,"active",o[0]),toggle_class(e,"useActive",o[3]),toggle_class(e,"only-icon",!o[2]),toggle_class(e,"has-icon",!!o[1])},m(m,_){insert(m,e,_),c&&c.m(e,null),append(e,n),d&&d.m(e,null),append(e,s),append(e,i),h&&h.m(i,null),o[10](e),r=!0,a||(u=listen(e,"click",o[7]),a=!0)},p(m,[_]){m[1]?c?(c.p(m,_),_&2&&transition_in(c,1)):(c=create_if_block_1$9(m),c.c(),transition_in(c,1),c.m(e,n)):c&&(group_outros(),transition_out(c,1,1,()=>{c=null}),check_outros()),m[2]?d?d.p(m,_):(d=create_if_block$e(m),d.c(),d.m(e,s)):d&&(d.d(1),d=null),h&&h.p&&(!r||_&256)&&update_slot_base(h,f,m,m[8],r?get_slot_changes(f,m[8],_,null):get_all_dirty_from_scope(m[8]),null),(!r||_&16)&&(e.disabled=m[4]),_&1&&toggle_class(e,"active",m[0]),_&8&&toggle_class(e,"useActive",m[3]),_&4&&toggle_class(e,"only-icon",!m[2]),_&2&&toggle_class(e,"has-icon",!!m[1])},i(m){r||(transition_in(c),transition_in(h,m),r=!0)},o(m){transition_out(c),transition_out(h,m),r=!1},d(m){m&&detach(e),c&&c.d(),d&&d.d(),h&&h.d(m),o[10](null),a=!1,u()}}}function instance$o(o,e,n){let s,{$$slots:i={},$$scope:r}=e,{icon:a=void 0}=e,{name:u=""}=e,{active:c=!1}=e,{useActive:d=!1}=e,{disabled:f=!1}=e,h;const m=createEventDispatcher(),_=()=>{n(0,c=!c),m("click")};function g(v){binding_callbacks[v?"unshift":"push"](()=>{h=v,n(5,h)})}return o.$$set=v=>{"icon"in v&&n(1,a=v.icon),"name"in v&&n(2,u=v.name),"active"in v&&n(0,c=v.active),"useActive"in v&&n(3,d=v.useActive),"disabled"in v&&n(4,f=v.disabled),"$$scope"in v&&n(8,r=v.$$scope)},o.$$.update=()=>{o.$$.dirty&32&&n(6,s=h&&!!h.parentElement)},[c,a,u,d,f,h,s,_,r,i,g]}class Button extends SvelteComponent{constructor(e){super();init(this,e,instance$o,create_fragment$r,safe_not_equal,{icon:1,name:2,active:0,useActive:3,disabled:4})}}var MessageType$1;(function(o){o.INFO="info",o.WARNING="warning",o.ERROR="error",o.SUCCESS="success"})(MessageType$1||(MessageType$1={}));const createMessageFactory=o=>(e,n)=>{var a;if(!e&&!n)return;const s=Array.isArray(n==null?void 0:n.values),i={id:shortid(),type:MessageType$1.INFO,content:e,props:n.props,title:(a=n==null?void 0:n.title)!=null?a:n==null?void 0:n.type,values:n==null?void 0:n.values,timeout:n==null?void 0:n.timeout},r=new Promise((u,c)=>{i.resolve=u,i.reject=c});if(r.finally(()=>o.update(u=>u.filter(c=>c.id!==i.id))),n&&"type"in n){const u=n.type.toLowerCase();Object.values(MessageType$1).forEach(c=>{u===c&&(i.type=c)})}if(e instanceof Error&&(i.type=MessageType$1.ERROR),typeof i.timeout=="undefined"){let u;i.type===MessageType$1.SUCCESS&&(u=3e3),i.type===MessageType$1.INFO&&(u=2e3),i.type===MessageType$1.WARNING&&(u=7e3),u&&!s&&(i.timeout=u)}return"title"in i||(i.title=i.type.toUpperCase().slice(0,1)+i.type.slice(1)),o.update(u=>[...u,i]),i.timeout&&setTimeout(i.resolve,i.timeout),r};var createMessageStore=()=>{const o=writable([]),e=createMessageFactory(o);return{store:o,createMessage:e,MessageType:MessageType$1}};const{store:store$3,createMessage:createMessage$1,MessageType}=createMessageStore(),createAlert=createMessage$1;var AlertWrapper_svelte_svelte_type_style_lang="";function get_each_context$b(o,e,n){const s=o.slice();return s[6]=e[n],s}function create_if_block$d(o){let e,n,s,i,r,a,u,c,d,f,h,m,_,g;i=new Button({props:{icon:"cross"}}),i.$on("click",o[4]);let v=o[0].title&&create_if_block_3$2(o);const w=[create_if_block_2$5,create_else_block$6],b=[];function $(k,N){return typeof k[0].content=="string"?0:1}c=$(o),d=b[c]=w[c](o);let y=o[0].values&&create_if_block_1$8(o);return{c(){e=element("div"),n=element("div"),s=element("div"),r=element("div"),create_component(i.$$.fragment),a=space(),v&&v.c(),u=space(),d.c(),f=space(),y&&y.c(),set_style(r,"display","contents"),set_style(r,"--bg","transparent"),attr(s,"class","close-wrapper svelte-r4wwk4"),attr(n,"class",h="alert-wrapper alert-"+o[0].type+" svelte-r4wwk4"),toggle_class(n,"isInverted",o[1]),attr(e,"class","alert-container svelte-r4wwk4")},m(k,N){insert(k,e,N),append(e,n),append(n,s),append(s,r),mount_component(i,r,null),append(n,a),v&&v.m(n,null),append(n,u),b[c].m(n,null),append(n,f),y&&y.m(n,null),g=!0},p(k,N){k[0].title?v?v.p(k,N):(v=create_if_block_3$2(k),v.c(),v.m(n,u)):v&&(v.d(1),v=null);let S=c;c=$(k),c===S?b[c].p(k,N):(group_outros(),transition_out(b[S],1,1,()=>{b[S]=null}),check_outros(),d=b[c],d?d.p(k,N):(d=b[c]=w[c](k),d.c()),transition_in(d,1),d.m(n,f)),k[0].values?y?(y.p(k,N),N&1&&transition_in(y,1)):(y=create_if_block_1$8(k),y.c(),transition_in(y,1),y.m(n,null)):y&&(group_outros(),transition_out(y,1,1,()=>{y=null}),check_outros()),(!g||N&1&&h!==(h="alert-wrapper alert-"+k[0].type+" svelte-r4wwk4"))&&attr(n,"class",h),N&3&&toggle_class(n,"isInverted",k[1])},i(k){g||(transition_in(i.$$.fragment,k),transition_in(d),transition_in(y),add_render_callback(()=>{m||(m=create_bidirectional_transition(n,scale,{},!0)),m.run(1)}),add_render_callback(()=>{_||(_=create_bidirectional_transition(e,fade,{},!0)),_.run(1)}),g=!0)},o(k){transition_out(i.$$.fragment,k),transition_out(d),transition_out(y),m||(m=create_bidirectional_transition(n,scale,{},!1)),m.run(0),_||(_=create_bidirectional_transition(e,fade,{},!1)),_.run(0),g=!1},d(k){k&&detach(e),destroy_component(i),v&&v.d(),b[c].d(),y&&y.d(),k&&m&&m.end(),k&&_&&_.end()}}}function create_if_block_3$2(o){let e,n=o[0].title+"",s;return{c(){e=element("h2"),s=text(n),attr(e,"class","svelte-r4wwk4")},m(i,r){insert(i,e,r),append(e,s)},p(i,r){r&1&&n!==(n=i[0].title+"")&&set_data(s,n)},d(i){i&&detach(e)}}}function create_else_block$6(o){let e,n,s;const i=[o[0].props];var r=o[0].content;function a(u){let c={};for(let d=0;d<i.length;d+=1)c=assign(c,i[d]);return{props:c}}return r&&(e=new r(a())),{c(){e&&create_component(e.$$.fragment),n=empty()},m(u,c){e&&mount_component(e,u,c),insert(u,n,c),s=!0},p(u,c){const d=c&1?get_spread_update(i,[get_spread_object(u[0].props)]):{};if(r!==(r=u[0].content)){if(e){group_outros();const f=e;transition_out(f.$$.fragment,1,0,()=>{destroy_component(f,1)}),check_outros()}r?(e=new r(a()),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,n.parentNode,n)):e=null}else r&&e.$set(d)},i(u){s||(e&&transition_in(e.$$.fragment,u),s=!0)},o(u){e&&transition_out(e.$$.fragment,u),s=!1},d(u){u&&detach(n),e&&destroy_component(e,u)}}}function create_if_block_2$5(o){let e,n=o[0].content+"";return{c(){e=element("p")},m(s,i){insert(s,e,i),e.innerHTML=n},p(s,i){i&1&&n!==(n=s[0].content+"")&&(e.innerHTML=n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_if_block_1$8(o){let e,n,s=o[0].values,i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$b(get_each_context$b(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){e=element("div");for(let a=0;a<i.length;a+=1)i[a].c();attr(e,"class","options-wrapper svelte-r4wwk4")},m(a,u){insert(a,e,u);for(let c=0;c<i.length;c+=1)i[c].m(e,null);n=!0},p(a,u){if(u&1){s=a[0].values;let c;for(c=0;c<s.length;c+=1){const d=get_each_context$b(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$b(d),i[c].c(),transition_in(i[c],1),i[c].m(e,null))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){a&&detach(e),destroy_each(i,a)}}}function create_each_block$b(o){let e,n,s;function i(){return o[5](o[6])}return e=new Button({props:{name:o[6]}}),e.$on("click",i),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--bg","#303030"),set_style(n,"--text","white")},m(r,a){insert(r,n,a),mount_component(e,n,null),s=!0},p(r,a){o=r;const u={};a&1&&(u.name=o[6]),e.$set(u)},i(r){s||(transition_in(e.$$.fragment,r),s=!0)},o(r){transition_out(e.$$.fragment,r),s=!1},d(r){r&&detach(n),destroy_component(e,r)}}}function create_fragment$q(o){let e,n,s,i,r=o[0]&&create_if_block$d(o);return{c(){r&&r.c(),e=empty()},m(a,u){r&&r.m(a,u),insert(a,e,u),n=!0,s||(i=listen(window,"keydown",o[2]),s=!0)},p(a,[u]){a[0]?r?(r.p(a,u),u&1&&transition_in(r,1)):(r=create_if_block$d(a),r.c(),transition_in(r,1),r.m(e.parentNode,e)):r&&(group_outros(),transition_out(r,1,1,()=>{r=null}),check_outros())},i(a){n||(transition_in(r),n=!0)},o(a){transition_out(r),n=!1},d(a){r&&r.d(a),a&&detach(e),s=!1,i()}}}function instance$n(o,e,n){let s,i,r;component_subscribe(o,store$3,d=>n(3,r=d));function a(d){d.key==="Escape"&&s&&s.reject()}const u=()=>{s.reject()},c=d=>s.resolve(d);return o.$$.update=()=>{o.$$.dirty&8&&n(0,s=r[0]),o.$$.dirty&1&&(s?isBrowser&&document.body.classList.add("overlay-visible"):isBrowser&&document.body.classList.remove("overlay-visible")),o.$$.dirty&1&&n(1,i=s&&(s.type==="success"||s.type==="warning"))},[s,i,a,r,u,c]}class AlertWrapper extends SvelteComponent{constructor(e){super();init(this,e,instance$n,create_fragment$q,safe_not_equal,{})}}const{store:store$2,createMessage}=createMessageStore(),createToast=createMessage;var aggregate=(o,...e)=>{const n=(i,r)=>{Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r).map(a=>a.toString())).forEach(a=>{a.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(r,a))})},s=class extends o{constructor(...r){super(...r);e.forEach(a=>n(this,new a))}};return e.forEach(i=>{n(s.prototype,i.prototype),n(s,i)}),s},convertHexToRGB=o=>{o[0]==="#"&&(o=o.replace("#","")),o.length===3&&(o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]);const e=o.match(/.{1,2}/g);return[parseInt(e[0],16)/255,parseInt(e[1],16)/255,parseInt(e[2],16)/255]};const tension=.4;function plotCBez(o,e,n,s,i,r,a,u,c,d){const f=i-n,h=a-i,m=c-a,_=r-s,g=u-r,v=d-u;let w,b,$,y,k=-1e4,N=-1e4;const S=[{x:n,y:s}];for(let C=1;C<o;C++){const E=C/o;w=n+f*E,$=i+h*E;const V=a+m*E;w+=($-w)*E,$+=(V-$)*E,b=s+_*E,y=r+g*E;const I=u+v*E;b+=(y-b)*E,y+=(I-y)*E;const R=w+($-w)*E,j=b+(y-b)*E,A=R-k,T=j-N;A*A+T*T>e&&(S.push({x:R,y:j}),k=R,N=j)}return S.push({x:c,y:d}),S}function computeControlPoints(o){const e=o.length-1;return o.map((n,s,i)=>{if(s===0)return{rx:i[s+1].x*tension*0,ry:n.y+(i[s+1].y-n.y)*tension*0};if(s===e)return{lx:i[s-1].x+(n.x-i[s-1].x)*tension*2,ly:i[s-1].y+(n.y-i[s-1].y)*tension*2};if(n.y>i[s+1].y&&n.y>i[s-1].y||n.y<i[s+1].y&&n.y<i[s-1].y)return{lx:i[s-1].x+(n.x-i[s-1].x)*tension,ly:n.y,rx:n.x+(i[s+1].x-n.x)*tension,ry:n.y};{const a={x:i[s-1].x-i[s+1].x,y:i[s-1].y-i[s+1].y},u=Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2));a.x/=u,a.y/=u;const c=i[s+1].x-n.x,d=n.x-i[s-1].x;return{lx:n.x+a.x*d*tension,ly:n.y+a.y*d*tension,rx:n.x-a.x*c*tension,ry:n.y-a.y*c*tension}}})}function toArray(o){const e=o.length-1,n={},s=computeControlPoints(o);return o.map((i,r,a)=>{if(r<e)return plotCBez(e*20,0,i.x,i.y,s[r].rx,s[r].ry,s[r+1].lx,s[r+1].ly,a[r+1].x,a[r+1].y)}).flat().filter(i=>!i||i.x in n?!1:(n[i.x]=!0,!0))}function debounce(o,e,n){let s;return(...i)=>{const r=()=>{s=null,n||o(...i)},a=n&&!s;clearTimeout(s),s=setTimeout(r,e),a&&o(...i)}}function Debounce(o,e=!1){return function(n,s,i){let r;const a=i.value;return i.value=function(...u){const c=()=>{r=null,e||a.apply(this,u)},d=e&&!r;clearTimeout(r),r=setTimeout(c,o),d&&a.apply(this,u)},i}}function throttle(o,e){let n,s,i,r=null,a=0;const u=()=>{a=0,r=null,i=o.apply(n,s),r||(n=s=null)};return function(){const c=Date.now();a||(a=c);const d=e-(c-a);return n=this,s=arguments,d<=0||d>e?(r&&(window.clearTimeout(r),r=null),a=c,i=o.apply(n,s),r||(n=s=null)):r||(r=window.setTimeout(u,d)),i}}const debug={amountEmitters:0,amountCallbacks:0,emitters:[]};typeof self!="undefined"&&"window"in self&&(window.debug=debug);class EventEmitter{constructor(){Z(this,"index",0);Z(this,"cbs",{});Z(this,"cbsOnce",{});this.index=debug.amountEmitters,debug.amountEmitters++}emit(e,n){e in this.cbs&&this.cbs[e].forEach(s=>s(n)),e in this.cbsOnce&&(this.cbsOnce[e].forEach(s=>s(n)),delete this.cbsOnce[e])}on(e,n,s=0){s>0&&(n=throttle(n,s));const i=Object.assign(this.cbs,{[e]:[...this.cbs[e]||[],n]});return this.cbs=i,debug.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(r=>[r,this.cbs[r].length]))},debug.amountCallbacks++,()=>{var r;debug.amountCallbacks--,(r=i[e])==null||r.splice(i[e].indexOf(n),1),debug.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(a=>[a,this.cbs[a].length]))}}}once(e,n){return this.cbsOnce[e]=[...this.cbsOnce[e]||[],n],()=>{this.cbsOnce[e].splice(this.cbsOnce[e].indexOf(n),1)}}destroyEventEmitter(){debug.amountEmitters--,Object.keys(this.cbs).forEach(e=>{debug.amountCallbacks-=this.cbs[e].length,delete this.cbs[e]}),Object.keys(this.cbsOnce).forEach(e=>delete this.cbsOnce[e]),this.cbs={},this.cbsOnce={},delete debug.emitters[this.index]}}function fastHash(o){if(o.length===0)return 0;let e=0;for(let n=0;n<o.length;n++)e=(e<<5)-e+o.charCodeAt(n),e=e&e;return e}var genId=()=>{const o={};let e=0;const n=(s=0,i=0)=>{if(i>500)throw new Error("Infinite loop in id generation algo");return s in o?n(Math.max(s++,e++),i+1):(o[s]=!0,s.toString())};return n.reset=()=>{Object.keys(o).forEach(s=>delete o[+s]),e=0},n};function groupArray(o,e){const n=[],s=o.length/e;for(let i=0;i<s;i++){const r=[];for(let a=0;a<e;a++)r[a]=o[i*e+a];n.push(r)}return n}const getPluralS=o=>o>1?"s":"",time=o=>{if(typeof o!="number"||isNaN(o))return"never";if(o<1e3)return"< 1 second";const e=Math.floor(o/1e3);if(e<60)return e+" second"+getPluralS(e);const n=Math.floor(e/60);if(n<60)return n+" minute"+getPluralS(n);const s=Math.floor(n/60);if(s<24)return s+" hour"+getPluralS(s);const i=Math.floor(s/24);if(i<7)return i+" day"+getPluralS(i);const r=Math.floor(i/7);if(r<30)return r+" week"+getPluralS(r);const a=Math.floor(r/30);if(a<12)return a+" month"+getPluralS(a);const u=Math.floor(a/12);if(u<10)return u+" year"+getPluralS(u);const c=Math.floor(a/10);return c+" decade"+getPluralS(c)};function memo(o){let e,n={length:NaN};const s=(i,r)=>i===n[r];return function(...r){return(r.length!==n.length||!r.every(s))&&(n=r,e=o.apply(this,r)),e}}const textureCache={},loadTexture=(o,e,n={})=>{if(textureCache[e])return textureCache[e];const s=new Texture(o,n),i=new Image;return textureCache[e]=s,i.onload=()=>{s.image=i},i.src=e,s};var loader={texture:loadTexture};let filters=[],level=2,longestName=0;const scopes={};let currentIndex=0;const colors=["#00ffff","#f0ffff","#f5f5dc","#000000","#0000ff","#a52a2a","#00ffff","#00008b","#008b8b","#a9a9a9","#006400","#bdb76b","#8b008b","#556b2f","#ff8c00","#9932cc","#8b0000","#e9967a","#9400d3","#ff00ff","#ffd700","#008000","#4b0082","#f0e68c","#add8e6","#e0ffff","#90ee90","#d3d3d3","#ffb6c1","#ffffe0","#00ff00","#ff00ff","#800000","#000080","#808000","#ffa500","#ffc0cb","#800080","#800080","#ff0000","#c0c0c0","#ffffff","#ffff00"];function log$8(o){longestName=Math.max(longestName,o.length);const e=currentIndex;scopes[o]=colors[currentIndex],currentIndex++;const n=(...s)=>{if((!filters.length||filters.includes(o))&&level===0){if(typeof s[0]=="string"&&typeof s[1]=="object"){console.groupCollapsed(`%c[${o.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,s[0]),console.log(...s.slice(1)),console.groupEnd();return}console.log(`%c[${o.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,...s)}};return n.group=(...s)=>{level<1&&console.groupCollapsed(`%c[${o.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,...s)},n.warn=(...s)=>{level<=1&&console.warn(`[${o.padEnd(longestName," ")}]`,...s)},n.error=s=>{console.error(`[${o.padEnd(longestName," ")}]`,s)},n}log$8.setFilter=(...o)=>{filters=o};log$8.setLevel=(o=0)=>{level=o};function memoize(o){const e={};return(...n)=>{const s=fastHash(JSON.stringify(n));return s in e?e[s]:e[s]=o(...n)}}const regex=/^(?:[ ]+)?(?:at )([^ ]*)?(?: )?(?:\[(.*?)\] )?(?:\(([^()]+)\))?$/gm,stripPath=o=>o.replace(window.location.href,"").replace(/^node_modules/,"").replace(/.+?(?=plantarium)plantarium\//,"");var parseStackTrace=o=>{const[e,...n]=o.split(`
`),[s,i]=e.split(":"),r=n.map(a=>{const u=[...a.matchAll(regex)][0],[,c,d,f]=u;return O(O({name:stripPath(c)},f?{location:stripPath(f)}:{}),d?{alias:d.trim().replace("as ","")}:{})});return{title:i,type:s,lines:r}},StackTrace_svelte_svelte_type_style_lang="";function get_each_context$a(o,e,n){const s=o.slice();return s[1]=e[n],s}function create_if_block$c(o){let e,n,s,i=o[0].type+"",r,a,u,c=o[0].title+"",d,f,h,m,_=o[0].lines,g=[];for(let v=0;v<_.length;v+=1)g[v]=create_each_block$a(get_each_context$a(o,_,v));return{c(){e=element("div"),n=element("p"),s=element("b"),r=text(i),a=text(":"),u=space(),d=text(c),f=space(),h=element("pre"),m=element("code");for(let v=0;v<g.length;v+=1)g[v].c();attr(h,"class","svelte-1e5rtbs"),attr(e,"class","wrapper svelte-1e5rtbs")},m(v,w){insert(v,e,w),append(e,n),append(n,s),append(s,r),append(s,a),append(n,u),append(n,d),append(e,f),append(e,h),append(h,m);for(let b=0;b<g.length;b+=1)g[b].m(m,null)},p(v,w){if(w&1&&i!==(i=v[0].type+"")&&set_data(r,i),w&1&&c!==(c=v[0].title+"")&&set_data(d,c),w&1){_=v[0].lines;let b;for(b=0;b<_.length;b+=1){const $=get_each_context$a(v,_,b);g[b]?g[b].p($,w):(g[b]=create_each_block$a($),g[b].c(),g[b].m(m,null))}for(;b<g.length;b+=1)g[b].d(1);g.length=_.length}},d(v){v&&detach(e),destroy_each(g,v)}}}function create_if_block_2$4(o){let e,n,s,i=o[1].alias+"",r;return{c(){e=text("as "),n=element("strong"),s=text("$"),r=text(i)},m(a,u){insert(a,e,u),insert(a,n,u),append(n,s),append(n,r)},p(a,u){u&1&&i!==(i=a[1].alias+"")&&set_data(r,i)},d(a){a&&detach(e),a&&detach(n)}}}function create_if_block_1$7(o){let e,n,s=o[1].location+"",i,r;return{c(){e=text("\xA0("),n=element("i"),i=text(s),r=text(")")},m(a,u){insert(a,e,u),insert(a,n,u),append(n,i),insert(a,r,u)},p(a,u){u&1&&s!==(s=a[1].location+"")&&set_data(i,s)},d(a){a&&detach(e),a&&detach(n),a&&detach(r)}}}function create_each_block$a(o){let e,n,s=o[1].name+"",i,r,a,u=o[1].alias&&create_if_block_2$4(o),c=o[1].location&&create_if_block_1$7(o);return{c(){e=text("at "),n=element("strong"),i=text(s),u&&u.c(),r=empty(),c&&c.c(),a=element("br")},m(d,f){insert(d,e,f),insert(d,n,f),append(n,i),u&&u.m(d,f),insert(d,r,f),c&&c.m(d,f),insert(d,a,f)},p(d,f){f&1&&s!==(s=d[1].name+"")&&set_data(i,s),d[1].alias?u?u.p(d,f):(u=create_if_block_2$4(d),u.c(),u.m(r.parentNode,r)):u&&(u.d(1),u=null),d[1].location?c?c.p(d,f):(c=create_if_block_1$7(d),c.c(),c.m(a.parentNode,a)):c&&(c.d(1),c=null)},d(d){d&&detach(e),d&&detach(n),u&&u.d(d),d&&detach(r),c&&c.d(d),d&&detach(a)}}}function create_fragment$p(o){let e,n=o[0]&&create_if_block$c(o);return{c(){n&&n.c(),e=empty()},m(s,i){n&&n.m(s,i),insert(s,e,i)},p(s,[i]){s[0]?n?n.p(s,i):(n=create_if_block$c(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:noop,o:noop,d(s){n&&n.d(s),s&&detach(e)}}}function instance$m(o,e,n){let{stacktrace:s}=e;return o.$$set=i=>{"stacktrace"in i&&n(0,s=i.stacktrace)},[s]}class StackTrace extends SvelteComponent{constructor(e){super();init(this,e,instance$m,create_fragment$p,safe_not_equal,{stacktrace:0})}}var Toast_svelte_svelte_type_style_lang="";function get_each_context$9(o,e,n){const s=o.slice();return s[13]=e[n],s}function create_if_block$b(o){let e,n,s,i,r,a,u,c,d,f,h,m,_,g,v,w,b,$,y,k,N,S,C=o[6]&&create_if_block_9(o),E=o[0].title&&create_if_block_8(o);const V=[create_if_block_4$1,create_if_block_5,create_if_block_7],I=[];function R(T,D){return typeof T[0].content=="string"?0:T[0].content instanceof Error?1:T[0].content instanceof SvelteComponentDev?2:-1}~(u=R(o))&&(c=I[u]=V[u](o));let j=o[0].content instanceof Error&&create_if_block_3$1(o),A=o[0].values&&create_if_block_1$6(o);return g=new Icon({props:{name:"cross"}}),{c(){e=element("div"),n=element("div"),s=element("div"),C&&C.c(),i=space(),r=element("div"),E&&E.c(),a=space(),c&&c.c(),d=space(),f=element("div"),j&&j.c(),h=space(),A&&A.c(),m=space(),_=element("div"),v=element("div"),create_component(g.$$.fragment),w=space(),b=element("div"),attr(f,"class","button-wrapper svelte-bnz79m"),attr(r,"class","toast-text svelte-bnz79m"),set_style(v,"display","contents"),set_style(v,"--height","fit-content"),attr(_,"class","toast-close svelte-bnz79m"),attr(s,"class","toast-content svelte-bnz79m"),toggle_class(s,"hasIcon",!!o[6]),attr(b,"style",$=`transition: width ${o[0].timeout}ms linear;`),attr(b,"class","toast-progress svelte-bnz79m"),toggle_class(b,"animateProgress",o[2]),attr(n,"class",y="toast toast-"+o[0].type+" svelte-bnz79m"),toggle_class(n,"isInverted",o[5]),attr(e,"class","wrapper svelte-bnz79m")},m(T,D){insert(T,e,D),append(e,n),append(n,s),C&&C.m(s,null),append(s,i),append(s,r),E&&E.m(r,null),append(r,a),~u&&I[u].m(r,null),append(r,d),append(r,f),j&&j.m(f,null),append(f,h),A&&A.m(f,null),append(s,m),append(s,_),append(_,v),mount_component(g,v,null),append(n,w),append(n,b),o[11](e),k=!0,N||(S=listen(_,"click",o[10]),N=!0)},p(T,D){T[6]?C?(C.p(T,D),D&64&&transition_in(C,1)):(C=create_if_block_9(T),C.c(),transition_in(C,1),C.m(s,i)):C&&(group_outros(),transition_out(C,1,1,()=>{C=null}),check_outros()),T[0].title?E?E.p(T,D):(E=create_if_block_8(T),E.c(),E.m(r,a)):E&&(E.d(1),E=null);let G=u;u=R(T),u===G?~u&&I[u].p(T,D):(c&&(group_outros(),transition_out(I[G],1,1,()=>{I[G]=null}),check_outros()),~u?(c=I[u],c?c.p(T,D):(c=I[u]=V[u](T),c.c()),transition_in(c,1),c.m(r,d)):c=null),T[0].content instanceof Error?j?(j.p(T,D),D&1&&transition_in(j,1)):(j=create_if_block_3$1(T),j.c(),transition_in(j,1),j.m(f,h)):j&&(group_outros(),transition_out(j,1,1,()=>{j=null}),check_outros()),T[0].values?A?(A.p(T,D),D&1&&transition_in(A,1)):(A=create_if_block_1$6(T),A.c(),transition_in(A,1),A.m(f,null)):A&&(group_outros(),transition_out(A,1,1,()=>{A=null}),check_outros()),D&64&&toggle_class(s,"hasIcon",!!T[6]),(!k||D&1&&$!==($=`transition: width ${T[0].timeout}ms linear;`))&&attr(b,"style",$),D&4&&toggle_class(b,"animateProgress",T[2]),(!k||D&1&&y!==(y="toast toast-"+T[0].type+" svelte-bnz79m"))&&attr(n,"class",y),D&33&&toggle_class(n,"isInverted",T[5])},i(T){k||(transition_in(C),transition_in(c),transition_in(j),transition_in(A),transition_in(g.$$.fragment,T),k=!0)},o(T){transition_out(C),transition_out(c),transition_out(j),transition_out(A),transition_out(g.$$.fragment,T),k=!1},d(T){T&&detach(e),C&&C.d(),E&&E.d(),~u&&I[u].d(),j&&j.d(),A&&A.d(),destroy_component(g),o[11](null),N=!1,S()}}}function create_if_block_9(o){let e,n,s,i;return n=new Icon({props:{name:o[6],circle:!0}}),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--width","40px"),set_style(s,"--height","40px"),attr(e,"class","toast-icon svelte-bnz79m")},m(r,a){insert(r,e,a),append(e,s),mount_component(n,s,null),i=!0},p(r,a){const u={};a&64&&(u.name=r[6]),n.$set(u)},i(r){i||(transition_in(n.$$.fragment,r),i=!0)},o(r){transition_out(n.$$.fragment,r),i=!1},d(r){r&&detach(e),destroy_component(n)}}}function create_if_block_8(o){let e,n=o[0].title+"",s;return{c(){e=element("h3"),s=text(n),attr(e,"class","svelte-bnz79m")},m(i,r){insert(i,e,r),append(e,s)},p(i,r){r&1&&n!==(n=i[0].title+"")&&set_data(s,n)},d(i){i&&detach(e)}}}function create_if_block_7(o){let e,n,s;var i=o[0].content;function r(a){return{}}return i&&(e=new i(r())),{c(){e&&create_component(e.$$.fragment),n=empty()},m(a,u){e&&mount_component(e,a,u),insert(a,n,u),s=!0},p(a,u){if(i!==(i=a[0].content)){if(e){group_outros();const c=e;transition_out(c.$$.fragment,1,0,()=>{destroy_component(c,1)}),check_outros()}i?(e=new i(r()),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,n.parentNode,n)):e=null}},i(a){s||(e&&transition_in(e.$$.fragment,a),s=!0)},o(a){e&&transition_out(e.$$.fragment,a),s=!1},d(a){a&&detach(n),e&&destroy_component(e,a)}}}function create_if_block_5(o){let e,n=o[0].content.message+"",s,i,r,a,u=o[3]&&create_if_block_6(o);return{c(){e=element("p"),s=text(n),i=space(),u&&u.c(),r=empty(),attr(e,"class","svelte-bnz79m")},m(c,d){insert(c,e,d),append(e,s),insert(c,i,d),u&&u.m(c,d),insert(c,r,d),a=!0},p(c,d){(!a||d&1)&&n!==(n=c[0].content.message+"")&&set_data(s,n),c[3]?u?(u.p(c,d),d&8&&transition_in(u,1)):(u=create_if_block_6(c),u.c(),transition_in(u,1),u.m(r.parentNode,r)):u&&(group_outros(),transition_out(u,1,1,()=>{u=null}),check_outros())},i(c){a||(transition_in(u),a=!0)},o(c){transition_out(u),a=!1},d(c){c&&detach(e),c&&detach(i),u&&u.d(c),c&&detach(r)}}}function create_if_block_4$1(o){let e,n=o[0].content+"";return{c(){e=element("p"),attr(e,"class","svelte-bnz79m")},m(s,i){insert(s,e,i),e.innerHTML=n},p(s,i){i&1&&n!==(n=s[0].content+"")&&(e.innerHTML=n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_if_block_6(o){let e,n,s,i;return n=new StackTrace({props:{stacktrace:parseStackTrace(o[0].content.stack)}}),{c(){e=element("div"),create_component(n.$$.fragment),attr(e,"class","stack-trace svelte-bnz79m")},m(r,a){insert(r,e,a),mount_component(n,e,null),i=!0},p(r,a){const u={};a&1&&(u.stacktrace=parseStackTrace(r[0].content.stack)),n.$set(u)},i(r){i||(transition_in(n.$$.fragment,r),add_render_callback(()=>{s||(s=create_bidirectional_transition(e,slide,{},!0)),s.run(1)}),i=!0)},o(r){transition_out(n.$$.fragment,r),s||(s=create_bidirectional_transition(e,slide,{},!1)),s.run(0),i=!1},d(r){r&&detach(e),destroy_component(n),r&&s&&s.end()}}}function create_if_block_3$1(o){let e,n,s,i;return e=new Button({props:{name:"> StackTrace"}}),e.$on("click",o[7]),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--margin","5px 10px 5px -10px"),set_style(n,"--text",s=o[5]?"#1a1a1a":"white"),set_style(n,"--bg","transparent")},m(r,a){insert(r,n,a),mount_component(e,n,null),i=!0},p(r,a){a&32&&s!==(s=r[5]?"#1a1a1a":"white")&&set_style(n,"--text",s)},i(r){i||(transition_in(e.$$.fragment,r),i=!0)},o(r){transition_out(e.$$.fragment,r),i=!1},d(r){r&&detach(n),destroy_component(e,r)}}}function create_if_block_1$6(o){let e,n,s=o[0].values,i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$9(get_each_context$9(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();e=empty()},m(a,u){for(let c=0;c<i.length;c+=1)i[c].m(a,u);insert(a,e,u),n=!0},p(a,u){if(u&49){s=a[0].values;let c;for(c=0;c<s.length;c+=1){const d=get_each_context$9(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$9(d),i[c].c(),transition_in(i[c],1),i[c].m(e.parentNode,e))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){destroy_each(i,a),a&&detach(e)}}}function create_else_block$5(o){let e,n,s,i,r;function a(){return o[9](o[13])}return e=new Button({props:{name:o[13]}}),e.$on("click",a),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--margin","5px 10px 5px 0"),set_style(n,"--text",s=o[5]?"white":"#1a1a1a"),set_style(n,"--bg",i=o[5]?"#1a1a1a":"white")},m(u,c){insert(u,n,c),mount_component(e,n,null),r=!0},p(u,c){o=u,c&32&&s!==(s=o[5]?"white":"#1a1a1a")&&set_style(n,"--text",s),c&32&&i!==(i=o[5]?"#1a1a1a":"white")&&set_style(n,"--bg",i);const d={};c&1&&(d.name=o[13]),e.$set(d)},i(u){r||(transition_in(e.$$.fragment,u),r=!0)},o(u){transition_out(e.$$.fragment,u),r=!1},d(u){u&&detach(n),destroy_component(e,u)}}}function create_if_block_2$3(o){let e,n,s,i;function r(){return o[8](o[13])}return{c(){e=element("plant-button"),set_custom_element_data(e,"name",n=o[13])},m(a,u){insert(a,e,u),s||(i=listen(e,"click",r),s=!0)},p(a,u){o=a,u&1&&n!==(n=o[13])&&set_custom_element_data(e,"name",n)},i:noop,o:noop,d(a){a&&detach(e),s=!1,i()}}}function create_each_block$9(o){let e,n,s,i,r;const a=[create_if_block_2$3,create_else_block$5],u=[];function c(d,f){return d[4]?0:1}return n=c(o),s=u[n]=a[n](o),{c(){e=element("div"),s.c(),i=space(),attr(e,"class","button-spacer svelte-bnz79m")},m(d,f){insert(d,e,f),u[n].m(e,null),append(e,i),r=!0},p(d,f){let h=n;n=c(d),n===h?u[n].p(d,f):(group_outros(),transition_out(u[h],1,1,()=>{u[h]=null}),check_outros(),s=u[n],s?s.p(d,f):(s=u[n]=a[n](d),s.c()),transition_in(s,1),s.m(e,i))},i(d){r||(transition_in(s),r=!0)},o(d){transition_out(s),r=!1},d(d){d&&detach(e),u[n].d()}}}function create_fragment$o(o){let e,n,s=o[0]&&create_if_block$b(o);return{c(){s&&s.c(),e=empty()},m(i,r){s&&s.m(i,r),insert(i,e,r),n=!0},p(i,[r]){i[0]?s?(s.p(i,r),r&1&&transition_in(s,1)):(s=create_if_block$b(i),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(i){n||(transition_in(s),n=!0)},o(i){transition_out(s),n=!1},d(i){s&&s.d(i),i&&detach(e)}}}function instance$l(o,e,n){let s,i,{toast:r}=e,a=!1,u=!1;function c(){if(r.type===MessageType$1.ERROR)return"warning";if(r.type===MessageType$1.SUCCESS)return"checkmark";if(r.type===MessageType$1.WARNING)return"exclamation"}let d=!1,f;onMount(()=>{setTimeout(()=>{n(2,a=!0)},10)});const h=()=>{n(3,u=!u)},m=w=>r.resolve(w),_=w=>r.resolve(w),g=()=>r.reject();function v(w){binding_callbacks[w?"unshift":"push"](()=>{f=w,n(1,f)})}return o.$$set=w=>{"toast"in w&&n(0,r=w.toast)},o.$$.update=()=>{o.$$.dirty&1&&n(6,s=r&&c()),o.$$.dirty&1&&n(5,i=r&&(r.type==="success"||r.type==="warning")),o.$$.dirty&2&&n(4,d=f&&!f.parentElement)},[r,f,a,u,d,i,s,h,m,_,g,v]}class Toast extends SvelteComponent{constructor(e){super();init(this,e,instance$l,create_fragment$o,safe_not_equal,{toast:0})}}var ToastWrapper_svelte_svelte_type_style_lang="";function get_each_context$8(o,e,n){const s=o.slice();return s[4]=e[n],s}function create_else_block$4(o){let e,n;return e=new Toast({props:{toast:o[4]}}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&4&&(r.toast=s[4]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_if_block$a(o){let e,n;return{c(){e=element("plant-toast"),set_custom_element_data(e,"toast",n=o[4])},m(s,i){insert(s,e,i)},p(s,i){i&4&&n!==(n=s[4])&&set_custom_element_data(e,"toast",n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_each_block$8(o,e){let n,s,i,r,a,u;const c=[create_if_block$a,create_else_block$4],d=[];function f(h,m){return h[0]?0:1}return s=f(e),i=d[s]=c[s](e),{key:o,first:null,c(){n=element("div"),i.c(),r=space(),this.first=n},m(h,m){insert(h,n,m),d[s].m(n,null),append(n,r),u=!0},p(h,m){e=h;let _=s;s=f(e),s===_?d[s].p(e,m):(group_outros(),transition_out(d[_],1,1,()=>{d[_]=null}),check_outros(),i=d[s],i?i.p(e,m):(i=d[s]=c[s](e),i.c()),transition_in(i,1),i.m(n,r))},i(h){u||(transition_in(i),add_render_callback(()=>{a||(a=create_bidirectional_transition(n,slide,{easing:backInOut},!0)),a.run(1)}),u=!0)},o(h){transition_out(i),a||(a=create_bidirectional_transition(n,slide,{easing:backInOut},!1)),a.run(0),u=!1},d(h){h&&detach(n),d[s].d(),h&&a&&a.end()}}}function create_fragment$n(o){let e,n=[],s=new Map,i,r=o[2];const a=u=>u[4].id;for(let u=0;u<r.length;u+=1){let c=get_each_context$8(o,r,u),d=a(c);s.set(d,n[u]=create_each_block$8(d,c))}return{c(){e=element("div");for(let u=0;u<n.length;u+=1)n[u].c();attr(e,"id","toast-wrapper"),attr(e,"class","svelte-1ujlok7")},m(u,c){insert(u,e,c);for(let d=0;d<n.length;d+=1)n[d].m(e,null);o[3](e),i=!0},p(u,[c]){c&5&&(r=u[2],group_outros(),n=update_keyed_each(n,c,a,1,u,r,s,e,outro_and_destroy_block,create_each_block$8,null,get_each_context$8),check_outros())},i(u){if(!i){for(let c=0;c<r.length;c+=1)transition_in(n[c]);i=!0}},o(u){for(let c=0;c<n.length;c+=1)transition_out(n[c]);i=!1},d(u){u&&detach(e);for(let c=0;c<n.length;c+=1)n[c].d();o[3](null)}}}function instance$k(o,e,n){let s;component_subscribe(o,store$2,u=>n(2,s=u));let i=!1,r;onMount(function(){n(0,i=!r.parentElement)});function a(u){binding_callbacks[u?"unshift":"push"](()=>{r=u,n(1,r)})}return[i,r,s,a]}class ToastWrapper extends SvelteComponent{constructor(e){super();init(this,e,instance$k,create_fragment$n,safe_not_equal,{})}}var InputCheckbox_svelte_svelte_type_style_lang="";function create_fragment$m(o){let e,n,s,i,r,a,u,c,d,f,h;return{c(){e=element("div"),n=element("input"),s=space(),i=element("label"),r=svg_element("svg"),a=svg_element("title"),u=text("cross"),c=svg_element("line"),d=svg_element("line"),attr(n,"type","checkbox"),attr(n,"id",o[1]),attr(n,"class","svelte-5ggwpz"),attr(a,"class","svelte-5ggwpz"),attr(c,"vector-effect","non-scaling-stroke"),attr(c,"x1","0"),attr(c,"y1","100"),attr(c,"x2","100"),attr(c,"y2","0"),attr(c,"class","svelte-5ggwpz"),attr(d,"vector-effect","non-scaling-stroke"),attr(d,"x1","0"),attr(d,"y1","0"),attr(d,"x2","100"),attr(d,"y2","100"),attr(d,"class","svelte-5ggwpz"),attr(r,"xmlns","http://www.w3.org/2000/svg"),attr(r,"viewBox","0 0 100 100"),attr(r,"class","svelte-5ggwpz"),attr(i,"class","checkbox-label svelte-5ggwpz"),attr(i,"for",o[1]),attr(e,"class","component-wrapper svelte-5ggwpz")},m(m,_){insert(m,e,_),append(e,n),n.checked=o[0],append(e,s),append(e,i),append(i,r),append(r,a),append(a,u),append(r,c),append(r,d),f||(h=listen(n,"change",o[2]),f=!0)},p(m,[_]){_&2&&attr(n,"id",m[1]),_&1&&(n.checked=m[0]),_&2&&attr(i,"for",m[1])},i:noop,o:noop,d(m){m&&detach(e),f=!1,h()}}}function instance$j(o,e,n){const s=createEventDispatcher();let{value:i=!1}=e,{id:r=shortid()}=e;function a(){i=this.checked,n(0,i)}return o.$$set=u=>{"value"in u&&n(0,i=u.value),"id"in u&&n(1,r=u.id)},o.$$.update=()=>{o.$$.dirty&1&&i!==void 0&&s("change",!!i)},[i,r,a]}class InputCheckbox extends SvelteComponent{constructor(e){super();init(this,e,instance$j,create_fragment$m,safe_not_equal,{value:0,id:1})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get id(){return this.$$.ctx[1]}set id(e){this.$$set({id:e}),flush()}}var InputColor_svelte_svelte_type_style_lang="",InputCurve_svelte_svelte_type_style_lang="";function get_each_context$7(o,e,n){const s=o.slice();return s[19]=e[n],s[21]=n,s}function get_each_context_1(o,e,n){const s=o.slice();return s[19]=e[n],s}function create_each_block_1(o){let e,n,s,i,r;function a(){return o[10](o[19])}return{c(){e=svg_element("circle"),attr(e,"cx",n=o[19].x*100),attr(e,"cy",s=o[19].y*100),attr(e,"r","2"),attr(e,"class","svelte-ag1nlf"),toggle_class(e,"pinned",o[19].pinned)},m(u,c){insert(u,e,c),i||(r=listen(e,"mousedown",a),i=!0)},p(u,c){o=u,c&1&&n!==(n=o[19].x*100)&&attr(e,"cx",n),c&1&&s!==(s=o[19].y*100)&&attr(e,"cy",s),c&1&&toggle_class(e,"pinned",o[19].pinned)},d(u){u&&detach(e),i=!1,r()}}}function create_if_block$9(o){let e,n,s,i,r;return{c(){e=svg_element("line"),attr(e,"x1",n=o[3][o[21]-1].x*100),attr(e,"y1",s=o[3][o[21]-1].y*100),attr(e,"x2",i=o[19].x*100),attr(e,"y2",r=o[19].y*100),attr(e,"class","svelte-ag1nlf")},m(a,u){insert(a,e,u)},p:noop,d(a){a&&detach(e)}}}function create_each_block$7(o){let e,n,s,i=o[21]>0&&o[21]%2==0&&create_if_block$9(o);return{c(){i&&i.c(),e=svg_element("circle"),attr(e,"cx",n=o[19].x*100),attr(e,"cy",s=o[19].y*100),attr(e,"r","1"),attr(e,"class","svelte-ag1nlf"),toggle_class(e,"pinned",o[19].pinned)},m(r,a){i&&i.m(r,a),insert(r,e,a)},p(r,a){r[21]>0&&r[21]%2==0&&i.p(r,a)},d(r){i&&i.d(r),r&&detach(e)}}}function create_fragment$l(o){let e,n,s,i,r,a,u=o[0],c=[];for(let h=0;h<u.length;h+=1)c[h]=create_each_block_1(get_each_context_1(o,u,h));let d=o[3],f=[];for(let h=0;h<d.length;h+=1)f[h]=create_each_block$7(get_each_context$7(o,d,h));return{c(){e=element("div"),n=svg_element("svg"),s=svg_element("path");for(let h=0;h<c.length;h+=1)c[h].c();i=svg_element("g");for(let h=0;h<f.length;h+=1)f[h].c();attr(s,"d",o[2]),attr(s,"fill","none"),attr(s,"stroke","grey"),attr(s,"class","svelte-ag1nlf"),attr(i,"id","debug"),attr(i,"class","svelte-ag1nlf"),attr(n,"viewBox","0 0 100 100"),attr(n,"width","100"),attr(n,"height","100"),attr(n,"class","svelte-ag1nlf"),attr(e,"class","component-wrapper svelte-ag1nlf")},m(h,m){insert(h,e,m),append(e,n),append(n,s);for(let _=0;_<c.length;_+=1)c[_].m(n,null);append(n,i);for(let _=0;_<f.length;_+=1)f[_].m(i,null);r||(a=[listen(n,"mousedown",o[5]),listen(n,"mousemove",o[4]),listen(n,"mouseover",o[7]),listen(n,"mouseout",o[8]),listen(n,"mouseup",o[6]),listen(n,"focus",o[7]),listen(n,"blur",o[8])],r=!0)},p(h,[m]){if(m&4&&attr(s,"d",h[2]),m&3){u=h[0];let _;for(_=0;_<u.length;_+=1){const g=get_each_context_1(h,u,_);c[_]?c[_].p(g,m):(c[_]=create_each_block_1(g),c[_].c(),c[_].m(n,i))}for(;_<c.length;_+=1)c[_].d(1);c.length=u.length}if(m&8){d=h[3];let _;for(_=0;_<d.length;_+=1){const g=get_each_context$7(h,d,_);f[_]?f[_].p(g,m):(f[_]=create_each_block$7(g),f[_].c(),f[_].m(i,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=d.length}},i:noop,o:noop,d(h){h&&detach(e),destroy_each(c,h),destroy_each(f,h),r=!1,run_all(a)}}}function instance$i(o,e,n){let s,i;const r=createEventDispatcher();let{value:a=[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}=e,u=!1,c,d,f=0,h=0,m=[];const _=()=>{requestAnimationFrame(()=>{r("change",s),n(0,s=s.sort((S,C)=>S.x>C.x?-1:1))})},g=S=>{S.pinned||(s.splice(s.indexOf(c),1),_())},v=S=>{u&&(f=S.offsetX,h=S.offsetY,c&&(d=c,n(1,c=void 0)),d&&(d.x=f/100,d.y=h/100,_()))},w=()=>{if(!c){const S={x:f/100,y:h/100,pinned:!1};n(1,c=S),s.push(c),_()}},b=()=>{c&&(g(c),n(1,c=void 0)),d=void 0},$=()=>{u=!0},y=()=>{u=!1};function k(S){const C=monotoneCubicSpline.points(S.map(E=>[E.x*100,E.y*100]));return monotoneCubicSpline.svgPath(C)}const N=S=>{n(1,c=S)};return o.$$set=S=>{"value"in S&&n(9,a=S.value)},o.$$.update=()=>{o.$$.dirty&512&&n(0,s=a),o.$$.dirty&1&&n(2,i=k(s))},[s,c,i,m,v,w,b,$,y,a,N]}class InputCurve extends SvelteComponent{constructor(e){super();init(this,e,instance$i,create_fragment$l,safe_not_equal,{value:9})}get value(){return this.$$.ctx[9]}set value(e){this.$$set({value:e}),flush()}}var InputInteger_svelte_svelte_type_style_lang="";function create_if_block$8(o){let e,n;return{c(){e=element("span"),attr(e,"class","overlay svelte-1f8wej8"),attr(e,"style",n=`width: ${(o[0]-o[1])/(o[2]-o[1])*100}%`)},m(s,i){insert(s,e,i)},p(s,i){i&7&&n!==(n=`width: ${(s[0]-s[1])/(s[2]-s[1])*100}%`)&&attr(e,"style",n)},d(s){s&&detach(e)}}}function create_fragment$k(o){let e,n,s,i,r,a,u,c,d,f,h=typeof o[1]!="undefined"&&typeof o[2]!="undefined"&&create_if_block$8(o);return{c(){e=element("div"),h&&h.c(),n=space(),s=element("button"),s.textContent="-",i=space(),r=element("input"),u=space(),c=element("button"),c.textContent="+",attr(s,"class","svelte-1f8wej8"),attr(r,"step",o[3]),attr(r,"max",o[2]),attr(r,"min",o[1]),attr(r,"type","number"),attr(r,"style",a=`width:${o[5]};`),attr(r,"class","svelte-1f8wej8"),attr(c,"class","svelte-1f8wej8"),attr(e,"class","component-wrapper svelte-1f8wej8")},m(m,_){insert(m,e,_),h&&h.m(e,null),append(e,n),append(e,s),append(e,i),append(e,r),set_input_value(r,o[0]),o[11](r),append(e,u),append(e,c),d||(f=[listen(s,"click",o[9]),listen(r,"input",o[10]),listen(r,"mousedown",o[7]),listen(r,"mouseup",o[8]),listen(c,"click",o[12])],d=!0)},p(m,[_]){typeof m[1]!="undefined"&&typeof m[2]!="undefined"?h?h.p(m,_):(h=create_if_block$8(m),h.c(),h.m(e,n)):h&&(h.d(1),h=null),_&8&&attr(r,"step",m[3]),_&4&&attr(r,"max",m[2]),_&2&&attr(r,"min",m[1]),_&32&&a!==(a=`width:${m[5]};`)&&attr(r,"style",a),_&1&&to_number(r.value)!==m[0]&&set_input_value(r,m[0])},i:noop,o:noop,d(m){m&&detach(e),h&&h.d(),o[11](null),d=!1,run_all(f)}}}function instance$h(o,e,n){let s,i;const r=createEventDispatcher();let{min:a=-1/0}=e,{max:u=1/0}=e,{step:c=1}=e,{value:d=0}=e,f;function h(S){n(0,d=Math.max(a,Math.min(+d+S,u)))}let m=0,_=0,g;function v(S){S.preventDefault(),_=d,m=S.clientX,g=f.getBoundingClientRect(),window.removeEventListener("mousemove",b),window.addEventListener("mousemove",b),window.addEventListener("mouseup",w),document.body.style.cursor="ew-resize"}function w(){_===d?f.focus():f.blur(),document.body.style.cursor="unset",window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",b)}function b(S){if(s){const C=(S.clientX-g.left)/g.width;n(0,d=Math.max(Math.min(Math.floor(a+(u-a)*C),u),a))}else{const C=S.clientX-m;n(0,d=_+Math.floor(C/10))}}const $=()=>h(-c);function y(){d=to_number(this.value),n(0,d)}function k(S){binding_callbacks[S?"unshift":"push"](()=>{f=S,n(4,f)})}const N=()=>h(+c);return o.$$set=S=>{"min"in S&&n(1,a=S.min),"max"in S&&n(2,u=S.max),"step"in S&&n(3,c=S.step),"value"in S&&n(0,d=S.value)},o.$$.update=()=>{var S;o.$$.dirty&6&&(s=typeof a!="undefined"&&typeof u!="undefined"&&Number.isFinite(a)&&Number.isFinite(u)),o.$$.dirty&1&&d!==void 0&&r("change",parseFloat(d+"")),o.$$.dirty&1&&n(5,i=Number.isFinite(d)?Math.max(((S=d==null?void 0:d.toString().length)!=null?S:1)*8,30)+"px":"20px")},[d,a,u,c,f,i,h,v,w,$,y,k,N]}class InputInteger extends SvelteComponent{constructor(e){super();init(this,e,instance$h,create_fragment$k,safe_not_equal,{min:1,max:2,step:3,value:0})}get min(){return this.$$.ctx[1]}set min(e){this.$$set({min:e}),flush()}get max(){return this.$$.ctx[2]}set max(e){this.$$set({max:e}),flush()}get step(){return this.$$.ctx[3]}set step(e){this.$$set({step:e}),flush()}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}}var InputFloat_svelte_svelte_type_style_lang="";function create_fragment$j(o){let e,n,s,i,r,a,u,c;return{c(){e=element("div"),n=element("span"),i=space(),r=element("input"),attr(n,"class","overlay svelte-19eeb1g"),attr(n,"style",s=`width: ${(o[0]-o[2])/(o[3]-o[2])*100}%`),attr(r,"step",o[1]),attr(r,"max",o[3]),attr(r,"min",o[2]),attr(r,"type","number"),attr(r,"style",a=`width:${o[6]};`),attr(r,"class","svelte-19eeb1g"),attr(e,"class","component-wrapper svelte-19eeb1g"),toggle_class(e,"is-down",o[5])},m(d,f){insert(d,e,f),append(e,n),append(e,i),append(e,r),set_input_value(r,o[0]),o[10](r),u||(c=[listen(r,"input",o[9]),listen(r,"mousedown",o[7]),listen(r,"mouseup",o[8])],u=!0)},p(d,[f]){f&13&&s!==(s=`width: ${(d[0]-d[2])/(d[3]-d[2])*100}%`)&&attr(n,"style",s),f&2&&attr(r,"step",d[1]),f&8&&attr(r,"max",d[3]),f&4&&attr(r,"min",d[2]),f&64&&a!==(a=`width:${d[6]};`)&&attr(r,"style",a),f&1&&to_number(r.value)!==d[0]&&set_input_value(r,d[0]),f&32&&toggle_class(e,"is-down",d[5])},i:noop,o:noop,d(d){d&&detach(e),o[10](null),u=!1,run_all(c)}}}function strip(o){return parseFloat(o).toPrecision(2)}function instance$g(o,e,n){let s,{value:i=.5}=e,{step:r=.01}=e,{min:a=0}=e,{max:u=1}=e;const c=createEventDispatcher();let d,f=!1,h=0,m=0,_=0,g;function v(k){k.preventDefault(),n(5,f=!0),m=i,h=k.clientY,g=d.getBoundingClientRect(),window.removeEventListener("mousemove",b),window.addEventListener("mousemove",b),window.addEventListener("mouseup",w),document.body.style.cursor="ew-resize"}function w(){n(5,f=!1),m===i&&d.focus(),document.body.style.cursor="unset",window.removeEventListener("mouseup",w),window.removeEventListener("mousemove",b)}function b(k){_=(k.clientX-g.left)/g.width,k.clientY-h,n(0,i=Math.max(Math.min(a+(u-a)*_,u),a))}function $(){i=to_number(this.value),n(0,i)}function y(k){binding_callbacks[k?"unshift":"push"](()=>{d=k,n(4,d)})}return o.$$set=k=>{"value"in k&&n(0,i=k.value),"step"in k&&n(1,r=k.step),"min"in k&&n(2,a=k.min),"max"in k&&n(3,u=k.max)},o.$$.update=()=>{var k;o.$$.dirty&1&&i.toString().length>15&&n(0,i=strip(i)),o.$$.dirty&1&&i!==void 0&&c("change",parseFloat(i+"")),o.$$.dirty&1&&n(6,s=Number.isFinite(i)?Math.max(((k=i==null?void 0:i.toString().length)!=null?k:1)*8,50)+"px":"20px")},[i,r,a,u,d,f,s,v,w,$,y]}class InputFloat extends SvelteComponent{constructor(e){super();init(this,e,instance$g,create_fragment$j,safe_not_equal,{value:0,step:1,min:2,max:3})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get step(){return this.$$.ctx[1]}set step(e){this.$$set({step:e}),flush()}get min(){return this.$$.ctx[2]}set min(e){this.$$set({min:e}),flush()}get max(){return this.$$.ctx[3]}set max(e){this.$$set({max:e}),flush()}}var InputSelect_svelte_svelte_type_style_lang="";function get_each_context$6(o,e,n){const s=o.slice();return s[11]=e[n],s}function create_else_block$3(o){let e,n,s;return{c(){e=element("div"),e.textContent="none",attr(e,"id","selected-value"),attr(e,"class","svelte-13uimdf")},m(i,r){insert(i,e,r),n||(s=listen(e,"click",o[4]),n=!0)},p:noop,d(i){i&&detach(e),n=!1,s()}}}function create_if_block_1$5(o){let e,n,s,i;return{c(){e=element("div"),n=text(o[0]),attr(e,"id","selected-value"),attr(e,"class","svelte-13uimdf")},m(r,a){insert(r,e,a),append(e,n),s||(i=listen(e,"click",o[4]),s=!0)},p(r,a){a&1&&set_data(n,r[0])},d(r){r&&detach(e),s=!1,i()}}}function create_if_block$7(o){let e,n=o[11]+"",s,i,r,a,u;function c(){return o[8](o[11])}return{c(){e=element("p"),s=text(n),i=space(),attr(e,"style",r=`opacity: ${o[11]===o[0]?.5:1}`),attr(e,"class","item svelte-13uimdf")},m(d,f){insert(d,e,f),append(e,s),append(e,i),a||(u=listen(e,"click",c),a=!0)},p(d,f){o=d,f&2&&n!==(n=o[11]+"")&&set_data(s,n),f&3&&r!==(r=`opacity: ${o[11]===o[0]?.5:1}`)&&attr(e,"style",r)},d(d){d&&detach(e),a=!1,u()}}}function create_each_block$6(o){let e,n=o[11]!==o[0]&&create_if_block$7(o);return{c(){n&&n.c(),e=empty()},m(s,i){n&&n.m(s,i),insert(s,e,i)},p(s,i){s[11]!==s[0]?n?n.p(s,i):(n=create_if_block$7(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){n&&n.d(s),s&&detach(e)}}}function create_fragment$i(o){let e,n,s,i;function r(f,h){return f[0]!==void 0?create_if_block_1$5:create_else_block$3}let a=r(o),u=a(o),c=o[1],d=[];for(let f=0;f<c.length;f+=1)d[f]=create_each_block$6(get_each_context$6(o,c,f));return{c(){e=element("div"),n=element("div"),u.c(),s=space(),i=element("div");for(let f=0;f<d.length;f+=1)d[f].c();attr(i,"id","item-wrapper"),attr(i,"class","svelte-13uimdf"),attr(n,"id","main"),attr(n,"class","svelte-13uimdf"),attr(e,"class","component-wrapper svelte-13uimdf"),toggle_class(e,"open",o[2])},m(f,h){insert(f,e,h),append(e,n),u.m(n,null),append(n,s),append(n,i);for(let m=0;m<d.length;m+=1)d[m].m(i,null);o[9](n)},p(f,[h]){if(a===(a=r(f))&&u?u.p(f,h):(u.d(1),u=a(f),u&&(u.c(),u.m(n,s))),h&35){c=f[1];let m;for(m=0;m<c.length;m+=1){const _=get_each_context$6(f,c,m);d[m]?d[m].p(_,h):(d[m]=create_each_block$6(_),d[m].c(),d[m].m(i,null))}for(;m<d.length;m+=1)d[m].d(1);d.length=c.length}h&4&&toggle_class(e,"open",f[2])},i:noop,o:noop,d(f){f&&detach(e),u.d(),destroy_each(d,f),o[9](null)}}}function instance$f(o,e,n){const s=createEventDispatcher();let{value:i=void 0}=e,r=!1,a;function u(){n(2,r=!0),setTimeout(()=>{document.addEventListener("click",()=>{n(2,r=!1)},{once:!0})},50)}function c(g){n(0,i=g),n(2,r=!1)}let{values:d=[]}=e;function f(g){n(1,d=g)}function h(g){n(0,i=g)}const m=g=>c(g);function _(g){binding_callbacks[g?"unshift":"push"](()=>{a=g,n(3,a)})}return o.$$set=g=>{"value"in g&&n(0,i=g.value),"values"in g&&n(1,d=g.values)},o.$$.update=()=>{o.$$.dirty&1&&i&&s("change",i)},[i,d,r,a,u,c,f,h,m,_]}class InputSelect extends SvelteComponent{constructor(e){super();init(this,e,instance$f,create_fragment$i,safe_not_equal,{value:0,values:1,setItems:6,setValue:7})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get values(){return this.$$.ctx[1]}set values(e){this.$$set({values:e}),flush()}get setItems(){return this.$$.ctx[6]}get setValue(){return this.$$.ctx[7]}}var InputShape_svelte_svelte_type_style_lang="";function get_each_context$5(o,e,n){const s=o.slice();return s[19]=e[n],s}function create_each_block$5(o){let e,n,s,i,r;function a(){return o[9](o[19])}return{c(){e=svg_element("circle"),attr(e,"cx",n=o[19].x*100),attr(e,"cy",s=o[19].y*200-50),attr(e,"r","4"),attr(e,"class","svelte-1z0d3lw"),toggle_class(e,"pinned",o[19].pinned)},m(u,c){insert(u,e,c),i||(r=listen(e,"mousedown",a),i=!0)},p(u,c){o=u,c&1&&n!==(n=o[19].x*100)&&attr(e,"cx",n),c&1&&s!==(s=o[19].y*200-50)&&attr(e,"cy",s),c&1&&toggle_class(e,"pinned",o[19].pinned)},d(u){u&&detach(e),i=!1,r()}}}function create_fragment$h(o){let e,n,s,i,r,a,u,c,d,f,h,m,_=o[0],g=[];for(let v=0;v<_.length;v+=1)g[v]=create_each_block$5(get_each_context$5(o,_,v));return{c(){e=element("div"),n=svg_element("svg"),s=svg_element("path");for(let v=0;v<g.length;v+=1)g[v].c();i=space(),r=svg_element("svg"),a=svg_element("defs"),u=svg_element("linearGradient"),c=svg_element("stop"),d=svg_element("stop"),f=svg_element("path"),attr(s,"d",o[2]),attr(s,"fill","none"),attr(s,"stroke","#65E2A0"),attr(s,"class","svelte-1z0d3lw"),attr(n,"viewBox","0 0 100 100"),attr(n,"width","50"),attr(n,"height","100"),attr(n,"class","svelte-1z0d3lw"),attr(c,"offset","0%"),set_style(c,"stop-color","#65E2A0"),set_style(c,"stop-opacity","1"),attr(c,"class","svelte-1z0d3lw"),attr(d,"offset","100%"),set_style(d,"stop-color","#469C6E"),set_style(d,"stop-opacity","1"),attr(d,"class","svelte-1z0d3lw"),attr(u,"id","grad1"),attr(u,"x1","0%"),attr(u,"y1","0%"),attr(u,"x2","100%"),attr(u,"y2","0%"),attr(u,"class","svelte-1z0d3lw"),attr(a,"class","svelte-1z0d3lw"),attr(f,"d",o[2]),attr(f,"fill","url(#grad1)"),attr(f,"stroke","grey"),attr(f,"class","svelte-1z0d3lw"),attr(r,"id","right"),attr(r,"viewBox","0 0 100 100"),attr(r,"width","50"),attr(r,"height","100"),attr(r,"class","svelte-1z0d3lw"),attr(e,"class","component-wrapper svelte-1z0d3lw")},m(v,w){insert(v,e,w),append(e,n),append(n,s);for(let b=0;b<g.length;b+=1)g[b].m(n,null);append(e,i),append(e,r),append(r,a),append(a,u),append(u,c),append(u,d),append(r,f),h||(m=[listen(n,"mousedown",o[4]),listen(n,"mousemove",o[3]),listen(n,"mouseover",o[6]),listen(n,"mouseout",o[7]),listen(n,"mouseup",o[5]),listen(n,"focus",o[6]),listen(n,"blur",o[7])],h=!0)},p(v,[w]){if(w&4&&attr(s,"d",v[2]),w&3){_=v[0];let b;for(b=0;b<_.length;b+=1){const $=get_each_context$5(v,_,b);g[b]?g[b].p($,w):(g[b]=create_each_block$5($),g[b].c(),g[b].m(n,null))}for(;b<g.length;b+=1)g[b].d(1);g.length=_.length}w&4&&attr(f,"d",v[2])},i:noop,o:noop,d(v){v&&detach(e),destroy_each(g,v),h=!1,run_all(m)}}}function instance$e(o,e,n){let s,i;const r=createEventDispatcher();let{value:a=[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}=e,u=!1,c,d,f=0,h=0;const m=()=>{requestAnimationFrame(()=>{r("change",s),n(0,s=s.sort((S,C)=>S.y>C.y?-1:1))})},_=S=>{S.pinned||(s.splice(s.indexOf(c),1),m())},g=S=>{u&&(f=S.offsetX,h=S.offsetY,c&&(d=c,n(1,c=void 0)),d&&(d.x=f/50,d.y=h/100,m()))},v=()=>{if(!c){const S={x:f/50,y:h/100,pinned:!1};n(1,c=S),s.push(c),m()}},w=()=>{c&&(_(c),n(1,c=void 0)),d=void 0},b=()=>{u=!0},$=()=>{u=!1},y=S=>`L ${S.x*100} ${S.y*200-50}`;function k(S){return S.reduce((C,E,V)=>V===0?`M ${E.x*100},${E.y*200-50}`:`${C} ${y(E)}`,"")}const N=S=>{n(1,c=S)};return o.$$set=S=>{"value"in S&&n(8,a=S.value)},o.$$.update=()=>{o.$$.dirty&256&&n(0,s=a),o.$$.dirty&1&&n(2,i=k(s))},[s,c,i,g,v,w,b,$,a,N]}class InputShape extends SvelteComponent{constructor(e){super();init(this,e,instance$e,create_fragment$h,safe_not_equal,{value:8})}get value(){return this.$$.ctx[8]}set value(e){this.$$set({value:e}),flush()}}var InputSlider_svelte_svelte_type_style_lang="",Section_svelte_svelte_type_style_lang="";function create_if_block$6(o){let e,n,s;return{c(){e=element("div"),n=element("p"),s=text(o[1]),attr(n,"class","svelte-1aw08v2"),attr(e,"class","border svelte-1aw08v2")},m(i,r){insert(i,e,r),append(e,n),append(n,s)},p(i,r){r&2&&set_data(s,i[1])},d(i){i&&detach(e)}}}function create_fragment$g(o){let e,n,s,i,r,a,u,c,d,f,h=o[1]&&create_if_block$6(o);const m=o[4].default,_=create_slot(m,o,o[3],null);return{c(){e=element("div"),n=element("div"),s=svg_element("svg"),i=svg_element("path"),r=space(),h&&h.c(),a=space(),u=element("div"),_&&_.c(),attr(i,"d","M13.172 12l-4.95-4.95 1.414-1.414L16 12l-6.364 6.364-1.414-1.414z"),attr(i,"class","svelte-1aw08v2"),attr(s,"xmlns","http://www.w3.org/2000/svg"),attr(s,"viewBox","0 0 24 24"),attr(s,"width","24"),attr(s,"height","24"),attr(s,"class","svelte-1aw08v2"),attr(n,"class","header svelte-1aw08v2"),attr(u,"class","content svelte-1aw08v2"),attr(e,"class","wrapper svelte-1aw08v2"),toggle_class(e,"open",o[0])},m(g,v){insert(g,e,v),append(e,n),append(n,s),append(s,i),append(n,r),h&&h.m(n,null),append(e,a),append(e,u),_&&_.m(u,null),c=!0,d||(f=listen(n,"click",o[2]),d=!0)},p(g,[v]){g[1]?h?h.p(g,v):(h=create_if_block$6(g),h.c(),h.m(n,null)):h&&(h.d(1),h=null),_&&_.p&&(!c||v&8)&&update_slot_base(_,m,g,g[3],c?get_slot_changes(m,g[3],v,null):get_all_dirty_from_scope(g[3]),null),v&1&&toggle_class(e,"open",g[0])},i(g){c||(transition_in(_,g),c=!0)},o(g){transition_out(_,g),c=!1},d(g){g&&detach(e),h&&h.d(),_&&_.d(g),d=!1,f()}}}function instance$d(o,e,n){let{$$slots:s={},$$scope:i}=e;const r=createEventDispatcher();let{open:a=!1}=e,{name:u=""}=e;const c=()=>{n(0,a=!a),r("toggle",a)};return o.$$set=d=>{"open"in d&&n(0,a=d.open),"name"in d&&n(1,u=d.name),"$$scope"in d&&n(3,i=d.$$scope)},[a,u,c,i,s]}class Section extends SvelteComponent{constructor(e){super();init(this,e,instance$d,create_fragment$g,safe_not_equal,{open:0,name:1})}}function stateToElement({target:o,template:e,value:n}){n===void 0&&"value"in e&&(n=e.value);const s=stateToComponent(e,n),i=O({},e);return delete i.type,delete i.inputType,delete i.defaultValue,delete i.internal,i.value=n,new s({target:o,props:F(O({},i),{"--width":"100%"})})}function stateToComponent(o,e){return o.inputType==="select"||Array.isArray(o.values)?InputSelect:o.inputType==="curve"?InputCurve:o.inputType==="shape"?InputShape:o.type==="number"||typeof e=="number"?o.step&&o.step%1!=0?InputFloat:InputInteger:InputCheckbox}function applyTransformation(o,e=[0,0,0],n=[0,0,0],s=[1,1,1]){const i=new Float32Array(o.position.length),r=o.position.length,a=o.position;for(let u=0;u<r;u+=3){const c=a[u+0]*s[0],d=a[u+1]*s[1],f=a[u+2]*s[2],h=c,m=Math.cos(n[0])*d-Math.sin(n[0])*f,_=Math.sin(n[0])*d+Math.cos(n[0])*f,g=Math.cos(n[1])*h-Math.sin(n[1])*_,v=m,w=Math.sin(n[1])*h+Math.cos(n[1])*_;i[u+0]=g+e[0],i[u+1]=v+e[1],i[u+2]=w+e[2]}return{position:i,uv:o.uv,normal:o.normal,index:o.index}}function convertInstancedGeometry(o){const e=[],n={position:o.position,normal:o.position,uv:o.uv,index:o.index},s=o.offset,i=o.rotation,r=o.scale,a=o.offset.length;for(let u=0;u<a;u+=3)e.push(applyTransformation(n,[s[u+0],s[u+1],s[u+2]],[i[u+0],i[u+1],i[u+2]],[r[u+0],r[u+1],r[u+2]]));return e}function createCircle(o){const e=2*Math.PI/o;return new Array(o).fill(null).map((s,i)=>[Math.cos(e*i),Math.sin(e*i)])}function createIndeces(o,e){const n=new Uint16Array(o*(e-1)*6);for(let s=0;s<e;s++){const i=s*o*6,r=s*o;for(let a=0;a<o;a++){const u=i+a*6,c=r+a;n[u+0]=c,n[u+1]=c-o+1,n[u+2]=c+1,n[u+3]=c+1,n[u+4]=c+o,n[u+5]=c,a===o-1?(n[u+0]=c,n[u+1]=c-o+1,n[u+2]=c+1,n[u+3]=c+1,n[u+4]=c+o,n[u+5]=c):(n[u+0]=c,n[u+1]=c+1,n[u+2]=c+o+1,n[u+3]=c+o+1,n[u+4]=c+o,n[u+5]=c)}}return n}function extrudePath(o,e){const n=[],s=[],i=[],r={position:[],index:createIndeces(e,o.length)},a=createCircle(e),u=a.length,c=o.length;for(let d=0;d<c;d++){const f=[0,0,1];d===0?subtract(s,o[d],o[d+1]):d===c-1?subtract(s,o[d-1],o[d]):subtract(s,o[d-1],o[d+1]),normalize(s,s),cross$1(i,f,s);const h=Math.acos(dot(f,s));identity(n),rotate(n,n,h,i);for(let m=0;m<u;m++){const _=a[m],g=[_[0],_[1],0],v=o[d][3];mul(g,g,[v,v,1]),transformMat4(g,g,n),add(g,g,o[d]),r.position.push(g)}}return r}function lerp(o,e,n){return o*(1-n)+e*n}function interpolateArray(o,e=0){const n=(o.length-1)*e,s=Math.floor(n),i=Math.ceil(n);return lerp(o[i],o[s],i-n)}function interpolateSkeleton(o,e){const n=(o.length/4-1)*e,s=Math.floor(n),i=Math.ceil(n),r=i-n;return[lerp(o[i*4+0],o[s*4+0],r),lerp(o[i*4+1],o[s*4+1],r),lerp(o[i*4+2],o[s*4+2],r),lerp(o[i*4+3],o[s*4+3],r)]}function interpolateSkeletonVec(o,e){const n=(o.length/4-1)*e,s=Math.floor(n),i=Math.ceil(n);return[o[i*4+0]-o[s*4+0],o[i*4+1]-o[s*4+1],o[i*4+2]-o[s*4+2],o[i*4+3]+o[s*4+3]/2]}function join(...o){if(o.length===1)return o[0];const e=new Float32Array(o.reduce((f,h)=>f+h.position.length,0)),n=new Float32Array(o.reduce((f,h)=>f+h.normal.length,0)),s=new Float32Array(o.reduce((f,h)=>f+h.uv.length,0)),i=o.reduce((f,h)=>f+h.index.length,0),r=i>65536?new Uint32Array(i):new Uint16Array(i);let a=0,u=0,c=0,d=0;for(let f=0;f<o.length;f++){const h=o[f].normal,m=h.length;for(let y=0;y<m;y++)n[u+y]=h[y];u+=m;const _=o[f].uv,g=_.length;for(let y=0;y<g;y++)s[c+y]=_[y];c+=g;const v=o[f].index,w=v.length;for(let y=0;y<w;y++)r[y+d]=v[y]+a/3;d+=w;const b=o[f].position,$=b.length;for(let y=0;y<$;y++)e[a+y]=b[y];a+=$}return{position:e,normal:n,uv:s,index:r}}var length2D=(o,e)=>Math.sqrt(o*o+e*e),length3D=(o,e,n)=>Math.sqrt(o*o+e*e+n*n);let seed=0,noise2D=mod.makeNoise2D(seed),noise3D=mod.makeNoise3D(seed);var noise={n1d:o=>noise2D(o,0),n2d:(o,e)=>noise2D(o,e),n3d:(o,e,n)=>noise3D(o,e,n),get seed(){return seed},set seed(o){seed=o,noise2D=mod.makeNoise2D(seed),noise3D=mod.makeNoise3D(seed)}},normalize2D=([o,e])=>{const n=length2D(o,e);return n===0?[1,0]:[o/n,e/n]},normalize3D=(o,e,n)=>{const s=length3D(o,e,n);return[o/s,e/s,n/s]},rotate2D=(o,e,n)=>[o*Math.cos(n)-e*Math.sin(n),o*Math.sin(n)+e*Math.cos(n)];function rotate3D(o,e,n){const[s,i,r]=o,[a,u,c]=normalize3D(e[0],e[1],e[2]),d=Math.cos(n),f=Math.sin(n);return new Vec3((d+(1-d)*a*a)*s+((1-d)*a*u-c*f)*i+((1-d)*a*c+u*f)*r,((1-d)*a*u+c*f)*s+(d+(1-d)*u*u)*i+((1-d)*u*c-a*f)*r,((1-d)*a*c-u*f)*s+((1-d)*u*c+a*f)*i+(d+(1-d)*c*c)*r)}function transferToGeometry(o,e){return new Geometry(o,{position:{size:3,data:e.position},normal:{size:3,data:e.normal},uv:{size:2,data:e.uv},index:{data:e.index}})}const totalSize=100,slopeLength=2,groundHeight=1;function ground(o=1,e=12,n=12){const s=360*(Math.PI/180)/n,i=e*n+1,r=(e-1)*n*2+n,a=new Float32Array(i*3),u=new Float32Array(i*3),c=new Float32Array(i*2),d=new Uint16Array(r*3);a[0]=0,a[1]=1-groundHeight,a[2]=0,u[0]=0,u[1]=1,u[2]=0,c[0]=.5,c[1]=.5;const f=new Array(e-1).fill(null).map((m,_,g)=>o+_/(g.length-1)*slopeLength);f.push(totalSize);const h=f.map(m=>{const _=(Math.max(Math.min(m,o+slopeLength),o)-o)/slopeLength;return Math.sin((_+.5)*Math.PI)/2+.5-groundHeight});for(let m=0;m<e;m++){const _=f[m],g=h[m];for(let v=0;v<n;v++){const w=s*v,b=Math.cos(w)*_,$=g,y=Math.sin(w)*_,N=m*n+v+1;if(a[N*3+0]=b,a[N*3+1]=$,a[N*3+2]=y,u[N*3+0]=0,u[N*3+1]=1,u[N*3+2]=0,c[N*2+0]=b,c[N*2+1]=y,m===0){const S=(N-1)*3;d[S+0]=0,d[S+1]=(v+1)%n+1,d[S+2]=v+1}else if(v===n-1){const S=m*n*6+v*6-n*3;d[S+0]=N,d[S+1]=N+1-n-n,d[S+2]=N+1-n,d[S+3]=N,d[S+4]=N-n,d[S+5]=N+1-n*2}else{const S=m*n*6+v*6-n*3;d[S+0]=N,d[S+1]=N+1-n,d[S+2]=N+1,d[S+3]=N,d[S+4]=N-n,d[S+5]=N+1-n}}}return{position:a,normal:u,uv:c,index:d}}function leaf(o,{res:e=1,xCurvature:n=.5,yCurvature:s=.2}={}){const i=o.length,r=3+e*2,a=r*i,u=(r-1)*(i-1)*2,c=new Float32Array(a*3),d=new Float32Array(a*2),f=new Float32Array(a*2),h=new Uint16Array(u*3);return o.forEach((m,_)=>{const g=_*r;for(let v=0;v<r;v++){const w=2-v/(r-1)*2-1;c[g*3+v*3+0]=(m.x-1)*w*.5;const b=-(1-m.y)*(1-m.y)*.5,$=Math.sin(Math.abs(w)*Math.PI)*.01;if(c[g*3+v*3+1]=$*n+b*s,c[g*3+v*3+2]=m.y-1,f[g*2+v*2+0]=c[g*3+v*3+0]+1/2,f[g*2+v*2+1]=c[g*3+v*3+2],_<o.length-1){const y=_*(r-1);h[y*6+v*6+0]=g+v+0,h[y*6+v*6+1]=g+v+1,h[y*6+v*6+2]=g+v+r,h[y*6+v*6+3]=g+v+1,h[y*6+v*6+4]=g+v+r,h[y*6+v*6+5]=g+v+r+1}}}),{position:c,normal:d,index:h,uv:f}}function tube(o,e=8){const n=groupArray(o,4),s=extrudePath(n,e);return{position:Float32Array.from(s.position.map(r=>r.splice(0,3)).flat()),index:s.index,normal:new Float32Array,uv:new Float32Array}}const node$f={title:"Branches",type:"branch",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},length:{type:["number","parameter","curve"],min:0,max:3,step:.05,value:0},thiccness:{type:"number",min:0,max:1,step:.01,value:.8},offsetSingle:{type:"number",min:0,max:1,step:.01,value:.5},lowestBranch:{type:"number",min:0,max:1,step:.01,value:.2},amount:{type:"number",min:0,max:64,value:10}},computeSkeleton(o,e){const{skeletons:n}=o.input.result,s=e.getSetting("stemResY"),i=n.map(r=>{const a=[],u=e.handleParameter(o.amount),c=e.handleParameter(o.lowestBranch);for(let d=0;d<u;d++){const f=d/u,h=e.handleParameter(o.length,f)*(1-f),m=e.handleParameter(o.thiccness,f),_=e.handleParameter(o.offsetSingle,f),g=d%2==0;let v=c+(1-c)*f;v-=1/u*_*(g?-1:1);const[w,,b]=interpolateSkeletonVec(r,v),$=normalize2D([w,b]),[y,k]=rotate2D($[0],$[1],g?-Math.PI/2:Math.PI/2),[N,S,C,E]=interpolateSkeleton(r,v),V=Math.max(Math.floor(s*h*10),4),I=new Float32Array(V*4);for(let R=0;R<V*4;R++){const j=R/V;I[R*4+0]=N+y*j*h,I[R*4+1]=S,I[R*4+2]=C+k*j*h,I[R*4+3]=E*m*(1-j)}a.push(I)}return a}).flat();return{skeletons:i,allSkeletons:[...i,...n]}},computeGeometry(o,e,n){const s=n.getSetting("stemResX"),{geometry:i}=o.input.result,{skeletons:r}=e;return{geometry:join(i,...r.map(a=>tube(a,s)))}}},node$e={title:"Curve",type:"curve",outputs:["number"],parameters:{value:{type:"curve",inputType:"curve",internal:!0,label:!1,value:[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}},computeValue(o,e,n){const s=toArray(o.value).map(i=>i.y);return interpolateArray(s,1-n)}},node$d={title:"Gravity",type:"gravity",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,type:"select",values:["simple","verlet","test"]},strength:{type:"number",inputType:"slider",min:0,max:2,step:.05}},computeSkeleton(o,e){const{input:n,type:s,strength:i}=o,{skeletons:r}=n.result;return s==="simple"&&r.forEach(a=>{const u=a.length/4;for(let c=1;c<u;c++){const d=c/u,f=a[c*4+1],h=e.handleParameter(i,d);a[c*4+1]=f-f*d*d*d*h}return a}),s==="test"&&r.forEach(a=>{const u=a.length/4;for(let c=1;c<u;c++){const d=c/u,f=e.handleParameter(i,d),h=a[c*4+0],m=a[c*4+1],_=a[c*4+2],g=a[(c-1)*4+0],v=a[(c-1)*4+1],w=a[(c-1)*4+2],b=g-h,$=v-m,y=v-_,[k,N]=rotate2D(b,y,90);for(let S=c;S<u;S++){const C=a[S*4+0],E=a[S*4+1],V=a[S*4+2],I=C-g,R=E-v,j=V-w;let[A,T,D]=rotate3D([I,R,j],[k,$,N],f*d);const G=A+g,K=T+v,Q=D+w;a[S*4+0]=G,a[S*4+1]=K,a[S*4+2]=Q}}return a}),s==="verlet"&&r.forEach(a=>{const u=a.length/4;for(let c=1;c<u;c++){const d=a[c*4+0],f=a[c*4+1],h=a[c*4+2],m=new Vec3(5,0,0).cross(new Vec3(d,f,h),new Vec3(0,1,0)),_=c/u,g=e.handleParameter(i,_);for(let v=c;v<u;v++){const w=rotate3D([d,f,h],m,_*g);a[v*4+0]=w[0],a[v*4+1]=w[1],a[v*4+2]=w[2]}}return a}),{skeletons:r}},computeGeometry(o){return o.input.result}},log$7=log$8("nodes.join"),node$c={title:"Join",type:"join",outputs:["plant"],parameters:{inputA:{type:"plant",label:"plant",external:!0},inputB:{type:"plant",label:"plant",external:!0}},computeSkeleton(o,e){log$7("compute skeleton",o,e);const{inputA:n,inputB:s}=o;if(!n||!s)return n?n.result:s.result;const{skeletons:i,allSkeletons:r}=n.result,{skeletons:a,allSkeletons:u}=s.result;log$7(i,a);const c=[...i,...a],d=[];return r&&d.push(...r),u&&d.push(...u),{allSkeletons:d,skeletons:c}},computeGeometry(o){const{inputA:e,inputB:n}=o;if(!e||!n)return e?e.result:n.result;const{geometry:s,instances:i}=e.result,{geometry:r,instances:a}=n.result,u=join(s,r),c=[];return i&&c.push(...i),a&&c.push(...a),log$7("compute geometry",{geometryA:s,geometryB:r,result:u}),{geometry:u,instances:c}}},defaultValue=[{x:1,y:1,pinned:!0},{x:.62,y:.84,pinned:!1},{x:.54,y:.63,pinned:!1},{x:.38,y:.41,pinned:!0},{x:.44,y:.23,pinned:!1},{x:.64,y:.12,pinned:!1},{x:.98,y:.02,pinned:!0}],node$b={title:"Leaf",type:"leaf",outputs:["plant","leaf"],parameters:{input:{type:"plant",external:!0},size:{type:["number","parameter","curve","vec2"],inputType:"slider",min:0,max:3,step:.05,value:0},shape:{type:"leaf",external:!0,defaultValue},lowestLeaf:{type:"number",inputType:"slider",min:0,max:1,step:.01,value:.5},curvature:{external:!0,type:"vec2",defaultValue:{x:0,y:0}},amount:{type:"number",min:0,max:20,value:10}},computeSkeleton(o,e){const{input:n}=o,{skeletons:s}=n.result,i=s.map((r,a)=>{const u=a/s.length,c=e.handleParameter(o.amount,u),d=new Float32Array(c*3),f=new Float32Array(c*3),h=new Float32Array(c*3);for(let m=0;m<c;m++){const _=m/(c-1),g=e.handleParameter(o.size,1-_),v=e.handleParameter(o.lowestLeaf,_),w=v+(1-v)*_-.001,[b,$,y]=interpolateSkeleton(r,w),[k,,N]=interpolateSkeletonVec(r,w),S=normalize2D([k,N]),C=Math.atan2(-S[0],S[1]);d[m*3+0]=b,d[m*3+1]=$,d[m*3+2]=y,f[m*3+0]=g,f[m*3+1]=1,f[m*3+2]=g,h[m*3+0]=0,h[m*3+1]=C-Math.PI/2*(m%2==0?-1:1),h[m*3+2]=0}return{offset:d,scale:f,rotation:h}});return{allSkeletons:n.result.allSkeletons,skeletons:s,instances:i}},computeGeometry(o,e,n){const{shape:s,input:i,curvature:r}=o,{instances:a}=e,u=n.handleParameter(r),c=leaf(n.handleParameter(s),{res:n.getSetting("leafRes",2),xCurvature:u.x,yCurvature:u.y});return{geometry:i.result.geometry,instances:a.map(d=>O(O({},d),c))}}},node$a={title:"Math",type:"math",outputs:["number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},computeValue(o,e,n){const{mode:s}=o,i=e.handleParameter(o.a,n),r=e.handleParameter(o.b,n);switch(s){case"multiply":return i*r;case"subtract":return i-r;default:return i+r}}},log$6=log$8("nodes.noise"),node$9={title:"Noise",type:"noise",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},size:{type:"number",inputType:"slider",min:0,max:20,step:.05,value:1},strength:{type:"number",inputType:"slider",min:0,max:2,step:.01,value:.5}},computeSkeleton(o,e){log$6(o);const{input:n}=o,s=e.handleParameter(o.size),i=e.handleParameter(o.strength),{skeletons:r}=n.result;return r.forEach((a,u)=>{const c=a.length/4,d=[a[0],a[1],a[2]];let f=0;for(let h=0;h<c;h++){const m=h/c;f+=(Math.abs(d[0]-a[h*4+0])+Math.abs(d[1]-a[h*4+1])+Math.abs(d[2]-a[h*4+2]))/3,d[0]=a[h*4+0],d[1]=a[h*4+1],d[2]=a[h*4+2],a[h*4+0]=a[h*4+0]+noise.n1d(f*s+0+u*500)*i*m,a[h*4+1]=a[h*4+1]+noise.n1d(f*s+1e3+u*500)*i*m,a[h*4+2]=a[h*4+2]+noise.n1d(f*s+2e3+u*500)*i*m}}),{skeletons:r,allSkeletons:n.result.allSkeletons}},computeGeometry(o){return o.input.result}},node$8={title:"Output",type:"output",outputs:[],parameters:{main:{type:"plant",label:"plant",external:!0}},computeNode(o={}){return o.main}},node$7={title:"Parameter",type:"parameter",outputs:["number"],parameters:{value:{type:"number",value:0},variation:{type:"number",inputType:"slider",value:0,min:0,max:1,step:.05}},computeValue(o,e){const{value:n=0,variation:s=0}=o;return s?n+e.n1d(200)*s*Math.max(n,1):n}},getRotationAxis=o=>o==="X"?[1,0,0]:o==="Z"?[0,0,1]:[0,1,0],node$6={title:"Rotate",type:"rotate",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,label:!1,type:"select",values:["Y","X","Z"]},spread:{internal:!0,type:"boolean",value:!0},angle:{type:"number",inputType:"slider",min:0,max:Math.PI*2,step:.05,value:0}},computeSkeleton(o,e){const{input:n,type:s,spread:i}=o,{result:{skeletons:r,allSkeletons:a}}=n,u=getRotationAxis(s);return r.forEach((c,d)=>{const f=c.length/4,h=c[0],m=c[1],_=c[2],g=d/r.length,v=e.handleParameter(o.angle,g)*(i?g:1);for(let w=1;w<f;w++){let b=c[w*4+0],$=c[w*4+1],y=c[w*4+2];b-=h,$-=m,y-=_,[b,$,y]=rotate3D([b,$,y],u,v),b+=h,$+=m,y+=_,c[w*4+0]=b,c[w*4+1]=$,c[w*4+2]=y}}),{skeletons:r,allSkeletons:a}},computeGeometry(o){return o.input.result}},node$5={title:"Shape",type:"shape",outputs:["leaf"],parameters:{value:{type:"leaf",inputType:"shape",internal:!0,label:!1,value:[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}},computeValue(o){return o.value}},node$4={title:"Slider",type:"slider",outputs:["number"],parameters:{value:{type:"number",label:!1,inputType:"slider",internal:!0,min:0,max:1,step:.01,value:0}},computeValue(o){return o.value}},log$5=log$8("nodes.stem"),node$3={title:"Stem",type:"stem",outputs:["plant"],parameters:{origin:{type:"vec3",external:!0,defaultValue:{x:0,y:0,z:0}},height:{type:"number",inputType:"slider",min:0,max:5,step:.05,value:2},thiccness:{type:"number",inputType:"slider",min:0,max:.2,step:.01,value:.06},amount:{type:"number",min:0,max:20,value:1}},computeSkeleton(o,e){log$5("computeSkeleton",o);const n=e.handleParameter(o.amount),s=e.getSetting("stemResY"),i=[];for(let r=0;r<n;r++){const{x:a,y:u,z:c}=e.handleParameter(o.origin),d=e.handleParameter(o.height),f=new Float32Array(s*4);for(let h=0;h<s;h++){const m=h/s,_=e.handleParameter(o.thiccness,m)*(1-m),g=a,v=u+m*d,w=c;f[h*4+0]=g,f[h*4+1]=v,f[h*4+2]=w,f[h*4+3]=_}i.push(f)}return{skeletons:i,allSkeletons:i}},computeGeometry(o,e,n){log$5("computeNode",o,e);const s=n.getSetting("stemResX");return{geometry:join(...e.skeletons.map(i=>tube(i,s)))}}},node$2={title:"Vec2",type:"vec2",outputs:["vec2"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0}}},node$1={title:"Vec3",type:"vec3",outputs:["vec3"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0},z:{label:!1,type:"number",value:0,defaultValue:0}}};var nodes$1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Branch:node$f,Curve:node$e,Gravity:node$d,Join:node$c,Leaf:node$b,Math:node$a,Noise:node$9,Output:node$8,Parameter:node$7,Rotate:node$6,Shape:node$5,Slider:node$4,Stem:node$3,Vec2:node$2,Vec3:node$1});const _nodes=Object.values(nodes$1).map(o=>("computeNode"in o?o.compute=o.computeNode:o.compute=e=>({type:o.type,parameters:e}),o));var index$2="",ConnectionView$1="";const minMax=(o,e)=>n=>Math.min(Math.max(n,o),e),limitDecimals=o=>{const e=10**o;return n=>Math.floor(n*e)/e},limitSafe=minMax(-1e5,1e5),removeDecimals=limitDecimals(1),limit=o=>limitSafe(removeDecimals(o));class ConnectionView{constructor({x1:e=0,y1:n=0,x2:s=0,y2:i=0},r){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x1=e,this.y1=n,this.x2=s,this.y2=i,this.system=r.node.system,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewbox","0 0 100 100"),this.svg.setAttribute("width","100"),this.svg.setAttribute("height","100"),this.svg.style.overflow="visible",this.svg.style.position="absolute",this.svg.style.top="3.5px",this.svg.style.pointerEvents="none",this.svg.style.zIndex="-1",r.view.wrapper.append(this.svg),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("node-connection-path"),this.path.setAttribute("vector-effect","non-scaling-stroke"),this.path.setAttribute("d",`
      M 0 0
      C 50 0 
        50 100
				100  100
      `),this.svg.appendChild(this.path),this.setPosition()}setPosition({x1:e=this.x1,y1:n=this.y1,x2:s=this.x2,y2:i=this.y2}={}){var u;this.x1=limit(e),this.y1=limit(n),this.x2=limit(s),this.y2=limit(i);const r=this.x2-this.x1+3.5,a=this.y2-this.y1;(u=this==null?void 0:this.hoverPath)==null||u.setAttribute("d",`
      M 0 0
      C ${r/2} 0 
        ${r/2} ${a}
				${r}  ${a}
      `),this.path.setAttribute("d",`
      M 0 0
      C ${r/2} 0 
        ${r/2} ${a}
				${r}  ${a}
      `)}remove(){var e;this.path.remove(),(e=this==null?void 0:this.hoverPath)==null||e.remove(),this.system.save()}}class NodeConnectionView extends ConnectionView{constructor(e){super({},e.output);this.connection=e,this.input=e.input.view,this.output=e.output.view,this.hoverPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.hoverPath.classList.add("node-connection-hover"),this.hoverPath.setAttribute("vector-effect","non-scaling-stroke"),this.svg.append(this.hoverPath),this.hoverPath.addEventListener("mouseover",()=>{const{activeNode:n}=this.system.view;n&&n.view.active&&n.view.hoveredConnection!==this&&this.handleNodeOver(n)}),this.hoverPath.addEventListener("mouseout",()=>{const{activeNode:n}=this.system.view;this.handleNodeOut(n)}),e.input.node.system.view.colorStore.on(e.input.type[0],n=>{this.path.style.stroke=n})}handleNodeOver(e){this.connection.isNodeJoinable(e)&&(e.view.hoveredConnection=this,this.path.classList.add("hover-active"))}handleNodeOut(e){e&&e.view.hoveredConnection===this&&delete e.view.hoveredConnection,this.path.classList.remove("hover-active")}remove(){super.remove()}}function makeDomController(o){if(!isDomElement(o))throw new Error("panzoom requires DOM element to be attached to the DOM tree");const n=o.parentElement;return o.scrollTop=0,{getBBox:r,getOwner:i,applyTransform:a};function i(){return n}function r(){return{left:0,top:0,width:o.clientWidth,height:o.clientHeight}}function a(u){o.style.transformOrigin="0 0 0",o.style.transform="matrix("+u.scale+", 0, 0, "+u.scale+", "+u.x+", "+u.y+")"}}function isDomElement(o){return o&&o.parentElement&&o.style}function kinetic(o,e,n){typeof n!="object"&&(n={});const s=typeof n.minVelocity=="number"?n.minVelocity:5,i=typeof n.amplitude=="number"?n.amplitude:.25,r=typeof n.cancelAnimationFrame=="function"?n.cancelAnimationFrame:getCancelAnimationFrame(),a=typeof n.requestAnimationFrame=="function"?n.requestAnimationFrame:getRequestAnimationFrame();let u,c;const d=342;let f,h,m,_,g,v,w,b;return{start:y,stop:N,cancel:$};function $(){r(f),r(b)}function y(){u=o(),_=w=h=g=0,c=new Date,r(f),r(b),f=a(k)}function k(){const C=Date.now(),E=C-c;c=C;const V=o(),I=V.x-u.x,R=V.y-u.y;u=V;const j=1e3/(1+E);h=.8*I*j+.2*h,g=.8*R*j+.2*g,f=a(k)}function N(){r(f),r(b);const C=o();m=C.x,v=C.y,c=Date.now(),(h<-s||h>s)&&(_=i*h,m+=_),(g<-s||g>s)&&(w=i*g,v+=w),b=a(S)}function S(){const C=Date.now()-c;let E=!1,V=0,I=0;_&&(V=-_*Math.exp(-C/d),V>.5||V<-.5?E=!0:V=_=0),w&&(I=-w*Math.exp(-C/d),I>.5||I<-.5?E=!0:I=w=0),E&&(e(m+V,v+I),b=a(S))}}function getCancelAnimationFrame(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function getRequestAnimationFrame(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(o){return setTimeout(o,16)}}const defaultZoomSpeed=.2;function createPanZoom(o,e){const n=makeDomController(o),s=n.getOwner(),i={x:0,y:0};let r=!1;const a={x:0,y:0,scale:1},u=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,c=e.bounds,d=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,f=typeof e.minZoom=="number"?e.minZoom:0,h=typeof e.boundsPadding=="number"?e.boundsPadding:.05,m=typeof e.zoomSpeed=="number"?e.zoomSpeed:defaultZoomSpeed;let _=parseTransformOrigin(e.transformOrigin);validateBounds(c);let g,v=!1,w=!1,b,$,y;const k=kinetic(Se,Ee,e.smoothScroll);let N,S=!1;ae();const C={dispose:Te,moveBy:oe,moveTo:ee,smoothMoveTo:Ce,centerOn:Pe,zoomTo:Y,zoomAbs:re,pause:R,resume:j,isPaused:A,getTransform:G,setTransform:D,getTransformOrigin:K,setTransformOrigin:Q},E=typeof e.initialX=="number"?e.initialX:a.x,V=typeof e.initialY=="number"?e.initialY:a.y,I=typeof e.initialZoom=="number"?e.initialZoom:a.scale;return(E!=a.x||V!=a.y||I!=a.scale)&&re(E,V,I),C;function R(){le(),S=!0}function j(){S&&(ae(),S=!1)}function A(){return S}function T(x,M){return i.x=x,i.y=M,i}function D(x,M,P){a.x=x,a.y=M,a.scale=P,q()}function G(){return a}function K(){return _}function Q(x){_=parseTransformOrigin(x)}function Se(){return{x:a.x,y:a.y}}function ee(x,M){a.x=x,a.y=M,te(),q()}function oe(x,M){ee(a.x+x,a.y+M)}function te(){const x=xe();if(!x)return;let M=!1;const P=Me();let L=x.left-P.right;return L>0&&(a.x+=L,M=!0),L=x.right-P.left,L<0&&(a.x+=L,M=!0),L=x.top-P.bottom,L>0&&(a.y+=L,M=!0),L=x.bottom-P.top,L<0&&(a.y+=L,M=!0),M}function xe(){if(!!c){if(typeof c=="boolean"){const x=s.getBoundingClientRect(),M=x.width,P=x.height;return{left:M*h,top:P*h,right:M*(1-h),bottom:P*(1-h)}}return c}}function Me(){const x=n.getBBox(),M=Ne(x.left,x.top);return{left:M.x,top:M.y,right:x.width*a.scale+M.x,bottom:x.height*a.scale+M.y}}function Ne(x,M){return{x:x*a.scale+a.x,y:M*a.scale+a.y}}function q(){r=!0,g=window.requestAnimationFrame(Le)}function ie(x,M,P){if(isNaN$1(x)||isNaN$1(M)||isNaN$1(P))throw new Error("zoom requires valid numbers");const L=a.scale*P;if(L<f){if(a.scale===f)return;P=f/a.scale}if(L>d){if(a.scale===d)return;P=d/a.scale}const B=T(x,M);a.x=B.x-P*(B.x-a.x),a.y=B.y-P*(B.y-a.y),c&&h===1&&f===1?(a.scale*=P,te()):te()||(a.scale*=P),q()}function re(x,M,P){const L=P/a.scale;ie(x,M,L)}function Pe(x){const M=x.ownerSVGElement;if(!M)throw new Error("ui element is required to be within the scene");const P=x.getBoundingClientRect(),L=P.left+P.width/2,B=P.top+P.height/2,z=M.getBoundingClientRect(),X=z.width/2-L,J=z.height/2-B;H(X,J)}function Ce(x,M){H(x-a.x,M-a.y)}function H(x,M){return oe(x,M)}function Ee(x,M){ee(x,M)}function Te(){le()}function ae(){s.addEventListener("mousedown",me,{passive:!0}),s.addEventListener("dblclick",he,{passive:!1}),s.addEventListener("touchstart",ue,{passive:!0}),s.addEventListener("keydown",ce),s.addEventListener("wheel",we,{passive:!0}),q()}function le(){s.removeEventListener("wheel",we),s.removeEventListener("mousedown",me),s.removeEventListener("keydown",ce),s.removeEventListener("dblclick",he),s.removeEventListener("touchstart",ue),g&&(window.cancelAnimationFrame(g),g=0),k.cancel(),ve(),De(),ke()}function Le(){r&&je()}function je(){r=!1,n.applyTransform(a),g=0,e.onTransform&&e.onTransform(a)}function ce(x){let M=0;if(x.keyCode===38||x.keyCode===40||x.keyCode===37||x.keyCode===39||(x.keyCode===189||x.keyCode===109?M=1:(x.keyCode===187||x.keyCode===107)&&(M=-1)),M){const P=be(M*100),L=_?ne():Ie();Y(L.x,L.y,P)}}function Ie(){const x=s.getBoundingClientRect();return{x:x.width/2,y:x.height/2}}function ue(x){if(Oe(x),x.touches.length===1)return Ae(x);x.touches.length===2&&(y=fe(x.touches[0],x.touches[1]),N=!0,pe())}function Oe(x){x.stopPropagation(),x.preventDefault()}function Ve(x){x.preventDefault(),x.stopPropagation()}function Ae(x){const M=x.touches[0],P=W(M),L=T(P.x,P.y);b=L.x,$=L.y,k.cancel(),pe()}function pe(){v||(v=!0,document.addEventListener("touchmove",de),document.addEventListener("touchend",U),document.addEventListener("touchcancel",U))}function de(x){if(x.touches.length===1){x.stopPropagation();const M=x.touches[0],P=W(M),L=T(P.x,P.y),B=L.x-b,z=L.y-$;B!==0&&z!==0&&ye(),b=L.x,$=L.y,H(B,z)}else if(x.touches.length===2){N=!0;const M=x.touches[0],P=x.touches[1],L=fe(M,P),B=1+(L/y-1)*u,z=W(M),X=W(P);if(b=(z.x+X.x)/2,$=(z.y+X.y)/2,_){const J=ne();b=J.x,$=J.y}Y(b,$,B),y=L,x.stopPropagation(),x.preventDefault()}}function U(x){if(x.touches.length>0){const M=W(x.touches[0]),P=T(M.x,M.y);b=P.x,$=P.y}}function fe(x,M){const P=x.clientX-M.clientX,L=x.clientY-M.clientY;return Math.sqrt(P*P+L*L)}function he(x){Ve(x)}function me(x){if(v)return x.stopPropagation(),!1;if(x.target!==s&&x.target!==o||!(x.button===1&&window.event!==null||x.button===0))return;k.cancel();const P=W(x),L=T(P.x,P.y);return b=L.x,$=L.y,document.addEventListener("mousemove",_e),document.addEventListener("mouseup",ge),!1}function _e(x){if(v||x.ctrlKey)return;ye();const M=W(x),P=T(M.x,M.y),L=P.x-b,B=P.y-$;b=P.x,$=P.y,H(L,B)}function ge(){ke(),ve()}function ve(){document.removeEventListener("mousemove",_e),document.removeEventListener("mouseup",ge),w=!1}function De(){document.removeEventListener("touchmove",de),document.removeEventListener("touchend",U),document.removeEventListener("touchcancel",U),w=!1,N=!1,v=!1}function we(x){k.cancel();let M=x.deltaY;x.deltaMode>0&&(M*=100);const P=be(M);if(P!==1){const L=_?ne():W(x);Y(L.x,L.y,P)}}function W(x){const M=s.getBoundingClientRect(),P=x.clientX-M.left,L=x.clientY-M.top;return{x:P,y:L}}function ne(){const x=s.getBoundingClientRect();return{x:x.width*_.x,y:x.height*_.y}}function Y(x,M,P){return k.cancel(),ie(x,M,P)}function be(x){const M=Math.sign(x),P=Math.min(.25,Math.abs(m*x/128));return 1-M*P}function ye(){w||(w=!0,k.start())}function ke(){w&&(N||k.stop())}}function parseTransformOrigin(o){if(!!o){if(typeof o=="object")return(!isNumber(o.x)||!isNumber(o.y))&&failTransformOrigin(),o;failTransformOrigin()}}function failTransformOrigin(o){throw new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function validateBounds(o){const e=typeof o;if(e==="undefined"||e==="boolean")return;if(!(isNumber(o.left)&&isNumber(o.top)&&isNumber(o.bottom)&&isNumber(o.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}function isNumber(o){return Number.isFinite(o)}function isNaN$1(o){return Number.isNaN?Number.isNaN(o):o!==o}function rectanglesIntersect(o,e){const n=o.x2<e.x1,s=o.x1>e.x2,i=o.y1>e.y2,r=o.y2<e.y1;return!(n||s||i||r)}var canSocketsConnect=(o,e)=>e.type.includes(o.type)||e.type.includes("*");class NodeConnection{constructor(e,{input:n,output:s}){if(!s||!n)return;if(this.system=e,n.node.getChildren().includes(s.node))throw new Error("Circular reference");if(!canSocketsConnect(s,n))throw new Error("Can't connect type "+n.type+" to "+s.type);this.output=s,this.input=n,e.options.view&&(this.view=new NodeConnectionView(this)),this.output.setConnection(this),this.input.setConnection(this),this.output.node.system.save()}joinNode(e){if(!this.isNodeJoinable(e))return;this.remove(),this.output.node.connectTo(e,0,e.getInputs()[0].key);const n=this.input.node.getInputs(),s=n.indexOf(this.input),i=n[s].key;e.connectTo(this.input.node,0,i)}isNodeJoinable(e){const n=this.input.type,s=this.output.type;if(this.input.node===e||this.output.node===e)return!1;const i=e.getInputs();if(!i.length||!i.find(a=>a.type.includes(s)))return!1;const r=e.outputs;return!(!r.length||!r.find(a=>n.includes(a.type)||n.includes("*")))}remove(){this.view&&this.view.remove(),this.input.removeConnection(),this.output.removeConnection(this)}deserialize(){return{id:this.input.node.attributes.id,out:this.indexOut,in:this.indexIn}}get indexOut(){return this.output.node.outputs.indexOf(this.output)}get indexIn(){return this.input.key}}class Node extends EventEmitter{constructor(e,n){super();this.outputs=[],this._state={},this.states={},this.inputData=[],this.enableUpdates=!0,this.refs=[],this.system=e;const{attributes:s,state:i={}}=n;this._state=i,this.attributes=s,this.id=s.id,this._compute=memoize((r=this._state)=>this.compute(r))}get state(){return this._state}bindView(e){this.view=e,this.outputs.forEach(n=>n.bindView()),Object.values(this.states).forEach(n=>n.bindView())}setAttributes(e){this.attributes=O(O({},this.attributes),e),this.save()}compute(e){return e}getChildren(){return this.outputs.map(s=>s.connections).flat().map(s=>s.input.node)}getSockets(){return[...this.getInputs(),...this.outputs]}getInputs(){return Object.values(this.states).map(e=>e.getInput()).filter(e=>!!e)}setStateValue(e,n){this.states[e].setValue(n)}getStateValue(e){return this.state[e]}update(){!this.enableUpdates||(this.computedData=this._compute(this.state),this.emit("computedData",this.computedData),this.refs.forEach(e=>{e.node.enableUpdates=!1,e.keyIn.forEach(n=>{e.node.setStateValue(n,this.computedData)}),e.node.enableUpdates=!0,e.node.update()}),this.save())}remove(){this.system.removeNode(this),this.destroyEventEmitter()}connectTo(e,n=0,s=e.getInputs()[0].key){var c,d,f;const i=this.outputs[n],r=(c=e.states[s])==null?void 0:c.getInput();if(!r)return;const a=new NodeConnection(this.system,{output:i,input:r});(d=i==null?void 0:i.view)==null||d.updatePosition(),(f=r==null?void 0:r.view)==null||f.updatePosition();const u=this.refs.find(h=>h.node.id===e.id&&h.indexOut===n);return u?u.keyIn=[...u.keyIn,s]:this.refs.push({node:e,keyIn:[s],indexOut:n}),this.update(),a}disconnectFrom(e,n,s){this.refs=this.refs.filter(i=>!(i.indexOut!==s||(i.keyIn.splice(i.keyIn.indexOf(n),1),i.keyIn.length===0))),this.update()}deserialize(){const e=Object.assign({},this.attributes);e.refs=this.outputs.map(s=>s.connections).flat().map(s=>s.deserialize());const n={};return Object.values(this.states).forEach(s=>{n[s.key]=s.getValue()}),Object.assign({},{attributes:e,state:n})}save(){this.system.save()}}var BooleanNode={title:"Boolean",type:"boolean",outputs:["boolean"],parameters:{value:{type:"boolean",defaultValue:!1}},compute({value:o=!1}){return o}};const node={title:"Math",type:"math",outputs:["number","number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},compute({mode:o,a:e,b:n}){switch(o){case"multiply":return e*n;case"subtract":return e-n;default:return e+n}}};var NumberNode={title:"Number",type:"number",outputs:["number"],parameters:{value:{type:"number",internal:!0,label:!1,defaultValue:0}},compute({value:o=0}){return o}},NodeStateView$1="";class NodeStateView{constructor(e){this.nodeState=e,this.wrapper=document.createElement("div"),this.input=document.createElement("div"),this.wrapper.classList.add("node-state-single-wrapper"),this.input.classList.add("node-state-input");const n=e.template,s=n.label||e.key;if(typeof s=="string"){const i=document.createElement("p");i.className="state-label",i.innerHTML=s,this.wrapper.appendChild(i)}if((n==null?void 0:n.label)===!1&&this.wrapper.classList.add("hide-label"),!n.external){const i=stateToElement({target:this.input,template:n,value:e.getValue()});i&&i.$on("change",({detail:r})=>{typeof r!="undefined"&&!Number.isNaN(r)&&this.nodeState.setValue(r)})}e.node.view.stateWrapper.appendChild(this.wrapper),this.wrapper.appendChild(this.input)}updatePosition(){var e,n;this.rect=this.wrapper.getBoundingClientRect(),(n=(e=this.nodeState.getInput())==null?void 0:e.view)==null||n.updatePosition()}get y(){return this.rect.y-this.nodeState.node.view.y}get height(){return this.rect.height}setActive(e){this.wrapper.classList[e?"remove":"add"]("disabled")}}var NodeInputView$1="";class NodeInputView{constructor(e){if(!e||!e.node)throw new Error("Somethings missing");this.input=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-input-wrapper"),e.type.forEach(n=>{this.wrapper.classList.add(`socket-type-${n==="*"?"all":n}`)}),e.state.view.wrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",n=>{n.stopPropagation(),n.preventDefault();const s=this.input.connection;s?(s.remove(),this.node.system.view.createFloatingConnection(s.output)):this.node.system.view.createFloatingConnection(this.input)},!1),this.node.system.view.colorStore.on(e.type[0],n=>{const s=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=s!=="rgba(0, 0, 0, 0)"?s:n})}updatePosition(){var e;this.rect=this.wrapper.getBoundingClientRect(),(e=this==null?void 0:this.connection)==null||e.setPosition({x2:this.x,y2:this.y})}remove(){this.wrapper.remove(),this.connection&&this.connection.remove()}set state(e){this.wrapper.classList.forEach(n=>{n.includes("socket-state-")&&this.wrapper.classList.remove(n)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}get x(){return this.node.view.x-3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class NodeInput{constructor(e,n,s){this.state=e,this.key=s,this.node=e.node,this.type=Array.isArray(n)?n:[n]}bindView(){this.view=new NodeInputView(this)}removeConnection(){const e=this.connection;delete this.connection,e&&e.remove(),this.node.setStateValue(this.key,void 0),this.state.setIsExternal(!1)}setConnection(e){this.connection&&this.connection.remove(),this.connection=e,this.view&&(this.view.connection=e.view),this.state.setIsExternal(!0)}remove(){this.view&&this.view.remove(),this.removeConnection()}}class NodeState extends EventEmitter{constructor(e,n,s){super();var i,r;this.node=e,this.key=n,this.template=s,this.isExternal=!1,this.value=(r=(i=e.state[n])!=null?i:s.defaultValue)!=null?r:s.value,this.node._state[n]=this.value,this.template.internal||(this.input=new NodeInput(this,s.type,n))}setIsExternal(e=!1){var n;this.isExternal=e,(n=this==null?void 0:this.view)==null||n.setActive(!e)}getValue(){return this.value}setValue(e){this.isExternal||(this.value=e),this.node._state[this.key]=e,this.node.update()}remove(){}getInput(){return this.input}bindView(){this.view=new NodeStateView(this),this.input&&this.input.bindView()}}var NodeView$1="";class NodeView{constructor(e){this.inputs=[],this.outputs=[],this.active=!1,this.x=0,this.y=0,this.downX=0,this.downY=0,this.mDownX=0,this.mDownY=0,this.height=50,this.width=91,this.node=e,this.system=e.system,this.wrapper=document.createElement("div"),this.wrapper.style.minHeight=this.height+"px",this.wrapper.style.minWidth=this.width+"px",this.wrapper.classList.add("node-wrapper","node-type-"+e.attributes.type.toLowerCase()),this.wrapper.setAttribute("id","node-view-"+this.system.id+"-"+this.node.id),this.outputWrapper=document.createElement("div"),this.outputWrapper.classList.add("node-outputs-wrapper"),this.wrapper.append(this.outputWrapper);const n=document.createElement("p");n.innerHTML=e.attributes.name||e.attributes.type,n.classList.add("node-title"),this.wrapper.appendChild(n),this.stateWrapper=document.createElement("div"),this.stateWrapper.classList.add("node-state-wrapper"),this.wrapper.append(this.stateWrapper),e.system.view.nodeContainer.append(this.wrapper);const{pos:{x:s=0,y:i=0}={}}=e.attributes;this.bindEventListeners(),setTimeout(()=>{const{width:r,height:a}=this.wrapper.getBoundingClientRect();this.width=r/this.system.view.s,this.height=a/this.system.view.s,this.setPosition(s,i)},100)}bindEventListeners(){this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this._unsubscribeMouseMove=this.system.view.on("mousemove",e=>this.handleMouseMove(e)),this._unsubscribeMouseUp=this.system.view.on("mouseup",()=>this.handleMouseUp())}removeEventListeners(){this._unsubscribeMouseMove(),this._unsubscribeMouseUp(),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e))}set state(e){this.wrapper.classList.remove("node-active","node-selected","node-dragging"),this.wrapper.classList.add("node-"+e),this._state=e}get state(){return this._state}handleMouseDown(e){var i,r,a,u;if(this.system.view.keyMap.space||e.button===2||e.target!==e.currentTarget)return;e.stopImmediatePropagation(),e.stopPropagation(),this.node.system.view.setActive(this.node,e);const{rmx:n,rmy:s}=this.system.view;this.mDownX=n,this.mDownY=s,this.downX=((r=(i=this.node.attributes)==null?void 0:i.pos)==null?void 0:r.x)||0,this.downY=((u=(a=this.node.attributes)==null?void 0:a.pos)==null?void 0:u.y)||0,this.active=!0,this.system.view.selectedNodes.length&&this.system.view.selectedNodes.forEach(c=>{c.view.active=!0,c.view.mDownX=n,c.view.mDownY=s,c.view.downX=c.view.x,c.view.downY=c.view.y})}handleMouseUp(){this.active=!1,this.hoveredConnection&&(this.hoveredConnection.connection.joinNode(this.node),delete this.hoveredConnection)}handleMouseMove({mx:e,my:n,keys:s}){if(this.active){this.state="dragging";const i=s.ctrlKey?.02:1;let r=this.mDownX-e,a=this.mDownY-n;s.shiftKey&&(Math.abs(r)>Math.abs(a)?a=0:r=0);const u=Math.round((this.downX-r/this.system.view.s)*i)/i,c=Math.round((this.downY-a/this.system.view.s)*i)/i;this.setPosition(u,c)}}setPosition(e,n){this.x=e,this.y=n,this.wrapper.style.left=e+"px",this.wrapper.style.top=n+"px",Object.values(this.node.states).forEach(s=>{var i;return(i=s==null?void 0:s.view)==null?void 0:i.updatePosition()}),this.node.outputs.forEach(s=>s.view.updatePosition()),this.node.setAttributes({pos:{x:e,y:n}})}remove(){this.removeEventListeners(),this.wrapper.remove()}}class DebugNode extends Node{constructor(e,n){super(e,n);this.states={input:new NodeState(this,"input",{type:"*"})},this.outputs=[]}compute({input:e}){return e}}class DebugView extends NodeView{constructor(e){super(e);const n=document.createElement("div");e.on("computedData",s=>{n.innerHTML="";const i=document.createElement("p");i.innerHTML=JSON.stringify(s,null," "),n.append(i)}),this.wrapper.appendChild(n)}}var DebugNode$1={title:"Debug",meta:{description:"Outputs any inputs for debug purposes"},node:DebugNode,view:DebugView};class OutputNode extends Node{constructor(e,n){super(e,n);this.states={input:new NodeState(this,"input",{type:"*",external:!0,label:!1})},this.outputs=[]}compute({input:e}){return e}}class OutputView extends NodeView{constructor(e){super(e);const n=document.createElement("p");n.style.margin="0px",n.style.padding="4px",n.style.color="white",n.style.fontWeight="bold",e.on("computedData",s=>{n.innerHTML=JSON.stringify(s,null,2)}),this.wrapper.appendChild(n)}}var OutputNode$1={title:"Output",meta:{description:"Outputs the final value"},node:OutputNode,view:OutputView};const types={BooleanNode,MathNode:node,NumberNode,DebugNode:DebugNode$1,OutputNode:OutputNode$1};var AddMenu="";let longestModuleName=0;class Logger{constructor(e,n="system"in e?e.system.log.level:2){this.isGrouped=!1,this.output=log$8("logger"),this.module=e,this.name=e.constructor.name,this.length=this.name.length,longestModuleName=Math.max(longestModuleName,this.length),this.level=n,this.output=log$8(this.getModuleName())}getModuleName(){return this.isGrouped?"":`${this.name.padEnd(longestModuleName," ")}`}handle(e,n,s){s&&s.length?(console.groupCollapsed(`${this.getModuleName()} ${n}`),e(...s),console.groupEnd()):e(`${this.getModuleName()} ${n}`)}info(e,...n){this.level>=3&&this.output(e,...n)}log(e,...n){this.level>=2&&this.output(e,...n)}warn(e,...n){this.level>=1&&this.output.warn(e,...n)}error(e,...n){this.level>=0&&(this.output.error(e),this.output(...n))}group(e){this.output.group(e),this.isGrouped=!0}groupEnd(){console.groupEnd(),this.isGrouped=!1}}class SearchContainer{constructor(e,n,s){this.children=[],this.menu=e,this.type=n,s&&this.children.push(...s),this.wrapper=document.createElement("div"),this.wrapper.classList.add("search-container");const i=document.createElement("p");i.innerHTML=this.type.title,this.wrapper.appendChild(i);const r=[n.title];this.type.meta&&(this.type.meta.description&&r.push(this.type.meta.description.split(" ").join(":")),this.type.meta.tags&&r.push(...this.type.meta.tags)),this.searchString=r.join(":").toLowerCase(),this.menu.wrapper.appendChild(this.wrapper)}show(){this.wrapper.style.display=""}hide(){this.wrapper.style.display="none"}blur(){this.wrapper.classList.remove("focused")}focus(){this.menu.activeContainer&&this.menu.activeContainer.blur(),this.menu.activeContainer=this,this.wrapper.classList.add("focused")}showIfSearch(e){return this.searchString.includes(e.toLowerCase())?(this.show(),!0):(this.hide(),!1)}destroy(){this.wrapper.remove()}}class RightClickMenu{constructor(e){this.x=0,this.y=0,this.visible=!1,this.possibleContainers=[],this.filteredContainers=[],this.containers=[],this.view=e,this.system=e.system,this.log=new Logger(this),this.wrapper=document.createElement("div"),this.wrapper.classList.add("context-wrapper"),this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.placeholder="Search",this.wrapper.appendChild(this.searchInput),this.view.wrapper.append(this.wrapper),this.bindEventListeners(),this.view.on("keydown",({key:n})=>n==="Escape"&&this.hide())}updateTypes(e){this.containers.forEach(n=>n.destroy()),this.containers.push(...e.map(n=>new SearchContainer(this,n)))}setActive(e){const{length:n}=this.filteredContainers;if(!n)return;const i=(((this.activeContainer?this.filteredContainers.indexOf(this.activeContainer):0)+e)%n+n)%n;this.filteredContainers[i].focus(),this.log.info(`Set active entry ${i}`)}bindEventListeners(){window.addEventListener("mousedown",e=>this.handleWindowClick(e)),this.view.system.store.on("types",e=>this.updateTypes(e),20),this.view.on("keydown",({key:e})=>{switch(e){case"escape":this.reject();break;case"arrowdown":this.setActive(1);break;case"arrowup":this.setActive(-1);break}}),this.searchInput.addEventListener("input",()=>{const{value:e=""}=this.searchInput;this.search(e)}),this.searchInput.addEventListener("keydown",({keyCode:e})=>{e===13&&this.activeContainer&&this.resolve()})}handleWindowClick(e){const n=e.composedPath();this.visible&&!n.includes(this.wrapper)&&this.reject()}search(e){if(e&&e.length){const n=this.possibleContainers.filter(s=>s.showIfSearch(e));n.length===0?(this.filteredContainers=[...this.possibleContainers],this.filteredContainers.forEach(s=>s.show())):(this.filteredContainers=[...n],n[0].focus()),this.log.info(`Found ${n.length} entries for search:${e}`)}else this.filteredContainers=[...this.possibleContainers],this.filteredContainers.forEach(n=>n.show())}reject(){this.rej&&this.rej(),this.hide()}resolve(){var a;const e=(a=this.activeContainer)==null?void 0:a.type,{x:n,y:s}=this.view.projectWindowToLocal(this.x,this.y),i=n-this.view.width/2,r=s-this.view.height/2;e?this.res({attributes:{pos:{x:i,y:r},id:"",name:e.title,type:e.title,refs:[]},state:{value:void 0}}):this.reject(),this.hide()}hide(){this.visible=!1,this.wrapper.classList.remove("context-visible"),this.wrapper.blur(),this.res=e=>e,this.reject=()=>{},this.searchInput.disabled=!0}show({x:e,y:n,socket:s}){return this.x=e,this.y=n,this.socket=s,this.visible=!0,this.wrapper.style.left=e+"px",this.wrapper.style.top=n+"px",setTimeout(()=>{this.searchInput.disabled=!1,this.wrapper.classList.add("context-visible"),this.searchInput.value="",this.searchInput.focus(),this.search()},10),this.containers.forEach(i=>i.hide()),this.possibleContainers=s?this.containers.filter(i=>{var r,a,u;if(s instanceof NodeInput){const{type:c}=s;return!i.type.outputs||!i.type.outputs.length?!1:c.includes("*")?!0:(r=i.type.outputs)==null?void 0:r.some(d=>c.includes(d))}else{const{type:c}=s;return!i.type.inputs||!i.type.inputs.length?!1:c==="*"?!0:((a=i.type.inputs)==null?void 0:a.includes("*"))||((u=i.type.inputs)==null?void 0:u.includes(c))}}):this.containers,this.possibleContainers.forEach(i=>i.show()),this.possibleContainers.length&&this.possibleContainers[0].focus(),this.filteredContainers=[...this.possibleContainers],new Promise((i,r)=>{this.res=i,this.rej=r})}}var BoxSelection="";class BoxSelectionView extends EventEmitter{constructor(e){super();this.mDownX=0,this.mDownY=0,this.downX=0,this.downY=0,this.isShiftKey=!1,this.view=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("box-selection-wrapper"),this.view.wrapper.append(this.wrapper),this.view.on("mousedown",({target:n,mx:s,x:i,my:r,y:a,keys:u})=>{var c;u.space||u.shiftKey||u.button===2||!u.ctrlKey||n&&!((c=n==null?void 0:n.className)==null?void 0:c.includes("nodesystem"))||(this.mDownX=s,this.mDownY=r,this.downX=i,this.downY=a,this.wrapper.style.left=s+"px",this.wrapper.style.top=r+"px",this.wrapper.style.width="0px",this.wrapper.style.height="0px",this.isShiftKey=u.shift,this.show())})}show(){this.wrapper.classList.add("box-selection-visible");const e=this.view.system.nodes.map(i=>{const{width:r,height:a}=i.view,{x:u,y:c}=i.view,d=u+this.view.width/2,f=c+this.view.height/2,h=d+r,m=f+a;return{n:i,state:i.view.state,x1:d,y1:f,x2:h,y2:m}});let n=[];const s=this.view.on("mousemove",({mx:i,my:r,x:a,y:u})=>{const{mDownX:c,mDownY:d,downX:f,downY:h,isShiftKey:m}=this,_={x1:Math.min(i,c),x2:Math.max(i,c),y1:Math.min(r,d),y2:Math.max(r,d)};this.wrapper.style.left=_.x1+"px",this.wrapper.style.top=_.y1+"px",this.wrapper.style.width=Math.abs(c-i)+"px",this.wrapper.style.height=Math.abs(d-r)+"px";const g={x1:Math.min(a,f),x2:Math.max(a,f),y1:Math.min(u,h),y2:Math.max(u,h)};n=e.filter(v=>rectanglesIntersect(g,v)?!0:(m||(v.state="normal",v.n.view.state="normal"),!1)).map(({n:v,state:w})=>(w!=="active"&&(w="selected",v.view.state="selected"),v))},5);this.view.once("mouseup",()=>{s(),this.hide(),this.emit("selection",n)})}projectBox(e){const{x:n,y:s}=this.view.projectWindowToLocal(e.x1,e.y1),{x:i,y:r}=this.view.projectWindowToLocal(e.x2,e.y2);return{x1:n,y1:s,x2:i,y2:r}}hide(){this.wrapper.classList.remove("box-selection-visible")}}var NodeOutputView$1="";class NodeOutputView{constructor(e){this.connections=[],this.output=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-output-wrapper"),this.wrapper.classList.add(`socket-type-${e.type}`),e.node.view.outputWrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",n=>{n.stopPropagation(),n.preventDefault(),this.node.system.view.createFloatingConnection(this.output)},!1),this.node.system.view.colorStore.on(e.type,n=>{const s=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=s!=="rgba(0, 0, 0, 0)"&&s!=="rgb(0,0,0)"?s:n})}remove(){this.wrapper.remove(),this.connections.forEach(e=>e.remove())}set state(e){this.wrapper.classList.forEach(n=>{n.includes("socket-state-")&&this.wrapper.classList.remove(n)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}updatePosition(){this.rect=this.wrapper.getBoundingClientRect(),this.output.connections.forEach(e=>e.view.setPosition({x1:this.x,y1:this.y}))}get x(){return this.node.view.x+this.node.view.width+3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class NodeOutput{constructor(e,n){if(this.connections=[],this.node=e,this.type=n,Array.isArray(n))throw new Error("Output can only output one type, not "+n)}bindView(){this.view=new NodeOutputView(this)}connectTo(e){const n=this.node.outputs.indexOf(this);return this.node.connectTo(e.node,n,e.key)}removeConnection(e){const n=this.connections.indexOf(e);this.connections.splice(n,1),this.node.disconnectFrom(e.input.node,e.indexIn,e.indexOut),this.view&&this.view.connections.splice(n,1)}setConnection(e){this.connections.push(e),this.view&&this.view.connections.push(e.view)}remove(){this.connections.forEach(e=>e.remove())}}class FloatingConnectionView extends aggregate(ConnectionView,EventEmitter){constructor(e,n={}){const{system:s}=e.node;super({},e);this.view=s.view,this.path.style.zIndex="999";const i=Array.isArray(e.type)?e.type[0]:e.type;s.view.colorStore.on(i,h=>{this.path.style.stroke=h}),e.view.updatePosition();const r=e.view.x,a=e.view.y;let u=r,c=a;n&&(u=n.x-s.view.width/2,c=n.y-s.view.height/2),this.setPosition({x1:r,y1:a,x2:u,y2:c}),this.dx2=this.x2,this.dy2=this.y2,this.isInput=e instanceof NodeInput,this.allSockets=e instanceof NodeInput?s.getOutputs(e.type):s.getInputs(e.type),this.allSockets.forEach(h=>h.view.state="potential");let d=this.allSockets.filter(h=>h.node.attributes.id!==e.node.attributes.id);d.forEach(h=>h.view.state="middle");const f="connection"in e?[e.connection]:e.connections;if(f&&!!f.length){const h=f.map(m=>[m.input,m.output]).flat();d=d.filter(m=>!h.includes(m))}this.potentialSockets=d,this.potentialSockets.forEach(h=>h.view.updatePosition()),this.potentialSockets.forEach(h=>h.view.state="highlight"),this._unsubMouseUp=this.view.on("mouseup",this.handleMouseUp.bind(this)),this._unsubMouseMove=this.view.on("mousemove",this.handleMouseMove.bind(this)),this.mdx=this.view.mx,this.mdy=this.view.my,this.socket=e}handleMouseUp(e){const{x:n,y:s,keys:i}=e;this._unsubMouseUp(),this._unsubMouseMove(),this.allSockets.forEach(u=>u.view.state="");let r,a=0;this.socket instanceof NodeInput&&this.hoveredSocket instanceof NodeOutput?(r=this.socket.key,a=this.hoveredSocket.node.outputs.indexOf(this.hoveredSocket)):this.socket instanceof NodeOutput&&this.hoveredSocket instanceof NodeInput&&(r=this.hoveredSocket.key,a=this.socket.node.outputs.indexOf(this.socket)),this.hoveredSocket?(this.emit("connection",{keyIn:r,indexOut:a,inputNode:this.isInput?this.socket.node:this.hoveredSocket.node,outputNode:this.isInput?this.hoveredSocket.node:this.socket.node}),this.remove()):i.ctrlKey?this.view.addMenu.show({x:n,y:s,socket:this.socket}).then(u=>this.view.system.createNode(u)).then(u=>{this.socket instanceof NodeOutput?this.socket.node.connectTo(u,a,r):u.connectTo(this.socket.node,a,r)}).catch(()=>{}).finally(()=>{this.remove()}):this.remove()}handleMouseMove(e){const{x:n,y:s}=e;this.mdx||(this.mdx=n,this.mdy=s);const i=this.dx2+(n-this.mdx),r=this.dy2+(s-this.mdy),a=20,u=this.potentialSockets.map(c=>{const{x:d,y:f}=c.view;return{socket:c,distance:Math.abs(i-d)+Math.abs(r-f)}}).filter(c=>c.distance<a).sort((c,d)=>c.distance>d.distance?-1:1).map(c=>c.socket);if(u.length){const{x:c,y:d}=u[0].view;this.hoveredSocket=u[0],this.setPosition({x2:c,y2:d})}else this.hoveredSocket=void 0,this.setPosition({x2:i,y2:r})}remove(){super.remove()}}var NodeSystemView$1="";const COLORS=[{color:"#a52a2a",name:"brown"},{color:"#008000",name:"green"},{color:"#4b0082",name:"indigo"},{color:"#f0e68c",name:"khaki"},{color:"#add8e6",name:"lightblue"},{color:"#e0ffff",name:"lightcyan"},{color:"#90ee90",name:"lightgreen"},{color:"#d3d3d3",name:"lightgrey"},{color:"#ffb6c1",name:"lightpink"},{color:"#ffffe0",name:"lightyellow"},{color:"#00ff00",name:"lime"},{color:"#ff00ff",name:"magenta"},{color:"#800000",name:"maroon"},{color:"#000080",name:"navy"},{color:"#808000",name:"olive"},{color:"#ffa500",name:"orange"},{color:"#ffc0cb",name:"pink"},{color:"#800080",name:"purple"},{color:"#800080",name:"violet"},{color:"#ff0000",name:"red"},{color:"#c0c0c0",name:"silver"},{color:"#ffffff",name:"white"}];class ColorStore extends EventEmitter{constructor(){super();this.colors={boolean:"#f00",number:"#fff",plant:"#65e2a0",vec3:"#6363C7"},this.index=0}setType(e){e in this.colors||(this.colors[e]=COLORS[this.index].color,this.index++),this.emit(e,this.colors[e])}on(e,n){return this.setType(e),n(this.colors[e]),super.on(e,n)}}class NodeSystemView extends EventEmitter{constructor(e){super();var n,s,i,r;this.colorStore=new ColorStore,this.width=0,this.height=0,this.top=0,this.left=0,this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.s=1,this.mx=0,this.my=0,this.mdx=0,this.mdy=0,this.rmx=0,this.rmy=0,this.mouseDown=!1,this.keyMap={},this.selectedNodes=[],this.selectedNodesDown=[],this.clipboard=[],this.system=e,this.wrapper=(s=(n=e.options)==null?void 0:n.wrapper)!=null?s:document.createElement("div"),this.wrapper.classList.add("nodesystem-wrapper"),e.options.parent&&e.options.parent.appendChild(this.wrapper),this.transformWrapper=document.createElement("div"),this.transformWrapper.classList.add("nodesystem-transform"),this.wrapper.appendChild(this.transformWrapper),this.nodeContainer=document.createElement("div"),this.nodeContainer.classList.add("nodes-container"),this.transformWrapper.append(this.nodeContainer),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewBox","0 0 1 1"),this.svg.setAttribute("height","1"),this.svg.setAttribute("width","1"),this.svg.setAttribute("preserveAspectRatio","none"),this.svg.style.transform=`scale(${(i=window.devicePixelRatio)!=null?i:1})`,this.transformWrapper.appendChild(this.svg),this.addMenu=new RightClickMenu(this),this.boxSelection=new BoxSelectionView(this),this.boxSelection.on("selection",a=>{this.selectedNodes=a}),this.dpr=(r=window.devicePixelRatio)!=null?r:1,this.bindEventListeners(),this.handleResize(),setTimeout(()=>{this.setTransform({x:0,y:0,s:1})},1)}createFloatingConnection(e){new FloatingConnectionView(e,{x:this.mx,y:this.my}).once("connection",({inputNode:s,outputNode:i,keyIn:r,indexOut:a})=>{i.connectTo(s,a,r)})}setActive(e,{shiftKey:n=!1,ctrlKey:s=!1}={}){if(!e)this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.selectedNodes.forEach(i=>i.view.state="normal"),this.selectedNodes=[];else if(n&&s){if(this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.activeNode=e,this.activeNode.view.state="active",this.activeNode.outputs.length){const i=this.system.createNode({state:{},attributes:{type:"debug",id:"0",name:"debug",refs:[],pos:{x:this.activeNode.view.x+this.activeNode.view.width+10,y:this.activeNode.view.y}}});i.enableUpdates=!0,this.activeNode.connectTo(i,0,"input")}}else n?this.activeNode?(this.selectedNodes.push(this.activeNode),this.activeNode.view.state="selected",this.activeNode=e,this.activeNode.view.state="active"):(this.activeNode=e,this.activeNode.view.state="active"):this.activeNode?(this.selectedNodes.forEach(i=>i.view.state="normal"),this.selectedNodes=[],this.activeNode!==e&&(this.activeNode.view.state="normal",this.activeNode=e,this.activeNode.view.state="active")):(this.activeNode=e,this.activeNode.view.state="active")}getSelectedNodes(){return this.activeNode&&this.selectedNodes.includes(this.activeNode)?this.selectedNodes:this.activeNode?[...this.selectedNodes,this.activeNode]:[...this.selectedNodes]}projectLocalToWindow(e,n){const s=e+this.x,i=n+this.y,r=s*this.s,a=i*this.s;return{x:r,y:a}}projectWindowToLocal(e,n){const s=e-this.x,i=n-this.y,r=s/this.s,a=i/this.s;return{x:r,y:a}}setTransform({x:e=this.x,y:n=this.y,s=this.s}={}){this.x=e,this.y=n,this.s=s/this.dpr,this.panzoom.setTransform(e,n,s/this.dpr)}bindEventListeners(){window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e)),this.wrapper.addEventListener("mousemove",e=>this.handleMouseMove(e)),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("touchdown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("mouseup",e=>this.handleMouseUp(e)),window.addEventListener("resize",throttle(()=>this.handleResize(),10)),this.panzoom=createPanZoom(this.transformWrapper,{minZoom:.2,maxZoom:5,onTransform:({x:e,y:n,scale:s})=>{this.x=e,this.y=n,this.s=s,this.wrapper.style.backgroundPosition=`${e}px ${n}px`,this.wrapper.style.backgroundSize=s*this.height*.02+"% "+s*this.width*.02+"%",this.wrapper.style.backgroundOrigin=`${e}px ${n}px`,window.t={x:e,y:n,s},this.system.setMetaData({transform:{x:e,y:n,s}})}})}handleResize(){const{width:e,height:n,top:s,left:i}=this.wrapper.getBoundingClientRect();this.width=e,this.height=n,this.top=s,this.left=i,this.emit("resize",{width:e,height:n})}handleMouseMove(e){this.ev=e;const{clientX:n,clientY:s,shiftKey:i,ctrlKey:r}=e;this.rmx=n-this.left,this.rmy=s-this.top;const{x:a,y:u}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=a,this.my=u,this.emit("mousemove",{x:a,y:u,mx:this.rmx,my:this.rmy,keys:F(O({},this.keyMap),{shiftKey:i,ctrlKey:r})})}handleMouseDown(e){const{shiftKey:n,ctrlKey:s,clientX:i,clientY:r,button:a,target:u}=e;n||this.setActive(),this.mouseDown=!0,this.rmx=i-this.left,this.rmy=r-this.top;const{x:c,y:d}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=c,this.my=d,this.selectedNodesDown=this.selectedNodes.map(f=>[f.view.x,f.view.y]),this.emit("mousedown",{x:c,y:d,mx:this.rmx,my:this.rmy,target:u,keys:F(O({},this.keyMap),{shiftKey:n,ctrlKey:s,button:a})})}handleMouseUp({clientX:e,clientY:n,shiftKey:s,ctrlKey:i}){this.mouseDown=!1;const r=e-this.left,a=n-this.top;this.emit("mouseup",{x:r,y:a,keys:F(O({},this.keyMap),{shiftKey:s,ctrlKey:i})})}handleKeyUp({key:e}){e===" "&&(e="space"),delete this.keyMap[e&&e.toLowerCase()],this.emit("keyup",{key:e,keys:this.keyMap})}handleKeyDown({key:e,ctrlKey:n,shiftKey:s}){switch(e=e===" "?"space":e.toLowerCase(),this.keyMap[e&&e.toLowerCase()]=!0,e==="space"&&this.ev&&this.handleMouseDown(this.ev),e){case"a":s&&this.addMenu.show({x:this.rmx,y:this.rmy}).then(i=>{this.system.createNode(i)}).catch();break;case"c":if(s&&n)localStorage.clear(),window.location.reload();else if(n){const i=this.selectedNodes.splice(0);this.activeNode&&!i.includes(this.activeNode)&&i.push(this.activeNode),this.clipboard=i.map(r=>r.deserialize())}else this.selectedNodes.length&&this.activeNode&&this.selectedNodes[0].connectTo(this.activeNode);break;case"f":this.setTransform({x:0,y:0,s:1});break;case"g":this.keyMap.g||(this.mdx=this.mx,this.mdy=this.my,this.selectedNodesDown=this.selectedNodes.map(i=>[i.view.x,i.view.y]));break;case"x":this.activeNode&&(n?this.system.spliceNode(this.activeNode):this.system.removeNode(this.activeNode)),this.selectedNodes.forEach(i=>i.remove());break;case"z":break;case"l":this.activeNode&&(console.log(this.activeNode),console.log(this.activeNode.deserialize()));break;case"v":if(n){const i=this.clipboard.sort((d,f)=>{const{pos:{x:h=0,y:m=0}={}}=d.attributes,{pos:{x:_=0,y:g=0}={}}=f.attributes;return h+m<_+g?-1:1});let{pos:{x:r=0,y:a=0}={}}=i[0].attributes;const{x:u,y:c}=this.projectWindowToLocal(this.mx,this.my);r-=u,a-=c,this.clipboard.map(d=>{const{pos:{x:f=0,y:h=0}={}}=d.attributes;return d.attributes.pos={x:f-r,y:h-a},d}).forEach(d=>this.system.createNode(d))}break}this.emit("keydown",{key:e,keys:F(O({},this.keyMap),{ctrlKey:n})})}}class NodeFactory{constructor(e){this.id=genId(),this.system=e,this.log=new Logger(this),this.log.info("Initialized")}reset(){this.id.reset(),this.log.info("Reset id generator")}create(e){const{attributes:n}=e,s=n.type.toLowerCase(),i=this.system.store.getByName(s);n.id=this.id(+n.id);const r=new i.node(this.system,e);if(this.system.options.view&&i.view){const a=new i.view(r);r.bindView(a)}return s==="output"&&(this.system.outputNode&&this.system.outputNode.remove(),this.system.outputNode=r,r.on("computedData",a=>this.system.result=a)),this.log.info(`Created node with type ${n.type}`,e),r}}class NodeParser{constructor(e){this.system=e}parseSystem(e){const{nodes:n}=e,s=new Map,i=n.map(r=>{const a=this.system.factory.create(r);return a.enableUpdates=!1,s.set(a.id,a),a});return i.forEach(r=>{r.attributes.refs&&r.attributes.refs.forEach(a=>{const u=s.get(a.id);if(!u)throw new Error(`Failed ref: from ${r.attributes.name||r.attributes.id} to ${a.id} `);r.connectTo(u,a.out,a.in)})}),i.forEach(r=>{r.enableUpdates=!0,r.update()}),i}parseType(e){const{compute:n,meta:s,outputs:i,title:r,parameters:a}=e,u=class extends Node{constructor(d,f){super(d,f);if(n&&(this.compute=n),i){const h=Array.isArray(i)?i:[i];this.outputs=h.map(m=>new NodeOutput(this,m))}Object.entries(a).forEach(([h,m])=>{this.states[h]=new NodeState(this,h,m)})}},c=Object.values(a).filter(d=>d.internal!==!0).map(d=>d.type);if(this.system.options.view){const d=class extends NodeView{constructor(h){super(h)}};return F(O({},e),{inputs:c,title:r,meta:s,node:u,view:d})}return F(O({inputs:c},e),{title:r,meta:s,node:u})}getData(){return{meta:this.system.meta,nodes:this.system.nodes.map(e=>e.deserialize())}}}const log$4=log$8("NodeTypeStore");class NodeTypeStore extends EventEmitter{constructor(){super();this.types=[],this.typeMap={}}add(e){log$4("register new type "+e.title,e),this.types=[...this.types.filter(n=>n.title.toLowerCase()!==e.title.toLowerCase()),e],this.typeMap[e.title.toLowerCase()]=e,this.emit("types",this.types),this.emit("type",e)}getByName(e){if(e in this.typeMap)return this.typeMap[e];throw new Error("NodeTypeStore: type "+e+" does not exist")}}var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(o,e,n,s)=>{for(var i=s>1?void 0:s?__getOwnPropDesc(e,n):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(i=(s?a(e,n,i):a(i))||i);return s&&i&&__defProp(e,n,i),i};let systemID=0;class NodeSystem extends EventEmitter{constructor(e={}){super();this.parser=new NodeParser(this),this.meta={lastSaved:Date.now()},this.isLoaded=!1,this.isPaused=!1,this.nodes=[],this.states=[],this.id=systemID++;const{view:n=!1,wrapper:s,defaultNodes:i=!1,registerNodes:r=!1,logLevel:a=5}=e;this.options={view:n,wrapper:s};try{if(this.log=new Logger(this,a),this.log.group(`Instantiated id:${this.id}`),this.store=new NodeTypeStore,this.factory=new NodeFactory(this),n&&(this.view=new NodeSystemView(this)),i){const u=[];i===!0?u.push(...Object.entries(types).map(c=>c[1])):Array.isArray(i)&&i.length&&i.forEach(c=>{typeof c=="string"&&c in types&&u.push(types[c])}),u.forEach(c=>this.registerNodeType(c))}r&&r.length&&r.forEach(this.registerNodeType.bind(this)),this.log.groupEnd()}catch(u){this.emit("error",{type:"init",error:u})}}get result(){return this._result}set result(e){this._result=e,this.isLoaded&&this.emit("result",e)}setMetaData(e){this.meta=O(O({},this.meta),e),this.save()}load(e){try{this.isLoaded=!1,this.isPaused=!0,this.nodes.forEach(s=>s.enableUpdates=!1),this.nodes.forEach(s=>s.remove()),this.factory.reset();const n=this.parser.parseSystem(e);return this.addNodes(n),this.meta=e.meta||{lastSaved:0},this.meta.lastSaved=Date.now(),this.view&&this.view.setTransform(this.meta.transform),this.log.info(`Loaded NodeSystemData with ${n.length} Nodes`,e),this.isPaused=!1,this.isLoaded=!0,this.result=this._result,this}catch(n){this.emit("error",{type:"loading",error:n})}}serialize(){return F(O({},this.parser.getData()),{meta:this.meta})}save(){this.isLoaded&&(this.meta.lastSaved=Date.now(),this.log.info("save system",this.serialize()),this.emit("save",this.serialize()))}addNodes(e){e.forEach(n=>this.addNode(n))}addNode(e){this.nodes.push(e),this.save()}removeNode(e){e.view.remove(),Object.values(e.states).forEach(n=>n.remove()),e.outputs.forEach(n=>n.remove()),e.getInputs().forEach(n=>n.remove()),this.nodes=this.nodes.filter(n=>n!==e),this.save(),this.log.info(`Removed Node id:${e.id} type:${e.attributes.type}`,e.deserialize())}spliceNode(e){const n=e.getInputs().map(i=>{var r;return(r=i==null?void 0:i.connection)==null?void 0:r.output}),s=e.outputs.map(i=>i.connections).flat().map(i=>i.input);for(let i=0;i<n.length;i++){const r=n[i],a=s[i];!a||!r||r.connectTo(a)}return this.removeNode(e)}getSockets(e){const n=this.nodes.map(s=>[...s.getSockets()]).flat();return e?n.filter(s=>s.type===e):n}getInputs(e){const n=this.nodes.map(s=>s.getInputs()).flat();return!e||e==="*"?n:n.filter(s=>s.type.includes("*")||s.type.includes(e))}getOutputs(e){const n=this.nodes.map(s=>s.outputs).flat();return!e||e.includes("*")?n:n.filter(s=>s.type==="*"||e.includes(s.type))}createNode(e){const n=this.factory.create(e);return this.addNode(n),this.save(),this.log.info(`Created new node id:${e.attributes.id} type:${e.attributes.type}`,e),n}getNodes(){return this.nodes}getNodeTypes(){return this.store.types}registerNodeType(e){if("node"in e)this.store.add(e);else{const n=this.parser.parseType(e);this.store.add(n)}this.log.info(`Registered new nodeType type:${e.title}`,e)}}__decorateClass([Debounce(1e3)],NodeSystem.prototype,"save",1);const log$3=log$8("ProjectManager"),PTP_PREFIX="pt_project_";class ProjectManager extends EventEmitter{constructor(){super();this.activeProject=writable(),this.projects={},this.store=writable([]),this.loadProjects()}createNewProject(){const e=Object.values(this.projects).filter(s=>/^DefaultProject((\d)+)?/.test(s.meta.name)).length,n={meta:{name:"DefaultProject"+(e||""),id:shortid(),transform:{x:0,y:0,s:1}},nodes:[{attributes:{pos:{x:-100,y:0},type:"stem",id:"1",refs:[{id:"0",in:"main",out:0}]}},{attributes:{pos:{x:0,y:0},type:"output",id:"0",refs:[]}}]};return log$3("created new plant",n),n}createNew(){const e=this.createNewProject();this.emit("new",e),this.saveProject(e)}async updateProjectMeta(e,n){const s=await this.getProject(e);s.meta=O(O({},s.meta),n),log$3("update meta",e),this.emit("update",s),this.saveProject(s)}async saveProject(e){const n=JSON.parse(JSON.stringify(e));this.projects[n.meta.id]=n,this.emit("save",n),await storage.setItem("pt_project_ids",Object.keys(this.projects)),await storage.setItem(PTP_PREFIX+n.meta.id,n),log$3("saved plant id: ",n.meta.id),this.store.set(Object.values(this.projects))}async getProject(e){if(e in this.projects)return this.projects[e];const n=await storage.getItem(PTP_PREFIX+e);return this.projects[e]=n,n}async deleteProject(e){e in this.projects?(delete this.projects[e],await storage.removeItem(PTP_PREFIX+e),await storage.setItem("pt_project_ids",Object.keys(this.projects)),this.store.set(Object.values(this.projects)),this.emit("delete",e),log$3("deleted project with id: "+e)):log$3.warn("cant delete project with id: "+e)}async setActiveProject(e){if(this.loadingActiveProject||e===this.activeProjectId)return;this.activeProjectId=e,this.loadingActiveProject=this.getProject(e);const n=await this.loadingActiveProject;this.loadingActiveProject?(this.activeProjectId=e,this.saveProject(n),this.activeProject.set(n),await storage.setItem("pt_active_id",e),log$3("set active project to id: "+e),this.emit("load",n),delete this.loadingActiveProject):log$3.warn("cant find plant with id: "+e)}async loadProjects(){const e=await storage.getItem("pt_project_ids")||[];log$3("loaded project ids",e);const n=await storage.getItem("pt_active_id");if(!e.length){const s=this.createNewProject();e.push(s.meta.id),await this.saveProject(s)}await Promise.all(e.map(async s=>{const i=await this.getProject(s);log$3("loaded ",s),this.projects[s]=i})),n&&e.includes(n)?this.setActiveProject(n):this.setActiveProject(e[0]),this.store.set(Object.values(this.projects))}setProject(e){this.plant=e,this.emit("plant",e)}getActiveProject(){return this.plant}setSettings(e){this.emit("settings",e)}}const savedState=JSON.parse(localStorage.getItem("pt_local_state")),state=O({},savedState),set=debounce((o,e)=>{state[o]=e,localStorage.setItem("pt_local_state",JSON.stringify(state))},100,!1);var localState={get(o,e){var n;return state[o]=(n=state[o])!=null?n:e,state[o]},set},isNode=o=>typeof o=="object"&&"type"in o,uniqID=(()=>{let o=Math.random();return()=>(o=o>0?o-Math.random():o+Math.random(),o.toString().split(".")[1])})();const nodes={};_nodes.forEach(o=>{nodes[o.type]=o,"computeSkeleton"in o&&(o.computeSkeleton=memo(o.computeSkeleton)),"computeGeometry"in o&&(o.computeGeometry=memo(o.computeGeometry)),"computeValue"in o&&(o.computeValue=memo(o.computeValue))});function executeSkeletonNode(o,e){return o.type in nodes&&nodes[o.type].computeSkeleton?nodes[o.type].computeSkeleton(o.computedParameters,e):o.computedParameters}function executeGeometryNode(o,e){return o.type in nodes&&nodes[o.type].computeGeometry?nodes[o.type].computeGeometry(o.computedParameters,o.result,e):o.computedParameters}function executeValueNode(o,e,n){return o.type in nodes&&nodes[o.type].computeValue?nodes[o.type].computeValue(o.computedParameters,e,n):o.computedParameters}const walkSkeletonNode=(o,e)=>(o.computedParameters={},Object.entries(o.parameters).forEach(([n,s])=>{isNode(s)?o.computedParameters[n]=walkSkeletonNode(s,e):o.computedParameters[n]=s}),o.result=executeSkeletonNode(o,e),o),walkGeometryNode=(o,e)=>(o.computedParameters={},Object.entries(o.parameters).forEach(([n,s])=>{isNode(s)?o.computedParameters[n]=walkGeometryNode(s,e):o.computedParameters[n]=s}),o.result=O(O({},o.result),executeGeometryNode(o,e)),o),walkValueNode=(o,e,n)=>{var s;return o.computedParameters=(s=o.computedParameters)!=null?s:{},Object.entries(o.parameters).forEach(([i,r])=>{isNode(r)?o.computedParameters[i]=walkValueNode(r,e,n):o.computedParameters[i]=r}),executeValueNode(o,e,n)};let lastSettings="",lastCtx,currentNoise=0;const createContext=o=>{let e=0;noise.seed=0;let n=uniqID();return{handleParameter(s,i=1){return typeof s=="number"?s:isNode(s)?walkValueNode(s,this,i):s},n1d(s){return noise.n1d(currentNoise++*s)},getSetting(s){return o[s]},get settings(){return o},get seed(){return e},refresh(){currentNoise=0,(o==null?void 0:o.useRandomSeed)&&(e=Math.floor(Math.random()*1e5),noise.seed=e),n=uniqID()}}};var createContext$1=o=>{const e=JSON.stringify(o);return e!==lastSettings&&(lastSettings=e,lastCtx=createContext(o)),lastCtx.refresh(),lastCtx};const log$2=log$8("gen.plant");function plant(o,e){var u;log$2("-------- ~generator started~ --------");const n=performance.now(),s=createContext$1(e),i=walkSkeletonNode(o,s);log$2("final skeleton",i.result);const r=walkGeometryNode(i,s);log$2("final geometry",r);const{result:a}=r;if(a.instances){const c=(u=a.instances)==null?void 0:u.map(d=>convertInstancedGeometry(d)).flat();a.geometry=join(a.geometry,...c)}return log$2("generated in ",Math.floor((performance.now()-n)*10)/10,"ms"),a}function WorkerWrapper(){return new Worker("assets/webWorker.22d229d5.js",{type:"module"})}var worker=()=>{const o=WorkerWrapper(),e=wrap(o);let n=!1;async function s(i,r){if(n)return;n=!0;const a=await e.plant(i,r);return n=!1,a}return{plant:s}};class Renderer extends EventEmitter{constructor({canvas:e,width:n,height:s,clearColor:i="ffffff",camPos:r=[0,2,4]}={}){super();if(this.scene=new Transform,this.lastCamPos=new Vec3(0,0,0),this.canvas=e,(!n||!s)&&e){const a=e.getBoundingClientRect();n=a.width,s=a.height}this.renderer=new Renderer$1({canvas:e,width:n,height:s,antialias:!0,dpr:1}),this.gl=this.renderer.gl,this.gl.clearColor(...convertHexToRGB(i),1),this.renderer.gl.canvas&&(this.canvas=this.renderer.gl.canvas),this.camera=new Camera(this.gl,{fov:70,aspect:n/s}),this.lastCamPos.set(r),this.camera.position.set(r),this.camera.lookAt(new Vec3(0,0,0)),e&&(this.controls=new Orbit(this.camera,{element:e,target:new Vec3(0,.2,0),maxPolarAngle:1.6,minDistance:.2,maxDistance:15,ease:.7,rotateSpeed:.5,inertia:.5})),this.bindEventlisteners(),e&&this.render()}setControlTarget(e){Number.isNaN(e.x)||(this.controlTarget||(this.controls.target=e),this.controlTarget=e)}setClearColor(e){this.gl.clearColor(...convertHexToRGB(e),1)}renderScene(e){this.renderer.render({scene:e,camera:this.camera})}render(){requestAnimationFrame(this.render.bind(this)),this.lastCamPos.equals(this.camera.position)||(this.lastCamPos.set(this.camera.position),this.emit("camPos",this.camera.position.toArray())),this.controlTarget&&(this.controlTarget.squaredDistance(this.controls.target)<5e-5?this.controls.target=this.controlTarget:this.controls.target.lerp(this.controlTarget,.05)),window.target=this.controls.target,this.controls.update(),this.renderer.render({scene:this.scene,camera:this.camera})}bindEventlisteners(){const e=throttle(()=>this.handleResize(),500);window.addEventListener("resize",()=>{this.canvas.classList.add("resizing"),e()})}handleResize(){let e=this.canvas.parentElement;e||(e=this.canvas);const{width:n,height:s}=e.getBoundingClientRect();this.renderer.setSize(n,s),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height}),this.canvas.classList.remove("resizing")}}var GroundShaderFrag=`precision highp float;precision highp int;
#define GLSLIFY 1
uniform float uTime;uniform sampler2D tMap;uniform vec3 uFogColor;uniform float uFogNear;uniform float uFogFar;uniform float texScale;varying vec2 vUv;varying vec4 vMVPos;varying vec3 vPos;void main(){vec3 tex=texture2D(tMap,vUv*texScale).rgb;float dist=length(vMVPos);float fog=smoothstep(uFogNear,uFogFar,dist);tex=mix(tex,uFogColor,fog);tex=mix(tex,uFogColor,smoothstep(0.0,-1.0,vPos.y));gl_FragColor.rgb=tex;}`,GroundShaderVert=`precision highp float;precision highp int;
#define GLSLIFY 1
attribute vec2 uv;attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform float uTime;varying vec2 vUv;varying vec4 vMVPos;varying vec3 vPos;void main(){vUv=uv;vec3 pos=position;vPos=pos;vMVPos=modelViewMatrix*vec4(pos,1.0);gl_Position=projectionMatrix*vMVPos;}`,MatCapFrag=`#version 300 es
precision highp float;
#define varying in
#define texture2D texture
#define gl_FragColor FragColor
out vec4 FragColor;precision highp float;
#define GLSLIFY 1
uniform sampler2D tMap;varying vec4 vMVPos;vec3 normals(vec3 pos){vec3 fdx=dFdx(pos);vec3 fdy=dFdy(pos);return normalize(cross(fdx,fdy));}vec2 matcap(vec3 eye,vec3 normal){vec3 reflected=reflect(eye,normal);float m=2.8284271247461903*sqrt(reflected.z+1.0);return reflected.xy/m+0.5;}void main(){vec3 normal=normals(vMVPos.xyz);vec3 mat=texture2D(tMap,matcap(normalize(vMVPos.xyz),normal)).rgb;gl_FragColor.rgb=mat;gl_FragColor.a=1.0;}`,MatCapVert=`#version 300 es
#define GLSLIFY 1
#define attribute in
#define varying out
attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;varying vec4 vMVPos;void main(){vMVPos=modelViewMatrix*vec4(position,1.0);gl_Position=projectionMatrix*vMVPos;}`,ParticleFrag=`precision highp float;
#define GLSLIFY 1
float pointSize=0.02;varying float distToCamera;void main(){vec2 uv=gl_PointCoord.xy;float dist=2.0-distToCamera;float circle=pointSize*dist>length(uv-0.5)?0.8:0.0;float xMask=min(abs(uv.x-0.5),abs(uv.y-0.5));circle=xMask>0.003?0.0:circle;gl_FragColor.rgb=vec3(0.0,0.0,0.0);gl_FragColor.a=circle;}`,ParticleVert=`#define GLSLIFY 1
attribute vec3 position;uniform mat4 modelMatrix;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;varying float distToCamera;void main(){vec4 mPos=modelMatrix*vec4(position,1.0);vec4 mvPos=viewMatrix*mPos;gl_PointSize=300.0/length(mvPos.xyz);distToCamera=-mvPos.z/10.0+1.0;gl_Position=projectionMatrix*mvPos;}`,WireFrameFrag=`precision highp float;precision highp int;
#define GLSLIFY 1
void main(){gl_FragColor=vec4(1.,.9,.4,.7);}`,WireFrameVert=`precision highp float;precision highp int;
#define GLSLIFY 1
attribute vec2 uv;attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`;const GroundShader={fragment:GroundShaderFrag,vertex:GroundShaderVert},WireFrameShader={fragment:WireFrameFrag,vertex:WireFrameVert},ParticleShader={fragment:ParticleFrag,vertex:ParticleVert},MatCapShader=o=>{const e=new Texture(o),n=new Image;return n.onload=()=>e.image=n,n.src="assets/matcap_green.jpg",new Program(o,{vertex:MatCapVert,fragment:MatCapFrag,uniforms:{tMap:{value:e}},cullFace:null})};worker();const renderer=new Renderer({width:100,height:100});new NodeSystem({view:!1,defaultNodes:!1,registerNodes:_nodes});const mesh=new Mesh(renderer.gl,{geometry:new Box(renderer.gl,{width:0,height:0,depth:0}),program:MatCapShader(renderer.gl)});mesh.setParent(renderer.scene);class BrowserInfo{constructor(e,n,s){this.name=e,this.version=n,this.os=s,this.type="browser"}}class NodeInfo{constructor(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}}class SearchBotDeviceInfo{constructor(e,n,s,i){this.name=e,this.version=n,this.os=s,this.bot=i,this.type="bot-device"}}class BotInfo{constructor(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}class ReactNativeInfo{constructor(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}const SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(o){return o?parseUserAgent(o):typeof document=="undefined"&&typeof navigator!="undefined"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator!="undefined"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(o){return o!==""&&userAgentRules.reduce((e,[n,s])=>{if(e)return e;const i=s.exec(o);return!!i&&[n,i]},!1)}function parseUserAgent(o){const e=matchUserAgent(o);if(!e)return null;const[n,s]=e;if(n==="searchbot")return new BotInfo;let i=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);i?i.length<REQUIRED_VERSION_PARTS&&(i=[...i,...createVersionParts(REQUIRED_VERSION_PARTS-i.length)]):i=[];const r=i.join("."),a=detectOS(o),u=SEARCHBOT_OS_REGEX.exec(o);return u&&u[1]?new SearchBotDeviceInfo(n,r,a,u[1]):new BrowserInfo(n,r,a)}function detectOS(o){for(let e=0,n=operatingSystemRules.length;e<n;e++){const[s,i]=operatingSystemRules[e];if(i.exec(o))return s}return null}function getNodeVersion(){return typeof process!="undefined"&&process.version?new NodeInfo(process.version.slice(1)):null}function createVersionParts(o){const e=[];for(let n=0;n<o;n++)e.push("0");return e}function getBrowser(){try{const browser=typeof eval("window")!="undefined";return browser}catch(o){return!1}}let _user={};(()=>{"sessionStorage"in globalThis||(globalThis.sessionStorage={getItem:o=>{},setItem:(o,e)=>{}})})();if("user"in sessionStorage)try{_user=JSON.parse(sessionStorage.getItem("user"))}catch{}const user$1=writable(_user);user$1.subscribe(o=>{sessionStorage.setItem("user",JSON.stringify(o))});const userStore=user$1,{VITE_API_URL="http://localhost:3000"}={VITE_API_URL:"https://plant-api.jim-fx.com",BASE_URL:"",MODE:"production",DEV:!1,PROD:!0};function parseJwt(o){const n=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(n).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}const browser=getBrowser(),store$1=(()=>{let o=browser&&localStorage.getItem("token");function e(){if(!o||o.length<10){userStore.set({});return}const n=parseJwt(o);userStore.set({username:n.username,id:n.sub})}return e(),{set token(n){o=n,browser&&localStorage.setItem("token",n),e()},get token(){return o}}})();async function send({method:o,path:e,data:n,isJSON:s=!0}){const i={method:o,headers:{}};n&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(n)),store$1.token&&(i.headers["access-token"]=`Bearer ${store$1.token}`);const r=await fetch(`${VITE_API_URL}/${e}`,i);if(r.ok){if(s)try{return await r.json()}catch(u){console.error("Response from "+e+" failed to parse"),console.error(u)}return r.text()}const a=await r.json();return console.error(a),a}function get(o,e={}){return send(O({method:"GET",path:o},e))}function del(o){return send({method:"DELETE",path:o})}function post(o,e){return send({method:"POST",path:o,data:e})}function getReport(o){return send({method:"GET",path:`api/report/${o}`})}function publishReport(o){return send({method:"PUT",path:`api/report/${o}/publish`})}function unpublishReport(o){return send({method:"PUT",path:`api/report/${o}/unpublish`})}function getAvailableLabels(){return send({method:"GET",path:"api/report/labels"})}function setReportLabels(o,e){return send({method:"PUT",path:`api/report/${o}`,data:{labels:e}})}var admin=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getReport,publishReport,unpublishReport,getAvailableLabels,setReportLabels});async function login(o,e){const n=await post("api/auth/login",{username:o,password:e});store$1.token=n.access_token}function logout(){store$1.token=""}function submitReport(o){return send({method:"POST",path:"api/report",data:o})}function deleteReport(o){return del(`api/report/${o}`)}async function getRole(){const o=await get("api/user/role",{isJSON:!1});return userStore.update(e=>(e.role=o,e)),o}async function getPermission(){const o=await get("api/user/permission");return userStore.update(e=>(e.permissions=o,e)),o}var user=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",login,logout,submitReport,deleteReport,getRole,getPermission});O(O({},admin),user);var Project_svelte_svelte_type_style_lang="";function create_fragment$f(o){let e,n,s,i,r,a,u,c,d,f=time(Date.now()-o[0].meta.lastSaved)+"",h,m,_,g,v,w,b,$,y;return{c(){e=element("div"),n=element("div"),s=space(),i=element("div"),r=element("div"),a=element("input"),c=space(),d=element("p"),h=text(f),m=text(" ago"),_=space(),g=element("div"),v=space(),w=element("div"),b=element("button"),b.textContent="delete",attr(n,"class","project-image svelte-129g8uk"),attr(a,"contenteditable",""),a.value=u=o[0].meta.name,attr(a,"class","svelte-129g8uk"),attr(d,"class","svelte-129g8uk"),attr(r,"class","project-content-header svelte-129g8uk"),attr(g,"class","project-content-main svelte-129g8uk"),attr(b,"class","delete svelte-129g8uk"),attr(w,"class","project-content-footer svelte-129g8uk"),attr(i,"class","project-content svelte-129g8uk"),attr(e,"class","project-wrapper svelte-129g8uk"),toggle_class(e,"active",o[0].meta.id===projectManager.activeProjectId||o[1])},m(k,N){insert(k,e,N),append(e,n),append(e,s),append(e,i),append(i,r),append(r,a),append(r,c),append(r,d),append(d,h),append(d,m),append(i,_),append(i,g),append(i,v),append(i,w),append(w,b),$||(y=[listen(a,"blur",o[3]),listen(a,"keydown",o[4]),listen(b,"click",stop_propagation(o[5])),listen(e,"resize",alert),listen(e,"click",o[6])],$=!0)},p(k,[N]){N&1&&u!==(u=k[0].meta.name)&&a.value!==u&&(a.value=u),N&1&&f!==(f=time(Date.now()-k[0].meta.lastSaved)+"")&&set_data(h,f),N&3&&toggle_class(e,"active",k[0].meta.id===projectManager.activeProjectId||k[1])},i:noop,o:noop,d(k){k&&detach(e),$=!1,run_all(y)}}}function instance$c(o,e,n){let{project:s}=e,i=!1;function r(){return n(1,i=!0),setTimeout(()=>{n(1,i=!1)},100),!0}const a=function(){const f=this.value.split(`
`).join("").trim();projectManager.updateProjectMeta(s.meta.id,{name:f})},u=function(f){if(f.key==="Enter"){const h=this.value.split(`
`).join("").trim();this.blur(),f.preventDefault(),projectManager.updateProjectMeta(s.meta.id,{name:h})}},c=()=>projectManager.deleteProject(s.meta.id),d=()=>r()&&projectManager.setActiveProject(s.meta.id);return o.$$set=f=>{"project"in f&&n(0,s=f.project)},[s,i,r,a,u,c,d]}class Project extends SvelteComponent{constructor(e){super();init(this,e,instance$c,create_fragment$f,safe_not_equal,{project:0})}}var ProjectManagerView_svelte_svelte_type_style_lang="";function get_each_context$4(o,e,n){const s=o.slice();return s[9]=e[n],s}function create_else_block$2(o){let e;return{c(){e=element("div"),attr(e,"class","svelte-7wgw1o")},m(n,s){insert(n,e,s)},p:noop,d(n){n&&detach(e)}}}function create_if_block_2$2(o){let e,n,s;return{c(){e=element("input"),attr(e,"type","text"),attr(e,"class","search svelte-7wgw1o"),attr(e,"placeholder","Search")},m(i,r){insert(i,e,r),set_input_value(e,o[1]),n||(s=listen(e,"input",o[8]),n=!0)},p(i,r){r&2&&e.value!==i[1]&&set_input_value(e,i[1])},d(i){i&&detach(e),n=!1,s()}}}function create_if_block$5(o){let e,n,s=o[2],i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$4(get_each_context$4(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){e=element("div");for(let a=0;a<i.length;a+=1)i[a].c();attr(e,"class","project-list svelte-7wgw1o")},m(a,u){insert(a,e,u);for(let c=0;c<i.length;c+=1)i[c].m(e,null);n=!0},p(a,u){if(u&6){s=a[2];let c;for(c=0;c<s.length;c+=1){const d=get_each_context$4(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$4(d),i[c].c(),transition_in(i[c],1),i[c].m(e,null))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){a&&detach(e),destroy_each(i,a)}}}function create_if_block_1$4(o){let e,n;return e=new Project({props:{project:o[9]}}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&4&&(r.project=s[9]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_each_block$4(o){let e=showProject(o[1],o[9]),n,s,i=e&&create_if_block_1$4(o);return{c(){i&&i.c(),n=empty()},m(r,a){i&&i.m(r,a),insert(r,n,a),s=!0},p(r,a){a&6&&(e=showProject(r[1],r[9])),e?i?(i.p(r,a),a&6&&transition_in(i,1)):(i=create_if_block_1$4(r),i.c(),transition_in(i,1),i.m(n.parentNode,n)):i&&(group_outros(),transition_out(i,1,1,()=>{i=null}),check_outros())},i(r){s||(transition_in(i),s=!0)},o(r){transition_out(i),s=!1},d(r){i&&i.d(r),r&&detach(n)}}}function create_fragment$e(o){let e,n,s,i,r,a,u,c,d,f;n=new ResizeObserver_1({}),n.$on("resize",o[6]);function h(v,w){return v[2].length>3?create_if_block_2$2:create_else_block$2}let m=h(o),_=m(o),g=o[0]&&create_if_block$5(o);return{c(){e=element("div"),create_component(n.$$.fragment),s=space(),i=element("div"),r=element("button"),r.innerHTML='<p class="svelte-7wgw1o">new</p>',a=space(),_.c(),u=space(),g&&g.c(),attr(r,"class","add-new svelte-7wgw1o"),attr(i,"class","header svelte-7wgw1o"),attr(e,"class","project-manager-wrapper svelte-7wgw1o"),attr(e,"style",`width: ${o[4]}px; height: ${o[5]}px;`)},m(v,w){insert(v,e,w),mount_component(n,e,null),append(e,s),append(e,i),append(i,r),append(i,a),_.m(i,null),append(e,u),g&&g.m(e,null),c=!0,d||(f=listen(r,"click",o[7]),d=!0)},p(v,[w]){m===(m=h(v))&&_?_.p(v,w):(_.d(1),_=m(v),_&&(_.c(),_.m(i,null))),v[0]?g?(g.p(v,w),w&1&&transition_in(g,1)):(g=create_if_block$5(v),g.c(),transition_in(g,1),g.m(e,null)):g&&(group_outros(),transition_out(g,1,1,()=>{g=null}),check_outros())},i(v){c||(transition_in(n.$$.fragment,v),transition_in(g),c=!0)},o(v){transition_out(n.$$.fragment,v),transition_out(g),c=!1},d(v){v&&detach(e),destroy_component(n),_.d(),g&&g.d(),d=!1,f()}}}function showProject(o,e){if(!o||o.length<1)return!0;const n=e.meta.name.toLowerCase();return o=o.toLowerCase(),!!(n.includes(o)||o.includes(n))}function instance$b(o,e,n){let s;const{store:i}=projectManager;component_subscribe(o,i,m=>n(2,s=m));let{visible:r}=e,a;const{width:u,height:c}=localState.get("projectManagerSize",{width:300,height:window.innerHeight/2}),d=m=>{r&&localState.set("projectManagerSize",{width:m.detail.contentRect.width,height:m.detail.contentRect.height})},f=()=>projectManager.createNew();function h(){a=this.value,n(1,a)}return o.$$set=m=>{"visible"in m&&n(0,r=m.visible)},[r,a,s,i,u,c,d,f,h]}class ProjectManagerView extends SvelteComponent{constructor(e){super();init(this,e,instance$b,create_fragment$e,safe_not_equal,{visible:0})}}var index$1="";const template={enableSync:{type:"boolean",defaultValue:!1},useRandomSeed:{type:"boolean",defaultValue:!1},theme:{type:"select",values:["dark","light"],defaultValue:"dark"},debug:{options:{reportError:{type:"boolean",defaultValue:!1},pd:{type:"boolean",defaultValue:!1},skeleton:{type:"boolean",defaultValue:!1},wireframe:{type:"boolean",defaultValue:!1},logLevel:{type:"number",min:0,max:2,defaultValue:1}}},ground:{options:{enabled:{type:"boolean",defaultValue:!0},resX:{type:"number",min:8,max:64,step:1,defaultValue:8},resY:{type:"number",min:8,max:64,step:1,defaultValue:16},scale:{type:"number",min:0,max:5,step:.1,defaultValue:1}}},leafRes:{type:"number",min:3,max:12,step:1,defaultValue:2},stemResX:{type:"number",min:3,max:32,step:1,defaultValue:3},stemResY:{type:"number",min:3,max:64,step:1,defaultValue:32}},log$1=log$8("SettingsManager"),templateToSettings=(o,e)=>{const n={};return Object.entries(o).forEach(([s,i])=>{var a;const r=e&&s in e?e[s]:void 0;"options"in i?n[s]=templateToSettings(i.options,r):n[s]=(a=r!=null?r:i.defaultValue)!=null?a:i.value}),n},resolveDeep=(o,e)=>{const n=e.shift();if(n&&n in o)return e.length?resolveDeep(o[n],e):o[n]},keyToPath=o=>o.includes(".")?o.split("."):[o];class SettingsManager extends EventEmitter{constructor(){super();this.settings={},this.store=writable(this.settings),this._save=debounce(()=>{storage.setItem("pt_settings",this.settings)},500,!1)}save(){var e,n,s;this.emit("settings",this.settings),log$8.setLevel((s=(n=(e=this.settings)==null?void 0:e.debug)==null?void 0:n.logLevel)!=null?s:2),this.store.set(this.settings),log$1("save settings",this.settings),this._save()}async loadFromLocal(){var n,s,i;const e=await storage.getItem("pt_settings")||{};this.settings=templateToSettings(template,e),log$8.setLevel((i=(s=(n=this.settings)==null?void 0:n.debug)==null?void 0:s.logLevel)!=null?i:2),this.store.set(this.settings),log$1("loaded settings from local",this.settings),this.emit("settings",this.settings)}set(e,n){const s=keyToPath(e);if(s.length>1){const i=s.pop(),r=resolveDeep(this.settings,s);r&&(r[i]=n)}else this.settings[s[0]]=n;log$1(`Set ${s}`,n),this.emit(s+".update",n),this.save()}get(e){return resolveDeep(this.settings,keyToPath(e))}getSettings(){return JSON.parse(JSON.stringify(this.settings))}}let index=0;const sections=localState.get("sections")||[];var sectionOpen=()=>{const o=index++;return{get(){return sections[o]||!1},set(e){sections[o]=e,localState.set("sections",sections)}}},SettingsSection_svelte_svelte_type_style_lang="";function get_each_context$3(o,e,n){const s=o.slice();return s[9]=e[n][0],s[10]=e[n][1],s}function create_else_block_1(o){let e,n,s,i,r,a;const u=[{value:o[1]},o[6](o[4])];var c=stateToComponent(o[4],o[1]);function d(f){let h={};for(let m=0;m<u.length;m+=1)h=assign(h,u[m]);return{props:h}}return c&&(i=new c(d()),i.$on("change",o[8])),{c(){e=element("p"),n=text(o[2]),s=space(),i&&create_component(i.$$.fragment),r=empty()},m(f,h){insert(f,e,h),append(e,n),insert(f,s,h),i&&mount_component(i,f,h),insert(f,r,h),a=!0},p(f,h){(!a||h&4)&&set_data(n,f[2]);const m=h&82?get_spread_update(u,[h&2&&{value:f[1]},h&80&&get_spread_object(f[6](f[4]))]):{};if(c!==(c=stateToComponent(f[4],f[1]))){if(i){group_outros();const _=i;transition_out(_.$$.fragment,1,0,()=>{destroy_component(_,1)}),check_outros()}c?(i=new c(d()),i.$on("change",f[8]),create_component(i.$$.fragment),transition_in(i.$$.fragment,1),mount_component(i,r.parentNode,r)):i=null}else c&&i.$set(m)},i(f){a||(i&&transition_in(i.$$.fragment,f),a=!0)},o(f){i&&transition_out(i.$$.fragment,f),a=!1},d(f){f&&detach(e),f&&detach(s),f&&detach(r),i&&destroy_component(i,f)}}}function create_if_block$4(o){let e,n;return e=new Section({props:{name:o[2],open:o[5].get(),$$slots:{default:[create_default_slot$2]},$$scope:{ctx:o}}}),e.$on("toggle",o[7]),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&4&&(r.name=s[2]),i&8203&&(r.$$scope={dirty:i,ctx:s}),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_else_block$1(o){let e;return{c(){e=element("p"),e.textContent="error"},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}function create_if_block_1$3(o){let e,n;return e=new SettingsSection({props:{path:o[0],value:o[10],key:o[9],template:o[3].options[o[9]]}}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&1&&(r.path=s[0]),i&2&&(r.value=s[10]),i&2&&(r.key=s[9]),i&10&&(r.template=s[3].options[s[9]]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_each_block$3(o){let e,n,s,i;const r=[create_if_block_1$3,create_else_block$1],a=[];function u(c,d){return c[9]in c[3].options?0:1}return e=u(o),n=a[e]=r[e](o),{c(){n.c(),s=empty()},m(c,d){a[e].m(c,d),insert(c,s,d),i=!0},p(c,d){let f=e;e=u(c),e===f?a[e].p(c,d):(group_outros(),transition_out(a[f],1,1,()=>{a[f]=null}),check_outros(),n=a[e],n?n.p(c,d):(n=a[e]=r[e](c),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(c){i||(transition_in(n),i=!0)},o(c){transition_out(n),i=!1},d(c){a[e].d(c),c&&detach(s)}}}function create_default_slot$2(o){let e,n,s=Object.entries(o[1]),i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$3(get_each_context$3(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();e=empty()},m(a,u){for(let c=0;c<i.length;c+=1)i[c].m(a,u);insert(a,e,u),n=!0},p(a,u){if(u&11){s=Object.entries(a[1]);let c;for(c=0;c<s.length;c+=1){const d=get_each_context$3(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$3(d),i[c].c(),transition_in(i[c],1),i[c].m(e.parentNode,e))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){destroy_each(i,a),a&&detach(e)}}}function create_fragment$d(o){let e,n,s,i;const r=[create_if_block$4,create_else_block_1],a=[];function u(c,d){return c[3].options?0:1}return n=u(o),s=a[n]=r[n](o),{c(){e=element("div"),s.c(),attr(e,"class","wrapper svelte-td5kv9")},m(c,d){insert(c,e,d),a[n].m(e,null),i=!0},p(c,[d]){let f=n;n=u(c),n===f?a[n].p(c,d):(group_outros(),transition_out(a[f],1,1,()=>{a[f]=null}),check_outros(),s=a[n],s?s.p(c,d):(s=a[n]=r[n](c),s.c()),transition_in(s,1),s.m(e,null))},i(c){i||(transition_in(s),i=!0)},o(c){transition_out(s),i=!1},d(c){c&&detach(e),a[n].d()}}}function instance$a(o,e,n){let{value:s}=e,{key:i}=e,{path:r=""}=e;r=r+(r.length?".":"")+i;let{template:a}=e,u=a;const c=sectionOpen(),d=m=>{const _=O({},m);return delete _.defaultValue,delete _.type,_},f=({detail:m})=>c.set(m),h=m=>settingsManager.set(r,m.detail);return o.$$set=m=>{"value"in m&&n(1,s=m.value),"key"in m&&n(2,i=m.key),"path"in m&&n(0,r=m.path),"template"in m&&n(3,a=m.template)},[r,s,i,a,u,c,d,f,h]}class SettingsSection extends SvelteComponent{constructor(e){super();init(this,e,instance$a,create_fragment$d,safe_not_equal,{value:1,key:2,path:0,template:3})}}function get_each_context$2(o,e,n){const s=o.slice();return s[2]=e[n][0],s[3]=e[n][1],s}function create_each_block$2(o){let e,n;return e=new SettingsSection({props:{key:o[2],value:o[3],template:template[o[2]]}}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,i){const r={};i&1&&(r.key=s[2]),i&1&&(r.value=s[3]),i&1&&(r.template=template[s[2]]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_fragment$c(o){let e,n,s=Object.entries(o[0]),i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$2(get_each_context$2(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){for(let a=0;a<i.length;a+=1)i[a].c();e=empty()},m(a,u){for(let c=0;c<i.length;c+=1)i[c].m(a,u);insert(a,e,u),n=!0},p(a,[u]){if(u&1){s=Object.entries(a[0]);let c;for(c=0;c<s.length;c+=1){const d=get_each_context$2(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$2(d),i[c].c(),transition_in(i[c],1),i[c].m(e.parentNode,e))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){destroy_each(i,a),a&&detach(e)}}}function instance$9(o,e,n){let s;const i=settingsManager.store;return component_subscribe(o,i,r=>n(0,s=r)),[s,i]}class SettingsManagerView extends SvelteComponent{constructor(e){super();init(this,e,instance$9,create_fragment$c,safe_not_equal,{})}}var Final_svelte_svelte_type_style_lang="";function create_fragment$b(o){let e;return{c(){e=element("p"),e.textContent=`\u{1F389} Now you have all the knowledge to use the Plantarium. Have some fun with
  it.`,attr(e,"class","svelte-1h3eb6p")},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}class Final extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment$b,safe_not_equal,{})}}var Greeting_svelte_svelte_type_style_lang="";function create_fragment$a(o){let e,n,s,i,r,a,u,c;return i=new Icon({props:{name:"hand"}}),{c(){e=element("p"),n=text("Hey there "),s=element("span"),r=element("div"),create_component(i.$$.fragment),a=space(),u=element("p"),u.innerHTML=`Welcome to <b>Plantarium</b>, a tool for creating parametrized, procedural 3D
  plants.`,set_style(r,"display","contents"),set_style(r,"--stroke","#1a1a1a"),attr(s,"class","svelte-1tutruj"),attr(e,"class","svelte-1tutruj"),attr(u,"class","svelte-1tutruj")},m(d,f){insert(d,e,f),append(e,n),append(e,s),append(s,r),mount_component(i,r,null),insert(d,a,f),insert(d,u,f),c=!0},p:noop,i(d){c||(transition_in(i.$$.fragment,d),c=!0)},o(d){transition_out(i.$$.fragment,d),c=!1},d(d){d&&detach(e),destroy_component(i),d&&detach(a),d&&detach(u)}}}class Greeting extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment$a,safe_not_equal,{})}}const steps=[{title:"Tutorial",description:Greeting,options:{"lets go":()=>{}},type:"alert"},{description:`This is the <b>Plant View</b>, here you can explore the generated 3D model of your plant. 
      Try to change the view by:`,selector:".scene-wrapper",checks:[{description:"Clicking and dragging",setup:function(o,{c:e}){const n=document.querySelector(e.selector);n.getAttribute("setup")!=="true"&&(n.setAttribute("setup","true"),n.addEventListener("click",o,{once:!0}))}},{description:"Scrolling / Zooming",setup:(o,{c:e})=>{const n=document.querySelector(e.selector+"> canvas");n.getAttribute("setup")!=="true"&&(n.setAttribute("setup","true"),n.addEventListener("wheel",o,{once:!0,passive:!0}))}}]},{selector:"#nodesystem-view",description:"This is the <b>Node View</b>, here you define the way your plant looks. Try playing with some of the settings. If you are not so sure how this works, maybe visit the NodeTutorial"},{description:"This Button opens the project view",clickSelector:"header > div.left > div > div"},{description:"This is the ProjectView, here you can create/rename/delete projects.",selector:".project-manager-wrapper",checks:[{description:"create a new project",setup:(o,{pm:e})=>{e.once("new",o)}},{description:"rename the project",setup:(o,{pm:e})=>{e.once("update",o)}},{description:"delete the project",setup:(o,{pm:e})=>{e.once("delete",o)}}]},{description:"This Button opens the <b>Settings View</b>",clickSelector:"header > div.right > div:nth-child(2) .icon-wrapper"},{description:"This is the <b>SettingView</b>, here you can change some general settings.",selector:"header > div.right > div:nth-child(2) > div > div > div.wrapper.right.visible"},{description:"When you encounter something which doesnt work or you have an Idea for a new feature, use this button to report it.",clickSelector:"header > div.right > div:nth-child(1) > div"},{title:"Tutorial",description:Final,options:{"lets go":()=>{}},type:"alert"}];var store=writable(void 0),Tutor_svelte_svelte_type_style_lang="";function get_each_context$1(o,e,n){const s=o.slice();return s[14]=e[n],s[15]=e,s[16]=n,s}function create_if_block$3(o){let e,n,s,i,r,a,u,c,d=o[6].description+"",f,h,m,_,g,v=o[3]&&create_if_block_4(o);r=new Button({props:{icon:"cross"}}),r.$on("click",o[11]);let w=o[1]&&create_if_block_3(o),b=!o[4]&&create_if_block_2$1(o),$=o[0]&&o[5]&&create_if_block_1$2(o);return{c(){e=element("span"),v&&v.c(),n=space(),s=element("div"),i=element("div"),a=element("div"),create_component(r.$$.fragment),u=space(),c=element("p"),f=space(),w&&w.c(),h=space(),b&&b.c(),_=space(),$&&$.c(),set_style(a,"display","contents"),set_style(a,"--bg","transparent"),attr(i,"class","close-wrapper svelte-zb5b7g"),attr(c,"class","svelte-zb5b7g"),attr(s,"class","wrapper svelte-zb5b7g"),attr(s,"style",m=`left: ${o[8]}px; top: ${o[0].top+20}px;`),attr(e,"class","svelte-zb5b7g"),toggle_class(e,"isLeft",o[2]),toggle_class(e,"hasElement",!!o[5]),toggle_class(e,"hasClick",!!o[3])},m(y,k){insert(y,e,k),v&&v.m(e,null),append(e,n),append(e,s),append(s,i),append(i,a),mount_component(r,a,null),append(s,u),append(s,c),c.innerHTML=d,append(s,f),w&&w.m(s,null),append(s,h),b&&b.m(s,null),append(e,_),$&&$.m(e,null),g=!0},p(y,k){y[3]?v?(v.p(y,k),k&8&&transition_in(v,1)):(v=create_if_block_4(y),v.c(),transition_in(v,1),v.m(e,n)):v&&(group_outros(),transition_out(v,1,1,()=>{v=null}),check_outros()),(!g||k&64)&&d!==(d=y[6].description+"")&&(c.innerHTML=d),y[1]?w?(w.p(y,k),k&2&&transition_in(w,1)):(w=create_if_block_3(y),w.c(),transition_in(w,1),w.m(s,h)):w&&(group_outros(),transition_out(w,1,1,()=>{w=null}),check_outros()),y[4]?b&&(group_outros(),transition_out(b,1,1,()=>{b=null}),check_outros()):b?(b.p(y,k),k&16&&transition_in(b,1)):(b=create_if_block_2$1(y),b.c(),transition_in(b,1),b.m(s,null)),(!g||k&257&&m!==(m=`left: ${y[8]}px; top: ${y[0].top+20}px;`))&&attr(s,"style",m),y[0]&&y[5]?$?$.p(y,k):($=create_if_block_1$2(y),$.c(),$.m(e,null)):$&&($.d(1),$=null),k&4&&toggle_class(e,"isLeft",y[2]),k&32&&toggle_class(e,"hasElement",!!y[5]),k&8&&toggle_class(e,"hasClick",!!y[3])},i(y){g||(transition_in(v),transition_in(r.$$.fragment,y),transition_in(w),transition_in(b),g=!0)},o(y){transition_out(v),transition_out(r.$$.fragment,y),transition_out(w),transition_out(b),g=!1},d(y){y&&detach(e),v&&v.d(),destroy_component(r),w&&w.d(),b&&b.d(),$&&$.d()}}}function create_if_block_4(o){let e,n,s,i,r;return n=new Icon({props:{name:"pointing"}}),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--fill","#303030"),attr(e,"class","click-wrapper svelte-zb5b7g"),attr(e,"style",i=`top: ${o[0].top+20}px; left: ${o[8]-(o[2]?20:-0)}px;`)},m(a,u){insert(a,e,u),append(e,s),mount_component(n,s,null),r=!0},p(a,u){(!r||u&261&&i!==(i=`top: ${a[0].top+20}px; left: ${a[8]-(a[2]?20:-0)}px;`))&&attr(e,"style",i)},i(a){r||(transition_in(n.$$.fragment,a),r=!0)},o(a){transition_out(n.$$.fragment,a),r=!1},d(a){a&&detach(e),destroy_component(n)}}}function create_if_block_3(o){let e,n,s=o[1],i=[];for(let a=0;a<s.length;a+=1)i[a]=create_each_block$1(get_each_context$1(o,s,a));const r=a=>transition_out(i[a],1,1,()=>{i[a]=null});return{c(){e=element("div");for(let a=0;a<i.length;a+=1)i[a].c();attr(e,"class","checks-wrapper svelte-zb5b7g")},m(a,u){insert(a,e,u);for(let c=0;c<i.length;c+=1)i[c].m(e,null);n=!0},p(a,u){if(u&2){s=a[1];let c;for(c=0;c<s.length;c+=1){const d=get_each_context$1(a,s,c);i[c]?(i[c].p(d,u),transition_in(i[c],1)):(i[c]=create_each_block$1(d),i[c].c(),transition_in(i[c],1),i[c].m(e,null))}for(group_outros(),c=s.length;c<i.length;c+=1)r(c);check_outros()}},i(a){if(!n){for(let u=0;u<s.length;u+=1)transition_in(i[u]);n=!0}},o(a){i=i.filter(Boolean);for(let u=0;u<i.length;u+=1)transition_out(i[u]);n=!1},d(a){a&&detach(e),destroy_each(i,a)}}}function create_each_block$1(o){let e,n,s,i,r,a=o[14].description+"",u,c,d;function f(m){o[12](m,o[14])}let h={};return o[14]._isCompleted!==void 0&&(h.value=o[14]._isCompleted),n=new InputCheckbox({props:h}),binding_callbacks.push(()=>bind(n,"value",f)),{c(){e=element("div"),create_component(n.$$.fragment),i=space(),r=element("p"),u=text(a),c=space(),attr(r,"class","svelte-zb5b7g"),attr(e,"class","check-wrapper svelte-zb5b7g"),toggle_class(e,"is-completed",o[14]._isCompleted)},m(m,_){insert(m,e,_),mount_component(n,e,null),append(e,i),append(e,r),append(r,u),append(e,c),d=!0},p(m,_){o=m;const g={};!s&&_&2&&(s=!0,g.value=o[14]._isCompleted,add_flush_callback(()=>s=!1)),n.$set(g),(!d||_&2)&&a!==(a=o[14].description+"")&&set_data(u,a),_&2&&toggle_class(e,"is-completed",o[14]._isCompleted)},i(m){d||(transition_in(n.$$.fragment,m),d=!0)},o(m){transition_out(n.$$.fragment,m),d=!1},d(m){m&&detach(e),destroy_component(n)}}}function create_if_block_2$1(o){let e,n,s,i;return n=new Button({props:{name:"next"}}),n.$on("click",o[13]),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--text","white"),set_style(s,"--bg","#303030"),attr(e,"class","next-wrapper svelte-zb5b7g")},m(r,a){insert(r,e,a),append(e,s),mount_component(n,s,null),i=!0},p:noop,i(r){i||(transition_in(n.$$.fragment,r),i=!0)},o(r){transition_out(n.$$.fragment,r),i=!1},d(r){r&&detach(e),destroy_component(n)}}}function create_if_block_1$2(o){let e,n;return{c(){e=element("span"),attr(e,"class","highlighter  svelte-zb5b7g"),attr(e,"style",n=`width: ${o[0].width}px; height: ${o[0].height}px; left: ${o[0].left}px; top: ${o[0].top}px;`)},m(s,i){insert(s,e,i)},p(s,i){i&1&&n!==(n=`width: ${s[0].width}px; height: ${s[0].height}px; left: ${s[0].left}px; top: ${s[0].top}px;`)&&attr(e,"style",n)},d(s){s&&detach(e)}}}function create_fragment$9(o){let e,n,s=o[7]&&create_if_block$3(o);return{c(){s&&s.c(),e=empty()},m(i,r){s&&s.m(i,r),insert(i,e,r),n=!0},p(i,[r]){i[7]?s?(s.p(i,r),r&128&&transition_in(s,1)):(s=create_if_block$3(i),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(i){n||(transition_in(s),n=!0)},o(i){transition_out(s),n=!1},d(i){s&&s.d(i),i&&detach(e)}}}function instance$8(o,e,n){let s,i,r,a,u,c,d,f,h,m,_;component_subscribe(o,store,b=>n(6,_=b));const g=()=>{n(7,m=!1)};function v(b,$){o.$$.not_equal($._isCompleted,b)&&($._isCompleted=b,n(1,h),n(6,_))}const w=()=>set_store_value(store,_._isCompleted=!0,_);return o.$$.update=()=>{if(o.$$.dirty&64&&_&&_.clickSelector){const b=document.querySelector(_.clickSelector);b&&b.getAttribute("setup")!=="true"&&(b.setAttribute("setup","true"),b.addEventListener("click",()=>{setTimeout(()=>{set_store_value(store,_._isCompleted=!0,_)},20)},{once:!0}))}o.$$.dirty&64&&n(10,s=_&&_.selector),o.$$.dirty&1024&&n(5,i=s&&document.querySelector(s)),o.$$.dirty&32&&n(9,r=i&&i.getBoundingClientRect()),o.$$.dirty&64&&n(4,a=_&&_.clickSelector&&document.querySelector(_.clickSelector)),o.$$.dirty&16&&n(3,u=a&&a.getBoundingClientRect()),o.$$.dirty&520&&n(0,c=r||u),o.$$.dirty&1&&n(2,d=c&&c.left+c.width>window.innerWidth-100),o.$$.dirty&5&&n(8,f=c&&(d?c.left-10:c.left+c.width+10)),o.$$.dirty&64&&n(1,h=_&&_.checks),o.$$.dirty&66&&h&&h.forEach((b,$)=>(b._isSetup||(b._isSetup=!0,b.setup(()=>{n(1,h[$]._isCompleted=!0,h),n(1,h),n(6,_)},{pm:projectManager,c:_})),b)),o.$$.dirty&1&&n(7,m=!!c)},[c,h,d,u,a,i,_,m,f,r,s,g,v,w]}class Tutor$1 extends SvelteComponent{constructor(e){super();init(this,e,instance$8,create_fragment$9,safe_not_equal,{})}}const affirmatives=["yes","next","lets go","okay"];let pm;const Tutor={handleReject:()=>{localState.set("hasViewedTutorial",!0),createToast("The tutorial is accessable under...")},currentIndex:0,previous:async function(){},next:async function(){var n;const o=steps[this.currentIndex];if(this.currentIndex===steps.length)return;if(o.setup&&await o.setup({pm}),store.set(o),this.currentIndex++,this.currentIndex>2&&localState.set("hasViewedTutorial",!0),o.title=(n=o.title)!=null?n:`Tutorial (${this.currentIndex}/${steps.length})`,o.type==="alert"){const s=await createAlert(o.description,{title:o.title,type:"success",values:o.options?Object.keys(o.options):void 0,timeout:0});if(affirmatives.includes(s.toString()))return this.next()}if(o.type==="toast"){const s=await createToast(o.description,{values:o.options?Object.keys(o.options):void 0,timeout:0});if(affirmatives.includes(s.toString()))return this.next()}const e=store.subscribe(s=>{s._isCompleted&&(e(),this.next())})},init:function({projectManager:o}){if(localState.get("hasViewedTutorial"))return;pm=o;const e=`It looks like this is your first time here...
    Want to take a little tour? `;setTimeout(async()=>{await createToast(e,{title:"",timeout:8e3,values:["nah","yes"]})==="yes"?this.next():this.handleReject()},1e4)},restart:function(){localState.set("hasViewedTutorial",!1),this.currentIndex=0,this.next()}},settingsManager=new SettingsManager,projectManager=new ProjectManager;setTheme(settingsManager.get("theme"));settingsManager.on("enableSync.update",o=>{createToast(`${o?"Enabled":"Disabled"} sync`,{type:"success"})});settingsManager.on("theme.update",o=>{setTheme(o)});const nodeSystem=new NodeSystem({view:!0,defaultNodes:!1,registerNodes:_nodes});projectManager.on("load",o=>{nodeSystem.load(o)});nodeSystem.on("result",o=>projectManager.setProject(o),50);nodeSystem.on("save",o=>projectManager.saveProject(o));settingsManager.on("settings",o=>projectManager.setSettings(o),50);Tutor.init({projectManager});const createGround=(o,e)=>{const{ground:{scale:n=1,resX:s=16,resY:i=16}={}}=e||{},r=n!=null?n:0,a=s!=null?s:8,u=i!=null?i:8,c=ground(r,a,u);return transferToGeometry(o,c)};class BackgroundScene{constructor(e,n){this.scene=e,this.gl=e.renderer.gl,this.initMeshes(),n.on("settings",this.setSettings.bind(this)),this.setSettings(settingsManager.getSettings())}initMeshes(){const e=new Plane(this.gl),n=loader.texture(this.gl,"assets/rocky_dirt1-albedo.jpg",{wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT}),s=new Program(this.gl,{vertex:GroundShader.vertex,fragment:GroundShader.fragment,uniforms:{uTime:{value:0},tMap:{value:n},uFogColor:{value:new Color("#ffffff")},uFogNear:{value:10},uFogFar:{value:30},texScale:{value:1}}});this.ground=this.scene.addMesh({geometry:e,program:s});const i=(r=0)=>{requestAnimationFrame(i),s.uniforms.uTime.value=r};i()}setSettings(e){var n,s;this.settings=e,((n=e==null?void 0:e.ground)==null?void 0:n.enabled)&&(this.ground.geometry=createGround(this.gl,e)),this.ground.visible=!!((s=e==null?void 0:e.ground)==null?void 0:s.enabled)}}function create_fragment$8(o){let e,n,s=(o[1]?"<b>[NEW]</b>":"")+"",i,r=o[0].subject+"",a;return{c(){e=element("p"),n=new HtmlTag,i=space(),a=text(r),n.a=i},m(u,c){insert(u,e,c),n.m(s,e),append(e,i),append(e,a)},p(u,[c]){c&2&&s!==(s=(u[1]?"<b>[NEW]</b>":"")+"")&&n.p(s),c&1&&r!==(r=u[0].subject+"")&&set_data(a,r)},i:noop,o:noop,d(u){u&&detach(e)}}}function instance$7(o,e,n){let{commit:s}=e,{isNew:i=!1}=e;return o.$$set=r=>{"commit"in r&&n(0,s=r.commit),"isNew"in r&&n(1,i=r.isNew)},[s,i]}class Commit extends SvelteComponent{constructor(e){super();init(this,e,instance$7,create_fragment$8,safe_not_equal,{commit:0,isNew:1})}}const commits=writable([]);let lastUpdated=localState.get("lastUpdated",Date.now());function parseCommit(o){const e=Date.parse(o.date);return F(O({},o),{date:e,new:lastUpdated<e})}let commitPromise;async function _fetchCommits(){const e=await(await fetch("commits.json")).json();return lastUpdated=Date.now(),localState.set("lastUpdated",lastUpdated),e.map(n=>parseCommit(n))}const fetchCommits=async()=>{if(commitPromise)return commitPromise;commitPromise=_fetchCommits();const o=await commitPromise;commits.set(o)};var ChangeLog_svelte_svelte_type_style_lang="";function get_each_context(o,e,n){const s=o.slice();return s[4]=e[n],s}function create_if_block$2(o){let e,n=o[2](o[4].date)+"",s;return{c(){e=element("h3"),s=text(n),attr(e,"class","svelte-13vbnbr")},m(i,r){insert(i,e,r),append(e,s)},p(i,r){r&1&&n!==(n=i[2](i[4].date)+"")&&set_data(s,n)},d(i){i&&detach(e)}}}function create_each_block(o){let e=o[1](o[4]),n,s,i,r=e&&create_if_block$2(o);return s=new Commit({props:{commit:o[4]}}),{c(){r&&r.c(),n=space(),create_component(s.$$.fragment)},m(a,u){r&&r.m(a,u),insert(a,n,u),mount_component(s,a,u),i=!0},p(a,u){u&1&&(e=a[1](a[4])),e?r?r.p(a,u):(r=create_if_block$2(a),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null);const c={};u&1&&(c.commit=a[4]),s.$set(c)},i(a){i||(transition_in(s.$$.fragment,a),i=!0)},o(a){transition_out(s.$$.fragment,a),i=!1},d(a){r&&r.d(a),a&&detach(n),destroy_component(s,a)}}}function create_fragment$7(o){let e,n,s,i,r=o[0],a=[];for(let c=0;c<r.length;c+=1)a[c]=create_each_block(get_each_context(o,r,c));const u=c=>transition_out(a[c],1,1,()=>{a[c]=null});return{c(){e=element("h1"),e.textContent="Changelog",n=space(),s=element("div");for(let c=0;c<a.length;c+=1)a[c].c();attr(s,"class","svelte-13vbnbr")},m(c,d){insert(c,e,d),insert(c,n,d),insert(c,s,d);for(let f=0;f<a.length;f+=1)a[f].m(s,null);i=!0},p(c,[d]){if(d&7){r=c[0];let f;for(f=0;f<r.length;f+=1){const h=get_each_context(c,r,f);a[f]?(a[f].p(h,d),transition_in(a[f],1)):(a[f]=create_each_block(h),a[f].c(),transition_in(a[f],1),a[f].m(s,null))}for(group_outros(),f=r.length;f<a.length;f+=1)u(f);check_outros()}},i(c){if(!i){for(let d=0;d<r.length;d+=1)transition_in(a[d]);i=!0}},o(c){a=a.filter(Boolean);for(let d=0;d<a.length;d+=1)transition_out(a[d]);i=!1},d(c){c&&detach(e),c&&detach(n),c&&detach(s),destroy_each(a,c)}}}function instance$6(o,e,n){let s;component_subscribe(o,commits,u=>n(0,s=u)),fetchCommits();let i=s.length&&new Date(s[0].date).getDay();return[s,u=>{const c=new Date(u.date);return c.getDay()!=i?(i=c.getDay(),!0):!1},u=>new Date(u).toLocaleDateString()]}class ChangeLog extends SvelteComponent{constructor(e){super();init(this,e,instance$6,create_fragment$7,safe_not_equal,{})}}var HoverWindow_svelte_svelte_type_style_lang="";function create_default_slot$1(o){let e,n,s,i,r,a,u,c,d;function f(g){o[6](g)}let h={useActive:!0,icon:o[2],name:o[0]};o[4]!==void 0&&(h.active=o[4]),n=new Button({props:h}),binding_callbacks.push(()=>bind(n,"active",f));var m=o[3];function _(g){return{props:{visible:g[4]}}}return m&&(c=new m(_(o))),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),a=space(),u=element("div"),c&&create_component(c.$$.fragment),set_style(s,"display","contents"),set_style(s,"--bg","transparent"),set_style(s,"--text",r=o[5]["text-color"]),attr(u,"class","wrapper svelte-1e2gb7"),toggle_class(u,"visible",o[4]),toggle_class(u,"right",o[1]),attr(e,"class","icon-wrapper svelte-1e2gb7"),toggle_class(e,"active",o[4])},m(g,v){insert(g,e,v),append(e,s),mount_component(n,s,null),append(e,a),append(e,u),c&&mount_component(c,u,null),d=!0},p(g,v){v&32&&r!==(r=g[5]["text-color"])&&set_style(s,"--text",r);const w={};v&4&&(w.icon=g[2]),v&1&&(w.name=g[0]),!i&&v&16&&(i=!0,w.active=g[4],add_flush_callback(()=>i=!1)),n.$set(w);const b={};if(v&16&&(b.visible=g[4]),m!==(m=g[3])){if(c){group_outros();const $=c;transition_out($.$$.fragment,1,0,()=>{destroy_component($,1)}),check_outros()}m?(c=new m(_(g)),create_component(c.$$.fragment),transition_in(c.$$.fragment,1),mount_component(c,u,null)):c=null}else m&&c.$set(b);v&16&&toggle_class(u,"visible",g[4]),v&2&&toggle_class(u,"right",g[1]),v&16&&toggle_class(e,"active",g[4])},i(g){d||(transition_in(n.$$.fragment,g),c&&transition_in(c.$$.fragment,g),d=!0)},o(g){transition_out(n.$$.fragment,g),c&&transition_out(c.$$.fragment,g),d=!1},d(g){g&&detach(e),destroy_component(n),c&&destroy_component(c)}}}function create_fragment$6(o){let e,n;return e=new Src({props:{$$slots:{default:[create_default_slot$1]},$$scope:{ctx:o}}}),e.$on("clickoutside",o[7]),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},p(s,[i]){const r={};i&319&&(r.$$scope={dirty:i,ctx:s}),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function instance$5(o,e,n){let s;component_subscribe(o,store$4,h=>n(5,s=h));let{name:i}=e,{right:r=!1}=e,{icon:a}=e,{component:u}=e,c;function d(h){c=h,n(4,c)}const f=()=>n(4,c=!1);return o.$$set=h=>{"name"in h&&n(0,i=h.name),"right"in h&&n(1,r=h.right),"icon"in h&&n(2,a=h.icon),"component"in h&&n(3,u=h.component)},[i,r,a,u,c,s,d,f]}class HoverWindow extends SvelteComponent{constructor(e){super();init(this,e,instance$5,create_fragment$6,safe_not_equal,{name:0,right:1,icon:2,component:3})}}var Report_svelte_svelte_type_style_lang="";function create_else_block(o){let e,n,s,i,r,a,u,c,d,f,h,m,_,g,v,w,b,$=o[0]==="bug"&&create_if_block_1$1(o);return _=new Button({props:{name:"Submit"}}),_.$on("click",o[9]),{c(){e=element("section"),n=element("label"),n.textContent="Title",s=space(),i=element("input"),r=space(),a=element("section"),u=element("label"),u.textContent="Description",c=space(),d=element("textarea"),h=space(),$&&$.c(),m=space(),g=element("div"),create_component(_.$$.fragment),attr(n,"for","title"),attr(n,"class","svelte-1725buf"),attr(i,"type","text"),attr(i,"id","title"),attr(i,"placeholder","Simple Title"),attr(i,"class","svelte-1725buf"),attr(e,"class","svelte-1725buf"),attr(u,"for","description"),attr(u,"class","svelte-1725buf"),attr(d,"type","text"),attr(d,"id","description"),attr(d,"rowspan","5"),attr(d,"placeholder",f=o[0]==="bug"?"Please provide a detailed description of what happened.":"Please describe the feature."),attr(d,"class","svelte-1725buf"),attr(a,"class","svelte-1725buf"),set_style(g,"display","contents"),set_style(g,"--bg","white"),set_style(g,"--text-color","#303030")},m(y,k){insert(y,e,k),append(e,n),append(e,s),append(e,i),set_input_value(i,o[2]),insert(y,r,k),insert(y,a,k),append(a,u),append(a,c),append(a,d),set_input_value(d,o[3]),insert(y,h,k),$&&$.m(y,k),insert(y,m,k),insert(y,g,k),mount_component(_,g,null),v=!0,w||(b=[listen(i,"keydown",stop_propagation(o[11])),listen(i,"input",o[12]),listen(d,"keydown",stop_propagation(o[10])),listen(d,"input",o[13])],w=!0)},p(y,k){k&4&&i.value!==y[2]&&set_input_value(i,y[2]),(!v||k&1&&f!==(f=y[0]==="bug"?"Please provide a detailed description of what happened.":"Please describe the feature."))&&attr(d,"placeholder",f),k&8&&set_input_value(d,y[3]),y[0]==="bug"?$?($.p(y,k),k&1&&transition_in($,1)):($=create_if_block_1$1(y),$.c(),transition_in($,1),$.m(m.parentNode,m)):$&&(group_outros(),transition_out($,1,1,()=>{$=null}),check_outros())},i(y){v||(transition_in($),transition_in(_.$$.fragment,y),v=!0)},o(y){transition_out($),transition_out(_.$$.fragment,y),v=!1},d(y){y&&detach(e),y&&detach(r),y&&detach(a),y&&detach(h),$&&$.d(y),y&&detach(m),y&&detach(g),destroy_component(_,y),w=!1,run_all(b)}}}function create_if_block$1(o){let e,n,s,i={ctx:o,current:null,token:null,hasCatch:!0,pending:create_pending_block$1,then:create_then_block$1,catch:create_catch_block$1,value:16,error:17,blocks:[,,,]};return handle_promise(n=o[6],i),{c(){e=empty(),i.block.c()},m(r,a){insert(r,e,a),i.block.m(r,i.anchor=a),i.mount=()=>e.parentNode,i.anchor=e,s=!0},p(r,a){o=r,i.ctx=o,a&64&&n!==(n=o[6])&&handle_promise(n,i)||update_await_block_branch(i,o,a)},i(r){s||(transition_in(i.block),s=!0)},o(r){for(let a=0;a<3;a+=1){const u=i.blocks[a];transition_out(u)}s=!1},d(r){r&&detach(e),i.block.d(r),i.token=null,i=null}}}function create_if_block_1$1(o){let e,n,s,i,r,a,u,c,d,f,h,m=o[7]&&create_if_block_2(o);function _(v){o[15](v)}let g={};return o[4]!==void 0&&(g.value=o[4]),i=new InputCheckbox({props:g}),binding_callbacks.push(()=>bind(i,"value",_)),f=new Section({props:{name:"What is that?",$$slots:{default:[create_default_slot]},$$scope:{ctx:o}}}),{c(){m&&m.c(),e=space(),n=element("section"),s=element("div"),create_component(i.$$.fragment),a=space(),u=element("p"),u.textContent="Include Browser Info",c=space(),d=element("div"),create_component(f.$$.fragment),set_style(u,"margin-left","5px"),set_style(s,"display","flex"),set_style(s,"align-items","center"),attr(d,"class","info svelte-1725buf"),attr(n,"class","svelte-1725buf")},m(v,w){m&&m.m(v,w),insert(v,e,w),insert(v,n,w),append(n,s),mount_component(i,s,null),append(s,a),append(s,u),append(n,c),append(n,d),mount_component(f,d,null),h=!0},p(v,w){v[7]?m?(m.p(v,w),w&128&&transition_in(m,1)):(m=create_if_block_2(v),m.c(),transition_in(m,1),m.m(e.parentNode,e)):m&&(group_outros(),transition_out(m,1,1,()=>{m=null}),check_outros());const b={};!r&&w&16&&(r=!0,b.value=v[4],add_flush_callback(()=>r=!1)),i.$set(b);const $={};w&262144&&($.$$scope={dirty:w,ctx:v}),f.$set($)},i(v){h||(transition_in(m),transition_in(i.$$.fragment,v),transition_in(f.$$.fragment,v),h=!0)},o(v){transition_out(m),transition_out(i.$$.fragment,v),transition_out(f.$$.fragment,v),h=!1},d(v){m&&m.d(v),v&&detach(e),v&&detach(n),destroy_component(i),destroy_component(f)}}}function create_if_block_2(o){let e,n,s,i,r,a,u,c,d,f;function h(_){o[14](_)}let m={};return o[5]!==void 0&&(m.value=o[5]),s=new InputCheckbox({props:m}),binding_callbacks.push(()=>bind(s,"value",h)),d=new Section({props:{name:"What is that?",$$slots:{default:[create_default_slot_1]},$$scope:{ctx:o}}}),{c(){e=element("section"),n=element("div"),create_component(s.$$.fragment),r=space(),a=element("p"),a.textContent="Include StackTrace",u=space(),c=element("div"),create_component(d.$$.fragment),set_style(a,"margin-left","5px"),set_style(n,"display","flex"),set_style(n,"align-items","center"),attr(c,"class","info svelte-1725buf"),attr(e,"class","svelte-1725buf")},m(_,g){insert(_,e,g),append(e,n),mount_component(s,n,null),append(n,r),append(n,a),append(e,u),append(e,c),mount_component(d,c,null),f=!0},p(_,g){const v={};!i&&g&32&&(i=!0,v.value=_[5],add_flush_callback(()=>i=!1)),s.$set(v);const w={};g&262146&&(w.$$scope={dirty:g,ctx:_}),d.$set(w)},i(_){f||(transition_in(s.$$.fragment,_),transition_in(d.$$.fragment,_),f=!0)},o(_){transition_out(s.$$.fragment,_),transition_out(d.$$.fragment,_),f=!1},d(_){_&&detach(e),destroy_component(s),destroy_component(d)}}}function create_default_slot_1(o){let e,n,s=o[1].stack+"",i;return{c(){e=element("pre"),n=element("code"),i=text(s)},m(r,a){insert(r,e,a),append(e,n),append(n,i)},p(r,a){a&2&&s!==(s=r[1].stack+"")&&set_data(i,s)},d(r){r&&detach(e)}}}function create_default_slot(o){let e,n,s,i,r,a,u,c,d,f,h,m,_,g,v,w,b,$;return{c(){e=element("p"),e.textContent=`This information makes it easier for a developer to track down what
            might have caused the bug.`,n=space(),s=element("ul"),i=element("li"),r=text("OS "),a=element("i"),a.textContent=`(${o[8].os})`,u=space(),c=element("li"),d=text("Browser "),f=element("i"),f.textContent=`(${o[8].name} / ${o[8].version})`,h=space(),m=element("li"),_=text("Screen Resolution "),g=element("i"),g.textContent=`(${window.innerWidth}x${window.innerHeight})`,v=space(),w=element("li"),b=text("Screen DPI "),$=element("i"),$.textContent=`(${window.devicePixelRatio})`},m(y,k){insert(y,e,k),insert(y,n,k),insert(y,s,k),append(s,i),append(i,r),append(i,a),append(s,u),append(s,c),append(c,d),append(c,f),append(s,h),append(s,m),append(m,_),append(m,g),append(s,v),append(s,w),append(w,b),append(w,$)},p:noop,d(y){y&&detach(e),y&&detach(n),y&&detach(s)}}}function create_catch_block$1(o){let e,n,s,i=JSON.stringify(o[17],null,2)+"",r;return{c(){e=element("p"),e.textContent="Errror",n=space(),s=element("code"),r=text(i)},m(a,u){insert(a,e,u),insert(a,n,u),insert(a,s,u),append(s,r)},p(a,u){u&64&&i!==(i=JSON.stringify(a[17],null,2)+"")&&set_data(r,i)},i:noop,o:noop,d(a){a&&detach(e),a&&detach(n),a&&detach(s)}}}function create_then_block$1(o){let e,n,s,i=JSON.stringify(o[16],null,2)+"",r,a;return e=new Button({props:{name:"Done",icon:"checkmark"}}),{c(){create_component(e.$$.fragment),n=space(),s=element("code"),r=text(i)},m(u,c){mount_component(e,u,c),insert(u,n,c),insert(u,s,c),append(s,r),a=!0},p(u,c){(!a||c&64)&&i!==(i=JSON.stringify(u[16],null,2)+"")&&set_data(r,i)},i(u){a||(transition_in(e.$$.fragment,u),a=!0)},o(u){transition_out(e.$$.fragment,u),a=!1},d(u){destroy_component(e,u),u&&detach(n),u&&detach(s)}}}function create_pending_block$1(o){let e;return{c(){e=text("Submitting Reprot")},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}function create_fragment$5(o){let e,n,s,i;const r=[create_if_block$1,create_else_block],a=[];function u(c,d){return c[6]?0:1}return e=u(o),n=a[e]=r[e](o),{c(){n.c(),s=empty()},m(c,d){a[e].m(c,d),insert(c,s,d),i=!0},p(c,[d]){let f=e;e=u(c),e===f?a[e].p(c,d):(group_outros(),transition_out(a[f],1,1,()=>{a[f]=null}),check_outros(),n=a[e],n?n.p(c,d):(n=a[e]=r[e](c),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(c){i||(transition_in(n),i=!0)},o(c){transition_out(n),i=!1},d(c){a[e].d(c),c&&detach(s)}}}function instance$4(o,e,n){let s,{mode:i="bug"}=e,r=detect(),a,u,c=!1,{error:d}=e,f=!0,h;function m(){const y={type:i,title:a,description:u};f&&(y.stacktrace=s),c&&(y.browser=detect(),y.browser.screen={width:window.innerWidth,height:window.innerHeight,dpi:window.devicePixelRatio}),n(6,h=submitReport(y))}onMount(async()=>{s&&n(2,a=s.type+": "+s.title)});function _(y){bubble.call(this,o,y)}function g(y){bubble.call(this,o,y)}function v(){a=this.value,n(2,a)}function w(){u=this.value,n(3,u)}function b(y){f=y,n(5,f)}function $(y){c=y,n(4,c)}return o.$$set=y=>{"mode"in y&&n(0,i=y.mode),"error"in y&&n(1,d=y.error)},o.$$.update=()=>{o.$$.dirty&2&&n(7,s=d&&parseStackTrace(d.stack))},[i,d,a,u,c,f,h,s,r,m,_,g,v,w,b,$]}class Report extends SvelteComponent{constructor(e){super();init(this,e,instance$4,create_fragment$5,safe_not_equal,{mode:0,error:1})}}class DebugScene{constructor(e,n){this.scene=e,this.pm=n,this.m={},this.gl=e.renderer.gl,this.initHTML(),this.initGeometry(),this.setSettings(settingsManager.getSettings()),n.on("settings",this.setSettings.bind(this))}initHTML(){}initGeometry(){this.m.skeleton=this.scene.addMesh({geometry:new Geometry(this.gl,{position:{size:3,data:new Float32Array([0,0,0])},uv:{size:2,data:new Float32Array([0,0])},index:{size:1,data:new Uint16Array([0])}}),program:new Program(this.gl,{vertex:WireFrameShader.vertex,fragment:WireFrameShader.fragment,depthTest:!1}),mode:this.gl.LINES}),this.m.vertices=this.scene.addMesh({mode:this.gl.POINTS,geometry:new Geometry(this.gl,{position:{size:3,data:new Float32Array(3)}}),program:new Program(this.gl,{vertex:ParticleShader.vertex,fragment:ParticleShader.fragment,depthTest:!1,transparent:!0})})}setSettings(e){var n,s;this.settings=JSON.parse(JSON.stringify(e)),this.m.skeleton.visible=!!((n=this.settings.debug)==null?void 0:n.skeleton),this.m.vertices.visible=!!((s=this.settings.debug)==null?void 0:s.skeleton),this.update()}setPlant(e){this.plant=e,this.update()}update(e=this.plant,n=this.settings){var s,i;if(!(!e||!n)&&(e.allSkeletons||e.skeletons)&&((s=n.debug)==null?void 0:s.skeleton)){const r=(i=e.allSkeletons)!=null?i:e.skeletons;let a=0;for(const f of r)a+=f.length/4*3;const u=new Float32Array(a),c=new Uint32Array((a/3-1)*2);let d=0;r.forEach(f=>{const h=f.length/4;for(let m=0;m<h;m++)u[d*3+m*3+0]=f[m*4+0],u[d*3+m*3+1]=f[m*4+1],u[d*3+m*3+2]=f[m*4+2];for(let m=0;m<h-1;m++)c[d*2+m*2]=d+m,c[d*2+m*2+1]=d+m+1;d+=h}),this.m.skeleton.geometry=new Geometry(this.gl,{position:{size:3,data:u},index:{size:1,data:c}}),this.m.vertices.geometry=new Geometry(this.gl,{position:{size:3,data:u}})}}}const log=log$8("scene.foreground");class ForegroundScene{constructor(e,n){this.scene=e,this.pm=n,this.worker=worker(),this.gl=e.renderer.gl,this.initGeometry(),this.dbg=new DebugScene(e,n),this.setSettings(settingsManager.getSettings()),this.setPlant(n.getActiveProject()),this.pm.on("settings",this.setSettings.bind(this)),this.pm.on("plant",this.setPlant.bind(this))}initGeometry(){const e=new Box(this.scene.gl,{width:0,height:0,depth:0});this.mesh=this.scene.addMesh({geometry:e,program:MatCapShader(this.gl)})}setSettings(e){this.settings=JSON.parse(JSON.stringify(e)),this.update()}setPlant(e){!e||(this.plant=JSON.parse(JSON.stringify(e)),this.update())}async update(e=this.plant,n=this.settings){var s;if(!(!e||!n)){this.scene.isLoading.set(!0);try{const i=await this.worker.plant(e,n);if(!i)return;this.scene.isLoading.set(!1),this.mesh.mode=((s=n==null?void 0:n.debug)==null?void 0:s.wireframe)?this.gl.LINES:this.gl.TRIANGLES,this.dbg.setPlant(i),this.mesh.geometry=transferToGeometry(this.gl,i.geometry),this.mesh.geometry.computeBoundingBox(),this.scene.renderer.setControlTarget(this.mesh.geometry.bounds.center)}catch(i){log.error(i),await createToast(i,{title:"Error [Generator]",values:["report"]})==="report"&&createAlert(Report,{timeout:0,title:"Report Bug",type:"error",props:{mode:"bug",error:i}})}}}}class Scene{constructor(e,n){this.isLoading=writable(!1),this.renderer=new Renderer({canvas:n,camPos:localState.get("camPos")}),this.renderer.on("camPos",s=>localState.set("camPos",s)),this.renderer.handleResize(),this.scene=this.renderer.scene,this.gl=this.renderer.gl,this.wrapper=n.parentElement,this.bg=new BackgroundScene(this,e),this.fg=new ForegroundScene(this,e)}addMesh(e){const n=new Mesh(this.gl,e);return n.setParent(this.scene),n}}var Scene_svelte_svelte_type_style_lang="";function create_if_block_1(o){let e,n,s=JSON.stringify(o[1],null,2)+"",i;return{c(){e=element("pre"),n=element("code"),i=text(s),attr(n,"class","svelte-1gkla7w"),attr(e,"class","svelte-1gkla7w")},m(r,a){insert(r,e,a),append(e,n),append(n,i)},p(r,a){a&2&&s!==(s=JSON.stringify(r[1],null,2)+"")&&set_data(i,s)},d(r){r&&detach(e)}}}function create_if_block(o){let e;return{c(){e=element("div"),e.innerHTML='<p class="svelte-1gkla7w">Is Loading</p>',attr(e,"class","is-loading svelte-1gkla7w")},m(n,s){insert(n,e,s)},d(n){n&&detach(e)}}}function create_fragment$4(o){var u,c;let e,n,s,i,r=((c=(u=o[4])==null?void 0:u.debug)==null?void 0:c.pd)&&o[1]&&create_if_block_1(o),a=o[5]&&create_if_block();return{c(){e=element("div"),r&&r.c(),n=space(),s=element("canvas"),i=space(),a&&a.c(),attr(s,"class","svelte-1gkla7w"),attr(e,"class","scene-wrapper svelte-1gkla7w")},m(d,f){insert(d,e,f),r&&r.m(e,null),append(e,n),append(e,s),o[8](s),append(e,i),a&&a.m(e,null)},p(d,[f]){var h,m;((m=(h=d[4])==null?void 0:h.debug)==null?void 0:m.pd)&&d[1]?r?r.p(d,f):(r=create_if_block_1(d),r.c(),r.m(e,n)):r&&(r.d(1),r=null),d[5]?a||(a=create_if_block(),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:noop,o:noop,d(d){d&&detach(e),r&&r.d(),o[8](null),a&&a.d()}}}function instance$3(o,e,n){let s,i,r=noop,a=()=>(r(),r=subscribe(g,w=>n(4,i=w)),g),u,c=noop,d=()=>(c(),c=subscribe(s,w=>n(5,u=w)),s);o.$$.on_destroy.push(()=>r()),o.$$.on_destroy.push(()=>c());let f,h,m,_,g;function v(w){binding_callbacks[w?"unshift":"push"](()=>{f=w,n(0,f)})}return o.$$.update=()=>{o.$$.dirty&65&&f&&projectManager&&!h&&n(6,h=new Scene(projectManager,f)),o.$$.dirty&64&&d(n(3,s=h&&h.isLoading)),o.$$.dirty&128&&projectManager&&(_&&_(),n(7,_=projectManager.on("save",w=>n(1,m=w))))},settingsManager&&a(n(2,g=settingsManager.store)),[f,m,g,s,i,u,h,_,v]}class Scene_1 extends SvelteComponent{constructor(e){super();init(this,e,instance$3,create_fragment$4,safe_not_equal,{})}}var Help_svelte_svelte_type_style_lang="";function create_fragment$3(o){let e,n,s,i,r,a,u,c,d,f,h,m,_;return n=new Button({props:{name:"Tutorial",icon:"hand"}}),n.$on("click",o[0]),r=new Button({props:{name:"Report Bug",icon:"exclamation"}}),r.$on("click",o[1]),c=new Button({props:{name:"Request Feature"}}),c.$on("click",o[2]),h=new Button({props:{name:"Changelog"}}),h.$on("click",o[3]),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),i=space(),a=element("div"),create_component(r.$$.fragment),u=space(),d=element("div"),create_component(c.$$.fragment),f=space(),m=element("div"),create_component(h.$$.fragment),set_style(s,"display","contents"),set_style(s,"--bg","#303030"),set_style(s,"--text","white"),set_style(a,"display","contents"),set_style(a,"--bg","#303030"),set_style(a,"--text","white"),set_style(d,"display","contents"),set_style(d,"--bg","#303030"),set_style(d,"--text","white"),set_style(m,"display","contents"),set_style(m,"--bg","#303030"),set_style(m,"--text","white"),attr(e,"class","svelte-4ypi13")},m(g,v){insert(g,e,v),append(e,s),mount_component(n,s,null),append(e,i),append(e,a),mount_component(r,a,null),append(e,u),append(e,d),mount_component(c,d,null),append(e,f),append(e,m),mount_component(h,m,null),_=!0},p:noop,i(g){_||(transition_in(n.$$.fragment,g),transition_in(r.$$.fragment,g),transition_in(c.$$.fragment,g),transition_in(h.$$.fragment,g),_=!0)},o(g){transition_out(n.$$.fragment,g),transition_out(r.$$.fragment,g),transition_out(c.$$.fragment,g),transition_out(h.$$.fragment,g),_=!1},d(g){g&&detach(e),destroy_component(n),destroy_component(r),destroy_component(c),destroy_component(h)}}}function instance$2(o){return[()=>Tutor.restart(),()=>createAlert(Report,{timeout:0,title:"Report Bug",type:"error",props:{mode:"bug"}}),()=>createAlert(Report,{timeout:0,title:"Request Feature",props:{mode:"feat"}}),()=>createAlert(ChangeLog,{timeout:0})]}class Help extends SvelteComponent{constructor(e){super();init(this,e,instance$2,create_fragment$3,safe_not_equal,{})}}var Header_svelte_svelte_type_style_lang="";function create_fragment$2(o){var v,w;let e,n,s,i,r,a=((w=(v=o[0])==null?void 0:v.meta.name)!=null?w:"")+"",u,c,d,f,h,m,_,g;return s=new HoverWindow({props:{icon:"folder",name:"Projects",component:ProjectManagerView}}),f=new HoverWindow({props:{icon:"question",component:Help,right:!0}}),m=new HoverWindow({props:{icon:"cog",component:SettingsManagerView,right:!0}}),{c(){e=element("header"),n=element("div"),create_component(s.$$.fragment),i=space(),r=element("h3"),u=text(a),c=space(),d=element("div"),create_component(f.$$.fragment),h=space(),_=element("div"),create_component(m.$$.fragment),attr(n,"class","left svelte-1dyrwb1"),attr(r,"class","svelte-1dyrwb1"),set_style(_,"display","contents"),set_style(_,"--min-width","250px"),attr(d,"class","right svelte-1dyrwb1"),attr(e,"class","svelte-1dyrwb1")},m(b,$){insert(b,e,$),append(e,n),mount_component(s,n,null),append(e,i),append(e,r),append(r,u),append(e,c),append(e,d),mount_component(f,d,null),append(d,h),append(d,_),mount_component(m,_,null),g=!0},p(b,[$]){var y,k;(!g||$&1)&&a!==(a=((k=(y=b[0])==null?void 0:y.meta.name)!=null?k:"")+"")&&set_data(u,a)},i(b){g||(transition_in(s.$$.fragment,b),transition_in(f.$$.fragment,b),transition_in(m.$$.fragment,b),g=!0)},o(b){transition_out(s.$$.fragment,b),transition_out(f.$$.fragment,b),transition_out(m.$$.fragment,b),g=!1},d(b){b&&detach(e),destroy_component(s),destroy_component(f),destroy_component(m)}}}function instance$1(o,e,n){let s;const i=projectManager.activeProject;return component_subscribe(o,i,r=>n(0,s=r)),[s,i]}class Header extends SvelteComponent{constructor(e){super();init(this,e,instance$1,create_fragment$2,safe_not_equal,{})}}var App_svelte_svelte_type_style_lang="";function create_fragment$1(o){let e,n,s,i,r,a,u,c,d,f,h,m,_,g,v;return e=new ThemeProvider({}),s=new AlertWrapper({}),r=new ToastWrapper({}),u=new Tutor$1({}),d=new Header({}),m=new Scene_1({}),{c(){create_component(e.$$.fragment),n=space(),create_component(s.$$.fragment),i=space(),create_component(r.$$.fragment),a=space(),create_component(u.$$.fragment),c=space(),create_component(d.$$.fragment),f=space(),h=element("main"),create_component(m.$$.fragment),_=space(),g=element("div"),attr(g,"id","nodesystem-view"),attr(g,"class","svelte-1lkll4k"),attr(h,"class","svelte-1lkll4k")},m(w,b){mount_component(e,w,b),insert(w,n,b),mount_component(s,w,b),insert(w,i,b),mount_component(r,w,b),insert(w,a,b),mount_component(u,w,b),insert(w,c,b),mount_component(d,w,b),insert(w,f,b),insert(w,h,b),mount_component(m,h,null),append(h,_),append(h,g),o[1](g),v=!0},p:noop,i(w){v||(transition_in(e.$$.fragment,w),transition_in(s.$$.fragment,w),transition_in(r.$$.fragment,w),transition_in(u.$$.fragment,w),transition_in(d.$$.fragment,w),transition_in(m.$$.fragment,w),v=!0)},o(w){transition_out(e.$$.fragment,w),transition_out(s.$$.fragment,w),transition_out(r.$$.fragment,w),transition_out(u.$$.fragment,w),transition_out(d.$$.fragment,w),transition_out(m.$$.fragment,w),v=!1},d(w){destroy_component(e,w),w&&detach(n),destroy_component(s,w),w&&detach(i),destroy_component(r,w),w&&detach(a),destroy_component(u,w),w&&detach(c),destroy_component(d,w),w&&detach(f),w&&detach(h),destroy_component(m),o[1](null)}}}function instance(o,e,n){let s;onMount(async()=>{s.append(nodeSystem.view.wrapper),nodeSystem.view.handleResize()});function i(r){binding_callbacks[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,i]}class App extends SvelteComponent{constructor(e){super();init(this,e,instance,create_fragment$1,safe_not_equal,{})}}function create_catch_block(o){return{c:noop,m:noop,i:noop,o:noop,d:noop}}function create_then_block(o){let e,n;return e=new App({}),{c(){create_component(e.$$.fragment)},m(s,i){mount_component(e,s,i),n=!0},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_pending_block(o){let e;return{c(){e=element("p"),e.textContent="Loading"},m(n,s){insert(n,e,s)},i:noop,o:noop,d(n){n&&detach(e)}}}function create_fragment(o){let e,n,s={ctx:o,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:0,blocks:[,,,]};return handle_promise(settingsManager.loadFromLocal(),s),{c(){e=empty(),s.block.c()},m(i,r){insert(i,e,r),s.block.m(i,s.anchor=r),s.mount=()=>e.parentNode,s.anchor=e,n=!0},p(i,[r]){o=i},i(i){n||(transition_in(s.block),n=!0)},o(i){for(let r=0;r<3;r+=1){const a=s.blocks[r];transition_out(a)}n=!1},d(i){i&&detach(e),s.block.d(i),s.token=null,s=null}}}class Loader extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment,safe_not_equal,{})}}let l;try{l=new Loader({target:document.body})}catch(o){console.log(o)}
//# sourceMappingURL=index.dd471342.js.map
