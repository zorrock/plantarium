var S=Object.defineProperty;var c=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var f=(e,t,o)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))_.call(t,o)&&f(e,o,t[o]);if(c)for(var o of c(t))R.call(t,o)&&f(e,o,t[o]);return e};import{C as T}from"./vendor-f14ba82b.js";function E(){return"window"in globalThis}let g={};(()=>{"sessionStorage"in globalThis||(globalThis.sessionStorage={getItem:e=>{},setItem:(e,t)=>{}})})();if("user"in sessionStorage)try{g=JSON.parse(sessionStorage.getItem("user"))}catch{}const m=T(g);m.subscribe(e=>{sessionStorage.setItem("user",JSON.stringify(e))});const i=m,{VITE_API_URL:I="http://localhost:3000"}={VITE_API_URL:"https://plant-api.jim-fx.com",VITE_SVELTEKIT_AMP:"",VITE_GH_ORG:"jim-fx",VITE_GH_REPO:"plantarium",BASE_URL:"/admin/_app/",MODE:"production",DEV:!1,PROD:!0};function k(e){const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),p=decodeURIComponent(atob(o).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(p)}const h=E(),u=(()=>{let e=h&&localStorage.getItem("token");function t(){if(!e||e.length<10){i.set({});return}const o=k(e);i.set({username:o.username,id:o.sub})}return t(),{set token(o){e=o,h&&localStorage.setItem("token",o),t()},get token(){return e}}})();async function r({method:e,path:t,data:o,isJSON:p=!0}){const n={method:e,headers:{}};o&&(n.headers["Content-Type"]="application/json",n.body=JSON.stringify(o)),u.token&&(n.headers["access-token"]=`Bearer ${u.token}`);const s=await fetch(`${I}/${t}`,n);if(s.ok){if(p)try{return await s.json()}catch(d){console.error("Response from "+t+" failed to parse"),console.error(d)}return s.text()}const l=await s.json();return console.error(l),l}function b(e,t={}){return r(a({method:"GET",path:e},t))}function y(e){return r({method:"DELETE",path:e})}function O(e,t){return r({method:"POST",path:e,data:t})}function P(e){return r({method:"GET",path:`api/report/${e}`})}function w(e){return r({method:"PUT",path:`api/report/${e}/publish`})}function j(e){return r({method:"PUT",path:`api/report/${e}/unpublish`})}function U(){return r({method:"GET",path:"api/report/labels"})}function L(e,t){return r({method:"PUT",path:`api/report/${e}`,data:{labels:t}})}var $=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getReport:P,publishReport:w,unpublishReport:j,getAvailableLabels:U,setReportLabels:L});async function v(e,t){const o=await O("api/auth/login",{username:e,password:t});u.token=o.access_token}function A(){u.token=""}function V(e){return r({method:"POST",path:"api/report",data:e})}function G(e){return y(`api/report/${e}`)}async function J(){const e=await b("api/user/role",{isJSON:!1});return i.update(t=>(t.role=e,t)),e}async function N(){const e=await b("api/user/permission");return i.update(t=>(t.permissions=e,t)),e}var x=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",login:v,logout:A,submitReport:V,deleteReport:G,getRole:J,getPermission:N}),M=a(a({},$),x);export{M as a,P as b,U as c,j as d,G as e,N as f,b as g,v as h,A as l,w as p,L as s,i as u};
