var b=Object.defineProperty;var c=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var f=(e,t,o)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,a=(e,t)=>{for(var o in t||(t={}))T.call(t,o)&&f(e,o,t[o]);if(c)for(var o of c(t))E.call(t,o)&&f(e,o,t[o]);return e};import{w as S}from"./index-56b15200.js";function I(){return"window"in globalThis}let d={};"sessionStorage"in globalThis||(globalThis.sessionStorage={getItem:e=>{},setItem:(e,t)=>{}});if("user"in sessionStorage)try{d=JSON.parse(sessionStorage.getItem("user"))}catch{}const h=S(d);h.subscribe(e=>{sessionStorage.setItem("user",JSON.stringify(e))});const i=h,{VITE_API_URL:R="http://localhost:3000"}={VITE_API_URL:"https://plantarium.fly.dev",VITE_SVELTEKIT_APP_VERSION:"1652735888197",VITE_SVELTEKIT_APP_VERSION_FILE:"_app/version.json",VITE_SVELTEKIT_APP_VERSION_POLL_INTERVAL:"0",VITE_SVELTEKIT_AMP:"",VITE_GH_ORG:"jim-fx",VITE_GH_REPO:"plantarium",BASE_URL:"/admin/_app/",MODE:"production",DEV:!1,PROD:!0};function P(e){const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),p=decodeURIComponent(atob(o).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(p)}const g=I(),u=(()=>{let e=g&&localStorage.getItem("token");function t(){if(!e||e.length<10){i.set({});return}const o=P(e);i.set({username:o.username,id:o.sub})}return t(),{set token(o){e=o,g&&localStorage.setItem("token",o),t()},get token(){return e}}})();async function r({method:e,path:t,data:o,isJSON:p=!0}){const n={method:e,headers:{}};o&&(n.headers["Content-Type"]="application/json",n.body=JSON.stringify(o)),u.token&&(n.headers["access-token"]=`Bearer ${u.token}`);const s=await fetch(`${R}/${t}`,n);if(s.ok){if(p)try{return await s.json()}catch(_){console.error("Response from "+t+" failed to parse"),console.error(_)}return s.text()}const l=await s.json();return console.error(l),l}function m(e,t={}){return r(a({method:"GET",path:e},t))}function O(e){return r({method:"DELETE",path:e})}function V(e,t){return r({method:"POST",path:e,data:t})}function y(e){return r({method:"GET",path:`api/report/${e}`})}function L(e){return r({method:"PUT",path:`api/report/${e}/publish`})}function k(e){return r({method:"PUT",path:`api/report/${e}/unpublish`})}function w(){return r({method:"GET",path:"api/report/labels"})}function j(e,t){return r({method:"PUT",path:`api/report/${e}`,data:{labels:t}})}var A=Object.freeze(Object.defineProperty({__proto__:null,getReport:y,publishReport:L,unpublishReport:k,getAvailableLabels:w,setReportLabels:j},Symbol.toStringTag,{value:"Module"}));async function v(e,t){const o=await V("api/auth/login",{username:e,password:t});u.token=o.access_token}function U(){u.token=""}function N(e){return r({method:"POST",path:"api/report",data:e})}function $(e){return O(`api/report/${e}`)}async function G(){const e=await m("api/user/role",{isJSON:!1});return i.update(t=>(t.role=e,t)),e}async function J(){const e=await m("api/user/permission");return i.update(t=>(t.permissions=e,t)),e}var D=Object.freeze(Object.defineProperty({__proto__:null,login:v,logout:U,submitReport:N,deleteReport:$,getRole:G,getPermission:J},Symbol.toStringTag,{value:"Module"})),x=a(a({},A),D);export{x as a,U as b,y as c,w as d,J as e,k as f,m as g,$ as h,v as l,L as p,j as s,i as u};
