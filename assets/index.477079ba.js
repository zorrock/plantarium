var cn=Object.defineProperty,un=Object.defineProperties;var hn=Object.getOwnPropertyDescriptors;var ss=Object.getOwnPropertySymbols;var dn=Object.prototype.hasOwnProperty,pn=Object.prototype.propertyIsEnumerable;var it=(s,e,t)=>e in s?cn(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,R=(s,e)=>{for(var t in e||(e={}))dn.call(e,t)&&it(s,t,e[t]);if(ss)for(var t of ss(e))pn.call(e,t)&&it(s,t,e[t]);return s},ne=(s,e)=>un(s,hn(e));var De=(s,e,t)=>(it(s,typeof e!="symbol"?e+"":e,t),t);import{w as le,s as ot,S as Z,i as K,a as Q,e as I,b as G,c as B,t as xe,d,f as V,g as k,l as C,n as O,h as D,j as ue,k as q,m as _e,r as de,o as ns,p as Re,q as pe,u as ze,v as Fe,x as rt,y as at,z as fe,A as lt,B as fn,C as mn,D as vn,E as yn,F as gn,G as wn,H as bn,I as xn,J as Be,V as he,K as _n,L as Sn,T as Mn,R as Nn,M as Pn,O as En,P as kn,N as jn,Q as Cn,U as Ln,W as $,X as is,Y as os,Z as ct,_ as ut,$ as rs,a0 as In}from"./vendor.5fc20639.js";const Tn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};Tn();const On="0px 0px 2px rgba(0, 0, 0, 0.7)",An="0px 0px 5px rgba(0, 0, 0, 0.144)";var Vn={"dark_background-color":"#1a1a1a","dark_foreground-color":"#303030","dark_outline-color":"#212121","dark_text-color":"#ffffff",dark_shadow:On,"light_background-color":"#d0d0d0","light_foreground-color":"white","light_outline-color":"#b9b9b9","light_text-color":"#484848",light_shadow:An};function Dn(s){const e={};return Object.entries(s).forEach(([t,n])=>{const[i,o]=t.split("_");i in e?e[i][o]=n:e[i]={[o]:n}}),e}const ht=Dn(Vn),Ye=Object.keys(ht);let dt="theme"in localStorage?localStorage.getItem("theme"):Ye[0];Ye.includes(dt)||(dt=Ye[0]);const Rn=le(ht[dt]),as=s=>{Ye.includes(s)&&(Rn.set(ht[s]),localStorage.setItem("theme",s))};var ie;(function(s){s.INFO="info",s.WARNING="warning",s.ERROR="error",s.SUCCESS="success"})(ie||(ie={}));const zn=s=>(e,t={})=>{var r;if(!e&&!t)return;const n=Array.isArray(t==null?void 0:t.values),i={id:ot(),type:ie.INFO,content:e,props:t.props,title:(r=t==null?void 0:t.title)!=null?r:t==null?void 0:t.type,values:t==null?void 0:t.values,timeout:t==null?void 0:t.timeout},o=new Promise((l,a)=>{i.resolve=l,i.reject=a});if(o.finally(()=>s.update(l=>l.filter(a=>a.id!==i.id))),t&&"type"in t){const l=t.type.toLowerCase();Object.values(ie).forEach(a=>{l===a&&(i.type=a)})}if(e instanceof Error&&(i.type=ie.ERROR),typeof i.timeout=="undefined"){let l;i.type===ie.SUCCESS&&(l=3e3),i.type===ie.INFO&&(l=2e3),i.type===ie.WARNING&&(l=7e3),l&&!n&&(i.timeout=l)}return"title"in i||(i.title=i.type.toUpperCase().slice(0,1)+i.type.slice(1)),s.update(l=>[...l,i]),i.timeout&&setTimeout(i.resolve,i.timeout),o};var ls=()=>{const s=le([]),e=zn(s);return{store:s,createMessage:e,MessageType:ie}};const{store:Fr,createMessage:Fn,MessageType:Br}=ls(),Bn=Fn;const{store:Yr,createMessage:Yn}=ls(),Ue=Yn;var Un=(s,...e)=>{const t=(i,o)=>{Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o).map(r=>r.toString())).forEach(r=>{r.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(o,r))})},n=class extends s{constructor(...o){super(...o);e.forEach(r=>t(this,new r))}};return e.forEach(i=>{t(n.prototype,i.prototype),t(n,i)}),n},cs=s=>{s[0]==="#"&&(s=s.replace("#","")),s.length===3&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]);const e=s.match(/.{1,2}/g);return[parseInt(e[0],16)/255,parseInt(e[1],16)/255,parseInt(e[2],16)/255]};const ee=.4;function Wn(s,e,t,n,i,o,r,l,a,c){const u=i-t,h=r-i,p=a-r,f=o-n,m=l-o,y=c-l;let b,w,N,S,P=-1e4,A=-1e4;const g=[{x:t,y:n}];for(let j=1;j<s;j++){const _=j/s;b=t+u*_,N=i+h*_;const L=r+p*_;b+=(N-b)*_,N+=(L-N)*_,w=n+f*_,S=o+m*_;const T=l+y*_;w+=(S-w)*_,S+=(T-S)*_;const z=b+(N-b)*_,F=w+(S-w)*_,re=z-P,X=F-A;re*re+X*X>e&&(g.push({x:z,y:F}),P=z,A=F)}return g.push({x:a,y:c}),g}function Xn(s){const e=s.length-1;return s.map((t,n,i)=>{if(n===0)return{rx:i[n+1].x*ee*0,ry:t.y+(i[n+1].y-t.y)*ee*0};if(n===e)return{lx:i[n-1].x+(t.x-i[n-1].x)*ee*2,ly:i[n-1].y+(t.y-i[n-1].y)*ee*2};if(t.y>i[n+1].y&&t.y>i[n-1].y||t.y<i[n+1].y&&t.y<i[n-1].y)return{lx:i[n-1].x+(t.x-i[n-1].x)*ee,ly:t.y,rx:t.x+(i[n+1].x-t.x)*ee,ry:t.y};{const r={x:i[n-1].x-i[n+1].x,y:i[n-1].y-i[n+1].y},l=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2));r.x/=l,r.y/=l;const a=i[n+1].x-t.x,c=t.x-i[n-1].x;return{lx:t.x+r.x*c*ee,ly:t.y+r.y*c*ee,rx:t.x-r.x*a*ee,ry:t.y-r.y*a*ee}}})}function Gn(s){const e=s.length-1,t={},n=Xn(s);return s.map((i,o,r)=>{if(o<e)return Wn(e*20,0,i.x,i.y,n[o].rx,n[o].ry,n[o+1].lx,n[o+1].ly,r[o+1].x,r[o+1].y)}).flat().filter(i=>!i||i.x in t?!1:(t[i.x]=!0,!0))}function us(s,e,t){let n;return(...i)=>{const o=()=>{n=null,t||s(...i)},r=t&&!n;clearTimeout(n),n=setTimeout(o,e),r&&s(...i)}}function qn(s,e=!1){return function(t,n,i){let o;const r=i.value;return i.value=function(...l){const a=()=>{o=null,e||r.apply(this,l)},c=e&&!o;clearTimeout(o),o=setTimeout(a,s),c&&r.apply(this,l)},i}}function pt(s,e){let t,n,i,o=null,r=0;const l=s,a=()=>{r=0,o=null,i=l.apply(t,n),o||(t=n=null)};return function(){const u=Date.now();r||(r=u);const h=e-(u-r);return t=this,n=arguments,h<=0||h>e?(o&&(clearTimeout(o),o=null),r=u,i=l.apply(t,n),o||(t=n=null)):o||(o=setTimeout(a,h)),i}}const te={amountEmitters:0,amountCallbacks:0,emitters:[]};typeof self!="undefined"&&"window"in self&&(window.debug=te);class H{constructor(){De(this,"index",0);De(this,"cbs",{});De(this,"cbsOnce",{});this.index=te.amountEmitters,te.amountEmitters++}emit(e,t){e in this.cbs&&this.cbs[e].forEach(n=>n(t)),e in this.cbsOnce&&(this.cbsOnce[e].forEach(n=>n(t)),delete this.cbsOnce[e])}on(e,t,n=0){n>0&&(t=pt(t,n));const i=Object.assign(this.cbs,{[e]:[...this.cbs[e]||[],t]});return this.cbs=i,te.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(o=>[o,this.cbs[o].length]))},te.amountCallbacks++,()=>{var o;te.amountCallbacks--,(o=i[e])==null||o.splice(i[e].indexOf(t),1),te.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(r=>[r,this.cbs[r].length]))}}}once(e,t){return this.cbsOnce[e]=[...this.cbsOnce[e]||[],t],()=>{this.cbsOnce[e].splice(this.cbsOnce[e].indexOf(t),1)}}destroyEventEmitter(){te.amountEmitters--,Object.keys(this.cbs).forEach(e=>{te.amountCallbacks-=this.cbs[e].length,delete this.cbs[e]}),Object.keys(this.cbsOnce).forEach(e=>delete this.cbsOnce[e]),this.cbs={},this.cbsOnce={},delete te.emitters[this.index]}}function Hn(s){if(s.length===0)return 0;let e=0;for(let t=0;t<s.length;t++)e=(e<<5)-e+s.charCodeAt(t),e=e&e;return e}var Jn=()=>{const s={};let e=0;const t=(n=0,i=0)=>{if(i>500)throw new Error("Infinite loop in id generation algo");return n in s?t(Math.max(n++,e++),i+1):(s[n]=!0,n.toString())};return t.reset=()=>{Object.keys(s).forEach(n=>delete s[+n]),e=0},t};function Zn(s,e){const t=[],n=s.length/e;for(let i=0;i<n;i++){const o=[];for(let r=0;r<e;r++)o[r]=s[i*e+r];t.push(o)}return t}function ft(s){let e,t={length:NaN};const n=(i,o)=>i===t[o];return function(...o){return(o.length!==t.length||!o.every(n))&&(t=o,e=s.apply(this,o)),e}}let mt=[],vt=2,me=0;const Kn={};let yt=0;const Qn=["#00ffff","#f0ffff","#f5f5dc","#000000","#0000ff","#a52a2a","#00ffff","#00008b","#008b8b","#a9a9a9","#006400","#bdb76b","#8b008b","#556b2f","#ff8c00","#9932cc","#8b0000","#e9967a","#9400d3","#ff00ff","#ffd700","#008000","#4b0082","#f0e68c","#add8e6","#e0ffff","#90ee90","#d3d3d3","#ffb6c1","#ffffe0","#00ff00","#ff00ff","#800000","#000080","#808000","#ffa500","#ffc0cb","#800080","#800080","#ff0000","#c0c0c0","#ffffff","#ffff00"],gt="plant.log.history",hs="localStorage"in globalThis,Se=hs?gt in localStorage?JSON.parse(localStorage.getItem(gt)):[]:[];function $n(){hs&&localStorage.setItem(gt,JSON.stringify(Se))}let ve;function Y(s){me=Math.max(me,s.length);const e=yt;Kn[s]=Qn[yt],yt++;const t=(i,o)=>{if(Se.push({scope:s,args:i,level:vt}),Se.length=Math.min(100,Se.length),ve&&ve.set(Se),$n(),(!mt.length||mt.includes(s))&&o<=vt){if(i instanceof Error||o===2){console.error(`[${s.padEnd(me," ")}]`,i);return}if(Array.isArray(i)&&typeof i[0]=="string"&&typeof i[1]=="object"){console.groupCollapsed(`%c[${s.padEnd(me," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,i[0]),console.log(...i.slice(1)),console.groupEnd();return}o===0&&console.log(`%c[${s.padEnd(me," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,...i),o===1&&console.warn(`[${s.padEnd(me," ")}]`,...i)}},n=(...i)=>t(i,0);return n.warn=(...i)=>t(i,1),n.error=i=>t(i,2),n}Y.getStore=function(){return ve||(ve=le([]),ve)};Y.setFilter=(...s)=>{mt=s};Y.setLevel=(s=0)=>{vt=s};function ei(s){const e={};return(...t)=>{const n=Hn(JSON.stringify(t));return n in e?e[n]:e[n]=s(...t)}}function ti(s){let e,t,n,i,o,r,l,a,c,u,h;return{c(){e=I("div"),t=I("input"),n=G(),i=I("label"),o=B("svg"),r=B("title"),l=xe("cross"),a=B("line"),c=B("line"),d(t,"type","checkbox"),d(t,"id",s[1]),d(t,"class","svelte-ohv39p"),d(r,"class","svelte-ohv39p"),d(a,"vector-effect","non-scaling-stroke"),d(a,"x1","0"),d(a,"y1","100"),d(a,"x2","100"),d(a,"y2","0"),d(a,"class","svelte-ohv39p"),d(c,"vector-effect","non-scaling-stroke"),d(c,"x1","0"),d(c,"y1","0"),d(c,"x2","100"),d(c,"y2","100"),d(c,"class","svelte-ohv39p"),d(o,"xmlns","http://www.w3.org/2000/svg"),d(o,"viewBox","0 0 100 100"),d(o,"class","svelte-ohv39p"),d(i,"class","checkbox-label svelte-ohv39p"),d(i,"for",s[1]),d(e,"class","component-wrapper svelte-ohv39p")},m(p,f){V(p,e,f),k(e,t),t.checked=s[0],k(e,n),k(e,i),k(i,o),k(o,r),k(r,l),k(o,a),k(o,c),u||(h=C(t,"change",s[2]),u=!0)},p(p,[f]){f&2&&d(t,"id",p[1]),f&1&&(t.checked=p[0]),f&2&&d(i,"for",p[1])},i:O,o:O,d(p){p&&D(e),u=!1,h()}}}function si(s,e,t){const n=ue();let{value:i=!1}=e,{id:o=ot()}=e;function r(){i=this.checked,t(0,i)}return s.$$set=l=>{"value"in l&&t(0,i=l.value),"id"in l&&t(1,o=l.id)},s.$$.update=()=>{s.$$.dirty&1&&i!==void 0&&n("change",!!i)},[i,o,r]}class ni extends Z{constructor(e){super();K(this,e,si,ti,Q,{value:0,id:1})}}function ds(s,e,t){const n=s.slice();return n[19]=e[t],n[21]=t,n}function ps(s,e,t){const n=s.slice();return n[19]=e[t],n}function fs(s){let e,t,n,i,o;function r(){return s[10](s[19])}return{c(){e=B("circle"),d(e,"cx",t=s[19].x*100),d(e,"cy",n=s[19].y*100),d(e,"r","2"),d(e,"class","svelte-tsaxx5"),q(e,"pinned",s[19].pinned)},m(l,a){V(l,e,a),i||(o=C(e,"mousedown",r),i=!0)},p(l,a){s=l,a&1&&t!==(t=s[19].x*100)&&d(e,"cx",t),a&1&&n!==(n=s[19].y*100)&&d(e,"cy",n),a&1&&q(e,"pinned",s[19].pinned)},d(l){l&&D(e),i=!1,o()}}}function ii(s){let e,t,n,i,o;return{c(){e=B("line"),d(e,"x1",t=s[3][s[21]-1].x*100),d(e,"y1",n=s[3][s[21]-1].y*100),d(e,"x2",i=s[19].x*100),d(e,"y2",o=s[19].y*100),d(e,"class","svelte-tsaxx5")},m(r,l){V(r,e,l)},p:O,d(r){r&&D(e)}}}function ms(s){let e,t,n,i=s[21]>0&&s[21]%2==0&&ii(s);return{c(){i&&i.c(),e=B("circle"),d(e,"cx",t=s[19].x*100),d(e,"cy",n=s[19].y*100),d(e,"r","1"),d(e,"class","svelte-tsaxx5"),q(e,"pinned",s[19].pinned)},m(o,r){i&&i.m(o,r),V(o,e,r)},p(o,r){o[21]>0&&o[21]%2==0&&i.p(o,r)},d(o){i&&i.d(o),o&&D(e)}}}function oi(s){let e,t,n,i,o,r,l=s[0],a=[];for(let h=0;h<l.length;h+=1)a[h]=fs(ps(s,l,h));let c=s[3],u=[];for(let h=0;h<c.length;h+=1)u[h]=ms(ds(s,c,h));return{c(){e=I("div"),t=B("svg"),n=B("path");for(let h=0;h<a.length;h+=1)a[h].c();i=B("g");for(let h=0;h<u.length;h+=1)u[h].c();d(n,"d",s[2]),d(n,"fill","none"),d(n,"stroke","grey"),d(n,"class","svelte-tsaxx5"),d(i,"id","debug"),d(i,"class","svelte-tsaxx5"),d(t,"viewBox","0 0 100 100"),d(t,"width","100"),d(t,"height","100"),d(t,"class","svelte-tsaxx5"),d(e,"class","component-wrapper svelte-tsaxx5")},m(h,p){V(h,e,p),k(e,t),k(t,n);for(let f=0;f<a.length;f+=1)a[f].m(t,null);k(t,i);for(let f=0;f<u.length;f+=1)u[f].m(i,null);o||(r=[C(t,"mousedown",s[5]),C(t,"mousemove",s[4]),C(t,"mouseover",s[7]),C(t,"mouseout",s[8]),C(t,"mouseup",s[6]),C(t,"focus",s[7]),C(t,"blur",s[8])],o=!0)},p(h,[p]){if(p&4&&d(n,"d",h[2]),p&3){l=h[0];let f;for(f=0;f<l.length;f+=1){const m=ps(h,l,f);a[f]?a[f].p(m,p):(a[f]=fs(m),a[f].c(),a[f].m(t,i))}for(;f<a.length;f+=1)a[f].d(1);a.length=l.length}if(p&8){c=h[3];let f;for(f=0;f<c.length;f+=1){const m=ds(h,c,f);u[f]?u[f].p(m,p):(u[f]=ms(m),u[f].c(),u[f].m(i,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=c.length}},i:O,o:O,d(h){h&&D(e),_e(a,h),_e(u,h),o=!1,de(r)}}}function ri(s,e,t){let n,i;const o=ue();let{value:r=[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}=e,l=!1,a,c,u=0,h=0,p=[];const f=()=>{requestAnimationFrame(()=>{o("change",n),t(0,n=n.sort((g,j)=>g.x>j.x?-1:1))})},m=g=>{g.pinned||(n.splice(n.indexOf(a),1),f())},y=g=>{l&&(u=g.offsetX,h=g.offsetY,a&&(c=a,t(1,a=void 0)),c&&(c.x=u/100,c.y=h/100,f()))},b=()=>{if(!a){const g={x:u/100,y:h/100,pinned:!1};t(1,a=g),n.push(a),f()}},w=()=>{a&&(m(a),t(1,a=void 0)),c=void 0},N=()=>{l=!0},S=()=>{l=!1};function P(g){const j=ns.points(g.map(_=>[_.x*100,_.y*100]));return ns.svgPath(j)}const A=g=>{t(1,a=g)};return s.$$set=g=>{"value"in g&&t(9,r=g.value)},s.$$.update=()=>{s.$$.dirty&512&&t(0,n=r),s.$$.dirty&1&&t(2,i=P(n))},[n,a,i,p,y,b,w,N,S,r,A]}class ai extends Z{constructor(e){super();K(this,e,ri,oi,Q,{value:9})}}function vs(s){let e,t;return{c(){e=I("span"),d(e,"class","overlay svelte-3lnuwn"),d(e,"style",t=`width: ${(s[0]-s[1])/(s[2]-s[1])*100}%`)},m(n,i){V(n,e,i)},p(n,i){i&7&&t!==(t=`width: ${(n[0]-n[1])/(n[2]-n[1])*100}%`)&&d(e,"style",t)},d(n){n&&D(e)}}}function li(s){let e,t,n,i,o,r,l,a,c,u,h=typeof s[1]!="undefined"&&typeof s[2]!="undefined"&&vs(s);return{c(){e=I("div"),h&&h.c(),t=G(),n=I("button"),n.textContent="-",i=G(),o=I("input"),l=G(),a=I("button"),a.textContent="+",d(n,"class","svelte-3lnuwn"),d(o,"step",s[3]),d(o,"max",s[2]),d(o,"min",s[1]),d(o,"type","number"),d(o,"style",r=`width:${s[5]};`),d(o,"class","svelte-3lnuwn"),d(a,"class","svelte-3lnuwn"),d(e,"class","component-wrapper svelte-3lnuwn")},m(p,f){V(p,e,f),h&&h.m(e,null),k(e,t),k(e,n),k(e,i),k(e,o),pe(o,s[0]),s[11](o),k(e,l),k(e,a),c||(u=[C(n,"click",s[9]),C(o,"input",s[10]),C(o,"mousedown",s[7]),C(o,"mouseup",s[8]),C(a,"click",s[12])],c=!0)},p(p,[f]){typeof p[1]!="undefined"&&typeof p[2]!="undefined"?h?h.p(p,f):(h=vs(p),h.c(),h.m(e,t)):h&&(h.d(1),h=null),f&8&&d(o,"step",p[3]),f&4&&d(o,"max",p[2]),f&2&&d(o,"min",p[1]),f&32&&r!==(r=`width:${p[5]};`)&&d(o,"style",r),f&1&&ze(o.value)!==p[0]&&pe(o,p[0])},i:O,o:O,d(p){p&&D(e),h&&h.d(),s[11](null),c=!1,de(u)}}}function ci(s,e,t){let n,i;const o=ue();let{min:r=-1/0}=e,{max:l=1/0}=e,{step:a=1}=e,{value:c=0}=e;c||(c=0);let u;function h(g){t(0,c=Math.max(r,Math.min(+c+g,l)))}let p=0,f=0,m;function y(g){g.preventDefault(),f=c,p=g.clientX,m=u.getBoundingClientRect(),window.removeEventListener("mousemove",w),window.addEventListener("mousemove",w),window.addEventListener("mouseup",b),document.body.style.cursor="ew-resize"}function b(){f===c?u.focus():u.blur(),document.body.style.cursor="unset",window.removeEventListener("mouseup",b),window.removeEventListener("mousemove",w)}function w(g){if(n){const j=(g.clientX-m.left)/m.width;t(0,c=Math.max(Math.min(Math.floor(r+(l-r)*j),l),r))}else{const j=g.clientX-p;t(0,c=f+Math.floor(j/10))}}const N=()=>h(-a);function S(){c=ze(this.value),t(0,c)}function P(g){Fe[g?"unshift":"push"](()=>{u=g,t(4,u)})}const A=()=>h(+a);return s.$$set=g=>{"min"in g&&t(1,r=g.min),"max"in g&&t(2,l=g.max),"step"in g&&t(3,a=g.step),"value"in g&&t(0,c=g.value)},s.$$.update=()=>{var g;s.$$.dirty&6&&(n=typeof r!="undefined"&&typeof l!="undefined"&&Number.isFinite(r)&&Number.isFinite(l)),s.$$.dirty&1&&c!==void 0&&o("change",parseFloat(c+"")),s.$$.dirty&1&&t(5,i=Number.isFinite(c)?Math.max(((g=c==null?void 0:c.toString().length)!=null?g:1)*8,30)+"px":"20px")},[c,r,l,a,u,i,h,y,b,N,S,P,A]}class ui extends Z{constructor(e){super();K(this,e,ci,li,Q,{min:1,max:2,step:3,value:0})}get min(){return this.$$.ctx[1]}set min(e){this.$$set({min:e}),Re()}get max(){return this.$$.ctx[2]}set max(e){this.$$set({max:e}),Re()}get step(){return this.$$.ctx[3]}set step(e){this.$$set({step:e}),Re()}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),Re()}}function hi(s){let e,t,n,i,o,r,l,a;return{c(){e=I("div"),t=I("span"),i=G(),o=I("input"),d(t,"class","overlay svelte-2vvjq7"),d(t,"style",n=`width: ${(s[0]-s[1])/(s[2]-s[1])*100}%`),d(o,"step",s[3]),d(o,"max",s[2]),d(o,"min",s[1]),d(o,"type","number"),d(o,"style",r=`width:${s[6]};`),d(o,"class","svelte-2vvjq7"),d(e,"class","component-wrapper svelte-2vvjq7"),q(e,"is-down",s[5])},m(c,u){V(c,e,u),k(e,t),k(e,i),k(e,o),pe(o,s[0]),s[10](o),l||(a=[C(o,"input",s[9]),C(o,"mousedown",s[7]),C(o,"mouseup",s[8])],l=!0)},p(c,[u]){u&7&&n!==(n=`width: ${(c[0]-c[1])/(c[2]-c[1])*100}%`)&&d(t,"style",n),u&8&&d(o,"step",c[3]),u&4&&d(o,"max",c[2]),u&2&&d(o,"min",c[1]),u&64&&r!==(r=`width:${c[6]};`)&&d(o,"style",r),u&1&&ze(o.value)!==c[0]&&pe(o,c[0]),u&32&&q(e,"is-down",c[5])},i:O,o:O,d(c){c&&D(e),s[10](null),l=!1,de(a)}}}function di(s){return parseFloat(s).toPrecision(2)}function pi(s,e,t){let n,{value:i=.5}=e,{step:o=.01}=e,{min:r=0}=e,{max:l=1}=e;const a=ue();let c,u=!1,h=0,p=0,f=0,m;function y(P){P.preventDefault(),t(5,u=!0),p=i,h=P.clientY,m=c.getBoundingClientRect(),window.removeEventListener("mousemove",w),window.addEventListener("mousemove",w),window.addEventListener("mouseup",b),document.body.style.cursor="ew-resize"}function b(){t(5,u=!1),p===i&&c.focus(),i<r&&t(1,r=i),i>l&&t(2,l=i),document.body.style.cursor="unset",window.removeEventListener("mouseup",b),window.removeEventListener("mousemove",w)}function w(P){if(f=(P.clientX-m.left)/m.width,P.clientY-h,P.ctrlKey){let A=r+(l-r)*f;t(0,i=A)}else t(1,r=0),t(2,l=1),t(0,i=Math.max(Math.min(r+(l-r)*f,l),r))}function N(){i=ze(this.value),t(0,i)}function S(P){Fe[P?"unshift":"push"](()=>{c=P,t(4,c)})}return s.$$set=P=>{"value"in P&&t(0,i=P.value),"step"in P&&t(3,o=P.step),"min"in P&&t(1,r=P.min),"max"in P&&t(2,l=P.max)},s.$$.update=()=>{var P;s.$$.dirty&1&&(i||0).toString().length>5&&t(0,i=di(i||0)),s.$$.dirty&1&&i!==void 0&&a("change",parseFloat(i+"")),s.$$.dirty&1&&t(6,n=Number.isFinite(i)?Math.max(((P=i==null?void 0:i.toString().length)!=null?P:1)*8,50)+"px":"20px")},[i,r,l,o,c,u,n,y,b,N,S]}class fi extends Z{constructor(e){super();K(this,e,pi,hi,Q,{value:0,step:3,min:1,max:2})}}function ys(s,e,t){const n=s.slice();return n[11]=e[t],n}function mi(s){let e,t,n;return{c(){e=I("div"),e.textContent="none",d(e,"id","selected-value"),d(e,"class","svelte-1ywe9t")},m(i,o){V(i,e,o),t||(n=C(e,"click",s[4]),t=!0)},p:O,d(i){i&&D(e),t=!1,n()}}}function vi(s){let e,t,n,i;return{c(){e=I("div"),t=xe(s[0]),d(e,"id","selected-value"),d(e,"class","svelte-1ywe9t")},m(o,r){V(o,e,r),k(e,t),n||(i=C(e,"click",s[4]),n=!0)},p(o,r){r&1&&at(t,o[0])},d(o){o&&D(e),n=!1,i()}}}function gs(s){let e,t=s[11]+"",n,i,o,r,l;function a(){return s[8](s[11])}return{c(){e=I("p"),n=xe(t),i=G(),d(e,"style",o=`opacity: ${s[11]===s[0]?.5:1}`),d(e,"class","item svelte-1ywe9t")},m(c,u){V(c,e,u),k(e,n),k(e,i),r||(l=C(e,"click",a),r=!0)},p(c,u){s=c,u&2&&t!==(t=s[11]+"")&&at(n,t),u&3&&o!==(o=`opacity: ${s[11]===s[0]?.5:1}`)&&d(e,"style",o)},d(c){c&&D(e),r=!1,l()}}}function ws(s){let e,t=s[11]!==s[0]&&gs(s);return{c(){t&&t.c(),e=rt()},m(n,i){t&&t.m(n,i),V(n,e,i)},p(n,i){n[11]!==n[0]?t?t.p(n,i):(t=gs(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&D(e)}}}function yi(s){let e,t,n,i;function o(u,h){return u[0]!==void 0?vi:mi}let r=o(s),l=r(s),a=s[1],c=[];for(let u=0;u<a.length;u+=1)c[u]=ws(ys(s,a,u));return{c(){e=I("div"),t=I("div"),l.c(),n=G(),i=I("div");for(let u=0;u<c.length;u+=1)c[u].c();d(i,"id","item-wrapper"),d(i,"class","svelte-1ywe9t"),d(t,"id","main"),d(t,"class","svelte-1ywe9t"),d(e,"class","component-wrapper svelte-1ywe9t"),q(e,"open",s[2])},m(u,h){V(u,e,h),k(e,t),l.m(t,null),k(t,n),k(t,i);for(let p=0;p<c.length;p+=1)c[p].m(i,null);s[9](t)},p(u,[h]){if(r===(r=o(u))&&l?l.p(u,h):(l.d(1),l=r(u),l&&(l.c(),l.m(t,n))),h&35){a=u[1];let p;for(p=0;p<a.length;p+=1){const f=ys(u,a,p);c[p]?c[p].p(f,h):(c[p]=ws(f),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=a.length}h&4&&q(e,"open",u[2])},i:O,o:O,d(u){u&&D(e),l.d(),_e(c,u),s[9](null)}}}function gi(s,e,t){const n=ue();let{value:i=void 0}=e,o=!1,r;function l(){t(2,o=!0),setTimeout(()=>{document.addEventListener("click",()=>{t(2,o=!1)},{once:!0})},50)}function a(m){t(0,i=m),t(2,o=!1)}let{values:c=[]}=e;function u(m){t(1,c=m)}function h(m){t(0,i=m)}const p=m=>a(m);function f(m){Fe[m?"unshift":"push"](()=>{r=m,t(3,r)})}return s.$$set=m=>{"value"in m&&t(0,i=m.value),"values"in m&&t(1,c=m.values)},s.$$.update=()=>{s.$$.dirty&1&&i&&n("change",i)},[i,c,o,r,l,a,u,h,p,f]}class wi extends Z{constructor(e){super();K(this,e,gi,yi,Q,{value:0,values:1,setItems:6,setValue:7})}get setItems(){return this.$$.ctx[6]}get setValue(){return this.$$.ctx[7]}}function bs(s,e,t){const n=s.slice();return n[19]=e[t],n}function xs(s){let e,t,n,i,o;function r(){return s[9](s[19])}return{c(){e=B("circle"),d(e,"cx",t=s[19].x*100),d(e,"cy",n=s[19].y*200-50),d(e,"r","4"),d(e,"class","svelte-vrnf7c"),q(e,"pinned",s[19].pinned)},m(l,a){V(l,e,a),i||(o=C(e,"mousedown",r),i=!0)},p(l,a){s=l,a&1&&t!==(t=s[19].x*100)&&d(e,"cx",t),a&1&&n!==(n=s[19].y*200-50)&&d(e,"cy",n),a&1&&q(e,"pinned",s[19].pinned)},d(l){l&&D(e),i=!1,o()}}}function bi(s){let e,t,n,i,o,r,l,a,c,u,h,p,f=s[0],m=[];for(let y=0;y<f.length;y+=1)m[y]=xs(bs(s,f,y));return{c(){e=I("div"),t=B("svg"),n=B("path");for(let y=0;y<m.length;y+=1)m[y].c();i=G(),o=B("svg"),r=B("defs"),l=B("linearGradient"),a=B("stop"),c=B("stop"),u=B("path"),d(n,"d",s[2]),d(n,"fill","none"),d(n,"stroke","#65E2A0"),d(n,"class","svelte-vrnf7c"),d(t,"viewBox","0 0 100 100"),d(t,"width","50"),d(t,"height","100"),d(t,"class","svelte-vrnf7c"),d(a,"offset","0%"),fe(a,"stop-color","#65E2A0"),fe(a,"stop-opacity","1"),d(a,"class","svelte-vrnf7c"),d(c,"offset","100%"),fe(c,"stop-color","#469C6E"),fe(c,"stop-opacity","1"),d(c,"class","svelte-vrnf7c"),d(l,"id","grad1"),d(l,"x1","0%"),d(l,"y1","0%"),d(l,"x2","100%"),d(l,"y2","0%"),d(l,"class","svelte-vrnf7c"),d(r,"class","svelte-vrnf7c"),d(u,"d",s[2]),d(u,"fill","url(#grad1)"),d(u,"stroke","grey"),d(u,"class","svelte-vrnf7c"),d(o,"id","right"),d(o,"viewBox","0 0 100 100"),d(o,"width","50"),d(o,"height","100"),d(o,"class","svelte-vrnf7c"),d(e,"class","component-wrapper svelte-vrnf7c")},m(y,b){V(y,e,b),k(e,t),k(t,n);for(let w=0;w<m.length;w+=1)m[w].m(t,null);k(e,i),k(e,o),k(o,r),k(r,l),k(l,a),k(l,c),k(o,u),h||(p=[C(t,"mousedown",s[4]),C(t,"mousemove",s[3]),C(t,"mouseover",s[6]),C(t,"mouseout",s[7]),C(t,"mouseup",s[5]),C(t,"focus",s[6]),C(t,"blur",s[7])],h=!0)},p(y,[b]){if(b&4&&d(n,"d",y[2]),b&3){f=y[0];let w;for(w=0;w<f.length;w+=1){const N=bs(y,f,w);m[w]?m[w].p(N,b):(m[w]=xs(N),m[w].c(),m[w].m(t,null))}for(;w<m.length;w+=1)m[w].d(1);m.length=f.length}b&4&&d(u,"d",y[2])},i:O,o:O,d(y){y&&D(e),_e(m,y),h=!1,de(p)}}}function xi(s,e,t){let n,i;const o=ue();let{value:r=[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}=e,l=!1,a,c,u=0,h=0;const p=()=>{requestAnimationFrame(()=>{o("change",n),t(0,n=n.sort((g,j)=>g.y>j.y?-1:1))})},f=g=>{g.pinned||(n.splice(n.indexOf(a),1),p())},m=g=>{l&&(u=g.offsetX,h=g.offsetY,a&&(c=a,t(1,a=void 0)),c&&(c.x=u/50,c.y=h/100,p()))},y=()=>{if(!a){const g={x:u/50,y:h/100,pinned:!1};t(1,a=g),n.push(a),p()}},b=()=>{a&&(f(a),t(1,a=void 0)),c=void 0},w=()=>{l=!0},N=()=>{l=!1},S=g=>`L ${g.x*100} ${g.y*200-50}`;function P(g){return g.reduce((j,_,L)=>L===0?`M ${_.x*100},${_.y*200-50}`:`${j} ${S(_)}`,"")}const A=g=>{t(1,a=g)};return s.$$set=g=>{"value"in g&&t(8,r=g.value)},s.$$.update=()=>{s.$$.dirty&256&&t(0,n=r),s.$$.dirty&1&&t(2,i=P(n))},[n,a,i,m,y,b,w,N,r,A]}class _i extends Z{constructor(e){super();K(this,e,xi,bi,Q,{value:8})}}function _s(s,e,t){const n=s.slice();return n[21]=e[t],n[23]=t,n}function Ss(s){let e,t=(s[21].title||s[21].value)+"",n,i,o,r;function l(){return s[14](s[21])}function a(){return s[15](s[21])}function c(){return s[16](s[21])}return{c(){e=I("div"),n=xe(t),i=G(),d(e,"class","search-entry svelte-779fwr"),q(e,"focused",s[21].value===s[3])},m(u,h){V(u,e,h),k(e,n),k(e,i),o||(r=[C(e,"focus",l),C(e,"mouseover",a),C(e,"click",c)],o=!0)},p(u,h){s=u,h&16&&t!==(t=(s[21].title||s[21].value)+"")&&at(n,t),h&24&&q(e,"focused",s[21].value===s[3])},d(u){u&&D(e),o=!1,de(r)}}}function Ms(s){let e,t=s[23]<s[0]&&Ss(s);return{c(){t&&t.c(),e=rt()},m(n,i){t&&t.m(n,i),V(n,e,i)},p(n,i){n[23]<n[0]?t?t.p(n,i):(t=Ss(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){t&&t.d(n),n&&D(e)}}}function Si(s){let e,t,n,i,o,r=s[4],l=[];for(let a=0;a<r.length;a+=1)l[a]=Ms(_s(s,r,a));return{c(){e=I("div"),t=I("input"),n=G();for(let a=0;a<l.length;a+=1)l[a].c();d(t,"type","text"),d(t,"placeholder","Search"),d(t,"class","svelte-779fwr"),d(e,"class","search-wrapper svelte-779fwr")},m(a,c){V(a,e,c),k(e,t),s[12](t),pe(t,s[1]),k(e,n);for(let u=0;u<l.length;u+=1)l[u].m(e,null);i||(o=[C(window,"keydown",s[6]),C(t,"input",s[13])],i=!0)},p(a,[c]){if(c&2&&t.value!==a[1]&&pe(t,a[1]),c&185){r=a[4];let u;for(u=0;u<r.length;u+=1){const h=_s(a,r,u);l[u]?l[u].p(h,c):(l[u]=Ms(h),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=r.length}},i:O,o:O,d(a){a&&D(e),s[12](null),_e(l,a),i=!1,de(o)}}}function Mi(s,e,t){let n,i;const o=ue(),r={};let{limitAmount:l=10}=e,{values:a=[]}=e,c,u="";function h(_,L){if(!(L==null?void 0:L.length))return _;const T=_.filter(F=>!!(F.value.includes(L)||F.title&&F.title.toLowerCase().includes(L)));return T.length?(T.find(F=>F.value===i)||t(3,i=T[0].value),T):[{value:"Nothing Found"}]}function p(){c.focus()}function f(){t(1,u="")}function m({value:_=i}={value:i}){r[_]=r[_]+1||1,o("input",_)}function y(_){if(!i.length){t(3,i=n[0].value);return}const L=n.slice(0,l).find(re=>re.value===i);if(!L)return;const T=n.indexOf(L),z=Math.min(n.length,l),F=((T+_)%z+z)%z;t(3,i=n[F].value)}function b({key:_}){_==="Enter"&&i.length&&m(),_==="ArrowDown"&&y(1),_==="ArrowUp"&&y(-1)}function w(_){t(3,i=_.value)}const N=_=>{t(8,a=_)};function S(_){Fe[_?"unshift":"push"](()=>{c=_,t(2,c)})}function P(){u=this.value,t(1,u)}const A=_=>w(_),g=_=>w(_),j=_=>m(_);return s.$$set=_=>{"limitAmount"in _&&t(0,l=_.limitAmount),"values"in _&&t(8,a=_.values)},s.$$.update=()=>{s.$$.dirty&258&&t(4,n=h(a,u.toLowerCase()))},t(3,i=""),[l,u,c,i,n,m,b,w,a,p,f,N,S,P,A,g,j]}class Ni extends Z{constructor(e){super();K(this,e,Mi,Si,Q,{limitAmount:0,values:8,focus:9,clear:10,setItems:11})}get focus(){return this.$$.ctx[9]}get clear(){return this.$$.ctx[10]}get setItems(){return this.$$.ctx[11]}}function Pi({target:s,template:e,value:t}){t===void 0&&"value"in e&&(t=e.value);const n=Ei(e,t),i=R({},e);return delete i.type,delete i.inputType,delete i.defaultValue,delete i.internal,i.value=t,new n({target:s,props:ne(R({},i),{"--width":"100%"})})}function Ei(s,e){return s.inputType==="select"||Array.isArray(s.values)?wi:s.inputType==="curve"?ai:s.inputType==="shape"?_i:s.type==="number"||typeof e=="number"?s.step&&s.step%1!=0?fi:ui:ni}function ki(s){const e=2*Math.PI/s;return new Array(s).fill(null).map((n,i)=>[Math.cos(e*i),Math.sin(e*i)])}function ji(s,e){const t=new Uint16Array(s*(e-1)*6);for(let n=0;n<e;n++){const i=n*s*6,o=n*s;for(let r=0;r<s;r++){const l=i+r*6,a=o+r;t[l+0]=a,t[l+1]=a-s+1,t[l+2]=a+1,t[l+3]=a+1,t[l+4]=a+s,t[l+5]=a,r===s-1?(t[l+0]=a,t[l+1]=a-s+1,t[l+2]=a+1,t[l+3]=a+1,t[l+4]=a+s,t[l+5]=a):(t[l+0]=a,t[l+1]=a+1,t[l+2]=a+s+1,t[l+3]=a+s+1,t[l+4]=a+s,t[l+5]=a)}}return t}function Ci(s,e){const t=[],n=[],i=[],o={position:[],index:ji(e,s.length)},r=ki(e),l=r.length,a=s.length;for(let c=0;c<a;c++){const u=[0,0,1];c===0?lt(n,s[c],s[c+1]):c===a-1?lt(n,s[c-1],s[c]):lt(n,s[c-1],s[c+1]),fn(n,n),mn(i,u,n);const h=Math.acos(vn(u,n));yn(t),gn(t,t,h,i);for(let p=0;p<l;p++){const f=r[p],m=[f[0],f[1],0],y=s[c][3];wn(m,m,[y,y,1]),bn(m,m,t),xn(m,m,s[c]),o.position.push(m)}}return o}function Me(s,e,t){return s*(1-t)+e*t}function Li(s,e=0){const t=(s.length-1)*e,n=Math.floor(t),i=Math.ceil(t);return Me(s[i],s[n],i-t)}function Ns(s,e){const t=(s.length/4-1)*e,n=Math.floor(t),i=Math.ceil(t),o=i-t;return[Me(s[i*4+0],s[n*4+0],o),Me(s[i*4+1],s[n*4+1],o),Me(s[i*4+2],s[n*4+2],o),Me(s[i*4+3],s[n*4+3],o)]}function Ps(s,e){const t=(s.length/4-1)*e,n=Math.floor(t),i=Math.ceil(t);return[s[i*4+0]-s[n*4+0],s[i*4+1]-s[n*4+1],s[i*4+2]-s[n*4+2],s[i*4+3]+s[n*4+3]/2]}function wt(...s){if(s.length===1)return s[0];const e=new Float32Array(s.reduce((u,h)=>u+h.position.length,0)),t=new Float32Array(s.reduce((u,h)=>u+h.normal.length,0)),n=new Float32Array(s.reduce((u,h)=>u+h.uv.length,0)),i=s.reduce((u,h)=>u+h.index.length,0),o=i>65536?new Uint32Array(i):new Uint16Array(i);let r=0,l=0,a=0,c=0;for(let u=0;u<s.length;u++){const h=s[u].normal,p=h.length;for(let S=0;S<p;S++)t[l+S]=h[S];l+=p;const f=s[u].uv,m=f.length;for(let S=0;S<m;S++)n[a+S]=f[S];a+=m;const y=s[u].index,b=y.length;for(let S=0;S<b;S++)o[S+c]=y[S]+r/3;c+=b;const w=s[u].position,N=w.length;for(let S=0;S<N;S++)e[r+S]=w[S];r+=N}return{position:e,normal:t,uv:n,index:o}}var Ii=(s,e)=>Math.sqrt(s*s+e*e),Ti=(s,e,t)=>Math.sqrt(s*s+e*e+t*t);let ye=0,bt=Be.makeNoise2D(ye),Es=Be.makeNoise3D(ye);var xt={n1d:s=>bt(s,0),n2d:(s,e)=>bt(s,e),n3d:(s,e,t)=>Es(s,e,t),get seed(){return ye},set seed(s){ye=s,bt=Be.makeNoise2D(ye),Es=Be.makeNoise3D(ye)}},ks=([s,e])=>{const t=Ii(s,e);return t===0?[1,0]:[s/t,e/t]},Oi=(s,e,t)=>{const n=Ti(s,e,t);return[s/n,e/n,t/n]},js=(s,e,t)=>[s*Math.cos(t)-e*Math.sin(t),s*Math.sin(t)+e*Math.cos(t)];function _t(s,e,t){const[n,i,o]=s,[r,l,a]=Oi(e[0],e[1],e[2]),c=Math.cos(t),u=Math.sin(t);return new he((c+(1-c)*r*r)*n+((1-c)*r*l-a*u)*i+((1-c)*r*a+l*u)*o,((1-c)*r*l+a*u)*n+(c+(1-c)*l*l)*i+((1-c)*l*a-r*u)*o,((1-c)*r*a-l*u)*n+((1-c)*l*a+r*u)*i+(c+(1-c)*a*a)*o)}function Ai(s,e){return new _n(s,{position:{size:3,data:e.position},normal:{size:3,data:e.normal},uv:{size:2,data:e.uv},index:{data:e.index}})}function Vi(s,{res:e=1,xCurvature:t=.5,yCurvature:n=.2}={}){const i=s.length,o=3+e*2,r=o*i,l=(o-1)*(i-1)*2,a=new Float32Array(r*3),c=new Float32Array(r*2),u=new Float32Array(r*2),h=new Uint16Array(l*3);return s.forEach((p,f)=>{const m=f*o;for(let y=0;y<o;y++){const b=2-y/(o-1)*2-1;a[m*3+y*3+0]=(p.x-1)*b*.5;const w=-(1-p.y)*(1-p.y)*.5,N=Math.sin(Math.abs(b)*Math.PI)*.01;if(a[m*3+y*3+1]=N*t+w*n,a[m*3+y*3+2]=p.y-1,u[m*2+y*2+0]=a[m*3+y*3+0]+1/2,u[m*2+y*2+1]=a[m*3+y*3+2],f<s.length-1){const S=f*(o-1);h[S*6+y*6+0]=m+y+0,h[S*6+y*6+1]=m+y+1,h[S*6+y*6+2]=m+y+o,h[S*6+y*6+3]=m+y+1,h[S*6+y*6+4]=m+y+o,h[S*6+y*6+5]=m+y+o+1}}}),{position:a,normal:c,index:h,uv:u}}function Cs(s,e=8){const t=Zn(s,4),n=Ci(t,e);return{position:Float32Array.from(n.position.map(o=>o.splice(0,3)).flat()),index:n.index,normal:new Float32Array,uv:new Float32Array}}const Di={title:"Branches",type:"branches",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},length:{type:["number","parameter","curve"],min:0,max:3,step:.05,value:.8},thiccness:{type:"number",min:0,max:1,step:.01,value:.8},offsetSingle:{type:"number",min:0,max:1,step:.01,value:.5},lowestBranch:{type:"number",min:0,max:1,step:.01,value:.2},amount:{type:"number",min:0,max:64,value:10}},computeSkeleton(s,e){const{skeletons:t}=s.input.result,n=e.getSetting("stemResY"),i=t.map(o=>{const r=[],l=e.handleParameter(s.amount),a=e.handleParameter(s.lowestBranch);for(let c=0;c<l;c++){const u=c/l,h=e.handleParameter(s.length,u)*(1-u),p=e.handleParameter(s.thiccness,u),f=e.handleParameter(s.offsetSingle,u),m=c%2==0;let y=a+(1-a)*u;y-=1/l*f*(m?-1:1);const[b,,w]=Ps(o,y),N=ks([b,w]),[S,P]=js(N[0],N[1],m?-Math.PI/2:Math.PI/2),[A,g,j,_]=Ns(o,y),L=Math.max(Math.floor(n*h*10),4),T=new Float32Array(L*4);for(let z=0;z<L*4;z++){const F=z/L;T[z*4+0]=A+S*F*h,T[z*4+1]=g,T[z*4+2]=j+P*F*h,T[z*4+3]=_*p*(1-F)}r.push(T)}return r}).flat();return{skeletons:i,allSkeletons:[...i,...t]}},computeGeometry(s,e,t){const n=t.getSetting("stemResX"),{geometry:i}=s.input.result,{skeletons:o}=e;return{geometry:wt(i,...o.map(r=>Cs(r,n)))}}},Ri={title:"Random",type:"random",outputs:["number"],parameters:{min:{type:"number",value:0,inputType:"slider",min:0,max:1,step:.05},max:{type:"number",inputType:"slider",value:1,min:0,max:1,step:.05}},computeValue(s,e){const{min:t=0,max:n=1}=s;if(n){const i=t+e.n1dn(200)*Math.abs(n-t);return console.log(i),i}return 0}},zi={title:"Curve",type:"curve",outputs:["number"],parameters:{value:{type:"curve",inputType:"curve",internal:!0,label:!1,value:[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}},computeValue(s,e,t){const n=Gn(s.value).map(i=>i.y);return Li(n,1-t)}},Fi={title:"Gravity",type:"gravity",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,type:"select",values:["simple","verlet","test"]},strength:{type:"number",inputType:"slider",min:0,max:2,step:.05}},computeSkeleton(s,e){const{input:t,type:n,strength:i}=s,{skeletons:o}=t.result;return n==="simple"&&o.forEach(r=>{const l=r.length/4;for(let a=1;a<l;a++){const c=a/l,u=r[a*4+1],h=e.handleParameter(i,c);r[a*4+1]=u-u*c*c*c*h}return r}),n==="test"&&o.forEach(r=>{const l=r.length/4;for(let a=1;a<l;a++){const c=a/l,u=e.handleParameter(i,c),h=r[a*4+0],p=r[a*4+1],f=r[a*4+2],m=r[(a-1)*4+0],y=r[(a-1)*4+1],b=r[(a-1)*4+2],w=m-h,N=y-p,S=y-f,[P,A]=js(w,S,90);for(let g=a;g<l;g++){const j=r[g*4+0],_=r[g*4+1],L=r[g*4+2],T=j-m,z=_-y,F=L-b;let[re,X,Ke]=_t([T,z,F],[P,N,A],u*c);const Qe=re+m,$e=X+y,et=Ke+b;r[g*4+0]=Qe,r[g*4+1]=$e,r[g*4+2]=et}}return r}),n==="verlet"&&o.forEach(r=>{const l=r.length/4;for(let a=1;a<l;a++){const c=r[a*4+0],u=r[a*4+1],h=r[a*4+2],p=new he(5,0,0).cross(new he(c,u,h),new he(0,1,0)),f=a/l,m=e.handleParameter(i,f);for(let y=a;y<l;y++){const b=_t([c,u,h],p,f*m);r[y*4+0]=b[0],r[y*4+1]=b[1],r[y*4+2]=b[2]}}return r}),{skeletons:o}},computeGeometry(s){return s.input.result}},St=Y("nodes.join"),Bi={title:"Join",type:"join",outputs:["plant"],parameters:{inputA:{type:"plant",label:"plant",external:!0},inputB:{type:"plant",label:"plant",external:!0}},computeSkeleton(s,e){St("compute skeleton",s,e);const{inputA:t,inputB:n}=s;if(!t||!n)return t?t.result:n.result;const{skeletons:i,allSkeletons:o}=t.result,{skeletons:r,allSkeletons:l}=n.result;St(i,r);const a=[...i,...r],c=[];return o&&c.push(...o),l&&c.push(...l),{allSkeletons:c,skeletons:a}},computeGeometry(s){const{inputA:e,inputB:t}=s;if(!e||!t)return e?e.result:t.result;const{geometry:n,instances:i}=e.result,{geometry:o,instances:r}=t.result,l=wt(n,o),a=[];return i&&a.push(...i),r&&a.push(...r),St("compute geometry",{geometryA:n,geometryB:o,result:l}),{geometry:l,instances:a}}},Yi=[{x:1,y:1,pinned:!0},{x:.62,y:.84,pinned:!1},{x:.54,y:.63,pinned:!1},{x:.38,y:.41,pinned:!0},{x:.44,y:.23,pinned:!1},{x:.64,y:.12,pinned:!1},{x:.98,y:.02,pinned:!0}],Ui={title:"Leaf",type:"leaf",outputs:["plant","leaf"],parameters:{input:{type:"plant",external:!0},size:{type:["number","parameter","curve","vec2"],inputType:"slider",min:0,max:3,step:.05,value:.2},shape:{type:"leaf",external:!0,defaultValue:Yi},lowestLeaf:{type:"number",inputType:"slider",min:0,max:1,step:.01,value:.5},curvature:{external:!0,type:"vec2",defaultValue:{x:.5,y:.2}},amount:{type:"number",min:0,max:20,value:10}},computeSkeleton(s,e){const{input:t}=s,{skeletons:n}=t.result,i=n.map((o,r)=>{const l=r/n.length,a=e.handleParameter(s.amount,l),c=new Float32Array(a*3),u=new Float32Array(a*3),h=new Float32Array(a*3);for(let p=0;p<a;p++){const f=p/(a-1),m=e.handleParameter(s.size,1-f),y=e.handleParameter(s.lowestLeaf,f),b=y+(1-y)*f-.001,[w,N,S]=Ns(o,b),[P,,A]=Ps(o,b),g=ks([P,A]),j=Math.atan2(-g[0],g[1]);c[p*3+0]=w,c[p*3+1]=N,c[p*3+2]=S,u[p*3+0]=m,u[p*3+1]=1,u[p*3+2]=m,h[p*3+0]=0,h[p*3+1]=j-Math.PI/2*(p%2==0?-1:1),h[p*3+2]=0}return{offset:c,scale:u,rotation:h}});return{allSkeletons:t.result.allSkeletons,skeletons:n,instances:i}},computeGeometry(s,e,t){const{shape:n,input:i,curvature:o}=s,{instances:r}=e,l=t.handleParameter(o),a=Vi(t.handleParameter(n),{res:t.getSetting("leafRes",2),xCurvature:l.x,yCurvature:l.y});return{geometry:i.result.geometry,instances:r.map(c=>R(R({},c),a))}}},Wi={title:"Math",type:"math",outputs:["number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},computeValue(s,e,t){const{mode:n}=s,i=e.handleParameter(s.a,t),o=e.handleParameter(s.b,t);switch(n){case"multiply":return i*o;case"subtract":return i-o;default:return i+o}}},Xi=Y("nodes.noise"),Gi={title:"Noise",type:"noise",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},size:{type:"number",inputType:"slider",min:0,max:20,step:.05,value:1},strength:{type:"number",inputType:"slider",min:0,max:2,step:.01,value:.5}},computeSkeleton(s,e){Xi(s);const{input:t}=s,n=e.handleParameter(s.size),i=e.handleParameter(s.strength),{skeletons:o}=t.result;return o.forEach((r,l)=>{const a=r.length/4,c=[r[0],r[1],r[2]];let u=0;for(let h=0;h<a;h++){const p=h/a;u+=(Math.abs(c[0]-r[h*4+0])+Math.abs(c[1]-r[h*4+1])+Math.abs(c[2]-r[h*4+2]))/3,c[0]=r[h*4+0],c[1]=r[h*4+1],c[2]=r[h*4+2],r[h*4+0]=r[h*4+0]+xt.n1d(u*n+0+l*500)*i*p,r[h*4+1]=r[h*4+1]+xt.n1d(u*n+1e3+l*500)*i*p,r[h*4+2]=r[h*4+2]+xt.n1d(u*n+2e3+l*500)*i*p}}),{skeletons:o,allSkeletons:t.result.allSkeletons}},computeGeometry(s){return s.input.result}},qi={title:"Output",type:"output",outputs:[],parameters:{main:{type:"plant",label:"plant",external:!0}},computeNode(s={}){return s.main}},Hi={title:"Parameter",type:"parameter",outputs:["number"],parameters:{value:{type:"number",value:0},variation:{type:"number",inputType:"slider",value:0,min:0,max:1,step:.05}},computeValue(s,e){const{value:t=0,variation:n=0}=s;return n?t+e.n1d(200)*n*Math.max(t,1):t}},Ji=s=>s==="X"?[1,0,0]:s==="Z"?[0,0,1]:[0,1,0],Zi={title:"Rotate",type:"rotate",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,label:!1,type:"select",values:["Y","X","Z"]},spread:{internal:!0,type:"boolean",value:!0},angle:{type:"number",inputType:"slider",min:0,max:Math.PI*2,step:.05,value:0}},computeSkeleton(s,e){const{input:t,type:n,spread:i}=s,{result:{skeletons:o,allSkeletons:r}}=t,l=Ji(n);return o.forEach((a,c)=>{const u=a.length/4,h=a[0],p=a[1],f=a[2],m=c/o.length,y=e.handleParameter(s.angle,m)*(i?m:1);for(let b=1;b<u;b++){let w=a[b*4+0],N=a[b*4+1],S=a[b*4+2];w-=h,N-=p,S-=f,[w,N,S]=_t([w,N,S],l,y),w+=h,N+=p,S+=f,a[b*4+0]=w,a[b*4+1]=N,a[b*4+2]=S}}),{skeletons:o,allSkeletons:r}},computeGeometry(s){return s.input.result}},Ki={title:"Shape",type:"shape",outputs:["leaf"],parameters:{value:{type:"leaf",inputType:"shape",internal:!0,label:!1,value:[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}},computeValue(s){return s.value}},Qi={title:"Slider",type:"slider",outputs:["number"],parameters:{value:{type:"number",label:!1,inputType:"slider",internal:!0,min:0,max:1,step:.01,value:0}},computeValue(s){return s.value}},Ls=Y("nodes.stem"),$i={title:"Stem",type:"stem",outputs:["plant"],parameters:{origin:{type:"vec3",external:!0,defaultValue:{x:0,y:0,z:0}},height:{type:"number",inputType:"slider",min:0,max:5,step:.05,value:2},thiccness:{type:"number",inputType:"slider",min:0,max:.2,step:.01,value:.06},amount:{type:"number",min:0,max:20,value:1}},computeSkeleton(s,e){Ls("computeSkeleton",s);const t=e.handleParameter(s.amount),n=e.getSetting("stemResY"),i=[];for(let o=0;o<t;o++){const{x:r,y:l,z:a}=e.handleParameter(s.origin),c=e.handleParameter(s.height),u=new Float32Array(n*4);for(let h=0;h<n;h++){const p=h/n,f=e.handleParameter(s.thiccness,p)*(1-p),m=r,y=l+p*c,b=a;u[h*4+0]=m,u[h*4+1]=y,u[h*4+2]=b,u[h*4+3]=f}i.push(u)}return{skeletons:i,allSkeletons:i}},computeGeometry(s,e,t){Ls("computeNode",s,e);const n=t.getSetting("stemResX");return{geometry:wt(...e.skeletons.map(i=>Cs(i,n)))}}},eo={title:"Vec2",type:"vec2",outputs:["vec2"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0}}},to={title:"Vec3",type:"vec3",outputs:["vec3"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0},z:{label:!1,type:"number",value:0,defaultValue:0}}},so={title:"Vec3Length",type:"vec3length",outputs:["number"],parameters:{vec:{label:!1,type:"vec3",value:0,defaultValue:0}},computeValue(s,e){const{vec:t}=s;return t?Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2)):0}};var no=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Branch:Di,Random:Ri,Curve:zi,Gravity:Fi,Join:Bi,Leaf:Ui,Math:Wi,Noise:Gi,Output:qi,Parameter:Hi,Rotate:Zi,Shape:Ki,Slider:Qi,Stem:$i,Vec2:eo,Vec3:to,VecLength:so});const Mt=Object.values(no).map(s=>("computeNode"in s?s.compute=s.computeNode:s.compute=e=>({type:s.type,parameters:e}),s));const io=(s,e)=>t=>Math.min(Math.max(t,s),e),oo=s=>{const e=10**s;return t=>Math.floor(t*e)/e},ro=io(-1e5,1e5),ao=oo(1),We=s=>ro(ao(s));class Is{constructor({x1:e=0,y1:t=0,x2:n=0,y2:i=0},o){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.system=o.node.system,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewbox","0 0 100 100"),this.svg.setAttribute("width","100"),this.svg.setAttribute("height","100"),this.svg.style.overflow="visible",this.svg.style.position="absolute",this.svg.style.top="3.5px",this.svg.style.pointerEvents="none",this.svg.style.zIndex="-1",o.view.wrapper.append(this.svg),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("node-connection-path"),this.path.setAttribute("vector-effect","non-scaling-stroke"),this.path.setAttribute("d",`
      M 0 0
      C 50 0 
        50 100
				100  100
      `),this.svg.appendChild(this.path),this.setPosition()}setPosition({x1:e=this.x1,y1:t=this.y1,x2:n=this.x2,y2:i=this.y2}={}){var l;this.x1=We(e),this.y1=We(t),this.x2=We(n),this.y2=We(i);const o=this.x2-this.x1+3.5,r=this.y2-this.y1;(l=this==null?void 0:this.hoverPath)==null||l.setAttribute("d",`
      M 0 0
      C ${o/2} 0 
        ${o/2} ${r}
				${o}  ${r}
      `),this.path.setAttribute("d",`
      M 0 0
      C ${o/2} 0 
        ${o/2} ${r}
				${o}  ${r}
      `)}remove(){var e;this.path.remove(),(e=this==null?void 0:this.hoverPath)==null||e.remove(),this.system.save()}}class lo extends Is{constructor(e){super({},e.output);this.connection=e,this.input=e.input.view,this.output=e.output.view,this.hoverPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.hoverPath.classList.add("node-connection-hover"),this.hoverPath.setAttribute("vector-effect","non-scaling-stroke"),this.svg.append(this.hoverPath),this.hoverPath.addEventListener("mouseover",()=>{const{activeNode:t}=this.system.view;t&&t.view.active&&t.view.hoveredConnection!==this&&this.handleNodeOver(t)}),this.hoverPath.addEventListener("mouseout",()=>{const{activeNode:t}=this.system.view;this.handleNodeOut(t)}),e.input.node.system.view.colorStore.on(e.input.type[0],t=>{this.path.style.stroke=t})}handleNodeOver(e){this.connection.isNodeJoinable(e)&&(e.view.hoveredConnection=this,this.path.classList.add("hover-active"))}handleNodeOut(e){e&&e.view.hoveredConnection===this&&delete e.view.hoveredConnection,this.path.classList.remove("hover-active")}remove(){super.remove()}}function co(s){if(!uo(s))throw new Error("panzoom requires DOM element to be attached to the DOM tree");const t=s.parentElement;return s.scrollTop=0,{getBBox:o,getOwner:i,applyTransform:r};function i(){return t}function o(){return{left:0,top:0,width:s.clientWidth,height:s.clientHeight}}function r(l){s.style.transformOrigin="0 0 0",s.style.transform="matrix("+l.scale+", 0, 0, "+l.scale+", "+l.x+", "+l.y+")"}}function uo(s){return s&&s.parentElement&&s.style}function ho(s,e,t){typeof t!="object"&&(t={});const n=typeof t.minVelocity=="number"?t.minVelocity:5,i=typeof t.amplitude=="number"?t.amplitude:.25,o=typeof t.cancelAnimationFrame=="function"?t.cancelAnimationFrame:po(),r=typeof t.requestAnimationFrame=="function"?t.requestAnimationFrame:fo();let l,a;const c=342;let u,h,p,f,m,y,b,w;return{start:S,stop:A,cancel:N};function N(){o(u),o(w)}function S(){l=s(),f=b=h=m=0,a=new Date,o(u),o(w),u=r(P)}function P(){const j=Date.now(),_=j-a;a=j;const L=s(),T=L.x-l.x,z=L.y-l.y;l=L;const F=1e3/(1+_);h=.8*T*F+.2*h,m=.8*z*F+.2*m,u=r(P)}function A(){o(u),o(w);const j=s();p=j.x,y=j.y,a=Date.now(),(h<-n||h>n)&&(f=i*h,p+=f),(m<-n||m>n)&&(b=i*m,y+=b),w=r(g)}function g(){const j=Date.now()-a;let _=!1,L=0,T=0;f&&(L=-f*Math.exp(-j/c),L>.5||L<-.5?_=!0:L=f=0),b&&(T=-b*Math.exp(-j/c),T>.5||T<-.5?_=!0:T=b=0),_&&(e(p+L,y+T),w=r(g))}}function po(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function fo(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(s){return setTimeout(s,16)}}const mo=.2;function vo(s,e){const t=co(s),n=t.getOwner(),i={x:0,y:0};let o=!1;const r={x:0,y:0,scale:1},l=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,a=e.bounds,c=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,u=typeof e.minZoom=="number"?e.minZoom:0,h=typeof e.boundsPadding=="number"?e.boundsPadding:.05,p=typeof e.zoomSpeed=="number"?e.zoomSpeed:mo;let f=Ts(e.transformOrigin);yo(a);let m,y=!1,b=!1,w,N,S;const P=ho(qs,$s,e.smoothScroll);let A,g=!1;Ft();const j={dispose:en,moveBy:Dt,moveTo:tt,smoothMoveTo:Qs,centerOn:Ks,zoomTo:Oe,zoomAbs:zt,pause:z,resume:F,isPaused:re,getTransform:Qe,setTransform:Ke,getTransformOrigin:$e,setTransformOrigin:et},_=typeof e.initialX=="number"?e.initialX:r.x,L=typeof e.initialY=="number"?e.initialY:r.y,T=typeof e.initialZoom=="number"?e.initialZoom:r.scale;return(_!=r.x||L!=r.y||T!=r.scale)&&zt(_,L,T),j;function z(){Bt(),g=!0}function F(){g&&(Ft(),g=!1)}function re(){return g}function X(v,x){return i.x=v,i.y=x,i}function Ke(v,x,M){r.x=v,r.y=x,r.scale=M,Le()}function Qe(){return r}function $e(){return f}function et(v){f=Ts(v)}function qs(){return{x:r.x,y:r.y}}function tt(v,x){r.x=v,r.y=x,st(),Le()}function Dt(v,x){tt(r.x+v,r.y+x)}function st(){const v=Hs();if(!v)return;let x=!1;const M=Js();let E=v.left-M.right;return E>0&&(r.x+=E,x=!0),E=v.right-M.left,E<0&&(r.x+=E,x=!0),E=v.top-M.bottom,E>0&&(r.y+=E,x=!0),E=v.bottom-M.top,E<0&&(r.y+=E,x=!0),x}function Hs(){if(!!a){if(typeof a=="boolean"){const v=n.getBoundingClientRect(),x=v.width,M=v.height;return{left:x*h,top:M*h,right:x*(1-h),bottom:M*(1-h)}}return a}}function Js(){const v=t.getBBox(),x=Zs(v.left,v.top);return{left:x.x,top:x.y,right:v.width*r.scale+x.x,bottom:v.height*r.scale+x.y}}function Zs(v,x){return{x:v*r.scale+r.x,y:x*r.scale+r.y}}function Le(){o=!0,m=window.requestAnimationFrame(tn)}function Rt(v,x,M){if(Nt(v)||Nt(x)||Nt(M))throw new Error("zoom requires valid numbers");const E=r.scale*M;if(E<u){if(r.scale===u)return;M=u/r.scale}if(E>c){if(r.scale===c)return;M=c/r.scale}const W=X(v,x);r.x=W.x-M*(W.x-r.x),r.y=W.y-M*(W.y-r.y),a&&h===1&&u===1?(r.scale*=M,st()):st()||(r.scale*=M),Le()}function zt(v,x,M){const E=M/r.scale;Rt(v,x,E)}function Ks(v){const x=v.ownerSVGElement;if(!x)throw new Error("ui element is required to be within the scene");const M=v.getBoundingClientRect(),E=M.left+M.width/2,W=M.top+M.height/2,se=x.getBoundingClientRect(),Ae=se.width/2-E,Ve=se.height/2-W;Ie(Ae,Ve)}function Qs(v,x){Ie(v-r.x,x-r.y)}function Ie(v,x){return Dt(v,x)}function $s(v,x){tt(v,x)}function en(){Bt()}function Ft(){n.addEventListener("mousedown",Ht,{passive:!0}),n.addEventListener("dblclick",qt,{passive:!1}),n.addEventListener("touchstart",Ut,{passive:!0}),n.addEventListener("keydown",Yt),n.addEventListener("wheel",Qt,{passive:!0}),Le()}function Bt(){n.removeEventListener("wheel",Qt),n.removeEventListener("mousedown",Ht),n.removeEventListener("keydown",Yt),n.removeEventListener("dblclick",qt),n.removeEventListener("touchstart",Ut),m&&(window.cancelAnimationFrame(m),m=0),P.cancel(),Kt(),ln(),ts()}function tn(){o&&sn()}function sn(){o=!1,t.applyTransform(r),m=0,e.onTransform&&e.onTransform(r)}function Yt(v){let x=0;if(v.keyCode===38||v.keyCode===40||v.keyCode===37||v.keyCode===39||(v.keyCode===189||v.keyCode===109?x=1:(v.keyCode===187||v.keyCode===107)&&(x=-1)),x){const M=$t(x*100),E=f?nt():nn();Oe(E.x,E.y,M)}}function nn(){const v=n.getBoundingClientRect();return{x:v.width/2,y:v.height/2}}function Ut(v){if(on(v),v.touches.length===1)return an(v);v.touches.length===2&&(S=Gt(v.touches[0],v.touches[1]),A=!0,Wt())}function on(v){v.stopPropagation(),v.preventDefault()}function rn(v){v.preventDefault(),v.stopPropagation()}function an(v){const x=v.touches[0],M=ae(x),E=X(M.x,M.y);w=E.x,N=E.y,P.cancel(),Wt()}function Wt(){y||(y=!0,document.addEventListener("touchmove",Xt),document.addEventListener("touchend",Te),document.addEventListener("touchcancel",Te))}function Xt(v){if(v.touches.length===1){v.stopPropagation();const x=v.touches[0],M=ae(x),E=X(M.x,M.y),W=E.x-w,se=E.y-N;W!==0&&se!==0&&es(),w=E.x,N=E.y,Ie(W,se)}else if(v.touches.length===2){A=!0;const x=v.touches[0],M=v.touches[1],E=Gt(x,M),W=1+(E/S-1)*l,se=ae(x),Ae=ae(M);if(w=(se.x+Ae.x)/2,N=(se.y+Ae.y)/2,f){const Ve=nt();w=Ve.x,N=Ve.y}Oe(w,N,W),S=E,v.stopPropagation(),v.preventDefault()}}function Te(v){if(v.touches.length>0){const x=ae(v.touches[0]),M=X(x.x,x.y);w=M.x,N=M.y}}function Gt(v,x){const M=v.clientX-x.clientX,E=v.clientY-x.clientY;return Math.sqrt(M*M+E*E)}function qt(v){rn(v)}function Ht(v){if(y)return v.stopPropagation(),!1;if(v.target!==n&&v.target!==s||!(v.button===1&&window.event!==null||v.button===0))return;P.cancel();const M=ae(v),E=X(M.x,M.y);return w=E.x,N=E.y,document.addEventListener("mousemove",Jt),document.addEventListener("mouseup",Zt),!1}function Jt(v){if(y||v.ctrlKey)return;es();const x=ae(v),M=X(x.x,x.y),E=M.x-w,W=M.y-N;w=M.x,N=M.y,Ie(E,W)}function Zt(){ts(),Kt()}function Kt(){document.removeEventListener("mousemove",Jt),document.removeEventListener("mouseup",Zt),b=!1}function ln(){document.removeEventListener("touchmove",Xt),document.removeEventListener("touchend",Te),document.removeEventListener("touchcancel",Te),b=!1,A=!1,y=!1}function Qt(v){P.cancel();let x=v.deltaY;v.deltaMode>0&&(x*=100);const M=$t(x);if(M!==1){const E=f?nt():ae(v);Oe(E.x,E.y,M)}}function ae(v){const x=n.getBoundingClientRect(),M=v.clientX-x.left,E=v.clientY-x.top;return{x:M,y:E}}function nt(){const v=n.getBoundingClientRect();return{x:v.width*f.x,y:v.height*f.y}}function Oe(v,x,M){return P.cancel(),Rt(v,x,M)}function $t(v){const x=Math.sign(v),M=Math.min(.25,Math.abs(p*v/128));return 1-x*M}function es(){b||(b=!0,P.start())}function ts(){b&&(A||P.stop())}}function Ts(s){if(!!s){if(typeof s=="object")return(!ge(s.x)||!ge(s.y))&&Os(),s;Os()}}function Os(s){throw new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function yo(s){const e=typeof s;if(e==="undefined"||e==="boolean")return;if(!(ge(s.left)&&ge(s.top)&&ge(s.bottom)&&ge(s.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}function ge(s){return Number.isFinite(s)}function Nt(s){return Number.isNaN?Number.isNaN(s):s!==s}function go(s,e){const t=s.x2<e.x1,n=s.x1>e.x2,i=s.y1>e.y2,o=s.y2<e.y1;return!(t||n||i||o)}var wo=(s,e)=>e.type.includes(s.type)||e.type.includes("*");function Xe(s,e){if(s===void 0&&e===void 0)return;const t=Array.isArray(s)?"array":typeof s;if(t==="string"||t==="boolean"||t==="number")return s===e?void 0:e;if(Array.isArray(s)){const r=s.map((l,a)=>typeof e=="object"&&a in e?Xe(l,e[a]):e[a]);return!r.length||r.length===1&&!r[0]?void 0:r}if(!s)return e;const n=Object.keys(s),i={};let o=!1;if(n.forEach(r=>{const l=Xe(s[r],e[r]);l!==void 0&&(o=!0,i[r]=l)}),!!o)return i}function bo(s,e){return[Xe(s,e),Xe(e,s)]}function Ge(s,e){const t=typeof s;if(t==="string"||t==="boolean"||t==="number")return e;if(Array.isArray(s))return s.map((n,i)=>e[i]?Ge(n,e[i]):n);if(typeof s=="object"){const n=Object.keys(e),i=R({},s);return n.forEach(o=>{i[o]=Ge(s[o],e[o])}),i}}class xo{constructor(e,{input:t,output:n}){if(!n||!t)return;if(this.system=e,t.node.getChildren().includes(n.node))throw new Error("Circular reference");if(!wo(n,t))throw new Error("Can't connect type "+t.type+" to "+n.type);this.output=n,this.input=t,e.options.view&&(this.view=new lo(this)),this.output.setConnection(this),this.input.setConnection(this),this.output.node.system.save()}joinNode(e){if(!this.isNodeJoinable(e))return;this.remove(),this.output.node.connectTo(e,0,e.getInputs()[0].key);const t=this.input.node.getInputs(),n=t.indexOf(this.input),i=t[n].key;e.connectTo(this.input.node,0,i)}isNodeJoinable(e){const t=this.input.type,n=this.output.type;if(this.input.node===e||this.output.node===e)return!1;const i=e.getInputs();if(!i.length||!i.find(r=>r.type.includes(n)))return!1;const o=e.outputs;return!(!o.length||!o.find(r=>t.includes(r.type)||t.includes("*")))}remove(){this.view&&this.view.remove(),this.input.removeConnection(),this.output.removeConnection(this)}deserialize(){return{id:this.input.node.attributes.id,out:this.indexOut,in:this.indexIn}}get indexOut(){return this.output.node.outputs.indexOf(this.output)}get indexIn(){return this.input.key}}class Pt extends H{constructor(e,t){super();this.outputs=[],this._state={},this.states={},this.inputData=[],this.enableUpdates=!0,this.refs=[],this.system=e;const{attributes:n,state:i={}}=t;this._state=i,this.attributes=n,this.id=n.id,this._compute=ei((o=this._state)=>this.compute(o))}get state(){return this._state}bindView(e){this.view=e,this.outputs.forEach(t=>t.bindView()),Object.values(this.states).forEach(t=>t.bindView())}setAttributes(e){this.enableUpdates&&this.system.history.addAction(),this.attributes=R(R({},this.attributes),e),this==null||this.view.updateViewPosition(),this.save()}compute(e){return e}getChildren(){return this.outputs.map(n=>n.connections).flat().map(n=>n.input.node)}getSockets(){return[...this.getInputs(),...this.outputs]}getInputs(){return Object.values(this.states).map(e=>e.getInput()).filter(e=>!!e)}setStateValue(e,t){this.states[e].setValue(t)}getStateValue(e){return this.state[e]}update(){!this.enableUpdates||(this.computedData=this._compute(this.state),this.emit("computedData",this.computedData),this.refs.forEach(e=>{e.node.enableUpdates=!1,e.keyIn.forEach(t=>{e.node.setStateValue(t,this.computedData)}),e.node.enableUpdates=!0,e.node.update()}),this.save())}remove(){this.system.removeNode(this),this.destroyEventEmitter()}connectTo(e,t=0,n=e.getInputs()[0].key){var a,c,u;const i=this.outputs[t],o=(a=e.states[n])==null?void 0:a.getInput();if(!o)return;const r=new xo(this.system,{output:i,input:o});(c=i==null?void 0:i.view)==null||c.updatePosition(),(u=o==null?void 0:o.view)==null||u.updatePosition();const l=this.refs.find(h=>h.node.id===e.id&&h.indexOut===t);return l?l.keyIn=[...l.keyIn,n]:this.refs.push({node:e,keyIn:[n],indexOut:t}),this.update(),r}disconnectFrom(e,t,n){this.refs=this.refs.filter(i=>!(i.indexOut!==n||(i.keyIn.splice(i.keyIn.indexOf(t),1),i.keyIn.length===0))),this.update()}deserialize(){const e=Object.assign({},this.attributes);e.refs=this.outputs.map(n=>n.connections).flat().map(n=>n.deserialize());const t={};return Object.values(this.states).forEach(n=>{t[n.key]=n.getValue()}),Object.assign({},{attributes:e,state:t})}save(){this.system.save()}}var _o={title:"Boolean",type:"boolean",outputs:["boolean"],parameters:{value:{type:"boolean",defaultValue:!1}},compute({value:s=!1}){return s}};const So={title:"Math",type:"math",outputs:["number","number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},compute({mode:s,a:e,b:t}){switch(s){case"multiply":return e*t;case"subtract":return e-t;default:return e+t}}};var Mo={title:"Number",type:"number",outputs:["number"],parameters:{value:{type:"number",internal:!0,label:!1,defaultValue:0}},compute({value:s=0}){return s}};class No{constructor(e){this.nodeState=e,this.wrapper=document.createElement("div"),this.input=document.createElement("div"),this.isPaused=!1,this.wrapper.classList.add("node-state-single-wrapper"),this.input.classList.add("node-state-input");const t=e.template,n=t.label||e.key;if(typeof n=="string"){const i=document.createElement("p");i.className="state-label",i.innerHTML=n,this.wrapper.appendChild(i)}(t==null?void 0:t.label)===!1&&this.wrapper.classList.add("hide-label"),t.external||(this.element=Pi({target:this.input,template:t,value:e.getValue()}),this.element&&this.element.$on("change",({detail:i})=>{this.isPaused||(this.isPaused=!0,typeof i!="undefined"&&!Number.isNaN(i)&&this.nodeState.setValue(i),this.isPaused=!1)})),e.node.view.stateWrapper.appendChild(this.wrapper),this.wrapper.appendChild(this.input)}updateValue(){this.isPaused||(this.isPaused=!0,setTimeout(()=>{this.element&&(this.element.value=this.nodeState.getValue())},50),this.isPaused=!1)}updatePosition(){var e,t;this.rect=this.wrapper.getBoundingClientRect(),(t=(e=this.nodeState.getInput())==null?void 0:e.view)==null||t.updatePosition()}get y(){return this.rect.y-this.nodeState.node.view.y}get height(){return this.rect.height}setActive(e){this.wrapper.classList[e?"remove":"add"]("disabled")}}class Po{constructor(e){if(!e||!e.node)throw new Error("Somethings missing");this.input=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-input-wrapper"),e.type.forEach(t=>{this.wrapper.classList.add(`socket-type-${t==="*"?"all":t}`)}),e.state.view.wrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",t=>{t.stopPropagation(),t.preventDefault();const n=this.input.connection;n?(n.remove(),this.node.system.view.createFloatingConnection(n.output)):this.node.system.view.createFloatingConnection(this.input)},!1),this.node.system.view.colorStore.on(e.type[0],t=>{const n=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=n!=="rgba(0, 0, 0, 0)"?n:t})}updatePosition(){var e;this.rect=this.wrapper.getBoundingClientRect(),(e=this==null?void 0:this.connection)==null||e.setPosition({x2:this.x,y2:this.y})}remove(){this.wrapper.remove(),this.connection&&this.connection.remove()}set state(e){this.wrapper.classList.forEach(t=>{t.includes("socket-state-")&&this.wrapper.classList.remove(t)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}get x(){return this.node.view.x-3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class Ne{constructor(e,t,n){this.state=e,this.key=n,this.node=e.node,this.type=Array.isArray(t)?t:[t]}bindView(){this.view=new Po(this)}removeConnection(){const e=this.connection;delete this.connection,e&&e.remove(),this.node.setStateValue(this.key,void 0),this.state.setIsExternal(!1)}setConnection(e){this.connection&&this.connection.remove(),this.connection=e,this.view&&(this.view.connection=e.view),this.state.setIsExternal(!0)}remove(){this.view&&this.view.remove(),this.removeConnection()}}class Et extends H{constructor(e,t,n){super();var i,o;this.node=e,this.key=t,this.template=n,this.isExternal=!1,this.value=(o=(i=e.state[t])!=null?i:n.defaultValue)!=null?o:n.value,this.node._state[t]=this.value,this.template.internal||(this.input=new Ne(this,n.type,t))}setIsExternal(e=!1){var t;this.isExternal=e,(t=this==null?void 0:this.view)==null||t.setActive(!e)}getValue(){return this.value}setValue(e){this.isExternal||(this.node.enableUpdates&&this.node.system.history.addAction(),this.value=e),this.node._state[this.key]=e,this.node.enableUpdates&&(this==null||this.view.updateValue(),this.node.update())}remove(){}getInput(){return this.input}bindView(){this.view=new No(this),this.input&&this.input.bindView()}}class kt{constructor(e){this.inputs=[],this.outputs=[],this.active=!1,this.x=0,this.y=0,this.downX=0,this.downY=0,this.mDownX=0,this.mDownY=0,this.height=50,this.width=91,this.node=e,this.system=e.system,this.wrapper=document.createElement("div"),this.wrapper.style.minHeight=this.height+"px",this.wrapper.style.minWidth=this.width+"px",this.wrapper.classList.add("node-wrapper","node-type-"+e.attributes.type.toLowerCase()),this.wrapper.setAttribute("id","node-view-"+this.system.id+"-"+this.node.id),this.outputWrapper=document.createElement("div"),this.outputWrapper.classList.add("node-outputs-wrapper"),this.wrapper.append(this.outputWrapper);const t=document.createElement("p");t.innerHTML=e.attributes.name||e.attributes.type,t.classList.add("node-title"),this.wrapper.appendChild(t),this.stateWrapper=document.createElement("div"),this.stateWrapper.classList.add("node-state-wrapper"),this.wrapper.append(this.stateWrapper),e.system.view.nodeContainer.append(this.wrapper);const{pos:{x:n=0,y:i=0}={}}=e.attributes;this.x=n,this.y=i,this.bindEventListeners(),this.wrapper.style.left=n+"px",this.wrapper.style.top=i+"px",setTimeout(()=>{const{width:o,height:r}=this.wrapper.getBoundingClientRect();this.width=o/this.system.view.s,this.height=r/this.system.view.s,this.updateViewPosition(n,i)},10)}bindEventListeners(){this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this._unsubscribeMouseMove=this.system.view.on("mousemove",e=>this.handleMouseMove(e)),this._unsubscribeMouseUp=this.system.view.on("mouseup",()=>this.handleMouseUp())}removeEventListeners(){this._unsubscribeMouseMove(),this._unsubscribeMouseUp(),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e))}set state(e){this.wrapper.classList.remove("node-active","node-selected","node-dragging"),this.wrapper.classList.add("node-"+e),this._state=e}get state(){return this._state}handleMouseDown(e){var i,o,r,l;if(this.system.view.keyMap.space||e.button===2||e.target!==e.currentTarget)return;e.stopImmediatePropagation(),e.stopPropagation(),this.node.system.view.setActive(this.node,e);const{rmx:t,rmy:n}=this.system.view;this.mDownX=t,this.mDownY=n,this.downX=((o=(i=this.node.attributes)==null?void 0:i.pos)==null?void 0:o.x)||0,this.downY=((l=(r=this.node.attributes)==null?void 0:r.pos)==null?void 0:l.y)||0,this.active=!0,this.system.view.selectedNodes.length&&this.system.view.selectedNodes.forEach(a=>{a.view.active=!0,a.view.mDownX=t,a.view.mDownY=n,a.view.downX=a.view.x,a.view.downY=a.view.y})}handleMouseUp(){this.active=!1,this.hoveredConnection&&(this.hoveredConnection.connection.joinNode(this.node),delete this.hoveredConnection)}handleMouseMove({mx:e,my:t,keys:n}){if(this.active){this.state="dragging";const i=n.ctrlKey?.02:1;let o=this.mDownX-e,r=this.mDownY-t;n.shiftKey&&(Math.abs(o)>Math.abs(r)?r=0:o=0);const l=Math.round((this.downX-o/this.system.view.s)*i)/i,a=Math.round((this.downY-r/this.system.view.s)*i)/i;this.setPosition(l,a)}}updateViewPosition(e=(o=>(o=(i=>(i=(n=>(n=this.node.attributes)==null?void 0:n.pos)())==null?void 0:i.x)())!=null?o:this.x)(),t=(a=>(a=(l=>(l=(r=>(r=this.node.attributes)==null?void 0:r.pos)())==null?void 0:l.y)())!=null?a:this.y)()){this.wrapper.style.left=e+"px",this.wrapper.style.top=t+"px",Object.values(this.node.states).forEach(c=>{var u;return(u=c==null?void 0:c.view)==null?void 0:u.updatePosition()}),this.node.outputs.forEach(c=>c.view.updatePosition())}setPosition(e,t){this.x=e,this.y=t,this.node.setAttributes({pos:{x:e,y:t}}),this.updateViewPosition()}remove(){this.removeEventListeners(),this.wrapper.remove()}}class Eo extends Pt{constructor(e,t){super(e,t);this.states={input:new Et(this,"input",{type:"*"})},this.outputs=[]}compute({input:e}){return e}}class ko extends kt{constructor(e){super(e);const t=document.createElement("div");e.on("computedData",n=>{t.innerHTML="";const i=document.createElement("p");i.innerHTML=JSON.stringify(n,null," "),t.append(i)}),this.wrapper.appendChild(t)}}var jo={title:"Debug",meta:{description:"Outputs any inputs for debug purposes"},node:Eo,view:ko};class Co extends Pt{constructor(e,t){super(e,t);this.states={input:new Et(this,"input",{type:"*",external:!0,label:!1})},this.outputs=[]}compute({input:e}){return e}}class Lo extends kt{constructor(e){super(e);const t=document.createElement("p");t.style.margin="0px",t.style.padding="4px",t.style.color="white",t.style.fontWeight="bold",e.on("computedData",n=>{t.innerHTML=JSON.stringify(n,null,2)}),this.wrapper.appendChild(t)}}var Io={title:"Output",meta:{description:"Outputs the final value"},node:Co,view:Lo};const jt={BooleanNode:_o,MathNode:So,NumberNode:Mo,DebugNode:jo,OutputNode:Io};class To{constructor(e){this.x=0,this.y=0,this.view=e,this.system=e.system,this.wrapper=document.createElement("div"),this.wrapper.classList.add("context-wrapper"),this.searchEl=new Ni({target:this.wrapper}),this.searchEl.$on("input",({detail:t})=>{this.resolve(t)}),this.view.wrapper.append(this.wrapper),this.view.system.store.on("types",t=>this.updateTypes(t),20),this.wrapper.classList.add("cl-"+Math.floor(Math.random()*1e3)),this.view.on("keydown",({key:t})=>t==="Escape"&&this.hide())}updateTypes(e){this.searchEl.setItems(e.map(t=>({value:t.type||t.title,title:t.title})))}handleWindowClick(e){e.composedPath().includes(this.wrapper)||this.reject()}reject(){this.rej&&this.rej(),this.hide()}resolve(e){const t=this.system.store.getByName(e),{x:n,y:i}=this.view.projectWindowToLocal(this.x,this.y),o=n-this.view.width/2,r=i-this.view.height/2;t?this.res({attributes:{pos:{x:o,y:r},id:"",name:t.title,type:t.title,refs:[]},state:{value:void 0}}):this.reject(),this.hide()}hide(){this.searchEl.clear(),this.wrapper.classList.remove("context-visible"),this.wrapper.blur(),this.res=e=>e,this.reject=()=>{}}show({x:e,y:t,socket:n}){return this.x=e,this.y=t,this.socket=n,this.wrapper.style.left=e/this.system.view.width*100+"%",this.wrapper.style.top=t/this.system.view.height*100+"%",this.wrapper.classList.add("context-visible"),setTimeout(()=>{this.searchEl.focus()},20),new Promise((i,o)=>{this.res=i,this.rej=o})}}class Oo extends H{constructor(e){super();this.mDownX=0,this.mDownY=0,this.downX=0,this.downY=0,this.isShiftKey=!1,this.view=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("box-selection-wrapper"),this.view.wrapper.append(this.wrapper),this.view.on("mousedown",({target:t,mx:n,x:i,my:o,y:r,keys:l})=>{var a;l.space||l.shiftKey||l.button===2||!l.ctrlKey||t&&!((a=t==null?void 0:t.className)==null?void 0:a.includes("nodesystem"))||(this.mDownX=n,this.mDownY=o,this.downX=i,this.downY=r,this.wrapper.style.left=n+"px",this.wrapper.style.top=o+"px",this.wrapper.style.width="0px",this.wrapper.style.height="0px",this.isShiftKey=l.shift,this.show())})}show(){this.wrapper.classList.add("box-selection-visible");const e=this.view.system.nodes.map(i=>{const{width:o,height:r}=i.view,{x:l,y:a}=i.view,c=l+this.view.width/2,u=a+this.view.height/2,h=c+o,p=u+r;return{n:i,state:i.view.state,x1:c,y1:u,x2:h,y2:p}});let t=[];const n=this.view.on("mousemove",({mx:i,my:o,x:r,y:l})=>{const{mDownX:a,mDownY:c,downX:u,downY:h,isShiftKey:p}=this,f={x1:Math.min(i,a),x2:Math.max(i,a),y1:Math.min(o,c),y2:Math.max(o,c)};this.wrapper.style.left=f.x1+"px",this.wrapper.style.top=f.y1+"px",this.wrapper.style.width=Math.abs(a-i)+"px",this.wrapper.style.height=Math.abs(c-o)+"px";const m={x1:Math.min(r,u),x2:Math.max(r,u),y1:Math.min(l,h),y2:Math.max(l,h)};t=e.filter(y=>go(m,y)?!0:(p||(y.state="normal",y.n.view.state="normal"),!1)).map(({n:y,state:b})=>(b!=="active"&&(b="selected",y.view.state="selected"),y))},5);this.view.once("mouseup",()=>{n(),this.hide(),this.emit("selection",t)})}projectBox(e){const{x:t,y:n}=this.view.projectWindowToLocal(e.x1,e.y1),{x:i,y:o}=this.view.projectWindowToLocal(e.x2,e.y2);return{x1:t,y1:n,x2:i,y2:o}}hide(){this.wrapper.classList.remove("box-selection-visible")}}class Ao{constructor(e){this.connections=[],this.output=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-output-wrapper"),this.wrapper.classList.add(`socket-type-${e.type}`),e.node.view.outputWrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",t=>{t.stopPropagation(),t.preventDefault(),this.node.system.view.createFloatingConnection(this.output)},!1),this.node.system.view.colorStore.on(e.type,t=>{const n=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=n!=="rgba(0, 0, 0, 0)"&&n!=="rgb(0,0,0)"?n:t})}remove(){this.wrapper.remove(),this.connections.forEach(e=>e.remove())}set state(e){this.wrapper.classList.forEach(t=>{t.includes("socket-state-")&&this.wrapper.classList.remove(t)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}updatePosition(){this.rect=this.wrapper.getBoundingClientRect(),this.output.connections.forEach(e=>e.view.setPosition({x1:this.x,y1:this.y}))}get x(){return this.node.view.x+this.node.view.width+3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class qe{constructor(e,t){if(this.connections=[],this.node=e,this.type=t,Array.isArray(t))throw new Error("Output can only output one type, not "+t)}bindView(){this.view=new Ao(this)}connectTo(e){const t=this.node.outputs.indexOf(this);return this.node.connectTo(e.node,t,e.key)}removeConnection(e){const t=this.connections.indexOf(e);this.connections.splice(t,1),this.node.disconnectFrom(e.input.node,e.indexIn,e.indexOut),this.view&&this.view.connections.splice(t,1)}setConnection(e){this.connections.push(e),this.view&&this.view.connections.push(e.view)}remove(){this.connections.forEach(e=>e.remove())}}class Vo extends Un(Is,H){constructor(e,t={}){const{system:n}=e.node;super({},e);this.view=n.view,this.path.style.zIndex="999";const i=Array.isArray(e.type)?e.type[0]:e.type;n.view.colorStore.on(i,h=>{this.path.style.stroke=h}),e.view.updatePosition();const o=e.view.x,r=e.view.y;let l=o,a=r;t&&(l=t.x-n.view.width/2,a=t.y-n.view.height/2),this.setPosition({x1:o,y1:r,x2:l,y2:a}),this.dx2=this.x2,this.dy2=this.y2,this.isInput=e instanceof Ne,this.allSockets=e instanceof Ne?n.getOutputs(e.type):n.getInputs(e.type),this.allSockets.forEach(h=>h.view.state="potential");let c=this.allSockets.filter(h=>h.node.attributes.id!==e.node.attributes.id);c.forEach(h=>h.view.state="middle");const u="connection"in e?[e.connection]:e.connections;if(u&&!!u.length){const h=u.map(p=>[p.input,p.output]).flat();c=c.filter(p=>!h.includes(p))}this.potentialSockets=c,this.potentialSockets.forEach(h=>h.view.updatePosition()),this.potentialSockets.forEach(h=>h.view.state="highlight"),this._unsubMouseUp=this.view.on("mouseup",this.handleMouseUp.bind(this)),this._unsubMouseMove=this.view.on("mousemove",this.handleMouseMove.bind(this)),this.mdx=this.view.mx,this.mdy=this.view.my,this.socket=e}handleMouseUp(e){const{x:t,y:n,keys:i}=e;this._unsubMouseUp(),this._unsubMouseMove(),this.allSockets.forEach(l=>l.view.state="");let o,r=0;this.socket instanceof Ne&&this.hoveredSocket instanceof qe?(o=this.socket.key,r=this.hoveredSocket.node.outputs.indexOf(this.hoveredSocket)):this.socket instanceof qe&&this.hoveredSocket instanceof Ne&&(o=this.hoveredSocket.key,r=this.socket.node.outputs.indexOf(this.socket)),this.hoveredSocket?(this.emit("connection",{keyIn:o,indexOut:r,inputNode:this.isInput?this.socket.node:this.hoveredSocket.node,outputNode:this.isInput?this.hoveredSocket.node:this.socket.node}),this.remove()):i.ctrlKey?this.view.addMenu.show({x:t,y:n,socket:this.socket}).then(l=>this.view.system.createNode(l)).then(l=>{this.socket instanceof qe?this.socket.node.connectTo(l,r,o):l.connectTo(this.socket.node,r,o)}).catch(()=>{}).finally(()=>{this.remove()}):this.remove()}handleMouseMove(e){const{x:t,y:n}=e;this.mdx||(this.mdx=t,this.mdy=n);const i=this.dx2+(t-this.mdx),o=this.dy2+(n-this.mdy),r=20,l=this.potentialSockets.map(a=>{const{x:c,y:u}=a.view;return{socket:a,distance:Math.abs(i-c)+Math.abs(o-u)}}).filter(a=>a.distance<r).sort((a,c)=>a.distance>c.distance?-1:1).map(a=>a.socket);if(l.length){const{x:a,y:c}=l[0].view;this.hoveredSocket=l[0],this.setPosition({x2:a,y2:c})}else this.hoveredSocket=void 0,this.setPosition({x2:i,y2:o})}remove(){super.remove()}}const Do=[{color:"#a52a2a",name:"brown"},{color:"#008000",name:"green"},{color:"#4b0082",name:"indigo"},{color:"#f0e68c",name:"khaki"},{color:"#add8e6",name:"lightblue"},{color:"#e0ffff",name:"lightcyan"},{color:"#90ee90",name:"lightgreen"},{color:"#d3d3d3",name:"lightgrey"},{color:"#ffb6c1",name:"lightpink"},{color:"#ffffe0",name:"lightyellow"},{color:"#00ff00",name:"lime"},{color:"#ff00ff",name:"magenta"},{color:"#800000",name:"maroon"},{color:"#000080",name:"navy"},{color:"#808000",name:"olive"},{color:"#ffa500",name:"orange"},{color:"#ffc0cb",name:"pink"},{color:"#800080",name:"purple"},{color:"#800080",name:"violet"},{color:"#ff0000",name:"red"},{color:"#c0c0c0",name:"silver"},{color:"#ffffff",name:"white"}];class Ro extends H{constructor(){super();this.colors={boolean:"#f00",number:"#fff",plant:"#65e2a0",vec3:"#6363C7"},this.index=0}setType(e){e in this.colors||(this.colors[e]=Do[this.index].color,this.index++),this.emit(e,this.colors[e])}on(e,t){return this.setType(e),t(this.colors[e]),super.on(e,t)}}class zo extends H{constructor(e){super();var t,n,i,o;this.colorStore=new Ro,this.width=0,this.height=0,this.top=0,this.left=0,this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.s=1,this.mx=0,this.my=0,this.mdx=0,this.mdy=0,this.rmx=0,this.rmy=0,this.mouseDown=!1,this.keyMap={},this.selectedNodes=[],this.selectedNodesDown=[],this.clipboard=[],this.system=e,this.wrapper=(n=(t=e.options)==null?void 0:t.wrapper)!=null?n:document.createElement("div"),this.wrapper.classList.add("nodesystem-wrapper"),e.options.parent&&e.options.parent.appendChild(this.wrapper),this.transformWrapper=document.createElement("div"),this.transformWrapper.classList.add("nodesystem-transform"),this.wrapper.appendChild(this.transformWrapper),this.nodeContainer=document.createElement("div"),this.nodeContainer.classList.add("nodes-container"),this.transformWrapper.append(this.nodeContainer),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewBox","0 0 1 1"),this.svg.setAttribute("height","1"),this.svg.setAttribute("width","1"),this.svg.setAttribute("preserveAspectRatio","none"),this.svg.style.transform=`scale(${(i=window.devicePixelRatio)!=null?i:1})`,this.transformWrapper.appendChild(this.svg),this.addMenu=new To(this),this.boxSelection=new Oo(this),this.boxSelection.on("selection",r=>{this.selectedNodes=r}),this.dpr=(o=window.devicePixelRatio)!=null?o:1,this.bindEventListeners(),this.handleResize()}createFloatingConnection(e){new Vo(e,{x:this.mx,y:this.my}).once("connection",({inputNode:n,outputNode:i,keyIn:o,indexOut:r})=>{i.connectTo(n,r,o)})}setActive(e,{shiftKey:t=!1,ctrlKey:n=!1}={}){if(!e)this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.selectedNodes.forEach(i=>i.view.state="normal"),this.selectedNodes=[];else if(t&&n){if(this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.activeNode=e,this.activeNode.view.state="active",this.activeNode.outputs.length){const i=this.system.createNode({state:{},attributes:{type:"debug",id:"0",name:"debug",refs:[],pos:{x:this.activeNode.view.x+this.activeNode.view.width+10,y:this.activeNode.view.y}}});i.enableUpdates=!0,this.activeNode.connectTo(i,0,"input")}}else t?this.activeNode?(this.selectedNodes.push(this.activeNode),this.activeNode.view.state="selected",this.activeNode=e,this.activeNode.view.state="active"):(this.activeNode=e,this.activeNode.view.state="active"):this.activeNode?(this.selectedNodes.forEach(i=>i.view.state="normal"),this.selectedNodes=[],this.activeNode!==e&&(this.activeNode.view.state="normal",this.activeNode=e,this.activeNode.view.state="active")):(this.activeNode=e,this.activeNode.view.state="active")}getSelectedNodes(){return this.activeNode&&this.selectedNodes.includes(this.activeNode)?this.selectedNodes:this.activeNode?[...this.selectedNodes,this.activeNode]:[...this.selectedNodes]}projectLocalToWindow(e,t){const n=e+this.x,i=t+this.y,o=n*this.s,r=i*this.s;return{x:o,y:r}}projectWindowToLocal(e,t){const n=e-this.x,i=t-this.y,o=n/this.s,r=i/this.s;return{x:o,y:r}}setTransform({x:e=this.x,y:t=this.y,s:n=this.s}={}){this.x=e,this.y=t,this.s=n/this.dpr,this.panzoom.setTransform(e,t,n/this.dpr)}showAddMenu(){this.addMenu.show({x:this.rmx,y:this.rmy}).then(e=>{const t=this.system.createNode(e);this.setActive(t)}).catch()}bindEventListeners(){window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e)),this.wrapper.addEventListener("mousemove",e=>this.handleMouseMove(e)),this.wrapper.addEventListener("contextmenu",e=>{e.preventDefault(),this.showAddMenu()}),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("touchdown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("mouseup",e=>this.handleMouseUp(e)),window.addEventListener("resize",pt(()=>this.handleResize(),10)),this.panzoom=vo(this.transformWrapper,{minZoom:.2,maxZoom:5,onTransform:({x:e,y:t,scale:n})=>{this.x=e,this.y=t,this.s=n;const i=(n-.2)/5/2,o=n*this.height*.02,r=n*this.width*.02;this.wrapper.style.setProperty("--scale",Math.abs(i)+""),this.wrapper.style.setProperty("--scale-x",o+"%"),this.wrapper.style.setProperty("--scale-y",r+"%"),this.wrapper.style.setProperty("--pos-x",`${e}px`),this.wrapper.style.setProperty("--pos-y",`${t}px`),this.system.setMetaData({transform:{x:e,y:t,s:n}})}})}handleResize(){const{width:e,height:t,top:n,left:i}=this.wrapper.getBoundingClientRect();this.width=e,this.height=t,this.top=n,this.left=i,this.emit("resize",{width:e,height:t})}handleMouseMove(e){this.ev=e;const{clientX:t,clientY:n,shiftKey:i,ctrlKey:o}=e;this.rmx=t-this.left,this.rmy=n-this.top;const{x:r,y:l}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=r,this.my=l,this.emit("mousemove",{x:r,y:l,mx:this.rmx,my:this.rmy,keys:ne(R({},this.keyMap),{shiftKey:i,ctrlKey:o})})}handleMouseDown(e){const{shiftKey:t,ctrlKey:n,clientX:i,clientY:o,button:r,target:l}=e;t||this.setActive(),e.path&&![...e.path].includes(this.addMenu.wrapper)&&(this.addMenu.hide(),e.preventDefault()),this.mouseDown=!0,this.rmx=i-this.left,this.rmy=o-this.top;const{x:a,y:c}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=a,this.my=c,this.selectedNodesDown=this.selectedNodes.map(u=>[u.view.x,u.view.y]),this.emit("mousedown",{x:a,y:c,mx:this.rmx,my:this.rmy,target:l,keys:ne(R({},this.keyMap),{shiftKey:t,ctrlKey:n,button:r})})}handleMouseUp({clientX:e,clientY:t,shiftKey:n,ctrlKey:i}){this.mouseDown=!1;const o=e-this.left,r=t-this.top;this.emit("mouseup",{x:o,y:r,keys:ne(R({},this.keyMap),{shiftKey:n,ctrlKey:i})})}handleKeyUp({key:e}){e===" "&&(e="space"),delete this.keyMap[e&&e.toLowerCase()],this.emit("keyup",{key:e,keys:this.keyMap})}handleKeyDown({key:e,ctrlKey:t,shiftKey:n}){switch(e=e===" "?"space":e.toLowerCase(),this.keyMap[e&&e.toLowerCase()]=!0,e==="space"&&this.ev&&this.handleMouseDown(this.ev),e){case"escape":this.addMenu.hide();break;case"a":n&&this.showAddMenu();break;case"c":if(n&&t)localStorage.clear(),window.location.reload();else if(t){const i=this.selectedNodes.splice(0);this.activeNode&&!i.includes(this.activeNode)&&i.push(this.activeNode),this.clipboard=i.map(o=>o.deserialize())}else this.selectedNodes.length&&this.activeNode&&this.selectedNodes[0].connectTo(this.activeNode);break;case"f":this.setTransform({x:0,y:0,s:1});break;case"g":this.keyMap.g||(this.mdx=this.mx,this.mdy=this.my,this.selectedNodesDown=this.selectedNodes.map(i=>[i.view.x,i.view.y]));break;case"x":this.activeNode&&(t?this.system.spliceNode(this.activeNode):this.system.removeNode(this.activeNode)),this.selectedNodes.forEach(i=>i.remove());break;case"z":this.system.history&&t&&(n?this.system.history.redo():this.system.history.undo());break;case"l":this.activeNode&&(console.log(this.activeNode),console.log(this.activeNode.deserialize()));break;case"v":if(t){const i=this.clipboard.sort((c,u)=>{const{pos:{x:h=0,y:p=0}={}}=c.attributes,{pos:{x:f=0,y:m=0}={}}=u.attributes;return h+p<f+m?-1:1});let{pos:{x:o=0,y:r=0}={}}=i[0].attributes;const{x:l,y:a}=this.projectWindowToLocal(this.mx,this.my);o-=l,r-=a,this.clipboard.map(c=>{const{pos:{x:u=0,y:h=0}={}}=c.attributes;return c.attributes.pos={x:u-o,y:h-r},c}).forEach(c=>this.system.createNode(c))}break}this.emit("keydown",{key:e,keys:ne(R({},this.keyMap),{ctrlKey:t})})}}const Ct=Y("NodeFactory");class Fo{constructor(e){this.id=Jn(),this.system=e,Ct("Initialized")}reset(){this.id.reset(),Ct("Reset id generator")}create(e){const{attributes:t}=e,n=t.type.toLowerCase(),i=this.system.store.getByName(n);t.id=this.id(+t.id);const o=new i.node(this.system,e);if(this.system.options.view&&i.view){const r=new i.view(o);o.bindView(r)}return n==="output"&&this.system.setOutputNode(o),Ct(`Created node with type ${t.type}`,e),o}}const He=Y("NodeHistory");class Bo{constructor(e){this.system=e,this.history=[],this.historyIndex=-1,this.isApplyingChanges=!1,this.addAction=(()=>{let t;return()=>{!this.system.isLoaded||this.isApplyingChanges||(t?clearTimeout(t):this.prevState=this.system.serialize().nodes,t=setTimeout(()=>{this._addAction(),t=void 0},200))}})().bind(this),He("Initialized")}_addAction(){if(He("Register History Step"),this.isApplyingChanges)return;this.historyIndex!==this.history.length-1&&(this.history.length=this.historyIndex+1);const e=this.system.serialize().nodes,[t,n]=bo(this.prevState,e);!n||!t||(this.history.push({previous:n,next:t}),this.history.length>60&&(this.history=this.history.reverse().slice(0,60).reverse()),this.historyIndex=this.history.length-1)}serialize(){return{steps:this.history,index:this.historyIndex}}deserialize(e){this.historyIndex=e.index,this.history=e.steps}undo(){if(this.isApplyingChanges)return;if(this.isApplyingChanges=!0,this.historyIndex<0){He("Reached beginning of Stack"),this.isApplyingChanges=!1;return}const{previous:e}=this.history[this.historyIndex],t=this.system.serialize(),n=Ge(t.nodes,e);t.nodes=n,this.system.load(t),this.historyIndex--,this.isApplyingChanges=!1}redo(){if(this.isApplyingChanges)return;if(this.isApplyingChanges=!0,this.historyIndex>=this.history.length-1){He("Reached end of Stack"),this.isApplyingChanges=!1;return}const{next:e}=this.history[this.historyIndex+1],t=this.system.serialize(),n=Ge(t.nodes,e);t.nodes=n,this.system.load(t),this.historyIndex++,this.isApplyingChanges=!1}}class Yo{constructor(e){this.system=e}parseSystem(e){const{nodes:t}=e,n=new Map,i=t.map(o=>{const r=this.system.factory.create(o);return r.enableUpdates=!1,n.set(r.id,r),r});return i.forEach(o=>{o.attributes.refs&&o.attributes.refs.forEach(r=>{const l=n.get(r.id);if(!l)throw new Error(`Failed ref: from ${o.attributes.name||o.attributes.id} to ${r.id} `);o.connectTo(l,r.out,r.in)})}),i.forEach(o=>{o.enableUpdates=!0,o.update()}),i}parseType(e){const{compute:t,meta:n,outputs:i,title:o,parameters:r}=e,l=class extends Pt{constructor(c,u){super(c,u);if(t&&(this.compute=t),i){const h=Array.isArray(i)?i:[i];this.outputs=h.map(p=>new qe(this,p))}Object.entries(r).forEach(([h,p])=>{this.states[h]=new Et(this,h,p)})}},a=Object.values(r).filter(c=>c.internal!==!0).map(c=>c.type);if(this.system.options.view){const c=class extends kt{constructor(h){super(h)}};return ne(R({},e),{inputs:a,title:o,meta:n,node:l,view:c})}return ne(R({inputs:a},e),{title:o,meta:n,node:l})}getData(){return{meta:this.system.meta,nodes:this.system.nodes.map(e=>e.deserialize())}}}const Uo=Y("NodeTypeStore");class Wo extends H{constructor(){super();this.types=[],this.typeMap={}}add(e){Uo("register new type "+e.title,e),this.types=[...this.types.filter(t=>t.title.toLowerCase()!==e.title.toLowerCase()),e],this.typeMap[e.title.toLowerCase()]=e,this.emit("types",this.types),this.emit("type",e)}getByName(e){if(e.toLowerCase()in this.typeMap)return this.typeMap[e.toLowerCase()];if(e in this.typeMap)return this.typeMap[e];throw new Error("NodeTypeStore: type "+e+" does not exist")}}var Xo=Object.defineProperty,Go=Object.getOwnPropertyDescriptor,qo=(s,e,t,n)=>{for(var i=n>1?void 0:n?Go(e,t):e,o=s.length-1,r;o>=0;o--)(r=s[o])&&(i=(n?r(e,t,i):r(i))||i);return n&&i&&Xo(e,t,i),i};let Ho=0;const Pe=Y("NodeSystem");class Lt extends H{constructor(e={}){super();this.parser=new Yo(this),this.meta={lastSaved:Date.now()},this.isLoaded=!1,this.isPaused=!1,this.nodes=[],this.states=[],this.id=Ho++;const{view:t=!1,wrapper:n,defaultNodes:i=!1,registerNodes:o=!1}=e;this.options={view:t,wrapper:n};try{if(Pe(`Instantiated id:${this.id}`),this.store=new Wo,this.factory=new Fo(this),this.history=new Bo(this),t&&(this.view=new zo(this)),i){const r=[];i===!0?r.push(...Object.entries(jt).map(l=>l[1])):Array.isArray(i)&&i.length&&i.forEach(l=>{typeof l=="string"&&l in jt&&r.push(jt[l])}),r.forEach(l=>this.registerNodeType(l))}o&&o.length&&o.forEach(this.registerNodeType.bind(this))}catch(r){this.emit("error",{type:"init",error:r})}}get result(){return this._result}set result(e){this._result=e,this.isLoaded&&this.emit("result",e)}setMetaData(e){this.meta=R(R({},this.meta),e),this.save()}load(e){var t;try{this.isLoaded=!1,this.isPaused=!0,this.nodes.forEach(i=>i.enableUpdates=!1),this.nodes.forEach(i=>i.remove()),this.factory.reset();const n=this.parser.parseSystem(e);return this.addNodes(n),this.meta=e.meta||{lastSaved:0},this.meta.lastSaved=Date.now(),(t=this==null?void 0:this.view)==null||t.setTransform(this.meta.transform),Pe(`Loaded NodeSystemData with ${n.length} Nodes`,e),"history"in e&&this.history.deserialize(e.history),this.isPaused=!1,this.isLoaded=!0,this.result=this._result,this}catch(n){this.emit("error",{type:"loading",error:n})}}serialize(){return ne(R({},this.parser.getData()),{history:this.history.serialize(),meta:this.meta})}save(){this.isLoaded&&(this.meta.lastSaved=Date.now(),Pe("save system",this.serialize()),this.emit("save",this.serialize()))}setOutputNode(e){this.outputNode&&this.outputNode.remove(),this.outputNode=e,e.on("computedData",t=>this.result=t)}addNodes(e){e.forEach(t=>this.addNode(t))}addNode(e){this.history.addAction(),this.nodes.push(e),this.save()}removeNode(e){this.history.addAction(),e.enableUpdates=!1,e.view.remove(),Object.values(e.states).forEach(t=>t.remove()),e.outputs.forEach(t=>t.remove()),e.getInputs().forEach(t=>t.remove()),this.nodes=this.nodes.filter(t=>t!==e),this.save(),Pe(`Removed Node id:${e.id} type:${e.attributes.type}`,e.deserialize())}spliceNode(e){const t=e.getInputs().map(i=>{var o;return(o=i==null?void 0:i.connection)==null?void 0:o.output}),n=e.outputs.map(i=>i.connections).flat().map(i=>i.input);for(let i=0;i<t.length;i++){const o=t[i],r=n[i];!r||!o||o.connectTo(r)}return this.removeNode(e)}getSockets(e){const t=this.nodes.map(n=>[...n.getSockets()]).flat();return e?t.filter(n=>n.type===e):t}getInputs(e){const t=this.nodes.map(n=>n.getInputs()).flat();return!e||e==="*"?t:t.filter(n=>n.type.includes("*")||n.type.includes(e))}getOutputs(e){const t=this.nodes.map(n=>n.outputs).flat();return!e||e.includes("*")?t:t.filter(n=>n.type==="*"||e.includes(n.type))}createNode(e){const t=this.factory.create(e);return this.addNode(t),this.save(),Pe(`Created new node id:${e.attributes.id} type:${e.attributes.type}`,e),t}getNodes(){return this.nodes}findNodeById(e){return this.nodes.filter(t=>t.id===e)[0]}getNodeTypes(){return this.store.types}registerNodeType(e){if("node"in e)this.store.add(e);else{const t=this.parser.parseType(e);this.store.add(t)}}}qo([qn(1e3)],Lt.prototype,"save",1);const Jo=JSON.parse(localStorage.getItem("pt_local_state")),Ee=R({},Jo),Zo=us((s,e)=>{Ee[s]=e,localStorage.setItem("pt_local_state",JSON.stringify(Ee))},100,!1);var we={get(s,e){var t;return Ee[s]=(t=Ee[s])!=null?t:e,Ee[s]},set:Zo};const Ko={};Mt.forEach(s=>{Ko[s.type]=s,"computeSkeleton"in s&&(s.computeSkeleton=ft(s.computeSkeleton)),"computeGeometry"in s&&(s.computeGeometry=ft(s.computeGeometry)),"computeValue"in s&&(s.computeValue=ft(s.computeValue))});Y("gen.plant");function Qo(){return new Worker("assets/webWorker.3709c44c.js",{type:"module"})}var $o=()=>{const s=Qo(),e=Sn(s);let t=!1;async function n(i,o){if(t)return;t=!0;const r=await e.plant(i,o);return t=!1,r}return{plant:n}};let As=0;class er extends H{constructor({canvas:e,width:t,height:n,clearColor:i="ffffff",alpha:o=!1,camPos:r=[0,2,4]}={}){super();if(this.scene=new Mn,this.lastCamPos=new he(0,0,0),this.canvas=e,(!t||!n)&&e){const l=e.getBoundingClientRect();t=l.width,n=l.height}this.renderer=new Nn({canvas:e,width:t,premultipliedAlpha:!0,height:n,alpha:o,antialias:!0,dpr:1}),this.gl=this.renderer.gl,this.gl.clearColor(...cs(i),0),this.renderer.gl.canvas&&(this.canvas=this.renderer.gl.canvas),this.camera=new Pn(this.gl,{fov:70,aspect:t/n}),this.lastCamPos.set(r),this.camera.position.set(r),this.camera.lookAt(new he(0,0,0)),e&&(this.controls=new En(this.camera,{element:e,target:new he(0,.2,0),maxPolarAngle:1.6,minDistance:.2,maxDistance:15,ease:.7,rotateSpeed:.5,inertia:.5})),this.bindEventlisteners(),e&&this.render()}setControlTarget(e){Number.isNaN(e.x)||(this.controlTarget||(this.controls.target=e),this.controlTarget=e)}setClearColor(e){this.gl.clearColor(...cs(e),1)}renderScene(e){this.renderer.render({scene:e,camera:this.camera})}render(){requestAnimationFrame(this.render.bind(this)),this.lastCamPos.equals(this.camera.position)||(this.lastCamPos.set(this.camera.position),this.emit("camPos",this.camera.position.toArray())),this.controlTarget&&(this.controlTarget.squaredDistance(this.controls.target)<5e-5?this.controls.target=this.controlTarget:this.controls.target.lerp(this.controlTarget,.05)),window.target=this.controls.target,this.controls.update(),this.renderer.render({scene:this.scene,camera:this.camera}),this.emit("perf",performance.now()-As),As=performance.now()}bindEventlisteners(){const e=pt(()=>this.handleResize(),500);window.addEventListener("resize",()=>{this.canvas.classList.add("resizing"),e()})}handleResize(){let e=this.canvas.parentElement;e||(e=this.canvas);const{width:t,height:n}=e.getBoundingClientRect();this.renderer.setSize(t,n),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height}),this.canvas.classList.remove("resizing")}}var tr=`#version 300 es
precision highp float;
#define varying in
#define texture2D texture
#define gl_FragColor FragColor
out vec4 FragColor;precision highp float;
#define GLSLIFY 1
uniform sampler2D tMap;varying vec4 vMVPos;vec3 normals(vec3 pos){vec3 fdx=dFdx(pos);vec3 fdy=dFdy(pos);return normalize(cross(fdx,fdy));}vec2 matcap(vec3 eye,vec3 normal){vec3 reflected=reflect(eye,normal);float m=2.8284271247461903*sqrt(reflected.z+1.0);return reflected.xy/m+0.5;}void main(){vec3 normal=normals(vMVPos.xyz);vec3 mat=texture2D(tMap,matcap(normalize(vMVPos.xyz),normal)).rgb;gl_FragColor.rgb=mat;gl_FragColor.a=1.0;}`,sr=`#version 300 es
#define GLSLIFY 1
#define attribute in
#define varying out
attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;varying vec4 vMVPos;void main(){vMVPos=modelViewMatrix*vec4(position,1.0);gl_Position=projectionMatrix*vMVPos;}`;const nr=s=>{const e=new jn(s),t=new Image;return t.onload=()=>e.image=t,t.src="assets/matcap_green.jpg",new kn(s,{vertex:sr,fragment:tr,uniforms:{tMap:{value:e}},cullFace:null})},ir=$o(),U=new er({width:100,height:100,alpha:!0,clearColor:"000"}),Vs=new Lt({view:!1,defaultNodes:!1,registerNodes:Mt}),ce=new Cn(U.gl,{geometry:new Ln(U.gl,{width:0,height:0,depth:0}),program:nr(U.gl)}),ke=document.createElement("canvas");ke.width=ke.height=100;const be=ke.getContext("2d");ce.setParent(U.scene);async function or({pd:s,geo:e}){Vs.load(s);const t=Vs.result;let n;if(e&&(n=e),s&&!n&&(n=(await(await ir).plant(t,{stemResX:12,stemResY:12})).geometry),!n)return;ce.geometry=Ai(U.gl,n),ce.geometry.computeBoundingBox(),U.camera.position.x=ce.geometry.bounds.center.x,U.camera.position.y=ce.geometry.bounds.center.y;const o=(ce.geometry.bounds.max.y-ce.geometry.bounds.center.y)*2/2/Math.tan(Math.PI*U.camera.fov/360);U.camera.position.z=o,U.camera.lookAt(ce.geometry.bounds.center),U.renderScene(U.scene),be.clearRect(0,0,100,100);for(let r=0;r<1;r++)be.drawImage(ke,0,0),be.drawImage(U.canvas,0,0),be.filter="blur(7px) opacity(0.6) brightness(0.95)";if(be.filter="blur(0px) drop-shadow(0px 0px 10px rgba(0, 0, 0, 0.8))",!(U.canvas.width===0||U.canvas.height===0))return be.drawImage(U.canvas,0,0),ke.toDataURL("image/webp",1)}function rr(){return"window"in globalThis}let Ds={};(()=>{"sessionStorage"in globalThis||(globalThis.sessionStorage={getItem:s=>{},setItem:(s,e)=>{}})})();if("user"in sessionStorage)try{Ds=JSON.parse(sessionStorage.getItem("user"))}catch{}const Rs=le(Ds);Rs.subscribe(s=>{sessionStorage.setItem("user",JSON.stringify(s))});const Je=Rs,{VITE_API_URL:ar="http://localhost:3000"}={VITE_API_URL:"https://plant-api.jim-fx.com",BASE_URL:"",MODE:"production",DEV:!1,PROD:!0};function lr(s){const t=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(i){return"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}const zs=rr(),Ze=(()=>{let s=zs&&localStorage.getItem("token");function e(){if(!s||s.length<10){Je.set({});return}const t=lr(s);Je.set({username:t.username,id:t.sub})}return e(),{set token(t){s=t,zs&&localStorage.setItem("token",t),e()},get token(){return s}}})();async function oe({method:s,path:e,data:t,isJSON:n=!0}){const i={method:s,headers:{}};t&&(i.headers["Content-Type"]="application/json",i.body=JSON.stringify(t)),Ze.token&&(i.headers["access-token"]=`Bearer ${Ze.token}`);const o=await fetch(`${ar}/${e}`,i);if(o.ok){if(n)try{return await o.json()}catch(l){console.error("Response from "+e+" failed to parse"),console.error(l)}return o.text()}const r=await o.json();return console.error(r),r}function Fs(s,e={}){return oe(R({method:"GET",path:s},e))}function cr(s){return oe({method:"DELETE",path:s})}function ur(s,e){return oe({method:"POST",path:s,data:e})}function hr(s){return oe({method:"GET",path:`api/report/${s}`})}function dr(s){return oe({method:"PUT",path:`api/report/${s}/publish`})}function pr(s){return oe({method:"PUT",path:`api/report/${s}/unpublish`})}function fr(){return oe({method:"GET",path:"api/report/labels"})}function mr(s,e){return oe({method:"PUT",path:`api/report/${s}`,data:{labels:e}})}var vr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getReport:hr,publishReport:dr,unpublishReport:pr,getAvailableLabels:fr,setReportLabels:mr});async function yr(s,e){const t=await ur("api/auth/login",{username:s,password:e});Ze.token=t.access_token}function gr(){Ze.token=""}function wr(s){return oe({method:"POST",path:"api/report",data:s})}function br(s){return cr(`api/report/${s}`)}async function xr(){const s=await Fs("api/user/role",{isJSON:!1});return Je.update(e=>(e.role=s,e)),s}async function _r(){const s=await Fs("api/user/permission");return Je.update(e=>(e.permissions=s,e)),s}var Sr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",login:yr,logout:gr,submitReport:wr,deleteReport:br,getRole:xr,getPermission:_r});R(R({},vr),Sr);const J=Y("ProjectManager"),It="pt_project_";class Mr extends H{constructor(){super();this.activeProject=le(),this.projects={},this.store=le([]),this.loadProjects()}createNewProject(){const e=Object.values(this.projects).filter(n=>/^DefaultProject((\d)+)?/.test(n.meta.name)).length,t={meta:{name:"DefaultProject"+(e||""),id:ot(),transform:{x:0,y:0,s:1}},nodes:[{attributes:{pos:{x:-100,y:0},type:"stem",id:"1",refs:[{id:"0",in:"main",out:0}]}},{attributes:{pos:{x:0,y:0},type:"output",id:"0",refs:[]}}]};return J("created new plant",t),t}createNew(){const e=this.createNewProject();this.emit("new",e),this.saveProject(e)}async updateProjectMeta(e,t){const n=await this.getProject(e);n.meta=R(R({},n.meta),t),J("update meta",e),this.emit("update",n),this.saveProject(n)}async saveProject(e){var n;const t=JSON.parse(JSON.stringify(e));this.projects[t.meta.id]=t,this.emit("save",t),((n=t==null?void 0:t.meta)==null?void 0:n.thumbnail)||this.renderThumbnail({project:t}),await $.setItem("pt_project_ids",Object.keys(this.projects)),await $.setItem(It+t.meta.id,t),J("saved plant id: ",t.meta.id),this.store.set(Object.values(this.projects))}async getProject(e){if(e in this.projects)return this.projects[e];const t=await $.getItem(It+e);return this.projects[e]=t,t}async deleteProject(e){e in this.projects?(delete this.projects[e],await $.removeItem(It+e),await $.setItem("pt_project_ids",Object.keys(this.projects)),this.store.set(Object.values(this.projects)),this.emit("delete",e),J("deleted project with id: "+e)):J.warn("cant delete project with id: "+e)}async setActiveProject(e){if(this.loadingActiveProject&&await this.loadingActiveProject,e===this.activeProjectId)return;this.activeProjectId=e,this.loadingActiveProject=this.getProject(e);const t=await this.loadingActiveProject;this.loadingActiveProject?(this.activeProjectId=e,this.saveProject(t),this.activeProject.set(t),await $.setItem("pt_active_id",e),J("set active project to id: "+e),this.emit("load",t),delete this.loadingActiveProject):J.warn("cant find plant with id: "+e)}async renderThumbnail({project:e,geo:t}){var r;const n=((r=e==null?void 0:e.meta)==null?void 0:r.id)||this.activeProjectId;if(!(n in this.projects))return;const i=performance.now(),o=await or(t?{geo:t}:{pd:e});if(o){const l=performance.now()-i;this.projects[n].meta.thumbnail=o,J("generated thumbnail for "+n+" in "+Math.floor(l)+"ms"),this.saveProject(this.projects[n]),this.store.set(Object.values(this.projects))}else J.warn("There was an error rendering a thumbnail for: "+n)}async loadProjects(){const e=await $.getItem("pt_project_ids")||[];J("loaded project ids",e);const t=await $.getItem("pt_active_id");if(!e.length){const n=this.createNewProject();e.push(n.meta.id),await this.saveProject(n)}await Promise.all(e.map(async n=>{const i=await this.getProject(n);J("loaded ",n),this.projects[n]=i})),t&&e.includes(t)?this.setActiveProject(t):this.setActiveProject(e[0]),this.store.set(Object.values(this.projects))}setProject(e){this.plant=e,this.emit("plant",e)}getActiveProject(){return this.plant}setSettings(e){this.emit("settings",e)}}const Nr={enableSync:{type:"boolean",defaultValue:!1},useRandomSeed:{type:"boolean",defaultValue:!1},theme:{type:"select",values:["dark","light"],defaultValue:"dark"},debug:{onlyDev:!0,options:{renderPerf:{type:"boolean",defaultValue:!1},generatePerf:{type:"boolean",defaultValue:!1},pd:{type:"boolean",defaultValue:!1},skeleton:{type:"boolean",defaultValue:!1},wireframe:{type:"boolean",defaultValue:!1},logLevel:{type:"number",min:0,max:2,defaultValue:1}}},background:{options:{grid:{label:"Show Grid",type:"boolean",defaultValue:!1},ground:{label:"Show Ground",type:"boolean",defaultValue:!0},resX:{onlyDev:!0,type:"number",min:8,max:64,step:1,defaultValue:8},resY:{onlyDev:!0,type:"number",min:8,max:64,step:1,defaultValue:16},scale:{type:"number",min:0,max:5,step:.1,defaultValue:1}}},leafRes:{onlyDev:!0,type:"number",min:3,max:12,step:1,defaultValue:2},stemResX:{onlyDev:!0,type:"number",min:3,max:32,step:1,defaultValue:3},stemResY:{onlyDev:!0,type:"number",min:3,max:64,step:1,defaultValue:32},isDev:{label:"Advanced",type:"boolean",defaultValue:!1}},Tt=Y("SettingsManager"),Bs=(s,e)=>{const t={};return Object.entries(s).forEach(([n,i])=>{var r;const o=e&&n in e?e[n]:void 0;"options"in i?t[n]=Bs(i.options,o):t[n]=(r=o!=null?o:i.defaultValue)!=null?r:i.value}),t},Ot=(s,e)=>{const t=e.shift();if(t&&t in s)return e.length?Ot(s[t],e):s[t]},Ys=s=>s.includes(".")?s.split("."):[s];class Pr extends H{constructor(){super();this.settings={},this.store=le(this.settings),this._save=us(()=>{$.setItem("pt_settings",this.settings)},500,!1)}save(){var e,t,n;this.emit("settings",this.settings),Y.setLevel((n=(t=(e=this.settings)==null?void 0:e.debug)==null?void 0:t.logLevel)!=null?n:2),this.store.set(this.settings),Tt("save settings",this.settings),this._save()}async loadFromLocal(){var t,n,i;const e=await $.getItem("pt_settings")||{};this.settings=Bs(Nr,e),Y.setLevel((i=(n=(t=this.settings)==null?void 0:t.debug)==null?void 0:n.logLevel)!=null?i:2),this.store.set(this.settings),Tt("loaded settings from local",this.settings),this.emit("settings",this.settings)}set(e,t){const n=Ys(e);if(n.length>1){const i=n.pop(),o=Ot(this.settings,n);o&&(o[i]=t)}else this.settings[n[0]]=t;Tt(`Set ${n}`,t),this.emit(n+".update",t),this.save()}get(e){return Ot(this.settings,Ys(e))}getSettings(){return JSON.parse(JSON.stringify(this.settings))}}we.get("sections");function Er(s){let e;return{c(){e=I("p"),e.textContent=`\u{1F389} Now you have all the knowledge to use the Plantarium. Have some fun with
  it.`,d(e,"class","svelte-1h3eb6p")},m(t,n){V(t,e,n)},p:O,i:O,o:O,d(t){t&&D(e)}}}class kr extends Z{constructor(e){super();K(this,e,null,Er,Q,{})}}function jr(s){let e,t,n,i,o,r,l,a;return i=new Icon({props:{name:"hand"}}),{c(){e=I("p"),t=xe("Hey there "),n=I("span"),o=I("div"),is(i.$$.fragment),r=G(),l=I("p"),l.innerHTML=`Welcome to <b>Plantarium</b>, a tool for creating parametrized, procedural 3D
  plants.`,fe(o,"display","contents"),fe(o,"--stroke","#1a1a1a"),d(n,"class","svelte-1tutruj"),d(e,"class","svelte-1tutruj"),d(l,"class","svelte-1tutruj")},m(c,u){V(c,e,u),k(e,t),k(e,n),k(n,o),os(i,o,null),V(c,r,u),V(c,l,u),a=!0},p:O,i(c){a||(ct(i.$$.fragment,c),a=!0)},o(c){ut(i.$$.fragment,c),a=!1},d(c){c&&D(e),rs(i),c&&D(r),c&&D(l)}}}class Cr extends Z{constructor(e){super();K(this,e,null,jr,Q,{})}}const At=[{title:"Tutorial",description:Cr,options:{"lets go":()=>{}},type:"alert"},{description:`This is the <b>Plant View</b>, here you can explore the generated 3D model of your plant. 
      Try to change the view by:`,selector:".scene-wrapper",checks:[{description:"Clicking and dragging",setup:function(s,{c:e}){const t=document.querySelector(e.selector);t.getAttribute("setup")!=="true"&&(t.setAttribute("setup","true"),t.addEventListener("click",s,{once:!0}))}},{description:"Scrolling / Zooming",setup:(s,{c:e})=>{const t=document.querySelector(e.selector+"> canvas");t.getAttribute("setup")!=="true"&&(t.setAttribute("setup","true"),t.addEventListener("wheel",s,{once:!0,passive:!0}))}}]},{selector:"#nodesystem-view",description:"This is the <b>Node View</b>, here you define the way your plant looks. Try playing with some of the settings. If you are not so sure how this works, maybe visit the NodeTutorial"},{description:"This Button opens the project view",clickSelector:"header > div.left > div > div"},{description:"This is the ProjectView, here you can create/rename/delete projects.",selector:".project-manager-wrapper",checks:[{description:"create a new project",setup:(s,{pm:e})=>{e.once("new",s)}},{description:"rename the project",setup:(s,{pm:e})=>{e.once("update",s)}},{description:"delete the project",setup:(s,{pm:e})=>{e.once("delete",s)}}]},{description:"This Button opens the <b>Settings View</b>",clickSelector:"header > div.right > div:nth-child(2) .icon-wrapper"},{description:"This is the <b>SettingView</b>, here you can change some general settings.",selector:"header > div.right > div:nth-child(2) > div > div > div.wrapper.right.visible"},{description:"When you encounter something which doesnt work or you have an Idea for a new feature, use this button to report it.",clickSelector:"header > div.right > div:nth-child(1) > div"},{title:"Tutorial",description:kr,options:{"lets go":()=>{}},type:"alert"}];var Us=le(void 0);const Ws=["yes","next","lets go","okay"];let Xs;const Lr={handleReject:()=>{we.set("hasViewedTutorial",!0),Ue("The tutorial is accessable under...")},currentIndex:0,previous:async function(){},next:async function(){var t;const s=At[this.currentIndex];if(this.currentIndex===At.length)return;if(s.setup&&await s.setup({pm:Xs}),Us.set(s),this.currentIndex++,this.currentIndex>2&&we.set("hasViewedTutorial",!0),s.title=(t=s.title)!=null?t:`Tutorial (${this.currentIndex}/${At.length})`,s.type==="alert"){const n=await Bn(s.description,{title:s.title,type:"success",values:s.options?Object.keys(s.options):void 0,timeout:0});if(Ws.includes(n.toString()))return this.next()}if(s.type==="toast"){const n=await Ue(s.description,{values:s.options?Object.keys(s.options):void 0,timeout:0});if(Ws.includes(n.toString()))return this.next()}const e=Us.subscribe(n=>{n._isCompleted&&(e(),this.next())})},init:function({projectManager:s}){if(we.get("hasViewedTutorial"))return;Xs=s;const e=`It looks like this is your first time here...
    Want to take a little tour? `;setTimeout(async()=>{await Ue(e,{title:"",timeout:8e3,values:["nah","yes"]})==="yes"?this.next():this.handleReject()},1e4)},restart:function(){we.set("hasViewedTutorial",!1),this.currentIndex=0,this.next()}};function Gs(s){var e,t;(e=s==null?void 0:s.debug)==null||e.renderPerf,(t=s==null?void 0:s.debug)==null||t.generatePerf}const je=new Pr,Ce=new Mr;as(je.get("theme"));Gs(je.getSettings());je.on("enableSync.update",s=>{Ue(`${s?"Enabled":"Disabled"} sync`,{type:"success"})});je.on("theme.update",s=>{as(s)});const Vt=new Lt({view:!0,defaultNodes:!1,registerNodes:Mt});Ce.on("load",s=>Vt.load(s));Vt.on("result",s=>Ce.setProject(s),50);Vt.on("save",s=>Ce.saveProject(s));je.on("settings",s=>{Ce.setSettings(s),Gs(s)},50);Lr.init({projectManager:Ce});we.get("lastUpdated",Date.now());Y("scene.foreground");function Ir(s){return{c:O,m:O,i:O,o:O,d:O}}function Tr(s){let e,t;return e=new App({}),{c(){is(e.$$.fragment)},m(n,i){os(e,n,i),t=!0},i(n){t||(ct(e.$$.fragment,n),t=!0)},o(n){ut(e.$$.fragment,n),t=!1},d(n){rs(e,n)}}}function Or(s){let e;return{c(){e=I("p"),e.textContent="Loading"},m(t,n){V(t,e,n)},i:O,o:O,d(t){t&&D(e)}}}function Ar(s){let e,t,n={ctx:s,current:null,token:null,hasCatch:!1,pending:Or,then:Tr,catch:Ir,value:0,blocks:[,,,]};return In(settingsManager.loadFromLocal(),n),{c(){e=rt(),n.block.c()},m(i,o){V(i,e,o),n.block.m(i,n.anchor=o),n.mount=()=>e.parentNode,n.anchor=e,t=!0},p(i,[o]){s=i},i(i){t||(ct(n.block),t=!0)},o(i){for(let o=0;o<3;o+=1){const r=n.blocks[o];ut(r)}t=!1},d(i){i&&D(e),n.block.d(i),n.token=null,n=null}}}class Vr extends Z{constructor(e){super();K(this,e,null,Ar,Q,{})}}let Dr;try{Dr=new Vr({target:document.body})}catch(s){console.log(s)}
//# sourceMappingURL=index.477079ba.js.map
