var Be=Object.defineProperty,Fe=Object.defineProperties;var ze=Object.getOwnPropertyDescriptors;var Se=Object.getOwnPropertySymbols;var We=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var ie=(i,e,n)=>e in i?Be(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,A=(i,e)=>{for(var n in e||(e={}))We.call(e,n)&&ie(i,n,e[n]);if(Se)for(var n of Se(e))qe.call(e,n)&&ie(i,n,e[n]);return i},z=(i,e)=>Fe(i,ze(e));var K=(i,e,n)=>(ie(i,typeof e!="symbol"?e+"":e,n),n);import{w as writable,S as SvelteComponent,i as init,s as safe_not_equal,e as element,a as space,b as attr,c as append,d as insert,n as noop,f as detach,g as component_subscribe,o as onMount,t,h as binding_callbacks,j as toggle_class,k as empty,l as group_outros,m as transition_out,p as check_outros,q as transition_in,r as text,u as set_data,v as create_slot,x as listen,y as update_slot_base,z as get_all_dirty_from_scope,A as get_slot_changes,B as createEventDispatcher,C as set_custom_element_data,D as create_component,E as mount_component,F as destroy_component,G as shortid,H as set_style,I as destroy_each,J as add_render_callback,K as create_bidirectional_transition,L as scale,M as fade,N as get_spread_update,O as get_spread_object,P as assign,T as Texture,Q as SvelteComponentDev,R as slide,U as update_keyed_each,V as backInOut,W as outro_and_destroy_block,X as flush,Y as svg_element,Z as run_all,_ as monotoneCubicSpline,$ as set_input_value,a0 as to_number,a1 as subtract,a2 as normalize,a3 as cross$1,a4 as dot,a5 as identity,a6 as rotate,a7 as mul,a8 as transformMat4,a9 as add$1,aa as mod,ab as Vec3,ac as Geometry,ad as wrap,ae as Transform,af as Renderer$1,ag as Camera,ah as Orbit,ai as Program,aj as Mesh,ak as Box,al as storage,am as stop_propagation,an as ResizeObserver_1,ao as add_flush_callback,ap as bind,aq as set_store_value,ar as get_store_value,as as Plane,at as Color,au as HtmlTag,av as Src,aw as bubble,ax as handle_promise,ay as update_await_block_branch,az as subscribe}from"./vendor.2896a0c9.js";const p=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};p();var global="";const dark_shadow="0px 0px 2px rgba(0, 0, 0, 0.7)",light_shadow="0px 0px 5px rgba(0, 0, 0, 0.144)";var styles={"dark_background-color":"#1a1a1a","dark_foreground-color":"#303030","dark_outline-color":"#212121","dark_text-color":"#ffffff",dark_shadow,"light_background-color":"#d0d0d0","light_foreground-color":"white","light_outline-color":"#b9b9b9","light_text-color":"#484848",light_shadow};function stylesToJSON(i){const e={};return Object.entries(i).forEach(([n,s])=>{const[o,r]=n.split("_");o in e?e[o][r]=s:e[o]={[r]:s}}),e}const themes=stylesToJSON(styles),themeNames=Object.keys(themes);let activeTheme="theme"in localStorage?localStorage.getItem("theme"):themeNames[0];themeNames.includes(activeTheme)||(activeTheme=themeNames[0]);const store$4=writable(themes[activeTheme]),setTheme=i=>{themeNames.includes(i)&&(store$4.set(themes[i]),localStorage.setItem("theme",i))};function create_fragment$t(i){let e,n;return{c(){e=element("style"),n=space(),attr(e,"type","text/css")},m(s,o){append(document.head,e),i[3](e),insert(s,n,o)},p:noop,i:noop,o:noop,d(s){detach(e),i[3](null),s&&detach(n)}}}function instance$q(i,e,n){let s,o;component_subscribe(i,store$4,h=>n(2,o=h));let r,c=!1;function d(){c||!r||(c=!0,n(0,r.innerHTML="* {transition: color 0.2s ease, background-color 0.2s ease, outline 0.2s ease !important;}",r),setTimeout(()=>{n(0,r.innerHTML=`* {transition: color 0.2s ease, background-color 0.2s ease, outline 0.2s ease !important;} :root{${s}}`,r),setTimeout(()=>{n(0,r.innerHTML=`:root{${s}}`,r),c=!1},200)},1))}onMount(()=>{n(0,r.innerHTML=`:root{${s}}`,r)});function u(h){binding_callbacks[h?"unshift":"push"](()=>{r=h,n(0,r)})}return i.$$.update=()=>{i.$$.dirty&4&&n(1,s=t(o)),i.$$.dirty&2&&s&&d()},[r,s,o,u]}class ThemeProvider extends SvelteComponent{constructor(e){super();init(this,e,instance$q,create_fragment$t,safe_not_equal,{})}}function getBrowser$1(){return"window"in globalThis}const isBrowser=getBrowser$1();var arrow=`<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.2" baseProfile="tiny" id="Ebene_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
	 x="0px" y="0px" width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
</svg>
`,branch=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>branch</title>
  <path class="cls-1" d="M49.59,57.35,72.15,38.69"/>
  <path class="cls-1" d="M51.58,29.45,38,11.21"/>
  <path class="cls-1" d="M53.14,82.61,21.78,55.74"/>
  <path class="cls-1" d="M33.46,47.91l4,21"/>
  <polyline class="cls-1" points="56 97 50 58 51 28 56 16"/>
</svg>`,checkmark='<svg id="e7691b6e-31fa-49a4-aaec-be19b623d191" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><style>.b50603dd-20d5-40a2-a0ce-2fdf3b92ec21{fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:5px;}</style></defs><title>checkmark</title><path class="b50603dd-20d5-40a2-a0ce-2fdf3b92ec21" d="M75.5,30,40.43,72.47a2,2,0,0,1-3.08,0L24.5,57"/></svg>',cog=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
<defs>
	<style>
		circle, path{
			fill:none;
			stroke: var(--text, white);
			stroke-width: 5px;
		}
	</style>
</defs>
	<circle class="cls-1" cx="50.37" cy="50.5" r="17.23"/>
  <path class="cls-1" d="M38.07,20.49,32.17,8.05,50.83,4.41l.61,13.8,12.13,2.28L68.73,8.05l14,10.16-9,10L81.17,38.7l12-5.47,3.34,17.3H81.93L80.57,63l12.59,6.37L82.7,83.62l-9-9.86L63.58,81.19l5.15,11.23-17.9,3.64V82.71L38.08,81.19,32.77,92.42,17.44,82.71l10.17-8.35L19.11,63,8.19,69.36,4.4,50.56H17.45l1.67-13.81L8.2,30.84l9.25-13.2,11.08,8.81Z"/>
</svg>
`,cross=`<svg
  xmlns="http://www.w3.org/2000/svg"
	viewBox="0 0 100 100">
  <line fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" x1="27.836" y1="72.164" x2="72.164" y2="27.836"/>
  <line fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" x1="27.836" y1="27.988" x2="72.164" y2="72.012"/>
</svg>
`,exclamation=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M50.552 59.3295L39.0695 13.7056H60.2078L50.552 59.3295Z" stroke="white" stroke-width="5" stroke-linejoin="round"/>
<path d="M58.4305 77.2411C58.4305 80.8276 55.4725 83.7944 51.7497 83.7944C48.0269 83.7944 45.0688 80.8276 45.0688 77.2411C45.0688 73.6546 48.0269 70.6878 51.7497 70.6878C55.4725 70.6878 58.4305 73.6546 58.4305 77.2411Z" stroke="white" stroke-width="5"/>
</svg>
`,folder=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">

<defs>
	<style>
		path{
			stroke: white;
			stroke-width: 5px;
		}
	</style>
</defs>

<path d="M23.5167 72.9513V32.1483H82.1056L87.6855 37.0307V76.09L82.1056 78.5312H29.4453L23.5167 72.9513Z" />
<path d="M23.2747 73.6489L12.3145 30.0463L15.8885 21.4688H71.8808L75.693 32.9055" />
<path d="M25.488 43.9781H86.7394" />
</svg>
`,hand=`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M70.5 26.5L77.5 23.5L82 32V69L77.5 82L64.5 92.5H47L32 82L18 46L21 40H27L35 57.5V15.5L39.5 11L45.5 13.5M70.5 26.5L69 15.5L58.5 14M70.5 26.5V57.5M58.5 14L55 8L45.5 13.5M58.5 14V49M45.5 13.5V49" stroke-width="5"/>
</svg>
`,leaf$1=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>leaf</title>
  <path class="cls-1" d="M50.69,96.21,72.86,72.33,77,47,65.91,21.7,50.66,4.5"/>
  <path class="cls-1" d="M53.37,96.21,31.2,72.33,27.07,47,38.15,21.7,53.4,4.5"/>
</svg>`,pointing=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M30.2312 46.4809V15.6962L33.3006 8H40.8035L44.3844 11.0785V29.7203H52.9104L55.9798 33.8249H65.0173L68.0867 38.9557L76.2717 40.1529L79 56.0583L73.7139 72.9899L66.8931 93H36.5405L30.2312 75.5553L20 60.334L21.7052 50.2435L30.2312 46.4809ZM30.2312 46.4809V58.1107M44.3844 29.3783V46.3099M56.4913 34.5091V46.3099M68.7688 39.2978V50.4145" stroke="white" stroke-width="5"/>
</svg>
`,stem=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <defs>
    <style>.cls-1{fill:none;stroke:#fff;stroke-width:5px;}</style>
  </defs>
  <title>stem</title>
  <path class="cls-1" d="M49,95.5l8.66-23.19L43.24,46.07l10.59-21L43.24,4.5"/>
</svg>`,triangle=`<svg
  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" xml:space="preserve">
  <polygon fill="none" stroke="#FFFFFF" stroke-width="5" stroke-miterlimit="10" points="33.5,73.759 33.5,26.241 67.441,50 "/>
</svg>
`,warning=`<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M54.7631 15.1799L91.7944 79.3201C93.9114 82.9867 91.2652 87.5701 87.0313 87.5701H12.9687C8.73476 87.5701 6.08857 82.9867 8.20552 79.3201L45.2368 15.1799C47.3538 11.5133 52.6462 11.5133 54.7631 15.1799Z" stroke="white" stroke-width="5" stroke-linejoin="round"/>
<ellipse cx="50.0578" cy="73.7787" rx="5.98166" ry="5.89858" fill="white"/>
<path d="M52.9755 60.2707C52.5275 63.7615 47.4723 63.7615 47.0243 60.2707L43.5981 33.5748C43.3678 31.781 44.7652 30.1929 46.5736 30.1929L53.4261 30.1929C55.2346 30.1929 56.6319 31.781 56.4017 33.5748L52.9755 60.2707Z" fill="white"/>
</svg>
`,question=`<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M32.7792 25.4477L45.6598 15.6472L61.6205 20.4075L67.2208 32.728L54.3402 46.4486L50.9801 59.3291V63.9218" stroke-width="8"/>
<path d="M47.3642 83.3434L44.983 79.0169L46.821 74.3331L51.3861 73.0881L55.5363 75.0446L56.307 80.8548L52.3347 84.3528L47.3642 83.3434Z" />
</svg>

`,icons=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",arrow,branch,checkmark,cog,cross,exclamation,folder,hand,leaf:leaf$1,pointing,stem,triangle,warning,question}),Icon_svelte_svelte_type_style_lang="";function create_fragment$s(i){let e;return{c(){e=element("div"),attr(e,"class","icon-wrapper svelte-1ho94ty"),toggle_class(e,"active",i[0]),toggle_class(e,"dark",i[1]),toggle_class(e,"circle",i[2])},m(n,s){insert(n,e,s),e.innerHTML=i[3]},p(n,[s]){s&8&&(e.innerHTML=n[3]),s&1&&toggle_class(e,"active",n[0]),s&2&&toggle_class(e,"dark",n[1]),s&4&&toggle_class(e,"circle",n[2])},i:noop,o:noop,d(n){n&&detach(e)}}}function instance$p(i,e,n){let s,{name:o="triangle"}=e,{active:r=!1}=e,{dark:c=!1}=e,{circle:d=!1}=e;return i.$$set=u=>{"name"in u&&n(4,o=u.name),"active"in u&&n(0,r=u.active),"dark"in u&&n(1,c=u.dark),"circle"in u&&n(2,d=u.circle)},i.$$.update=()=>{i.$$.dirty&16&&n(3,s=o in icons?icons[o]:o.toString()+" icon not found")},[r,c,d,s,o]}class Icon extends SvelteComponent{constructor(e){super();init(this,e,instance$p,create_fragment$s,safe_not_equal,{name:4,active:0,dark:1,circle:2})}}var Button_svelte_svelte_type_style_lang="";function create_if_block_1$9(i){let e,n,s,o;const r=[create_if_block_2$7,create_else_block$7],c=[];function d(u,h){return u[6]?0:1}return e=d(i),n=c[e]=r[e](i),{c(){n.c(),s=empty()},m(u,h){c[e].m(u,h),insert(u,s,h),o=!0},p(u,h){let f=e;e=d(u),e===f?c[e].p(u,h):(group_outros(),transition_out(c[f],1,1,()=>{c[f]=null}),check_outros(),n=c[e],n?n.p(u,h):(n=c[e]=r[e](u),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(u){o||(transition_in(n),o=!0)},o(u){transition_out(n),o=!1},d(u){c[e].d(u),u&&detach(s)}}}function create_else_block$7(i){let e;return{c(){e=element("plant-icon"),set_custom_element_data(e,"name",i[1]),set_custom_element_data(e,"active",i[0]),set_custom_element_data(e,"class","svelte-1om2jl4")},m(n,s){insert(n,e,s)},p(n,s){s&2&&set_custom_element_data(e,"name",n[1]),s&1&&set_custom_element_data(e,"active",n[0])},i:noop,o:noop,d(n){n&&detach(e)}}}function create_if_block_2$7(i){let e,n;return e=new Icon({props:{name:i[1],active:i[0]}}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&2&&(r.name=s[1]),o&1&&(r.active=s[0]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_if_block$e(i){let e,n;return{c(){e=element("p"),n=text(i[2]),attr(e,"class","svelte-1om2jl4")},m(s,o){insert(s,e,o),append(e,n)},p(s,o){o&4&&set_data(n,s[2])},d(s){s&&detach(e)}}}function create_fragment$r(i){let e,n,s,o,r,c,d,u=i[1]&&create_if_block_1$9(i),h=i[2]&&create_if_block$e(i);const f=i[9].default,m=create_slot(f,i,i[8],null);return{c(){e=element("button"),u&&u.c(),n=space(),h&&h.c(),s=space(),o=element("div"),m&&m.c(),attr(o,"class","content svelte-1om2jl4"),e.disabled=i[4],attr(e,"class","svelte-1om2jl4"),toggle_class(e,"active",i[0]),toggle_class(e,"useActive",i[3]),toggle_class(e,"only-icon",!i[2]),toggle_class(e,"has-icon",!!i[1])},m(_,g){insert(_,e,g),u&&u.m(e,null),append(e,n),h&&h.m(e,null),append(e,s),append(e,o),m&&m.m(o,null),i[10](e),r=!0,c||(d=listen(e,"click",i[7]),c=!0)},p(_,[g]){_[1]?u?(u.p(_,g),g&2&&transition_in(u,1)):(u=create_if_block_1$9(_),u.c(),transition_in(u,1),u.m(e,n)):u&&(group_outros(),transition_out(u,1,1,()=>{u=null}),check_outros()),_[2]?h?h.p(_,g):(h=create_if_block$e(_),h.c(),h.m(e,s)):h&&(h.d(1),h=null),m&&m.p&&(!r||g&256)&&update_slot_base(m,f,_,_[8],r?get_slot_changes(f,_[8],g,null):get_all_dirty_from_scope(_[8]),null),(!r||g&16)&&(e.disabled=_[4]),g&1&&toggle_class(e,"active",_[0]),g&8&&toggle_class(e,"useActive",_[3]),g&4&&toggle_class(e,"only-icon",!_[2]),g&2&&toggle_class(e,"has-icon",!!_[1])},i(_){r||(transition_in(u),transition_in(m,_),r=!0)},o(_){transition_out(u),transition_out(m,_),r=!1},d(_){_&&detach(e),u&&u.d(),h&&h.d(),m&&m.d(_),i[10](null),c=!1,d()}}}function instance$o(i,e,n){let s,{$$slots:o={},$$scope:r}=e,{icon:c=void 0}=e,{name:d=""}=e,{active:u=!1}=e,{useActive:h=!1}=e,{disabled:f=!1}=e,m;const _=createEventDispatcher(),g=()=>{n(0,u=!u),_("click")};function v(y){binding_callbacks[y?"unshift":"push"](()=>{m=y,n(5,m)})}return i.$$set=y=>{"icon"in y&&n(1,c=y.icon),"name"in y&&n(2,d=y.name),"active"in y&&n(0,u=y.active),"useActive"in y&&n(3,h=y.useActive),"disabled"in y&&n(4,f=y.disabled),"$$scope"in y&&n(8,r=y.$$scope)},i.$$.update=()=>{i.$$.dirty&32&&n(6,s=m&&!!m.parentElement)},[u,c,d,h,f,m,s,g,r,o,v]}class Button extends SvelteComponent{constructor(e){super();init(this,e,instance$o,create_fragment$r,safe_not_equal,{icon:1,name:2,active:0,useActive:3,disabled:4})}}var MessageType$1;(function(i){i.INFO="info",i.WARNING="warning",i.ERROR="error",i.SUCCESS="success"})(MessageType$1||(MessageType$1={}));const createMessageFactory=i=>(e,n)=>{var c;if(!e&&!n)return;const s=Array.isArray(n==null?void 0:n.values),o={id:shortid(),type:MessageType$1.INFO,content:e,props:n.props,title:(c=n==null?void 0:n.title)!=null?c:n==null?void 0:n.type,values:n==null?void 0:n.values,timeout:n==null?void 0:n.timeout},r=new Promise((d,u)=>{o.resolve=d,o.reject=u});if(r.finally(()=>i.update(d=>d.filter(u=>u.id!==o.id))),n&&"type"in n){const d=n.type.toLowerCase();Object.values(MessageType$1).forEach(u=>{d===u&&(o.type=u)})}if(e instanceof Error&&(o.type=MessageType$1.ERROR),typeof o.timeout=="undefined"){let d;o.type===MessageType$1.SUCCESS&&(d=3e3),o.type===MessageType$1.INFO&&(d=2e3),o.type===MessageType$1.WARNING&&(d=7e3),d&&!s&&(o.timeout=d)}return"title"in o||(o.title=o.type.toUpperCase().slice(0,1)+o.type.slice(1)),i.update(d=>[...d,o]),o.timeout&&setTimeout(o.resolve,o.timeout),r};var createMessageStore=()=>{const i=writable([]),e=createMessageFactory(i);return{store:i,createMessage:e,MessageType:MessageType$1}};const{store:_store$1,createMessage:createMessage$1,MessageType}=createMessageStore(),store$3=_store$1,createAlert=createMessage$1;var AlertWrapper_svelte_svelte_type_style_lang="";function get_each_context$b(i,e,n){const s=i.slice();return s[6]=e[n],s}function create_if_block$d(i){let e,n,s,o,r,c,d,u,h,f,m,_,g,v;o=new Button({props:{icon:"cross"}}),o.$on("click",i[4]);let y=i[0].title&&create_if_block_3$2(i);const b=[create_if_block_2$6,create_else_block$6],w=[];function S($,P){return typeof $[0].content=="string"?0:1}u=S(i),h=w[u]=b[u](i);let k=i[0].values&&create_if_block_1$8(i);return{c(){e=element("div"),n=element("div"),s=element("div"),r=element("div"),create_component(o.$$.fragment),c=space(),y&&y.c(),d=space(),h.c(),f=space(),k&&k.c(),set_style(r,"display","contents"),set_style(r,"--bg","transparent"),attr(s,"class","close-wrapper svelte-r4wwk4"),attr(n,"class",m="alert-wrapper alert-"+i[0].type+" svelte-r4wwk4"),toggle_class(n,"isInverted",i[1]),attr(e,"class","alert-container svelte-r4wwk4")},m($,P){insert($,e,P),append(e,n),append(n,s),append(s,r),mount_component(o,r,null),append(n,c),y&&y.m(n,null),append(n,d),w[u].m(n,null),append(n,f),k&&k.m(n,null),v=!0},p($,P){$[0].title?y?y.p($,P):(y=create_if_block_3$2($),y.c(),y.m(n,d)):y&&(y.d(1),y=null);let x=u;u=S($),u===x?w[u].p($,P):(group_outros(),transition_out(w[x],1,1,()=>{w[x]=null}),check_outros(),h=w[u],h?h.p($,P):(h=w[u]=b[u]($),h.c()),transition_in(h,1),h.m(n,f)),$[0].values?k?(k.p($,P),P&1&&transition_in(k,1)):(k=create_if_block_1$8($),k.c(),transition_in(k,1),k.m(n,null)):k&&(group_outros(),transition_out(k,1,1,()=>{k=null}),check_outros()),(!v||P&1&&m!==(m="alert-wrapper alert-"+$[0].type+" svelte-r4wwk4"))&&attr(n,"class",m),P&3&&toggle_class(n,"isInverted",$[1])},i($){v||(transition_in(o.$$.fragment,$),transition_in(h),transition_in(k),add_render_callback(()=>{_||(_=create_bidirectional_transition(n,scale,{},!0)),_.run(1)}),add_render_callback(()=>{g||(g=create_bidirectional_transition(e,fade,{},!0)),g.run(1)}),v=!0)},o($){transition_out(o.$$.fragment,$),transition_out(h),transition_out(k),_||(_=create_bidirectional_transition(n,scale,{},!1)),_.run(0),g||(g=create_bidirectional_transition(e,fade,{},!1)),g.run(0),v=!1},d($){$&&detach(e),destroy_component(o),y&&y.d(),w[u].d(),k&&k.d(),$&&_&&_.end(),$&&g&&g.end()}}}function create_if_block_3$2(i){let e,n=i[0].title+"",s;return{c(){e=element("h2"),s=text(n),attr(e,"class","svelte-r4wwk4")},m(o,r){insert(o,e,r),append(e,s)},p(o,r){r&1&&n!==(n=o[0].title+"")&&set_data(s,n)},d(o){o&&detach(e)}}}function create_else_block$6(i){let e,n,s;const o=[i[0].props];var r=i[0].content;function c(d){let u={};for(let h=0;h<o.length;h+=1)u=assign(u,o[h]);return{props:u}}return r&&(e=new r(c())),{c(){e&&create_component(e.$$.fragment),n=empty()},m(d,u){e&&mount_component(e,d,u),insert(d,n,u),s=!0},p(d,u){const h=u&1?get_spread_update(o,[get_spread_object(d[0].props)]):{};if(r!==(r=d[0].content)){if(e){group_outros();const f=e;transition_out(f.$$.fragment,1,0,()=>{destroy_component(f,1)}),check_outros()}r?(e=new r(c()),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,n.parentNode,n)):e=null}else r&&e.$set(h)},i(d){s||(e&&transition_in(e.$$.fragment,d),s=!0)},o(d){e&&transition_out(e.$$.fragment,d),s=!1},d(d){d&&detach(n),e&&destroy_component(e,d)}}}function create_if_block_2$6(i){let e,n=i[0].content+"";return{c(){e=element("p")},m(s,o){insert(s,e,o),e.innerHTML=n},p(s,o){o&1&&n!==(n=s[0].content+"")&&(e.innerHTML=n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_if_block_1$8(i){let e,n,s=i[0].values,o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$b(get_each_context$b(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){e=element("div");for(let c=0;c<o.length;c+=1)o[c].c();attr(e,"class","options-wrapper svelte-r4wwk4")},m(c,d){insert(c,e,d);for(let u=0;u<o.length;u+=1)o[u].m(e,null);n=!0},p(c,d){if(d&1){s=c[0].values;let u;for(u=0;u<s.length;u+=1){const h=get_each_context$b(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$b(h),o[u].c(),transition_in(o[u],1),o[u].m(e,null))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){c&&detach(e),destroy_each(o,c)}}}function create_each_block$b(i){let e,n,s;function o(){return i[5](i[6])}return e=new Button({props:{name:i[6]}}),e.$on("click",o),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--bg","#303030"),set_style(n,"--text","white")},m(r,c){insert(r,n,c),mount_component(e,n,null),s=!0},p(r,c){i=r;const d={};c&1&&(d.name=i[6]),e.$set(d)},i(r){s||(transition_in(e.$$.fragment,r),s=!0)},o(r){transition_out(e.$$.fragment,r),s=!1},d(r){r&&detach(n),destroy_component(e,r)}}}function create_fragment$q(i){let e,n,s,o,r=i[0]&&create_if_block$d(i);return{c(){r&&r.c(),e=empty()},m(c,d){r&&r.m(c,d),insert(c,e,d),n=!0,s||(o=listen(window,"keydown",i[2]),s=!0)},p(c,[d]){c[0]?r?(r.p(c,d),d&1&&transition_in(r,1)):(r=create_if_block$d(c),r.c(),transition_in(r,1),r.m(e.parentNode,e)):r&&(group_outros(),transition_out(r,1,1,()=>{r=null}),check_outros())},i(c){n||(transition_in(r),n=!0)},o(c){transition_out(r),n=!1},d(c){r&&r.d(c),c&&detach(e),s=!1,o()}}}function instance$n(i,e,n){let s,o,r;component_subscribe(i,store$3,h=>n(3,r=h));function c(h){h.key==="Escape"&&s&&s.reject()}const d=()=>{s.reject()},u=h=>s.resolve(h);return i.$$.update=()=>{i.$$.dirty&8&&n(0,s=r[0]),i.$$.dirty&1&&(s?isBrowser&&document.body.classList.add("overlay-visible"):isBrowser&&document.body.classList.remove("overlay-visible")),i.$$.dirty&1&&n(1,o=s&&(s.type==="success"||s.type==="warning"))},[s,o,c,r,d,u]}class AlertWrapper extends SvelteComponent{constructor(e){super();init(this,e,instance$n,create_fragment$q,safe_not_equal,{})}}const{store:_store,createMessage}=createMessageStore(),store$2=_store,createToast=createMessage;var aggregate=(i,...e)=>{const n=(o,r)=>{Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r).map(c=>c.toString())).forEach(c=>{c.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(o,c,Object.getOwnPropertyDescriptor(r,c))})},s=class extends i{constructor(...r){super(...r);e.forEach(c=>n(this,new c))}};return e.forEach(o=>{n(s.prototype,o.prototype),n(s,o)}),s},convertHexToRGB=i=>{i[0]==="#"&&(i=i.replace("#","")),i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]);const e=i.match(/.{1,2}/g);return[parseInt(e[0],16)/255,parseInt(e[1],16)/255,parseInt(e[2],16)/255]};const tension=.4;function plotCBez(i,e,n,s,o,r,c,d,u,h){const f=o-n,m=c-o,_=u-c,g=r-s,v=d-r,y=h-d;let b,w,S,k,$=-1e4,P=-1e4;const x=[{x:n,y:s}];for(let T=1;T<i;T++){const j=T/i;b=n+f*j,S=o+m*j;const V=c+_*j;b+=(S-b)*j,S+=(V-S)*j,w=s+g*j,k=r+v*j;const O=d+y*j;w+=(k-w)*j,k+=(O-k)*j;const B=b+(S-b)*j,I=w+(k-w)*j,D=B-$,E=I-P;D*D+E*E>e&&(x.push({x:B,y:I}),$=B,P=I)}return x.push({x:u,y:h}),x}function computeControlPoints(i){const e=i.length-1;return i.map((n,s,o)=>{if(s===0)return{rx:o[s+1].x*tension*0,ry:n.y+(o[s+1].y-n.y)*tension*0};if(s===e)return{lx:o[s-1].x+(n.x-o[s-1].x)*tension*2,ly:o[s-1].y+(n.y-o[s-1].y)*tension*2};if(n.y>o[s+1].y&&n.y>o[s-1].y||n.y<o[s+1].y&&n.y<o[s-1].y)return{lx:o[s-1].x+(n.x-o[s-1].x)*tension,ly:n.y,rx:n.x+(o[s+1].x-n.x)*tension,ry:n.y};{const c={x:o[s-1].x-o[s+1].x,y:o[s-1].y-o[s+1].y},d=Math.sqrt(Math.pow(c.x,2)+Math.pow(c.y,2));c.x/=d,c.y/=d;const u=o[s+1].x-n.x,h=n.x-o[s-1].x;return{lx:n.x+c.x*h*tension,ly:n.y+c.y*h*tension,rx:n.x-c.x*u*tension,ry:n.y-c.y*u*tension}}})}function toArray(i){const e=i.length-1,n={},s=computeControlPoints(i);return i.map((o,r,c)=>{if(r<e)return plotCBez(e*20,0,o.x,o.y,s[r].rx,s[r].ry,s[r+1].lx,s[r+1].ly,c[r+1].x,c[r+1].y)}).flat().filter(o=>!o||o.x in n?!1:(n[o.x]=!0,!0))}function debounce(i,e,n){let s;return(...o)=>{const r=()=>{s=null,n||i(...o)},c=n&&!s;clearTimeout(s),s=setTimeout(r,e),c&&i(...o)}}function Debounce(i,e=!1){return function(n,s,o){let r;const c=o.value;return o.value=function(...d){const u=()=>{r=null,e||c.apply(this,d)},h=e&&!r;clearTimeout(r),r=setTimeout(u,i),h&&c.apply(this,d)},o}}function throttle(i,e){let n,s,o,r=null,c=0;const d=i,u=()=>{c=0,r=null,o=d.apply(n,s),r||(n=s=null)};return function(){const f=Date.now();c||(c=f);const m=e-(f-c);return n=this,s=arguments,m<=0||m>e?(r&&(window.clearTimeout(r),r=null),c=f,o=d.apply(n,s),r||(n=s=null)):r||(r=window.setTimeout(u,m)),o}}const debug={amountEmitters:0,amountCallbacks:0,emitters:[]};typeof self!="undefined"&&"window"in self&&(window.debug=debug);class EventEmitter{constructor(){K(this,"index",0);K(this,"cbs",{});K(this,"cbsOnce",{});this.index=debug.amountEmitters,debug.amountEmitters++}emit(e,n){e in this.cbs&&this.cbs[e].forEach(s=>s(n)),e in this.cbsOnce&&(this.cbsOnce[e].forEach(s=>s(n)),delete this.cbsOnce[e])}on(e,n,s=0){s>0&&(n=throttle(n,s));const o=Object.assign(this.cbs,{[e]:[...this.cbs[e]||[],n]});return this.cbs=o,debug.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(r=>[r,this.cbs[r].length]))},debug.amountCallbacks++,()=>{var r;debug.amountCallbacks--,(r=o[e])==null||r.splice(o[e].indexOf(n),1),debug.emitters[this.index]={name:this.constructor.name,cbs:Object.fromEntries(Object.keys(this.cbs).map(c=>[c,this.cbs[c].length]))}}}once(e,n){return this.cbsOnce[e]=[...this.cbsOnce[e]||[],n],()=>{this.cbsOnce[e].splice(this.cbsOnce[e].indexOf(n),1)}}destroyEventEmitter(){debug.amountEmitters--,Object.keys(this.cbs).forEach(e=>{debug.amountCallbacks-=this.cbs[e].length,delete this.cbs[e]}),Object.keys(this.cbsOnce).forEach(e=>delete this.cbsOnce[e]),this.cbs={},this.cbsOnce={},delete debug.emitters[this.index]}}function fastHash(i){if(i.length===0)return 0;let e=0;for(let n=0;n<i.length;n++)e=(e<<5)-e+i.charCodeAt(n),e=e&e;return e}var genId=()=>{const i={};let e=0;const n=(s=0,o=0)=>{if(o>500)throw new Error("Infinite loop in id generation algo");return s in i?n(Math.max(s++,e++),o+1):(i[s]=!0,s.toString())};return n.reset=()=>{Object.keys(i).forEach(s=>delete i[+s]),e=0},n};function groupArray(i,e){const n=[],s=i.length/e;for(let o=0;o<s;o++){const r=[];for(let c=0;c<e;c++)r[c]=i[o*e+c];n.push(r)}return n}const getPluralS=i=>i>1?"s":"",time=i=>{if(typeof i!="number"||isNaN(i))return"never";if(i<1e3)return"< 1 second";const e=Math.floor(i/1e3);if(e<60)return e+" second"+getPluralS(e);const n=Math.floor(e/60);if(n<60)return n+" minute"+getPluralS(n);const s=Math.floor(n/60);if(s<24)return s+" hour"+getPluralS(s);const o=Math.floor(s/24);if(o<7)return o+" day"+getPluralS(o);const r=Math.floor(o/7);if(r<30)return r+" week"+getPluralS(r);const c=Math.floor(r/30);if(c<12)return c+" month"+getPluralS(c);const d=Math.floor(c/12);if(d<10)return d+" year"+getPluralS(d);const u=Math.floor(c/10);return u+" decade"+getPluralS(u)};function memo(i){let e,n={length:NaN};const s=(o,r)=>o===n[r];return function(...r){return(r.length!==n.length||!r.every(s))&&(n=r,e=i.apply(this,r)),e}}const textureCache={},loadTexture=(i,e,n={})=>{if(textureCache[e])return textureCache[e];const s=new Texture(i,n),o=new Image;return textureCache[e]=s,o.onload=()=>{s.image=o},o.src=e,s};var loader={texture:loadTexture};let filters=[],level=2,longestName=0;const scopes={};let currentIndex=0;const colors=["#00ffff","#f0ffff","#f5f5dc","#000000","#0000ff","#a52a2a","#00ffff","#00008b","#008b8b","#a9a9a9","#006400","#bdb76b","#8b008b","#556b2f","#ff8c00","#9932cc","#8b0000","#e9967a","#9400d3","#ff00ff","#ffd700","#008000","#4b0082","#f0e68c","#add8e6","#e0ffff","#90ee90","#d3d3d3","#ffb6c1","#ffffe0","#00ff00","#ff00ff","#800000","#000080","#808000","#ffa500","#ffc0cb","#800080","#800080","#ff0000","#c0c0c0","#ffffff","#ffff00"];function log$8(i){longestName=Math.max(longestName,i.length);const e=currentIndex;scopes[i]=colors[currentIndex],currentIndex++;const n=(...s)=>{if((!filters.length||filters.includes(i))&&level===0){if(typeof s[0]=="string"&&typeof s[1]=="object"){console.groupCollapsed(`%c[${i.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,s[0]),console.log(...s.slice(1)),console.groupEnd();return}console.log(`%c[${i.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,...s)}};return n.group=(...s)=>{level<1&&console.groupCollapsed(`%c[${i.padEnd(longestName," ")}]`,`color: hsl(${e*30}deg 68% 64%); font-weight: bold;`,...s)},n.warn=(...s)=>{level<=1&&console.warn(`[${i.padEnd(longestName," ")}]`,...s)},n.error=s=>{console.error(`[${i.padEnd(longestName," ")}]`,s)},n}log$8.setFilter=(...i)=>{filters=i};log$8.setLevel=(i=0)=>{level=i};function memoize(i){const e={};return(...n)=>{const s=fastHash(JSON.stringify(n));return s in e?e[s]:e[s]=i(...n)}}const regex=/^(?:[ ]+)?(?:at )([^ ]*)?(?: )?(?:\[(.*?)\] )?(?:\(([^()]+)\))?$/gm,stripPath=i=>i.replace(window.location.href,"").replace(/^node_modules/,"").replace(/.+?(?=plantarium)plantarium\//,"");var parseStackTrace=i=>{const[e,...n]=i.split(`
`),[s,o]=e.split(":"),r=n.map(c=>{const d=[...c.matchAll(regex)][0],[,u,h,f]=d;return A(A({name:stripPath(u)},f?{location:stripPath(f)}:{}),h?{alias:h.trim().replace("as ","")}:{})});return{title:o,type:s,lines:r}},StackTrace_svelte_svelte_type_style_lang="";function get_each_context$a(i,e,n){const s=i.slice();return s[1]=e[n],s}function create_if_block$c(i){let e,n,s,o=i[0].type+"",r,c,d,u=i[0].title+"",h,f,m,_,g=i[0].lines,v=[];for(let y=0;y<g.length;y+=1)v[y]=create_each_block$a(get_each_context$a(i,g,y));return{c(){e=element("div"),n=element("p"),s=element("b"),r=text(o),c=text(":"),d=space(),h=text(u),f=space(),m=element("pre"),_=element("code");for(let y=0;y<v.length;y+=1)v[y].c();attr(m,"class","svelte-1e5rtbs"),attr(e,"class","wrapper svelte-1e5rtbs")},m(y,b){insert(y,e,b),append(e,n),append(n,s),append(s,r),append(s,c),append(n,d),append(n,h),append(e,f),append(e,m),append(m,_);for(let w=0;w<v.length;w+=1)v[w].m(_,null)},p(y,b){if(b&1&&o!==(o=y[0].type+"")&&set_data(r,o),b&1&&u!==(u=y[0].title+"")&&set_data(h,u),b&1){g=y[0].lines;let w;for(w=0;w<g.length;w+=1){const S=get_each_context$a(y,g,w);v[w]?v[w].p(S,b):(v[w]=create_each_block$a(S),v[w].c(),v[w].m(_,null))}for(;w<v.length;w+=1)v[w].d(1);v.length=g.length}},d(y){y&&detach(e),destroy_each(v,y)}}}function create_if_block_2$5(i){let e,n,s,o=i[1].alias+"",r;return{c(){e=text("as "),n=element("strong"),s=text("$"),r=text(o)},m(c,d){insert(c,e,d),insert(c,n,d),append(n,s),append(n,r)},p(c,d){d&1&&o!==(o=c[1].alias+"")&&set_data(r,o)},d(c){c&&detach(e),c&&detach(n)}}}function create_if_block_1$7(i){let e,n,s=i[1].location+"",o,r;return{c(){e=text("\xA0("),n=element("i"),o=text(s),r=text(")")},m(c,d){insert(c,e,d),insert(c,n,d),append(n,o),insert(c,r,d)},p(c,d){d&1&&s!==(s=c[1].location+"")&&set_data(o,s)},d(c){c&&detach(e),c&&detach(n),c&&detach(r)}}}function create_each_block$a(i){let e,n,s=i[1].name+"",o,r,c,d=i[1].alias&&create_if_block_2$5(i),u=i[1].location&&create_if_block_1$7(i);return{c(){e=text("at "),n=element("strong"),o=text(s),d&&d.c(),r=empty(),u&&u.c(),c=element("br")},m(h,f){insert(h,e,f),insert(h,n,f),append(n,o),d&&d.m(h,f),insert(h,r,f),u&&u.m(h,f),insert(h,c,f)},p(h,f){f&1&&s!==(s=h[1].name+"")&&set_data(o,s),h[1].alias?d?d.p(h,f):(d=create_if_block_2$5(h),d.c(),d.m(r.parentNode,r)):d&&(d.d(1),d=null),h[1].location?u?u.p(h,f):(u=create_if_block_1$7(h),u.c(),u.m(c.parentNode,c)):u&&(u.d(1),u=null)},d(h){h&&detach(e),h&&detach(n),d&&d.d(h),h&&detach(r),u&&u.d(h),h&&detach(c)}}}function create_fragment$p(i){let e,n=i[0]&&create_if_block$c(i);return{c(){n&&n.c(),e=empty()},m(s,o){n&&n.m(s,o),insert(s,e,o)},p(s,[o]){s[0]?n?n.p(s,o):(n=create_if_block$c(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:noop,o:noop,d(s){n&&n.d(s),s&&detach(e)}}}function instance$m(i,e,n){let{stacktrace:s}=e;return i.$$set=o=>{"stacktrace"in o&&n(0,s=o.stacktrace)},[s]}class StackTrace extends SvelteComponent{constructor(e){super();init(this,e,instance$m,create_fragment$p,safe_not_equal,{stacktrace:0})}}var Toast_svelte_svelte_type_style_lang="";function get_each_context$9(i,e,n){const s=i.slice();return s[13]=e[n],s}function create_if_block$b(i){let e,n,s,o,r,c,d,u,h,f,m,_,g,v,y,b,w,S,k,$,P,x,T=i[6]&&create_if_block_9(i),j=i[0].title&&create_if_block_8(i);const V=[create_if_block_4$1,create_if_block_5,create_if_block_7],O=[];function B(E,R){return typeof E[0].content=="string"?0:E[0].content instanceof Error?1:E[0].content instanceof SvelteComponentDev?2:-1}~(d=B(i))&&(u=O[d]=V[d](i));let I=i[0].content instanceof Error&&create_if_block_3$1(i),D=i[0].values&&create_if_block_1$6(i);return v=new Icon({props:{name:"cross"}}),{c(){e=element("div"),n=element("div"),s=element("div"),T&&T.c(),o=space(),r=element("div"),j&&j.c(),c=space(),u&&u.c(),h=space(),f=element("div"),I&&I.c(),m=space(),D&&D.c(),_=space(),g=element("div"),y=element("div"),create_component(v.$$.fragment),b=space(),w=element("div"),attr(f,"class","button-wrapper svelte-bnz79m"),attr(r,"class","toast-text svelte-bnz79m"),set_style(y,"display","contents"),set_style(y,"--height","fit-content"),attr(g,"class","toast-close svelte-bnz79m"),attr(s,"class","toast-content svelte-bnz79m"),toggle_class(s,"hasIcon",!!i[6]),attr(w,"style",S=`transition: width ${i[0].timeout}ms linear;`),attr(w,"class","toast-progress svelte-bnz79m"),toggle_class(w,"animateProgress",i[2]),attr(n,"class",k="toast toast-"+i[0].type+" svelte-bnz79m"),toggle_class(n,"isInverted",i[5]),attr(e,"class","wrapper svelte-bnz79m")},m(E,R){insert(E,e,R),append(e,n),append(n,s),T&&T.m(s,null),append(s,o),append(s,r),j&&j.m(r,null),append(r,c),~d&&O[d].m(r,null),append(r,h),append(r,f),I&&I.m(f,null),append(f,m),D&&D.m(f,null),append(s,_),append(s,g),append(g,y),mount_component(v,y,null),append(n,b),append(n,w),i[11](e),$=!0,P||(x=listen(g,"click",i[10]),P=!0)},p(E,R){E[6]?T?(T.p(E,R),R&64&&transition_in(T,1)):(T=create_if_block_9(E),T.c(),transition_in(T,1),T.m(s,o)):T&&(group_outros(),transition_out(T,1,1,()=>{T=null}),check_outros()),E[0].title?j?j.p(E,R):(j=create_if_block_8(E),j.c(),j.m(r,c)):j&&(j.d(1),j=null);let G=d;d=B(E),d===G?~d&&O[d].p(E,R):(u&&(group_outros(),transition_out(O[G],1,1,()=>{O[G]=null}),check_outros()),~d?(u=O[d],u?u.p(E,R):(u=O[d]=V[d](E),u.c()),transition_in(u,1),u.m(r,h)):u=null),E[0].content instanceof Error?I?(I.p(E,R),R&1&&transition_in(I,1)):(I=create_if_block_3$1(E),I.c(),transition_in(I,1),I.m(f,m)):I&&(group_outros(),transition_out(I,1,1,()=>{I=null}),check_outros()),E[0].values?D?(D.p(E,R),R&1&&transition_in(D,1)):(D=create_if_block_1$6(E),D.c(),transition_in(D,1),D.m(f,null)):D&&(group_outros(),transition_out(D,1,1,()=>{D=null}),check_outros()),R&64&&toggle_class(s,"hasIcon",!!E[6]),(!$||R&1&&S!==(S=`transition: width ${E[0].timeout}ms linear;`))&&attr(w,"style",S),R&4&&toggle_class(w,"animateProgress",E[2]),(!$||R&1&&k!==(k="toast toast-"+E[0].type+" svelte-bnz79m"))&&attr(n,"class",k),R&33&&toggle_class(n,"isInverted",E[5])},i(E){$||(transition_in(T),transition_in(u),transition_in(I),transition_in(D),transition_in(v.$$.fragment,E),$=!0)},o(E){transition_out(T),transition_out(u),transition_out(I),transition_out(D),transition_out(v.$$.fragment,E),$=!1},d(E){E&&detach(e),T&&T.d(),j&&j.d(),~d&&O[d].d(),I&&I.d(),D&&D.d(),destroy_component(v),i[11](null),P=!1,x()}}}function create_if_block_9(i){let e,n,s,o;return n=new Icon({props:{name:i[6],circle:!0}}),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--width","40px"),set_style(s,"--height","40px"),attr(e,"class","toast-icon svelte-bnz79m")},m(r,c){insert(r,e,c),append(e,s),mount_component(n,s,null),o=!0},p(r,c){const d={};c&64&&(d.name=r[6]),n.$set(d)},i(r){o||(transition_in(n.$$.fragment,r),o=!0)},o(r){transition_out(n.$$.fragment,r),o=!1},d(r){r&&detach(e),destroy_component(n)}}}function create_if_block_8(i){let e,n=i[0].title+"",s;return{c(){e=element("h3"),s=text(n),attr(e,"class","svelte-bnz79m")},m(o,r){insert(o,e,r),append(e,s)},p(o,r){r&1&&n!==(n=o[0].title+"")&&set_data(s,n)},d(o){o&&detach(e)}}}function create_if_block_7(i){let e,n,s;var o=i[0].content;function r(c){return{}}return o&&(e=new o(r())),{c(){e&&create_component(e.$$.fragment),n=empty()},m(c,d){e&&mount_component(e,c,d),insert(c,n,d),s=!0},p(c,d){if(o!==(o=c[0].content)){if(e){group_outros();const u=e;transition_out(u.$$.fragment,1,0,()=>{destroy_component(u,1)}),check_outros()}o?(e=new o(r()),create_component(e.$$.fragment),transition_in(e.$$.fragment,1),mount_component(e,n.parentNode,n)):e=null}},i(c){s||(e&&transition_in(e.$$.fragment,c),s=!0)},o(c){e&&transition_out(e.$$.fragment,c),s=!1},d(c){c&&detach(n),e&&destroy_component(e,c)}}}function create_if_block_5(i){let e,n=i[0].content.message+"",s,o,r,c,d=i[3]&&create_if_block_6(i);return{c(){e=element("p"),s=text(n),o=space(),d&&d.c(),r=empty(),attr(e,"class","svelte-bnz79m")},m(u,h){insert(u,e,h),append(e,s),insert(u,o,h),d&&d.m(u,h),insert(u,r,h),c=!0},p(u,h){(!c||h&1)&&n!==(n=u[0].content.message+"")&&set_data(s,n),u[3]?d?(d.p(u,h),h&8&&transition_in(d,1)):(d=create_if_block_6(u),d.c(),transition_in(d,1),d.m(r.parentNode,r)):d&&(group_outros(),transition_out(d,1,1,()=>{d=null}),check_outros())},i(u){c||(transition_in(d),c=!0)},o(u){transition_out(d),c=!1},d(u){u&&detach(e),u&&detach(o),d&&d.d(u),u&&detach(r)}}}function create_if_block_4$1(i){let e,n=i[0].content+"";return{c(){e=element("p"),attr(e,"class","svelte-bnz79m")},m(s,o){insert(s,e,o),e.innerHTML=n},p(s,o){o&1&&n!==(n=s[0].content+"")&&(e.innerHTML=n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_if_block_6(i){let e,n,s,o;return n=new StackTrace({props:{stacktrace:parseStackTrace(i[0].content.stack)}}),{c(){e=element("div"),create_component(n.$$.fragment),attr(e,"class","stack-trace svelte-bnz79m")},m(r,c){insert(r,e,c),mount_component(n,e,null),o=!0},p(r,c){const d={};c&1&&(d.stacktrace=parseStackTrace(r[0].content.stack)),n.$set(d)},i(r){o||(transition_in(n.$$.fragment,r),add_render_callback(()=>{s||(s=create_bidirectional_transition(e,slide,{},!0)),s.run(1)}),o=!0)},o(r){transition_out(n.$$.fragment,r),s||(s=create_bidirectional_transition(e,slide,{},!1)),s.run(0),o=!1},d(r){r&&detach(e),destroy_component(n),r&&s&&s.end()}}}function create_if_block_3$1(i){let e,n,s,o;return e=new Button({props:{name:"> StackTrace"}}),e.$on("click",i[7]),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--margin","5px 10px 5px -10px"),set_style(n,"--text",s=i[5]?"#1a1a1a":"white"),set_style(n,"--bg","transparent")},m(r,c){insert(r,n,c),mount_component(e,n,null),o=!0},p(r,c){c&32&&s!==(s=r[5]?"#1a1a1a":"white")&&set_style(n,"--text",s)},i(r){o||(transition_in(e.$$.fragment,r),o=!0)},o(r){transition_out(e.$$.fragment,r),o=!1},d(r){r&&detach(n),destroy_component(e,r)}}}function create_if_block_1$6(i){let e,n,s=i[0].values,o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$9(get_each_context$9(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=empty()},m(c,d){for(let u=0;u<o.length;u+=1)o[u].m(c,d);insert(c,e,d),n=!0},p(c,d){if(d&49){s=c[0].values;let u;for(u=0;u<s.length;u+=1){const h=get_each_context$9(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$9(h),o[u].c(),transition_in(o[u],1),o[u].m(e.parentNode,e))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){destroy_each(o,c),c&&detach(e)}}}function create_else_block$5(i){let e,n,s,o,r;function c(){return i[9](i[13])}return e=new Button({props:{name:i[13]}}),e.$on("click",c),{c(){n=element("div"),create_component(e.$$.fragment),set_style(n,"display","contents"),set_style(n,"--margin","5px 10px 5px 0"),set_style(n,"--text",s=i[5]?"white":"#1a1a1a"),set_style(n,"--bg",o=i[5]?"#1a1a1a":"white")},m(d,u){insert(d,n,u),mount_component(e,n,null),r=!0},p(d,u){i=d,u&32&&s!==(s=i[5]?"white":"#1a1a1a")&&set_style(n,"--text",s),u&32&&o!==(o=i[5]?"#1a1a1a":"white")&&set_style(n,"--bg",o);const h={};u&1&&(h.name=i[13]),e.$set(h)},i(d){r||(transition_in(e.$$.fragment,d),r=!0)},o(d){transition_out(e.$$.fragment,d),r=!1},d(d){d&&detach(n),destroy_component(e,d)}}}function create_if_block_2$4(i){let e,n,s,o;function r(){return i[8](i[13])}return{c(){e=element("plant-button"),set_custom_element_data(e,"name",n=i[13])},m(c,d){insert(c,e,d),s||(o=listen(e,"click",r),s=!0)},p(c,d){i=c,d&1&&n!==(n=i[13])&&set_custom_element_data(e,"name",n)},i:noop,o:noop,d(c){c&&detach(e),s=!1,o()}}}function create_each_block$9(i){let e,n,s,o,r;const c=[create_if_block_2$4,create_else_block$5],d=[];function u(h,f){return h[4]?0:1}return n=u(i),s=d[n]=c[n](i),{c(){e=element("div"),s.c(),o=space(),attr(e,"class","button-spacer svelte-bnz79m")},m(h,f){insert(h,e,f),d[n].m(e,null),append(e,o),r=!0},p(h,f){let m=n;n=u(h),n===m?d[n].p(h,f):(group_outros(),transition_out(d[m],1,1,()=>{d[m]=null}),check_outros(),s=d[n],s?s.p(h,f):(s=d[n]=c[n](h),s.c()),transition_in(s,1),s.m(e,o))},i(h){r||(transition_in(s),r=!0)},o(h){transition_out(s),r=!1},d(h){h&&detach(e),d[n].d()}}}function create_fragment$o(i){let e,n,s=i[0]&&create_if_block$b(i);return{c(){s&&s.c(),e=empty()},m(o,r){s&&s.m(o,r),insert(o,e,r),n=!0},p(o,[r]){o[0]?s?(s.p(o,r),r&1&&transition_in(s,1)):(s=create_if_block$b(o),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(o){n||(transition_in(s),n=!0)},o(o){transition_out(s),n=!1},d(o){s&&s.d(o),o&&detach(e)}}}function instance$l(i,e,n){let s,o,{toast:r}=e,c=!1,d=!1;function u(){if(r.type===MessageType$1.ERROR)return"warning";if(r.type===MessageType$1.SUCCESS)return"checkmark";if(r.type===MessageType$1.WARNING)return"exclamation"}let h=!1,f;onMount(()=>{setTimeout(()=>{n(2,c=!0)},10)});const m=()=>{n(3,d=!d)},_=b=>r.resolve(b),g=b=>r.resolve(b),v=()=>r.reject();function y(b){binding_callbacks[b?"unshift":"push"](()=>{f=b,n(1,f)})}return i.$$set=b=>{"toast"in b&&n(0,r=b.toast)},i.$$.update=()=>{i.$$.dirty&1&&n(6,s=r&&u()),i.$$.dirty&1&&n(5,o=r&&(r.type==="success"||r.type==="warning")),i.$$.dirty&2&&n(4,h=f&&!f.parentElement)},[r,f,c,d,h,o,s,m,_,g,v,y]}class Toast extends SvelteComponent{constructor(e){super();init(this,e,instance$l,create_fragment$o,safe_not_equal,{toast:0})}}var ToastWrapper_svelte_svelte_type_style_lang="";function get_each_context$8(i,e,n){const s=i.slice();return s[4]=e[n],s}function create_else_block$4(i){let e,n;return e=new Toast({props:{toast:i[4]}}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&4&&(r.toast=s[4]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_if_block$a(i){let e,n;return{c(){e=element("plant-toast"),set_custom_element_data(e,"toast",n=i[4])},m(s,o){insert(s,e,o)},p(s,o){o&4&&n!==(n=s[4])&&set_custom_element_data(e,"toast",n)},i:noop,o:noop,d(s){s&&detach(e)}}}function create_each_block$8(i,e){let n,s,o,r,c,d;const u=[create_if_block$a,create_else_block$4],h=[];function f(m,_){return m[0]?0:1}return s=f(e),o=h[s]=u[s](e),{key:i,first:null,c(){n=element("div"),o.c(),r=space(),this.first=n},m(m,_){insert(m,n,_),h[s].m(n,null),append(n,r),d=!0},p(m,_){e=m;let g=s;s=f(e),s===g?h[s].p(e,_):(group_outros(),transition_out(h[g],1,1,()=>{h[g]=null}),check_outros(),o=h[s],o?o.p(e,_):(o=h[s]=u[s](e),o.c()),transition_in(o,1),o.m(n,r))},i(m){d||(transition_in(o),add_render_callback(()=>{c||(c=create_bidirectional_transition(n,slide,{easing:backInOut},!0)),c.run(1)}),d=!0)},o(m){transition_out(o),c||(c=create_bidirectional_transition(n,slide,{easing:backInOut},!1)),c.run(0),d=!1},d(m){m&&detach(n),h[s].d(),m&&c&&c.end()}}}function create_fragment$n(i){let e,n=[],s=new Map,o,r=i[2];const c=d=>d[4].id;for(let d=0;d<r.length;d+=1){let u=get_each_context$8(i,r,d),h=c(u);s.set(h,n[d]=create_each_block$8(h,u))}return{c(){e=element("div");for(let d=0;d<n.length;d+=1)n[d].c();attr(e,"id","toast-wrapper"),attr(e,"class","svelte-1ujlok7")},m(d,u){insert(d,e,u);for(let h=0;h<n.length;h+=1)n[h].m(e,null);i[3](e),o=!0},p(d,[u]){u&5&&(r=d[2],group_outros(),n=update_keyed_each(n,u,c,1,d,r,s,e,outro_and_destroy_block,create_each_block$8,null,get_each_context$8),check_outros())},i(d){if(!o){for(let u=0;u<r.length;u+=1)transition_in(n[u]);o=!0}},o(d){for(let u=0;u<n.length;u+=1)transition_out(n[u]);o=!1},d(d){d&&detach(e);for(let u=0;u<n.length;u+=1)n[u].d();i[3](null)}}}function instance$k(i,e,n){let s;component_subscribe(i,store$2,d=>n(2,s=d));let o=!1,r;onMount(function(){n(0,o=!r.parentElement)});function c(d){binding_callbacks[d?"unshift":"push"](()=>{r=d,n(1,r)})}return[o,r,s,c]}class ToastWrapper extends SvelteComponent{constructor(e){super();init(this,e,instance$k,create_fragment$n,safe_not_equal,{})}}var InputCheckbox_svelte_svelte_type_style_lang="";function create_fragment$m(i){let e,n,s,o,r,c,d,u,h,f,m;return{c(){e=element("div"),n=element("input"),s=space(),o=element("label"),r=svg_element("svg"),c=svg_element("title"),d=text("cross"),u=svg_element("line"),h=svg_element("line"),attr(n,"type","checkbox"),attr(n,"id",i[1]),attr(n,"class","svelte-1r80sp7"),attr(c,"class","svelte-1r80sp7"),attr(u,"vector-effect","non-scaling-stroke"),attr(u,"x1","0"),attr(u,"y1","100"),attr(u,"x2","100"),attr(u,"y2","0"),attr(u,"class","svelte-1r80sp7"),attr(h,"vector-effect","non-scaling-stroke"),attr(h,"x1","0"),attr(h,"y1","0"),attr(h,"x2","100"),attr(h,"y2","100"),attr(h,"class","svelte-1r80sp7"),attr(r,"xmlns","http://www.w3.org/2000/svg"),attr(r,"viewBox","0 0 100 100"),attr(r,"class","svelte-1r80sp7"),attr(o,"class","checkbox-label svelte-1r80sp7"),attr(o,"for",i[1]),attr(e,"class","component-wrapper svelte-1r80sp7")},m(_,g){insert(_,e,g),append(e,n),n.checked=i[0],append(e,s),append(e,o),append(o,r),append(r,c),append(c,d),append(r,u),append(r,h),f||(m=listen(n,"change",i[2]),f=!0)},p(_,[g]){g&2&&attr(n,"id",_[1]),g&1&&(n.checked=_[0]),g&2&&attr(o,"for",_[1])},i:noop,o:noop,d(_){_&&detach(e),f=!1,m()}}}function instance$j(i,e,n){const s=createEventDispatcher();let{value:o=!1}=e,{id:r=shortid()}=e;function c(){o=this.checked,n(0,o)}return i.$$set=d=>{"value"in d&&n(0,o=d.value),"id"in d&&n(1,r=d.id)},i.$$.update=()=>{i.$$.dirty&1&&o!==void 0&&s("change",!!o)},[o,r,c]}class InputCheckbox extends SvelteComponent{constructor(e){super();init(this,e,instance$j,create_fragment$m,safe_not_equal,{value:0,id:1})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get id(){return this.$$.ctx[1]}set id(e){this.$$set({id:e}),flush()}}var InputColor_svelte_svelte_type_style_lang="",InputCurve_svelte_svelte_type_style_lang="";function get_each_context$7(i,e,n){const s=i.slice();return s[19]=e[n],s[21]=n,s}function get_each_context_1(i,e,n){const s=i.slice();return s[19]=e[n],s}function create_each_block_1(i){let e,n,s,o,r;function c(){return i[10](i[19])}return{c(){e=svg_element("circle"),attr(e,"cx",n=i[19].x*100),attr(e,"cy",s=i[19].y*100),attr(e,"r","2"),attr(e,"class","svelte-rytqgf"),toggle_class(e,"pinned",i[19].pinned)},m(d,u){insert(d,e,u),o||(r=listen(e,"mousedown",c),o=!0)},p(d,u){i=d,u&1&&n!==(n=i[19].x*100)&&attr(e,"cx",n),u&1&&s!==(s=i[19].y*100)&&attr(e,"cy",s),u&1&&toggle_class(e,"pinned",i[19].pinned)},d(d){d&&detach(e),o=!1,r()}}}function create_if_block$9(i){let e,n,s,o,r;return{c(){e=svg_element("line"),attr(e,"x1",n=i[3][i[21]-1].x*100),attr(e,"y1",s=i[3][i[21]-1].y*100),attr(e,"x2",o=i[19].x*100),attr(e,"y2",r=i[19].y*100),attr(e,"class","svelte-rytqgf")},m(c,d){insert(c,e,d)},p:noop,d(c){c&&detach(e)}}}function create_each_block$7(i){let e,n,s,o=i[21]>0&&i[21]%2==0&&create_if_block$9(i);return{c(){o&&o.c(),e=svg_element("circle"),attr(e,"cx",n=i[19].x*100),attr(e,"cy",s=i[19].y*100),attr(e,"r","1"),attr(e,"class","svelte-rytqgf"),toggle_class(e,"pinned",i[19].pinned)},m(r,c){o&&o.m(r,c),insert(r,e,c)},p(r,c){r[21]>0&&r[21]%2==0&&o.p(r,c)},d(r){o&&o.d(r),r&&detach(e)}}}function create_fragment$l(i){let e,n,s,o,r,c,d=i[0],u=[];for(let m=0;m<d.length;m+=1)u[m]=create_each_block_1(get_each_context_1(i,d,m));let h=i[3],f=[];for(let m=0;m<h.length;m+=1)f[m]=create_each_block$7(get_each_context$7(i,h,m));return{c(){e=element("div"),n=svg_element("svg"),s=svg_element("path");for(let m=0;m<u.length;m+=1)u[m].c();o=svg_element("g");for(let m=0;m<f.length;m+=1)f[m].c();attr(s,"d",i[2]),attr(s,"fill","none"),attr(s,"stroke","grey"),attr(s,"class","svelte-rytqgf"),attr(o,"id","debug"),attr(o,"class","svelte-rytqgf"),attr(n,"viewBox","0 0 100 100"),attr(n,"width","100"),attr(n,"height","100"),attr(n,"class","svelte-rytqgf"),attr(e,"class","component-wrapper svelte-rytqgf")},m(m,_){insert(m,e,_),append(e,n),append(n,s);for(let g=0;g<u.length;g+=1)u[g].m(n,null);append(n,o);for(let g=0;g<f.length;g+=1)f[g].m(o,null);r||(c=[listen(n,"mousedown",i[5]),listen(n,"mousemove",i[4]),listen(n,"mouseover",i[7]),listen(n,"mouseout",i[8]),listen(n,"mouseup",i[6]),listen(n,"focus",i[7]),listen(n,"blur",i[8])],r=!0)},p(m,[_]){if(_&4&&attr(s,"d",m[2]),_&3){d=m[0];let g;for(g=0;g<d.length;g+=1){const v=get_each_context_1(m,d,g);u[g]?u[g].p(v,_):(u[g]=create_each_block_1(v),u[g].c(),u[g].m(n,o))}for(;g<u.length;g+=1)u[g].d(1);u.length=d.length}if(_&8){h=m[3];let g;for(g=0;g<h.length;g+=1){const v=get_each_context$7(m,h,g);f[g]?f[g].p(v,_):(f[g]=create_each_block$7(v),f[g].c(),f[g].m(o,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=h.length}},i:noop,o:noop,d(m){m&&detach(e),destroy_each(u,m),destroy_each(f,m),r=!1,run_all(c)}}}function instance$i(i,e,n){let s,o;const r=createEventDispatcher();let{value:c=[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}=e,d=!1,u,h,f=0,m=0,_=[];const g=()=>{requestAnimationFrame(()=>{r("change",s),n(0,s=s.sort((x,T)=>x.x>T.x?-1:1))})},v=x=>{x.pinned||(s.splice(s.indexOf(u),1),g())},y=x=>{d&&(f=x.offsetX,m=x.offsetY,u&&(h=u,n(1,u=void 0)),h&&(h.x=f/100,h.y=m/100,g()))},b=()=>{if(!u){const x={x:f/100,y:m/100,pinned:!1};n(1,u=x),s.push(u),g()}},w=()=>{u&&(v(u),n(1,u=void 0)),h=void 0},S=()=>{d=!0},k=()=>{d=!1};function $(x){const T=monotoneCubicSpline.points(x.map(j=>[j.x*100,j.y*100]));return monotoneCubicSpline.svgPath(T)}const P=x=>{n(1,u=x)};return i.$$set=x=>{"value"in x&&n(9,c=x.value)},i.$$.update=()=>{i.$$.dirty&512&&n(0,s=c),i.$$.dirty&1&&n(2,o=$(s))},[s,u,o,_,y,b,w,S,k,c,P]}class InputCurve extends SvelteComponent{constructor(e){super();init(this,e,instance$i,create_fragment$l,safe_not_equal,{value:9})}get value(){return this.$$.ctx[9]}set value(e){this.$$set({value:e}),flush()}}var InputInteger_svelte_svelte_type_style_lang="";function create_if_block$8(i){let e,n;return{c(){e=element("span"),attr(e,"class","overlay svelte-bolkyu"),attr(e,"style",n=`width: ${(i[0]-i[1])/(i[2]-i[1])*100}%`)},m(s,o){insert(s,e,o)},p(s,o){o&7&&n!==(n=`width: ${(s[0]-s[1])/(s[2]-s[1])*100}%`)&&attr(e,"style",n)},d(s){s&&detach(e)}}}function create_fragment$k(i){let e,n,s,o,r,c,d,u,h,f,m=typeof i[1]!="undefined"&&typeof i[2]!="undefined"&&create_if_block$8(i);return{c(){e=element("div"),m&&m.c(),n=space(),s=element("button"),s.textContent="-",o=space(),r=element("input"),d=space(),u=element("button"),u.textContent="+",attr(s,"class","svelte-bolkyu"),attr(r,"step",i[3]),attr(r,"max",i[2]),attr(r,"min",i[1]),attr(r,"type","number"),attr(r,"style",c=`width:${i[5]};`),attr(r,"class","svelte-bolkyu"),attr(u,"class","svelte-bolkyu"),attr(e,"class","component-wrapper svelte-bolkyu")},m(_,g){insert(_,e,g),m&&m.m(e,null),append(e,n),append(e,s),append(e,o),append(e,r),set_input_value(r,i[0]),i[11](r),append(e,d),append(e,u),h||(f=[listen(s,"click",i[9]),listen(r,"input",i[10]),listen(r,"mousedown",i[7]),listen(r,"mouseup",i[8]),listen(u,"click",i[12])],h=!0)},p(_,[g]){typeof _[1]!="undefined"&&typeof _[2]!="undefined"?m?m.p(_,g):(m=create_if_block$8(_),m.c(),m.m(e,n)):m&&(m.d(1),m=null),g&8&&attr(r,"step",_[3]),g&4&&attr(r,"max",_[2]),g&2&&attr(r,"min",_[1]),g&32&&c!==(c=`width:${_[5]};`)&&attr(r,"style",c),g&1&&to_number(r.value)!==_[0]&&set_input_value(r,_[0])},i:noop,o:noop,d(_){_&&detach(e),m&&m.d(),i[11](null),h=!1,run_all(f)}}}function instance$h(i,e,n){let s,o;const r=createEventDispatcher();let{min:c=-1/0}=e,{max:d=1/0}=e,{step:u=1}=e,{value:h=0}=e,f;function m(x){n(0,h=Math.max(c,Math.min(+h+x,d)))}let _=0,g=0,v;function y(x){x.preventDefault(),g=h,_=x.clientX,v=f.getBoundingClientRect(),window.removeEventListener("mousemove",w),window.addEventListener("mousemove",w),window.addEventListener("mouseup",b),document.body.style.cursor="ew-resize"}function b(){g===h?f.focus():f.blur(),document.body.style.cursor="unset",window.removeEventListener("mouseup",b),window.removeEventListener("mousemove",w)}function w(x){if(s){const T=(x.clientX-v.left)/v.width;n(0,h=Math.max(Math.min(Math.floor(c+(d-c)*T),d),c))}else{const T=x.clientX-_;n(0,h=g+Math.floor(T/10))}}const S=()=>m(-u);function k(){h=to_number(this.value),n(0,h)}function $(x){binding_callbacks[x?"unshift":"push"](()=>{f=x,n(4,f)})}const P=()=>m(+u);return i.$$set=x=>{"min"in x&&n(1,c=x.min),"max"in x&&n(2,d=x.max),"step"in x&&n(3,u=x.step),"value"in x&&n(0,h=x.value)},i.$$.update=()=>{var x;i.$$.dirty&6&&(s=typeof c!="undefined"&&typeof d!="undefined"&&Number.isFinite(c)&&Number.isFinite(d)),i.$$.dirty&1&&h!==void 0&&r("change",parseFloat(h+"")),i.$$.dirty&1&&n(5,o=Number.isFinite(h)?Math.max(((x=h==null?void 0:h.toString().length)!=null?x:1)*8,30)+"px":"20px")},[h,c,d,u,f,o,m,y,b,S,k,$,P]}class InputInteger extends SvelteComponent{constructor(e){super();init(this,e,instance$h,create_fragment$k,safe_not_equal,{min:1,max:2,step:3,value:0})}get min(){return this.$$.ctx[1]}set min(e){this.$$set({min:e}),flush()}get max(){return this.$$.ctx[2]}set max(e){this.$$set({max:e}),flush()}get step(){return this.$$.ctx[3]}set step(e){this.$$set({step:e}),flush()}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}}var InputFloat_svelte_svelte_type_style_lang="";function create_fragment$j(i){let e,n,s,o,r,c,d,u;return{c(){e=element("div"),n=element("span"),o=space(),r=element("input"),attr(n,"class","overlay svelte-mh6l3o"),attr(n,"style",s=`width: ${(i[0]-i[2])/(i[3]-i[2])*100}%`),attr(r,"step",i[1]),attr(r,"max",i[3]),attr(r,"min",i[2]),attr(r,"type","number"),attr(r,"style",c=`width:${i[6]};`),attr(r,"class","svelte-mh6l3o"),attr(e,"class","component-wrapper svelte-mh6l3o"),toggle_class(e,"is-down",i[5])},m(h,f){insert(h,e,f),append(e,n),append(e,o),append(e,r),set_input_value(r,i[0]),i[10](r),d||(u=[listen(r,"input",i[9]),listen(r,"mousedown",i[7]),listen(r,"mouseup",i[8])],d=!0)},p(h,[f]){f&13&&s!==(s=`width: ${(h[0]-h[2])/(h[3]-h[2])*100}%`)&&attr(n,"style",s),f&2&&attr(r,"step",h[1]),f&8&&attr(r,"max",h[3]),f&4&&attr(r,"min",h[2]),f&64&&c!==(c=`width:${h[6]};`)&&attr(r,"style",c),f&1&&to_number(r.value)!==h[0]&&set_input_value(r,h[0]),f&32&&toggle_class(e,"is-down",h[5])},i:noop,o:noop,d(h){h&&detach(e),i[10](null),d=!1,run_all(u)}}}function strip(i){return parseFloat(i).toPrecision(2)}function instance$g(i,e,n){let s,{value:o=.5}=e,{step:r=.01}=e,{min:c=0}=e,{max:d=1}=e;const u=createEventDispatcher();let h,f=!1,m=0,_=0,g=0,v;function y($){$.preventDefault(),n(5,f=!0),_=o,m=$.clientY,v=h.getBoundingClientRect(),window.removeEventListener("mousemove",w),window.addEventListener("mousemove",w),window.addEventListener("mouseup",b),document.body.style.cursor="ew-resize"}function b(){n(5,f=!1),_===o&&h.focus(),document.body.style.cursor="unset",window.removeEventListener("mouseup",b),window.removeEventListener("mousemove",w)}function w($){g=($.clientX-v.left)/v.width,$.clientY-m,n(0,o=Math.max(Math.min(c+(d-c)*g,d),c))}function S(){o=to_number(this.value),n(0,o)}function k($){binding_callbacks[$?"unshift":"push"](()=>{h=$,n(4,h)})}return i.$$set=$=>{"value"in $&&n(0,o=$.value),"step"in $&&n(1,r=$.step),"min"in $&&n(2,c=$.min),"max"in $&&n(3,d=$.max)},i.$$.update=()=>{var $;i.$$.dirty&1&&o.toString().length>15&&n(0,o=strip(o)),i.$$.dirty&1&&o!==void 0&&u("change",parseFloat(o+"")),i.$$.dirty&1&&n(6,s=Number.isFinite(o)?Math.max((($=o==null?void 0:o.toString().length)!=null?$:1)*8,50)+"px":"20px")},[o,r,c,d,h,f,s,y,b,S,k]}class InputFloat extends SvelteComponent{constructor(e){super();init(this,e,instance$g,create_fragment$j,safe_not_equal,{value:0,step:1,min:2,max:3})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get step(){return this.$$.ctx[1]}set step(e){this.$$set({step:e}),flush()}get min(){return this.$$.ctx[2]}set min(e){this.$$set({min:e}),flush()}get max(){return this.$$.ctx[3]}set max(e){this.$$set({max:e}),flush()}}var InputSelect_svelte_svelte_type_style_lang="";function get_each_context$6(i,e,n){const s=i.slice();return s[11]=e[n],s}function create_else_block$3(i){let e,n,s;return{c(){e=element("div"),e.textContent="none",attr(e,"id","selected-value"),attr(e,"class","svelte-11xg3i7")},m(o,r){insert(o,e,r),n||(s=listen(e,"click",i[4]),n=!0)},p:noop,d(o){o&&detach(e),n=!1,s()}}}function create_if_block_1$5(i){let e,n,s,o;return{c(){e=element("div"),n=text(i[0]),attr(e,"id","selected-value"),attr(e,"class","svelte-11xg3i7")},m(r,c){insert(r,e,c),append(e,n),s||(o=listen(e,"click",i[4]),s=!0)},p(r,c){c&1&&set_data(n,r[0])},d(r){r&&detach(e),s=!1,o()}}}function create_if_block$7(i){let e,n=i[11]+"",s,o,r,c,d;function u(){return i[8](i[11])}return{c(){e=element("p"),s=text(n),o=space(),attr(e,"style",r=`opacity: ${i[11]===i[0]?.5:1}`),attr(e,"class","item svelte-11xg3i7")},m(h,f){insert(h,e,f),append(e,s),append(e,o),c||(d=listen(e,"click",u),c=!0)},p(h,f){i=h,f&2&&n!==(n=i[11]+"")&&set_data(s,n),f&3&&r!==(r=`opacity: ${i[11]===i[0]?.5:1}`)&&attr(e,"style",r)},d(h){h&&detach(e),c=!1,d()}}}function create_each_block$6(i){let e,n=i[11]!==i[0]&&create_if_block$7(i);return{c(){n&&n.c(),e=empty()},m(s,o){n&&n.m(s,o),insert(s,e,o)},p(s,o){s[11]!==s[0]?n?n.p(s,o):(n=create_if_block$7(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){n&&n.d(s),s&&detach(e)}}}function create_fragment$i(i){let e,n,s,o;function r(f,m){return f[0]!==void 0?create_if_block_1$5:create_else_block$3}let c=r(i),d=c(i),u=i[1],h=[];for(let f=0;f<u.length;f+=1)h[f]=create_each_block$6(get_each_context$6(i,u,f));return{c(){e=element("div"),n=element("div"),d.c(),s=space(),o=element("div");for(let f=0;f<h.length;f+=1)h[f].c();attr(o,"id","item-wrapper"),attr(o,"class","svelte-11xg3i7"),attr(n,"id","main"),attr(n,"class","svelte-11xg3i7"),attr(e,"class","component-wrapper svelte-11xg3i7"),toggle_class(e,"open",i[2])},m(f,m){insert(f,e,m),append(e,n),d.m(n,null),append(n,s),append(n,o);for(let _=0;_<h.length;_+=1)h[_].m(o,null);i[9](n)},p(f,[m]){if(c===(c=r(f))&&d?d.p(f,m):(d.d(1),d=c(f),d&&(d.c(),d.m(n,s))),m&35){u=f[1];let _;for(_=0;_<u.length;_+=1){const g=get_each_context$6(f,u,_);h[_]?h[_].p(g,m):(h[_]=create_each_block$6(g),h[_].c(),h[_].m(o,null))}for(;_<h.length;_+=1)h[_].d(1);h.length=u.length}m&4&&toggle_class(e,"open",f[2])},i:noop,o:noop,d(f){f&&detach(e),d.d(),destroy_each(h,f),i[9](null)}}}function instance$f(i,e,n){const s=createEventDispatcher();let{value:o=void 0}=e,r=!1,c;function d(){n(2,r=!0),setTimeout(()=>{document.addEventListener("click",()=>{n(2,r=!1)},{once:!0})},50)}function u(v){n(0,o=v),n(2,r=!1)}let{values:h=[]}=e;function f(v){n(1,h=v)}function m(v){n(0,o=v)}const _=v=>u(v);function g(v){binding_callbacks[v?"unshift":"push"](()=>{c=v,n(3,c)})}return i.$$set=v=>{"value"in v&&n(0,o=v.value),"values"in v&&n(1,h=v.values)},i.$$.update=()=>{i.$$.dirty&1&&o&&s("change",o)},[o,h,r,c,d,u,f,m,_,g]}class InputSelect extends SvelteComponent{constructor(e){super();init(this,e,instance$f,create_fragment$i,safe_not_equal,{value:0,values:1,setItems:6,setValue:7})}get value(){return this.$$.ctx[0]}set value(e){this.$$set({value:e}),flush()}get values(){return this.$$.ctx[1]}set values(e){this.$$set({values:e}),flush()}get setItems(){return this.$$.ctx[6]}get setValue(){return this.$$.ctx[7]}}var InputShape_svelte_svelte_type_style_lang="";function get_each_context$5(i,e,n){const s=i.slice();return s[19]=e[n],s}function create_each_block$5(i){let e,n,s,o,r;function c(){return i[9](i[19])}return{c(){e=svg_element("circle"),attr(e,"cx",n=i[19].x*100),attr(e,"cy",s=i[19].y*200-50),attr(e,"r","4"),attr(e,"class","svelte-qu578u"),toggle_class(e,"pinned",i[19].pinned)},m(d,u){insert(d,e,u),o||(r=listen(e,"mousedown",c),o=!0)},p(d,u){i=d,u&1&&n!==(n=i[19].x*100)&&attr(e,"cx",n),u&1&&s!==(s=i[19].y*200-50)&&attr(e,"cy",s),u&1&&toggle_class(e,"pinned",i[19].pinned)},d(d){d&&detach(e),o=!1,r()}}}function create_fragment$h(i){let e,n,s,o,r,c,d,u,h,f,m,_,g=i[0],v=[];for(let y=0;y<g.length;y+=1)v[y]=create_each_block$5(get_each_context$5(i,g,y));return{c(){e=element("div"),n=svg_element("svg"),s=svg_element("path");for(let y=0;y<v.length;y+=1)v[y].c();o=space(),r=svg_element("svg"),c=svg_element("defs"),d=svg_element("linearGradient"),u=svg_element("stop"),h=svg_element("stop"),f=svg_element("path"),attr(s,"d",i[2]),attr(s,"fill","none"),attr(s,"stroke","#65E2A0"),attr(s,"class","svelte-qu578u"),attr(n,"viewBox","0 0 100 100"),attr(n,"width","50"),attr(n,"height","100"),attr(n,"class","svelte-qu578u"),attr(u,"offset","0%"),set_style(u,"stop-color","#65E2A0"),set_style(u,"stop-opacity","1"),attr(u,"class","svelte-qu578u"),attr(h,"offset","100%"),set_style(h,"stop-color","#469C6E"),set_style(h,"stop-opacity","1"),attr(h,"class","svelte-qu578u"),attr(d,"id","grad1"),attr(d,"x1","0%"),attr(d,"y1","0%"),attr(d,"x2","100%"),attr(d,"y2","0%"),attr(d,"class","svelte-qu578u"),attr(c,"class","svelte-qu578u"),attr(f,"d",i[2]),attr(f,"fill","url(#grad1)"),attr(f,"stroke","grey"),attr(f,"class","svelte-qu578u"),attr(r,"id","right"),attr(r,"viewBox","0 0 100 100"),attr(r,"width","50"),attr(r,"height","100"),attr(r,"class","svelte-qu578u"),attr(e,"class","component-wrapper svelte-qu578u")},m(y,b){insert(y,e,b),append(e,n),append(n,s);for(let w=0;w<v.length;w+=1)v[w].m(n,null);append(e,o),append(e,r),append(r,c),append(c,d),append(d,u),append(d,h),append(r,f),m||(_=[listen(n,"mousedown",i[4]),listen(n,"mousemove",i[3]),listen(n,"mouseover",i[6]),listen(n,"mouseout",i[7]),listen(n,"mouseup",i[5]),listen(n,"focus",i[6]),listen(n,"blur",i[7])],m=!0)},p(y,[b]){if(b&4&&attr(s,"d",y[2]),b&3){g=y[0];let w;for(w=0;w<g.length;w+=1){const S=get_each_context$5(y,g,w);v[w]?v[w].p(S,b):(v[w]=create_each_block$5(S),v[w].c(),v[w].m(n,null))}for(;w<v.length;w+=1)v[w].d(1);v.length=g.length}b&4&&attr(f,"d",y[2])},i:noop,o:noop,d(y){y&&detach(e),destroy_each(v,y),m=!1,run_all(_)}}}function instance$e(i,e,n){let s,o;const r=createEventDispatcher();let{value:c=[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}=e,d=!1,u,h,f=0,m=0;const _=()=>{requestAnimationFrame(()=>{r("change",s),n(0,s=s.sort((x,T)=>x.y>T.y?-1:1))})},g=x=>{x.pinned||(s.splice(s.indexOf(u),1),_())},v=x=>{d&&(f=x.offsetX,m=x.offsetY,u&&(h=u,n(1,u=void 0)),h&&(h.x=f/50,h.y=m/100,_()))},y=()=>{if(!u){const x={x:f/50,y:m/100,pinned:!1};n(1,u=x),s.push(u),_()}},b=()=>{u&&(g(u),n(1,u=void 0)),h=void 0},w=()=>{d=!0},S=()=>{d=!1},k=x=>`L ${x.x*100} ${x.y*200-50}`;function $(x){return x.reduce((T,j,V)=>V===0?`M ${j.x*100},${j.y*200-50}`:`${T} ${k(j)}`,"")}const P=x=>{n(1,u=x)};return i.$$set=x=>{"value"in x&&n(8,c=x.value)},i.$$.update=()=>{i.$$.dirty&256&&n(0,s=c),i.$$.dirty&1&&n(2,o=$(s))},[s,u,o,v,y,b,w,S,c,P]}class InputShape extends SvelteComponent{constructor(e){super();init(this,e,instance$e,create_fragment$h,safe_not_equal,{value:8})}get value(){return this.$$.ctx[8]}set value(e){this.$$set({value:e}),flush()}}var InputSlider_svelte_svelte_type_style_lang="",Section_svelte_svelte_type_style_lang="";function create_if_block$6(i){let e,n,s;return{c(){e=element("div"),n=element("p"),s=text(i[1]),attr(n,"class","svelte-1aw08v2"),attr(e,"class","border svelte-1aw08v2")},m(o,r){insert(o,e,r),append(e,n),append(n,s)},p(o,r){r&2&&set_data(s,o[1])},d(o){o&&detach(e)}}}function create_fragment$g(i){let e,n,s,o,r,c,d,u,h,f,m=i[1]&&create_if_block$6(i);const _=i[4].default,g=create_slot(_,i,i[3],null);return{c(){e=element("div"),n=element("div"),s=svg_element("svg"),o=svg_element("path"),r=space(),m&&m.c(),c=space(),d=element("div"),g&&g.c(),attr(o,"d","M13.172 12l-4.95-4.95 1.414-1.414L16 12l-6.364 6.364-1.414-1.414z"),attr(o,"class","svelte-1aw08v2"),attr(s,"xmlns","http://www.w3.org/2000/svg"),attr(s,"viewBox","0 0 24 24"),attr(s,"width","24"),attr(s,"height","24"),attr(s,"class","svelte-1aw08v2"),attr(n,"class","header svelte-1aw08v2"),attr(d,"class","content svelte-1aw08v2"),attr(e,"class","wrapper svelte-1aw08v2"),toggle_class(e,"open",i[0])},m(v,y){insert(v,e,y),append(e,n),append(n,s),append(s,o),append(n,r),m&&m.m(n,null),append(e,c),append(e,d),g&&g.m(d,null),u=!0,h||(f=listen(n,"click",i[2]),h=!0)},p(v,[y]){v[1]?m?m.p(v,y):(m=create_if_block$6(v),m.c(),m.m(n,null)):m&&(m.d(1),m=null),g&&g.p&&(!u||y&8)&&update_slot_base(g,_,v,v[3],u?get_slot_changes(_,v[3],y,null):get_all_dirty_from_scope(v[3]),null),y&1&&toggle_class(e,"open",v[0])},i(v){u||(transition_in(g,v),u=!0)},o(v){transition_out(g,v),u=!1},d(v){v&&detach(e),m&&m.d(),g&&g.d(v),h=!1,f()}}}function instance$d(i,e,n){let{$$slots:s={},$$scope:o}=e;const r=createEventDispatcher();let{open:c=!1}=e,{name:d=""}=e;const u=()=>{n(0,c=!c),r("toggle",c)};return i.$$set=h=>{"open"in h&&n(0,c=h.open),"name"in h&&n(1,d=h.name),"$$scope"in h&&n(3,o=h.$$scope)},[c,d,u,o,s]}class Section extends SvelteComponent{constructor(e){super();init(this,e,instance$d,create_fragment$g,safe_not_equal,{open:0,name:1})}}function stateToElement({target:i,template:e,value:n}){n===void 0&&"value"in e&&(n=e.value);const s=stateToComponent(e,n),o=A({},e);return delete o.type,delete o.inputType,delete o.defaultValue,delete o.internal,o.value=n,new s({target:i,props:z(A({},o),{"--width":"100%"})})}function stateToComponent(i,e){return i.inputType==="select"||Array.isArray(i.values)?InputSelect:i.inputType==="curve"?InputCurve:i.inputType==="shape"?InputShape:i.type==="number"||typeof e=="number"?i.step&&i.step%1!=0?InputFloat:InputInteger:InputCheckbox}function applyTransformation(i,e=[0,0,0],n=[0,0,0],s=[1,1,1]){const o=new Float32Array(i.position.length),r=i.position.length,c=i.position;for(let d=0;d<r;d+=3){const u=c[d+0]*s[0],h=c[d+1]*s[1],f=c[d+2]*s[2],m=u,_=Math.cos(n[0])*h-Math.sin(n[0])*f,g=Math.sin(n[0])*h+Math.cos(n[0])*f,v=Math.cos(n[1])*m-Math.sin(n[1])*g,y=_,b=Math.sin(n[1])*m+Math.cos(n[1])*g;o[d+0]=v+e[0],o[d+1]=y+e[1],o[d+2]=b+e[2]}return{position:o,uv:i.uv,normal:i.normal,index:i.index}}function convertInstancedGeometry(i){const e=[],n={position:i.position,normal:i.position,uv:i.uv,index:i.index},s=i.offset,o=i.rotation,r=i.scale,c=i.offset.length;for(let d=0;d<c;d+=3)e.push(applyTransformation(n,[s[d+0],s[d+1],s[d+2]],[o[d+0],o[d+1],o[d+2]],[r[d+0],r[d+1],r[d+2]]));return e}function createCircle(i){const e=2*Math.PI/i;return new Array(i).fill(null).map((s,o)=>[Math.cos(e*o),Math.sin(e*o)])}function createIndeces(i,e){const n=new Uint16Array(i*(e-1)*6);for(let s=0;s<e;s++){const o=s*i*6,r=s*i;for(let c=0;c<i;c++){const d=o+c*6,u=r+c;n[d+0]=u,n[d+1]=u-i+1,n[d+2]=u+1,n[d+3]=u+1,n[d+4]=u+i,n[d+5]=u,c===i-1?(n[d+0]=u,n[d+1]=u-i+1,n[d+2]=u+1,n[d+3]=u+1,n[d+4]=u+i,n[d+5]=u):(n[d+0]=u,n[d+1]=u+1,n[d+2]=u+i+1,n[d+3]=u+i+1,n[d+4]=u+i,n[d+5]=u)}}return n}function extrudePath(i,e){const n=[],s=[],o=[],r={position:[],index:createIndeces(e,i.length)},c=createCircle(e),d=c.length,u=i.length;for(let h=0;h<u;h++){const f=[0,0,1];h===0?subtract(s,i[h],i[h+1]):h===u-1?subtract(s,i[h-1],i[h]):subtract(s,i[h-1],i[h+1]),normalize(s,s),cross$1(o,f,s);const m=Math.acos(dot(f,s));identity(n),rotate(n,n,m,o);for(let _=0;_<d;_++){const g=c[_],v=[g[0],g[1],0],y=i[h][3];mul(v,v,[y,y,1]),transformMat4(v,v,n),add$1(v,v,i[h]),r.position.push(v)}}return r}function lerp(i,e,n){return i*(1-n)+e*n}function interpolateArray(i,e=0){const n=(i.length-1)*e,s=Math.floor(n),o=Math.ceil(n);return lerp(i[o],i[s],o-n)}function interpolateSkeleton(i,e){const n=(i.length/4-1)*e,s=Math.floor(n),o=Math.ceil(n),r=o-n;return[lerp(i[o*4+0],i[s*4+0],r),lerp(i[o*4+1],i[s*4+1],r),lerp(i[o*4+2],i[s*4+2],r),lerp(i[o*4+3],i[s*4+3],r)]}function interpolateSkeletonVec(i,e){const n=(i.length/4-1)*e,s=Math.floor(n),o=Math.ceil(n);return[i[o*4+0]-i[s*4+0],i[o*4+1]-i[s*4+1],i[o*4+2]-i[s*4+2],i[o*4+3]+i[s*4+3]/2]}function join(...i){if(i.length===1)return i[0];const e=new Float32Array(i.reduce((f,m)=>f+m.position.length,0)),n=new Float32Array(i.reduce((f,m)=>f+m.normal.length,0)),s=new Float32Array(i.reduce((f,m)=>f+m.uv.length,0)),o=i.reduce((f,m)=>f+m.index.length,0),r=o>65536?new Uint32Array(o):new Uint16Array(o);let c=0,d=0,u=0,h=0;for(let f=0;f<i.length;f++){const m=i[f].normal,_=m.length;for(let k=0;k<_;k++)n[d+k]=m[k];d+=_;const g=i[f].uv,v=g.length;for(let k=0;k<v;k++)s[u+k]=g[k];u+=v;const y=i[f].index,b=y.length;for(let k=0;k<b;k++)r[k+h]=y[k]+c/3;h+=b;const w=i[f].position,S=w.length;for(let k=0;k<S;k++)e[c+k]=w[k];c+=S}return{position:e,normal:n,uv:s,index:r}}var length2D=(i,e)=>Math.sqrt(i*i+e*e),length3D=(i,e,n)=>Math.sqrt(i*i+e*e+n*n);let seed=0,noise2D=mod.makeNoise2D(seed),noise3D=mod.makeNoise3D(seed);var noise={n1d:i=>noise2D(i,0),n2d:(i,e)=>noise2D(i,e),n3d:(i,e,n)=>noise3D(i,e,n),get seed(){return seed},set seed(i){seed=i,noise2D=mod.makeNoise2D(seed),noise3D=mod.makeNoise3D(seed)}},normalize2D=([i,e])=>{const n=length2D(i,e);return n===0?[1,0]:[i/n,e/n]},normalize3D=(i,e,n)=>{const s=length3D(i,e,n);return[i/s,e/s,n/s]},rotate2D=(i,e,n)=>[i*Math.cos(n)-e*Math.sin(n),i*Math.sin(n)+e*Math.cos(n)];function rotate3D(i,e,n){const[s,o,r]=i,[c,d,u]=normalize3D(e[0],e[1],e[2]),h=Math.cos(n),f=Math.sin(n);return new Vec3((h+(1-h)*c*c)*s+((1-h)*c*d-u*f)*o+((1-h)*c*u+d*f)*r,((1-h)*c*d+u*f)*s+(h+(1-h)*d*d)*o+((1-h)*d*u-c*f)*r,((1-h)*c*u-d*f)*s+((1-h)*d*u+c*f)*o+(h+(1-h)*u*u)*r)}function transferToGeometry(i,e){return new Geometry(i,{position:{size:3,data:e.position},normal:{size:3,data:e.normal},uv:{size:2,data:e.uv},index:{data:e.index}})}const totalSize=100,slopeLength=2,groundHeight=1;function ground(i=1,e=12,n=12){const s=360*(Math.PI/180)/n,o=e*n+1,r=(e-1)*n*2+n,c=new Float32Array(o*3),d=new Float32Array(o*3),u=new Float32Array(o*2),h=new Uint16Array(r*3);c[0]=0,c[1]=1-groundHeight,c[2]=0,d[0]=0,d[1]=1,d[2]=0,u[0]=.5,u[1]=.5;const f=new Array(e-1).fill(null).map((_,g,v)=>i+g/(v.length-1)*slopeLength);f.push(totalSize);const m=f.map(_=>{const g=(Math.max(Math.min(_,i+slopeLength),i)-i)/slopeLength;return Math.sin((g+.5)*Math.PI)/2+.5-groundHeight});for(let _=0;_<e;_++){const g=f[_],v=m[_];for(let y=0;y<n;y++){const b=s*y,w=Math.cos(b)*g,S=v,k=Math.sin(b)*g,P=_*n+y+1;if(c[P*3+0]=w,c[P*3+1]=S,c[P*3+2]=k,d[P*3+0]=0,d[P*3+1]=1,d[P*3+2]=0,u[P*2+0]=w,u[P*2+1]=k,_===0){const x=(P-1)*3;h[x+0]=0,h[x+1]=(y+1)%n+1,h[x+2]=y+1}else if(y===n-1){const x=_*n*6+y*6-n*3;h[x+0]=P,h[x+1]=P+1-n-n,h[x+2]=P+1-n,h[x+3]=P,h[x+4]=P-n,h[x+5]=P+1-n*2}else{const x=_*n*6+y*6-n*3;h[x+0]=P,h[x+1]=P+1-n,h[x+2]=P+1,h[x+3]=P,h[x+4]=P-n,h[x+5]=P+1-n}}}return{position:c,normal:d,uv:u,index:h}}function leaf(i,{res:e=1,xCurvature:n=.5,yCurvature:s=.2}={}){const o=i.length,r=3+e*2,c=r*o,d=(r-1)*(o-1)*2,u=new Float32Array(c*3),h=new Float32Array(c*2),f=new Float32Array(c*2),m=new Uint16Array(d*3);return i.forEach((_,g)=>{const v=g*r;for(let y=0;y<r;y++){const b=2-y/(r-1)*2-1;u[v*3+y*3+0]=(_.x-1)*b*.5;const w=-(1-_.y)*(1-_.y)*.5,S=Math.sin(Math.abs(b)*Math.PI)*.01;if(u[v*3+y*3+1]=S*n+w*s,u[v*3+y*3+2]=_.y-1,f[v*2+y*2+0]=u[v*3+y*3+0]+1/2,f[v*2+y*2+1]=u[v*3+y*3+2],g<i.length-1){const k=g*(r-1);m[k*6+y*6+0]=v+y+0,m[k*6+y*6+1]=v+y+1,m[k*6+y*6+2]=v+y+r,m[k*6+y*6+3]=v+y+1,m[k*6+y*6+4]=v+y+r,m[k*6+y*6+5]=v+y+r+1}}}),{position:u,normal:h,index:m,uv:f}}function tube(i,e=8){const n=groupArray(i,4),s=extrudePath(n,e);return{position:Float32Array.from(s.position.map(r=>r.splice(0,3)).flat()),index:s.index,normal:new Float32Array,uv:new Float32Array}}const node$f={title:"Branches",type:"branch",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},length:{type:["number","parameter","curve"],min:0,max:3,step:.05,value:.8},thiccness:{type:"number",min:0,max:1,step:.01,value:.8},offsetSingle:{type:"number",min:0,max:1,step:.01,value:.5},lowestBranch:{type:"number",min:0,max:1,step:.01,value:.2},amount:{type:"number",min:0,max:64,value:10}},computeSkeleton(i,e){const{skeletons:n}=i.input.result,s=e.getSetting("stemResY"),o=n.map(r=>{const c=[],d=e.handleParameter(i.amount),u=e.handleParameter(i.lowestBranch);for(let h=0;h<d;h++){const f=h/d,m=e.handleParameter(i.length,f)*(1-f),_=e.handleParameter(i.thiccness,f),g=e.handleParameter(i.offsetSingle,f),v=h%2==0;let y=u+(1-u)*f;y-=1/d*g*(v?-1:1);const[b,,w]=interpolateSkeletonVec(r,y),S=normalize2D([b,w]),[k,$]=rotate2D(S[0],S[1],v?-Math.PI/2:Math.PI/2),[P,x,T,j]=interpolateSkeleton(r,y),V=Math.max(Math.floor(s*m*10),4),O=new Float32Array(V*4);for(let B=0;B<V*4;B++){const I=B/V;O[B*4+0]=P+k*I*m,O[B*4+1]=x,O[B*4+2]=T+$*I*m,O[B*4+3]=j*_*(1-I)}c.push(O)}return c}).flat();return{skeletons:o,allSkeletons:[...o,...n]}},computeGeometry(i,e,n){const s=n.getSetting("stemResX"),{geometry:o}=i.input.result,{skeletons:r}=e;return{geometry:join(o,...r.map(c=>tube(c,s)))}}},node$e={title:"Curve",type:"curve",outputs:["number"],parameters:{value:{type:"curve",inputType:"curve",internal:!0,label:!1,value:[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}},computeValue(i,e,n){const s=toArray(i.value).map(o=>o.y);return interpolateArray(s,1-n)}},node$d={title:"Gravity",type:"gravity",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,type:"select",values:["simple","verlet","test"]},strength:{type:"number",inputType:"slider",min:0,max:2,step:.05}},computeSkeleton(i,e){const{input:n,type:s,strength:o}=i,{skeletons:r}=n.result;return s==="simple"&&r.forEach(c=>{const d=c.length/4;for(let u=1;u<d;u++){const h=u/d,f=c[u*4+1],m=e.handleParameter(o,h);c[u*4+1]=f-f*h*h*h*m}return c}),s==="test"&&r.forEach(c=>{const d=c.length/4;for(let u=1;u<d;u++){const h=u/d,f=e.handleParameter(o,h),m=c[u*4+0],_=c[u*4+1],g=c[u*4+2],v=c[(u-1)*4+0],y=c[(u-1)*4+1],b=c[(u-1)*4+2],w=v-m,S=y-_,k=y-g,[$,P]=rotate2D(w,k,90);for(let x=u;x<d;x++){const T=c[x*4+0],j=c[x*4+1],V=c[x*4+2],O=T-v,B=j-y,I=V-b;let[D,E,R]=rotate3D([O,B,I],[$,S,P],f*h);const G=D+v,Q=E+y,ee=R+b;c[x*4+0]=G,c[x*4+1]=Q,c[x*4+2]=ee}}return c}),s==="verlet"&&r.forEach(c=>{const d=c.length/4;for(let u=1;u<d;u++){const h=c[u*4+0],f=c[u*4+1],m=c[u*4+2],_=new Vec3(5,0,0).cross(new Vec3(h,f,m),new Vec3(0,1,0)),g=u/d,v=e.handleParameter(o,g);for(let y=u;y<d;y++){const b=rotate3D([h,f,m],_,g*v);c[y*4+0]=b[0],c[y*4+1]=b[1],c[y*4+2]=b[2]}}return c}),{skeletons:r}},computeGeometry(i){return i.input.result}},log$7=log$8("nodes.join"),node$c={title:"Join",type:"join",outputs:["plant"],parameters:{inputA:{type:"plant",label:"plant",external:!0},inputB:{type:"plant",label:"plant",external:!0}},computeSkeleton(i,e){log$7("compute skeleton",i,e);const{inputA:n,inputB:s}=i;if(!n||!s)return n?n.result:s.result;const{skeletons:o,allSkeletons:r}=n.result,{skeletons:c,allSkeletons:d}=s.result;log$7(o,c);const u=[...o,...c],h=[];return r&&h.push(...r),d&&h.push(...d),{allSkeletons:h,skeletons:u}},computeGeometry(i){const{inputA:e,inputB:n}=i;if(!e||!n)return e?e.result:n.result;const{geometry:s,instances:o}=e.result,{geometry:r,instances:c}=n.result,d=join(s,r),u=[];return o&&u.push(...o),c&&u.push(...c),log$7("compute geometry",{geometryA:s,geometryB:r,result:d}),{geometry:d,instances:u}}},defaultValue=[{x:1,y:1,pinned:!0},{x:.62,y:.84,pinned:!1},{x:.54,y:.63,pinned:!1},{x:.38,y:.41,pinned:!0},{x:.44,y:.23,pinned:!1},{x:.64,y:.12,pinned:!1},{x:.98,y:.02,pinned:!0}],node$b={title:"Leaf",type:"leaf",outputs:["plant","leaf"],parameters:{input:{type:"plant",external:!0},size:{type:["number","parameter","curve","vec2"],inputType:"slider",min:0,max:3,step:.05,value:.2},shape:{type:"leaf",external:!0,defaultValue},lowestLeaf:{type:"number",inputType:"slider",min:0,max:1,step:.01,value:.5},curvature:{external:!0,type:"vec2",defaultValue:{x:.5,y:.2}},amount:{type:"number",min:0,max:20,value:10}},computeSkeleton(i,e){const{input:n}=i,{skeletons:s}=n.result,o=s.map((r,c)=>{const d=c/s.length,u=e.handleParameter(i.amount,d),h=new Float32Array(u*3),f=new Float32Array(u*3),m=new Float32Array(u*3);for(let _=0;_<u;_++){const g=_/(u-1),v=e.handleParameter(i.size,1-g),y=e.handleParameter(i.lowestLeaf,g),b=y+(1-y)*g-.001,[w,S,k]=interpolateSkeleton(r,b),[$,,P]=interpolateSkeletonVec(r,b),x=normalize2D([$,P]),T=Math.atan2(-x[0],x[1]);h[_*3+0]=w,h[_*3+1]=S,h[_*3+2]=k,f[_*3+0]=v,f[_*3+1]=1,f[_*3+2]=v,m[_*3+0]=0,m[_*3+1]=T-Math.PI/2*(_%2==0?-1:1),m[_*3+2]=0}return{offset:h,scale:f,rotation:m}});return{allSkeletons:n.result.allSkeletons,skeletons:s,instances:o}},computeGeometry(i,e,n){const{shape:s,input:o,curvature:r}=i,{instances:c}=e,d=n.handleParameter(r),u=leaf(n.handleParameter(s),{res:n.getSetting("leafRes",2),xCurvature:d.x,yCurvature:d.y});return{geometry:o.result.geometry,instances:c.map(h=>A(A({},h),u))}}},node$a={title:"Math",type:"math",outputs:["number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},computeValue(i,e,n){const{mode:s}=i,o=e.handleParameter(i.a,n),r=e.handleParameter(i.b,n);switch(s){case"multiply":return o*r;case"subtract":return o-r;default:return o+r}}},log$6=log$8("nodes.noise"),node$9={title:"Noise",type:"noise",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0},size:{type:"number",inputType:"slider",min:0,max:20,step:.05,value:1},strength:{type:"number",inputType:"slider",min:0,max:2,step:.01,value:.5}},computeSkeleton(i,e){log$6(i);const{input:n}=i,s=e.handleParameter(i.size),o=e.handleParameter(i.strength),{skeletons:r}=n.result;return r.forEach((c,d)=>{const u=c.length/4,h=[c[0],c[1],c[2]];let f=0;for(let m=0;m<u;m++){const _=m/u;f+=(Math.abs(h[0]-c[m*4+0])+Math.abs(h[1]-c[m*4+1])+Math.abs(h[2]-c[m*4+2]))/3,h[0]=c[m*4+0],h[1]=c[m*4+1],h[2]=c[m*4+2],c[m*4+0]=c[m*4+0]+noise.n1d(f*s+0+d*500)*o*_,c[m*4+1]=c[m*4+1]+noise.n1d(f*s+1e3+d*500)*o*_,c[m*4+2]=c[m*4+2]+noise.n1d(f*s+2e3+d*500)*o*_}}),{skeletons:r,allSkeletons:n.result.allSkeletons}},computeGeometry(i){return i.input.result}},node$8={title:"Output",type:"output",outputs:[],parameters:{main:{type:"plant",label:"plant",external:!0}},computeNode(i={}){return i.main}},node$7={title:"Parameter",type:"parameter",outputs:["number"],parameters:{value:{type:"number",value:0},variation:{type:"number",inputType:"slider",value:0,min:0,max:1,step:.05}},computeValue(i,e){const{value:n=0,variation:s=0}=i;return s?n+e.n1d(200)*s*Math.max(n,1):n}},getRotationAxis=i=>i==="X"?[1,0,0]:i==="Z"?[0,0,1]:[0,1,0],node$6={title:"Rotate",type:"rotate",outputs:["plant"],parameters:{input:{type:"plant",external:!0},type:{internal:!0,label:!1,type:"select",values:["Y","X","Z"]},spread:{internal:!0,type:"boolean",value:!0},angle:{type:"number",inputType:"slider",min:0,max:Math.PI*2,step:.05,value:0}},computeSkeleton(i,e){const{input:n,type:s,spread:o}=i,{result:{skeletons:r,allSkeletons:c}}=n,d=getRotationAxis(s);return r.forEach((u,h)=>{const f=u.length/4,m=u[0],_=u[1],g=u[2],v=h/r.length,y=e.handleParameter(i.angle,v)*(o?v:1);for(let b=1;b<f;b++){let w=u[b*4+0],S=u[b*4+1],k=u[b*4+2];w-=m,S-=_,k-=g,[w,S,k]=rotate3D([w,S,k],d,y),w+=m,S+=_,k+=g,u[b*4+0]=w,u[b*4+1]=S,u[b*4+2]=k}}),{skeletons:r,allSkeletons:c}},computeGeometry(i){return i.input.result}},node$5={title:"Shape",type:"shape",outputs:["leaf"],parameters:{value:{type:"leaf",inputType:"shape",internal:!0,label:!1,value:[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}},computeValue(i){return i.value}},node$4={title:"Slider",type:"slider",outputs:["number"],parameters:{value:{type:"number",label:!1,inputType:"slider",internal:!0,min:0,max:1,step:.01,value:0}},computeValue(i){return i.value}},log$5=log$8("nodes.stem"),node$3={title:"Stem",type:"stem",outputs:["plant"],parameters:{origin:{type:"vec3",external:!0,defaultValue:{x:0,y:0,z:0}},height:{type:"number",inputType:"slider",min:0,max:5,step:.05,value:2},thiccness:{type:"number",inputType:"slider",min:0,max:.2,step:.01,value:.06},amount:{type:"number",min:0,max:20,value:1}},computeSkeleton(i,e){log$5("computeSkeleton",i);const n=e.handleParameter(i.amount),s=e.getSetting("stemResY"),o=[];for(let r=0;r<n;r++){const{x:c,y:d,z:u}=e.handleParameter(i.origin),h=e.handleParameter(i.height),f=new Float32Array(s*4);for(let m=0;m<s;m++){const _=m/s,g=e.handleParameter(i.thiccness,_)*(1-_),v=c,y=d+_*h,b=u;f[m*4+0]=v,f[m*4+1]=y,f[m*4+2]=b,f[m*4+3]=g}o.push(f)}return{skeletons:o,allSkeletons:o}},computeGeometry(i,e,n){log$5("computeNode",i,e);const s=n.getSetting("stemResX");return{geometry:join(...e.skeletons.map(o=>tube(o,s)))}}},node$2={title:"Vec2",type:"vec2",outputs:["vec2"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0}}},node$1={title:"Vec3",type:"vec3",outputs:["vec3"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0},z:{label:!1,type:"number",value:0,defaultValue:0}}};var nodes$1=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",Branch:node$f,Curve:node$e,Gravity:node$d,Join:node$c,Leaf:node$b,Math:node$a,Noise:node$9,Output:node$8,Parameter:node$7,Rotate:node$6,Shape:node$5,Slider:node$4,Stem:node$3,Vec2:node$2,Vec3:node$1});const _nodes=Object.values(nodes$1).map(i=>("computeNode"in i?i.compute=i.computeNode:i.compute=e=>({type:i.type,parameters:e}),i));var index$2="",ConnectionView$1="";const minMax=(i,e)=>n=>Math.min(Math.max(n,i),e),limitDecimals=i=>{const e=10**i;return n=>Math.floor(n*e)/e},limitSafe=minMax(-1e5,1e5),removeDecimals=limitDecimals(1),limit=i=>limitSafe(removeDecimals(i));class ConnectionView{constructor({x1:e=0,y1:n=0,x2:s=0,y2:o=0},r){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x1=e,this.y1=n,this.x2=s,this.y2=o,this.system=r.node.system,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewbox","0 0 100 100"),this.svg.setAttribute("width","100"),this.svg.setAttribute("height","100"),this.svg.style.overflow="visible",this.svg.style.position="absolute",this.svg.style.top="3.5px",this.svg.style.pointerEvents="none",this.svg.style.zIndex="-1",r.view.wrapper.append(this.svg),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.classList.add("node-connection-path"),this.path.setAttribute("vector-effect","non-scaling-stroke"),this.path.setAttribute("d",`
      M 0 0
      C 50 0 
        50 100
				100  100
      `),this.svg.appendChild(this.path),this.setPosition()}setPosition({x1:e=this.x1,y1:n=this.y1,x2:s=this.x2,y2:o=this.y2}={}){var d;this.x1=limit(e),this.y1=limit(n),this.x2=limit(s),this.y2=limit(o);const r=this.x2-this.x1+3.5,c=this.y2-this.y1;(d=this==null?void 0:this.hoverPath)==null||d.setAttribute("d",`
      M 0 0
      C ${r/2} 0 
        ${r/2} ${c}
				${r}  ${c}
      `),this.path.setAttribute("d",`
      M 0 0
      C ${r/2} 0 
        ${r/2} ${c}
				${r}  ${c}
      `)}remove(){var e;this.path.remove(),(e=this==null?void 0:this.hoverPath)==null||e.remove(),this.system.save()}}class NodeConnectionView extends ConnectionView{constructor(e){super({},e.output);this.connection=e,this.input=e.input.view,this.output=e.output.view,this.hoverPath=document.createElementNS("http://www.w3.org/2000/svg","path"),this.hoverPath.classList.add("node-connection-hover"),this.hoverPath.setAttribute("vector-effect","non-scaling-stroke"),this.svg.append(this.hoverPath),this.hoverPath.addEventListener("mouseover",()=>{const{activeNode:n}=this.system.view;n&&n.view.active&&n.view.hoveredConnection!==this&&this.handleNodeOver(n)}),this.hoverPath.addEventListener("mouseout",()=>{const{activeNode:n}=this.system.view;this.handleNodeOut(n)}),e.input.node.system.view.colorStore.on(e.input.type[0],n=>{this.path.style.stroke=n})}handleNodeOver(e){this.connection.isNodeJoinable(e)&&(e.view.hoveredConnection=this,this.path.classList.add("hover-active"))}handleNodeOut(e){e&&e.view.hoveredConnection===this&&delete e.view.hoveredConnection,this.path.classList.remove("hover-active")}remove(){super.remove()}}function makeDomController(i){if(!isDomElement(i))throw new Error("panzoom requires DOM element to be attached to the DOM tree");const n=i.parentElement;return i.scrollTop=0,{getBBox:r,getOwner:o,applyTransform:c};function o(){return n}function r(){return{left:0,top:0,width:i.clientWidth,height:i.clientHeight}}function c(d){i.style.transformOrigin="0 0 0",i.style.transform="matrix("+d.scale+", 0, 0, "+d.scale+", "+d.x+", "+d.y+")"}}function isDomElement(i){return i&&i.parentElement&&i.style}function kinetic(i,e,n){typeof n!="object"&&(n={});const s=typeof n.minVelocity=="number"?n.minVelocity:5,o=typeof n.amplitude=="number"?n.amplitude:.25,r=typeof n.cancelAnimationFrame=="function"?n.cancelAnimationFrame:getCancelAnimationFrame(),c=typeof n.requestAnimationFrame=="function"?n.requestAnimationFrame:getRequestAnimationFrame();let d,u;const h=342;let f,m,_,g,v,y,b,w;return{start:k,stop:P,cancel:S};function S(){r(f),r(w)}function k(){d=i(),g=b=m=v=0,u=new Date,r(f),r(w),f=c($)}function $(){const T=Date.now(),j=T-u;u=T;const V=i(),O=V.x-d.x,B=V.y-d.y;d=V;const I=1e3/(1+j);m=.8*O*I+.2*m,v=.8*B*I+.2*v,f=c($)}function P(){r(f),r(w);const T=i();_=T.x,y=T.y,u=Date.now(),(m<-s||m>s)&&(g=o*m,_+=g),(v<-s||v>s)&&(b=o*v,y+=b),w=c(x)}function x(){const T=Date.now()-u;let j=!1,V=0,O=0;g&&(V=-g*Math.exp(-T/h),V>.5||V<-.5?j=!0:V=g=0),b&&(O=-b*Math.exp(-T/h),O>.5||O<-.5?j=!0:O=b=0),j&&(e(_+V,y+O),w=c(x))}}function getCancelAnimationFrame(){return typeof cancelAnimationFrame=="function"?cancelAnimationFrame:clearTimeout}function getRequestAnimationFrame(){return typeof requestAnimationFrame=="function"?requestAnimationFrame:function(i){return setTimeout(i,16)}}const defaultZoomSpeed=.2;function createPanZoom(i,e){const n=makeDomController(i),s=n.getOwner(),o={x:0,y:0};let r=!1;const c={x:0,y:0,scale:1},d=typeof e.pinchSpeed=="number"?e.pinchSpeed:1,u=e.bounds,h=typeof e.maxZoom=="number"?e.maxZoom:Number.POSITIVE_INFINITY,f=typeof e.minZoom=="number"?e.minZoom:0,m=typeof e.boundsPadding=="number"?e.boundsPadding:.05,_=typeof e.zoomSpeed=="number"?e.zoomSpeed:defaultZoomSpeed;let g=parseTransformOrigin(e.transformOrigin);validateBounds(u);let v,y=!1,b=!1,w,S,k;const $=kinetic(xe,je,e.smoothScroll);let P,x=!1;le();const T={dispose:Ee,moveBy:oe,moveTo:te,smoothMoveTo:Te,centerOn:Ce,zoomTo:X,zoomAbs:ae,pause:B,resume:I,isPaused:D,getTransform:G,setTransform:R,getTransformOrigin:Q,setTransformOrigin:ee},j=typeof e.initialX=="number"?e.initialX:c.x,V=typeof e.initialY=="number"?e.initialY:c.y,O=typeof e.initialZoom=="number"?e.initialZoom:c.scale;return(j!=c.x||V!=c.y||O!=c.scale)&&ae(j,V,O),T;function B(){ce(),x=!0}function I(){x&&(le(),x=!1)}function D(){return x}function E(M,N){return o.x=M,o.y=N,o}function R(M,N,C){c.x=M,c.y=N,c.scale=C,H()}function G(){return c}function Q(){return g}function ee(M){g=parseTransformOrigin(M)}function xe(){return{x:c.x,y:c.y}}function te(M,N){c.x=M,c.y=N,ne(),H()}function oe(M,N){te(c.x+M,c.y+N)}function ne(){const M=Me();if(!M)return;let N=!1;const C=Ne();let L=M.left-C.right;return L>0&&(c.x+=L,N=!0),L=M.right-C.left,L<0&&(c.x+=L,N=!0),L=M.top-C.bottom,L>0&&(c.y+=L,N=!0),L=M.bottom-C.top,L<0&&(c.y+=L,N=!0),N}function Me(){if(!!u){if(typeof u=="boolean"){const M=s.getBoundingClientRect(),N=M.width,C=M.height;return{left:N*m,top:C*m,right:N*(1-m),bottom:C*(1-m)}}return u}}function Ne(){const M=n.getBBox(),N=Pe(M.left,M.top);return{left:N.x,top:N.y,right:M.width*c.scale+N.x,bottom:M.height*c.scale+N.y}}function Pe(M,N){return{x:M*c.scale+c.x,y:N*c.scale+c.y}}function H(){r=!0,v=window.requestAnimationFrame(Le)}function re(M,N,C){if(isNaN$1(M)||isNaN$1(N)||isNaN$1(C))throw new Error("zoom requires valid numbers");const L=c.scale*C;if(L<f){if(c.scale===f)return;C=f/c.scale}if(L>h){if(c.scale===h)return;C=h/c.scale}const F=E(M,N);c.x=F.x-C*(F.x-c.x),c.y=F.y-C*(F.y-c.y),u&&m===1&&f===1?(c.scale*=C,ne()):ne()||(c.scale*=C),H()}function ae(M,N,C){const L=C/c.scale;re(M,N,L)}function Ce(M){const N=M.ownerSVGElement;if(!N)throw new Error("ui element is required to be within the scene");const C=M.getBoundingClientRect(),L=C.left+C.width/2,F=C.top+C.height/2,W=N.getBoundingClientRect(),J=W.width/2-L,Z=W.height/2-F;U(J,Z)}function Te(M,N){U(M-c.x,N-c.y)}function U(M,N){return oe(M,N)}function je(M,N){te(M,N)}function Ee(){ce()}function le(){s.addEventListener("mousedown",_e,{passive:!0}),s.addEventListener("dblclick",me,{passive:!1}),s.addEventListener("touchstart",pe,{passive:!0}),s.addEventListener("keydown",ue),s.addEventListener("wheel",be,{passive:!0}),H()}function ce(){s.removeEventListener("wheel",be),s.removeEventListener("mousedown",_e),s.removeEventListener("keydown",ue),s.removeEventListener("dblclick",me),s.removeEventListener("touchstart",pe),v&&(window.cancelAnimationFrame(v),v=0),$.cancel(),ye(),Re(),$e()}function Le(){r&&Ie()}function Ie(){r=!1,n.applyTransform(c),v=0,e.onTransform&&e.onTransform(c)}function ue(M){let N=0;if(M.keyCode===38||M.keyCode===40||M.keyCode===37||M.keyCode===39||(M.keyCode===189||M.keyCode===109?N=1:(M.keyCode===187||M.keyCode===107)&&(N=-1)),N){const C=we(N*100),L=g?se():Oe();X(L.x,L.y,C)}}function Oe(){const M=s.getBoundingClientRect();return{x:M.width/2,y:M.height/2}}function pe(M){if(Ae(M),M.touches.length===1)return De(M);M.touches.length===2&&(k=fe(M.touches[0],M.touches[1]),P=!0,de())}function Ae(M){M.stopPropagation(),M.preventDefault()}function Ve(M){M.preventDefault(),M.stopPropagation()}function De(M){const N=M.touches[0],C=q(N),L=E(C.x,C.y);w=L.x,S=L.y,$.cancel(),de()}function de(){y||(y=!0,document.addEventListener("touchmove",he),document.addEventListener("touchend",Y),document.addEventListener("touchcancel",Y))}function he(M){if(M.touches.length===1){M.stopPropagation();const N=M.touches[0],C=q(N),L=E(C.x,C.y),F=L.x-w,W=L.y-S;F!==0&&W!==0&&ke(),w=L.x,S=L.y,U(F,W)}else if(M.touches.length===2){P=!0;const N=M.touches[0],C=M.touches[1],L=fe(N,C),F=1+(L/k-1)*d,W=q(N),J=q(C);if(w=(W.x+J.x)/2,S=(W.y+J.y)/2,g){const Z=se();w=Z.x,S=Z.y}X(w,S,F),k=L,M.stopPropagation(),M.preventDefault()}}function Y(M){if(M.touches.length>0){const N=q(M.touches[0]),C=E(N.x,N.y);w=C.x,S=C.y}}function fe(M,N){const C=M.clientX-N.clientX,L=M.clientY-N.clientY;return Math.sqrt(C*C+L*L)}function me(M){Ve(M)}function _e(M){if(y)return M.stopPropagation(),!1;if(M.target!==s&&M.target!==i||!(M.button===1&&window.event!==null||M.button===0))return;$.cancel();const C=q(M),L=E(C.x,C.y);return w=L.x,S=L.y,document.addEventListener("mousemove",ge),document.addEventListener("mouseup",ve),!1}function ge(M){if(y||M.ctrlKey)return;ke();const N=q(M),C=E(N.x,N.y),L=C.x-w,F=C.y-S;w=C.x,S=C.y,U(L,F)}function ve(){$e(),ye()}function ye(){document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",ve),b=!1}function Re(){document.removeEventListener("touchmove",he),document.removeEventListener("touchend",Y),document.removeEventListener("touchcancel",Y),b=!1,P=!1,y=!1}function be(M){$.cancel();let N=M.deltaY;M.deltaMode>0&&(N*=100);const C=we(N);if(C!==1){const L=g?se():q(M);X(L.x,L.y,C)}}function q(M){const N=s.getBoundingClientRect(),C=M.clientX-N.left,L=M.clientY-N.top;return{x:C,y:L}}function se(){const M=s.getBoundingClientRect();return{x:M.width*g.x,y:M.height*g.y}}function X(M,N,C){return $.cancel(),re(M,N,C)}function we(M){const N=Math.sign(M),C=Math.min(.25,Math.abs(_*M/128));return 1-N*C}function ke(){b||(b=!0,$.start())}function $e(){b&&(P||$.stop())}}function parseTransformOrigin(i){if(!!i){if(typeof i=="object")return(!isNumber(i.x)||!isNumber(i.y))&&failTransformOrigin(),i;failTransformOrigin()}}function failTransformOrigin(i){throw new Error(["Cannot parse transform origin.","Some good examples:",'  "center center" can be achieved with {x: 0.5, y: 0.5}','  "top center" can be achieved with {x: 0.5, y: 0}','  "bottom right" can be achieved with {x: 1, y: 1}'].join(`
`))}function validateBounds(i){const e=typeof i;if(e==="undefined"||e==="boolean")return;if(!(isNumber(i.left)&&isNumber(i.top)&&isNumber(i.bottom)&&isNumber(i.right)))throw new Error("Bounds object is not valid. It can be: undefined, boolean (true|false) or an object {left, top, right, bottom}")}function isNumber(i){return Number.isFinite(i)}function isNaN$1(i){return Number.isNaN?Number.isNaN(i):i!==i}function rectanglesIntersect(i,e){const n=i.x2<e.x1,s=i.x1>e.x2,o=i.y1>e.y2,r=i.y2<e.y1;return!(n||s||o||r)}var canSocketsConnect=(i,e)=>e.type.includes(i.type)||e.type.includes("*");function diffObjects(i,e){if(i===void 0&&e===void 0)return;const n=Array.isArray(i)?"array":typeof i;if(n==="string"||n==="boolean"||n==="number")return i===e?void 0:e;if(Array.isArray(i)){const c=i.map((d,u)=>typeof e=="object"&&u in e?diffObjects(d,e[u]):e[u]);return!c.length||c.length===1&&!c[0]?void 0:c}if(!i)return e;const s=Object.keys(i),o={};let r=!1;if(s.forEach(c=>{const d=diffObjects(i[c],e[c]);d!==void 0&&(r=!0,o[c]=d)}),!!r)return o}function diffBoth(i,e){return[diffObjects(i,e),diffObjects(e,i)]}function mergeObjects(i,e){const n=typeof i;if(n==="string"||n==="boolean"||n==="number")return e;if(Array.isArray(i))return i.map((s,o)=>e[o]?mergeObjects(s,e[o]):s);if(typeof i=="object"){const s=Object.keys(e),o=A({},i);return s.forEach(r=>{o[r]=mergeObjects(i[r],e[r])}),o}}class NodeConnection{constructor(e,{input:n,output:s}){if(!s||!n)return;if(this.system=e,n.node.getChildren().includes(s.node))throw new Error("Circular reference");if(!canSocketsConnect(s,n))throw new Error("Can't connect type "+n.type+" to "+s.type);this.output=s,this.input=n,e.options.view&&(this.view=new NodeConnectionView(this)),this.output.setConnection(this),this.input.setConnection(this),this.output.node.system.save()}joinNode(e){if(!this.isNodeJoinable(e))return;this.remove(),this.output.node.connectTo(e,0,e.getInputs()[0].key);const n=this.input.node.getInputs(),s=n.indexOf(this.input),o=n[s].key;e.connectTo(this.input.node,0,o)}isNodeJoinable(e){const n=this.input.type,s=this.output.type;if(this.input.node===e||this.output.node===e)return!1;const o=e.getInputs();if(!o.length||!o.find(c=>c.type.includes(s)))return!1;const r=e.outputs;return!(!r.length||!r.find(c=>n.includes(c.type)||n.includes("*")))}remove(){this.view&&this.view.remove(),this.input.removeConnection(),this.output.removeConnection(this)}deserialize(){return{id:this.input.node.attributes.id,out:this.indexOut,in:this.indexIn}}get indexOut(){return this.output.node.outputs.indexOf(this.output)}get indexIn(){return this.input.key}}class Node extends EventEmitter{constructor(e,n){super();this.outputs=[],this._state={},this.states={},this.inputData=[],this.enableUpdates=!0,this.refs=[],this.system=e;const{attributes:s,state:o={}}=n;this._state=o,this.attributes=s,this.id=s.id,this._compute=memoize((r=this._state)=>this.compute(r))}get state(){return this._state}bindView(e){this.view=e,this.outputs.forEach(n=>n.bindView()),Object.values(this.states).forEach(n=>n.bindView())}setAttributes(e){this.enableUpdates&&this.system.history.addAction(),this.attributes=A(A({},this.attributes),e),this==null||this.view.updateViewPosition(),this.save()}compute(e){return e}getChildren(){return this.outputs.map(s=>s.connections).flat().map(s=>s.input.node)}getSockets(){return[...this.getInputs(),...this.outputs]}getInputs(){return Object.values(this.states).map(e=>e.getInput()).filter(e=>!!e)}setStateValue(e,n){this.states[e].setValue(n)}getStateValue(e){return this.state[e]}update(){!this.enableUpdates||(this.computedData=this._compute(this.state),this.emit("computedData",this.computedData),this.refs.forEach(e=>{e.node.enableUpdates=!1,e.keyIn.forEach(n=>{e.node.setStateValue(n,this.computedData)}),e.node.enableUpdates=!0,e.node.update()}),this.save())}remove(){this.system.removeNode(this),this.destroyEventEmitter()}connectTo(e,n=0,s=e.getInputs()[0].key){var u,h,f;const o=this.outputs[n],r=(u=e.states[s])==null?void 0:u.getInput();if(!r)return;const c=new NodeConnection(this.system,{output:o,input:r});(h=o==null?void 0:o.view)==null||h.updatePosition(),(f=r==null?void 0:r.view)==null||f.updatePosition();const d=this.refs.find(m=>m.node.id===e.id&&m.indexOut===n);return d?d.keyIn=[...d.keyIn,s]:this.refs.push({node:e,keyIn:[s],indexOut:n}),this.update(),c}disconnectFrom(e,n,s){this.refs=this.refs.filter(o=>!(o.indexOut!==s||(o.keyIn.splice(o.keyIn.indexOf(n),1),o.keyIn.length===0))),this.update()}deserialize(){const e=Object.assign({},this.attributes);e.refs=this.outputs.map(s=>s.connections).flat().map(s=>s.deserialize());const n={};return Object.values(this.states).forEach(s=>{n[s.key]=s.getValue()}),Object.assign({},{attributes:e,state:n})}save(){this.system.save()}}var BooleanNode={title:"Boolean",type:"boolean",outputs:["boolean"],parameters:{value:{type:"boolean",defaultValue:!1}},compute({value:i=!1}){return i}};const node={title:"Math",type:"math",outputs:["number","number"],parameters:{mode:{type:"whatever",internal:!0,inputType:"selection",label:!1,defaultValue:"add",values:["add","multiply","subtract"]},a:{type:"number",defaultValue:0,label:!1},b:{type:"number",defaultValue:0,label:!1}},compute({mode:i,a:e,b:n}){switch(i){case"multiply":return e*n;case"subtract":return e-n;default:return e+n}}};var NumberNode={title:"Number",type:"number",outputs:["number"],parameters:{value:{type:"number",internal:!0,label:!1,defaultValue:0}},compute({value:i=0}){return i}},NodeStateView$1="";class NodeStateView{constructor(e){this.nodeState=e,this.wrapper=document.createElement("div"),this.input=document.createElement("div"),this.isPaused=!1,this.wrapper.classList.add("node-state-single-wrapper"),this.input.classList.add("node-state-input");const n=e.template,s=n.label||e.key;if(typeof s=="string"){const o=document.createElement("p");o.className="state-label",o.innerHTML=s,this.wrapper.appendChild(o)}(n==null?void 0:n.label)===!1&&this.wrapper.classList.add("hide-label"),n.external||(this.element=stateToElement({target:this.input,template:n,value:e.getValue()}),this.element&&this.element.$on("change",({detail:o})=>{this.isPaused||(this.isPaused=!0,typeof o!="undefined"&&!Number.isNaN(o)&&this.nodeState.setValue(o),this.isPaused=!1)})),e.node.view.stateWrapper.appendChild(this.wrapper),this.wrapper.appendChild(this.input)}updateValue(){this.isPaused||(this.isPaused=!0,setTimeout(()=>{this.element&&(this.element.value=this.nodeState.getValue())},50),this.isPaused=!1)}updatePosition(){var e,n;this.rect=this.wrapper.getBoundingClientRect(),(n=(e=this.nodeState.getInput())==null?void 0:e.view)==null||n.updatePosition()}get y(){return this.rect.y-this.nodeState.node.view.y}get height(){return this.rect.height}setActive(e){this.wrapper.classList[e?"remove":"add"]("disabled")}}var NodeInputView$1="";class NodeInputView{constructor(e){if(!e||!e.node)throw new Error("Somethings missing");this.input=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-input-wrapper"),e.type.forEach(n=>{this.wrapper.classList.add(`socket-type-${n==="*"?"all":n}`)}),e.state.view.wrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",n=>{n.stopPropagation(),n.preventDefault();const s=this.input.connection;s?(s.remove(),this.node.system.view.createFloatingConnection(s.output)):this.node.system.view.createFloatingConnection(this.input)},!1),this.node.system.view.colorStore.on(e.type[0],n=>{const s=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=s!=="rgba(0, 0, 0, 0)"?s:n})}updatePosition(){var e;this.rect=this.wrapper.getBoundingClientRect(),(e=this==null?void 0:this.connection)==null||e.setPosition({x2:this.x,y2:this.y})}remove(){this.wrapper.remove(),this.connection&&this.connection.remove()}set state(e){this.wrapper.classList.forEach(n=>{n.includes("socket-state-")&&this.wrapper.classList.remove(n)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}get x(){return this.node.view.x-3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class NodeInput{constructor(e,n,s){this.state=e,this.key=s,this.node=e.node,this.type=Array.isArray(n)?n:[n]}bindView(){this.view=new NodeInputView(this)}removeConnection(){const e=this.connection;delete this.connection,e&&e.remove(),this.node.setStateValue(this.key,void 0),this.state.setIsExternal(!1)}setConnection(e){this.connection&&this.connection.remove(),this.connection=e,this.view&&(this.view.connection=e.view),this.state.setIsExternal(!0)}remove(){this.view&&this.view.remove(),this.removeConnection()}}class NodeState extends EventEmitter{constructor(e,n,s){super();var o,r;this.node=e,this.key=n,this.template=s,this.isExternal=!1,this.value=(r=(o=e.state[n])!=null?o:s.defaultValue)!=null?r:s.value,this.node._state[n]=this.value,this.template.internal||(this.input=new NodeInput(this,s.type,n))}setIsExternal(e=!1){var n;this.isExternal=e,(n=this==null?void 0:this.view)==null||n.setActive(!e)}getValue(){return this.value}setValue(e){this.isExternal||(this.node.enableUpdates&&this.node.system.history.addAction(),this.value=e),this.node._state[this.key]=e,this.node.enableUpdates&&(this==null||this.view.updateValue(),this.node.update())}remove(){}getInput(){return this.input}bindView(){this.view=new NodeStateView(this),this.input&&this.input.bindView()}}var NodeView$1="";class NodeView{constructor(e){this.inputs=[],this.outputs=[],this.active=!1,this.x=0,this.y=0,this.downX=0,this.downY=0,this.mDownX=0,this.mDownY=0,this.height=50,this.width=91,this.node=e,this.system=e.system,this.wrapper=document.createElement("div"),this.wrapper.style.minHeight=this.height+"px",this.wrapper.style.minWidth=this.width+"px",this.wrapper.classList.add("node-wrapper","node-type-"+e.attributes.type.toLowerCase()),this.wrapper.setAttribute("id","node-view-"+this.system.id+"-"+this.node.id),this.outputWrapper=document.createElement("div"),this.outputWrapper.classList.add("node-outputs-wrapper"),this.wrapper.append(this.outputWrapper);const n=document.createElement("p");n.innerHTML=e.attributes.name||e.attributes.type,n.classList.add("node-title"),this.wrapper.appendChild(n),this.stateWrapper=document.createElement("div"),this.stateWrapper.classList.add("node-state-wrapper"),this.wrapper.append(this.stateWrapper),e.system.view.nodeContainer.append(this.wrapper);const{pos:{x:s=0,y:o=0}={}}=e.attributes;this.x=s,this.y=o,this.bindEventListeners(),this.wrapper.style.left=s+"px",this.wrapper.style.top=o+"px",setTimeout(()=>{const{width:r,height:c}=this.wrapper.getBoundingClientRect();this.width=r/this.system.view.s,this.height=c/this.system.view.s,this.updateViewPosition(s,o)},10)}bindEventListeners(){this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this._unsubscribeMouseMove=this.system.view.on("mousemove",e=>this.handleMouseMove(e)),this._unsubscribeMouseUp=this.system.view.on("mouseup",()=>this.handleMouseUp())}removeEventListeners(){this._unsubscribeMouseMove(),this._unsubscribeMouseUp(),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e))}set state(e){this.wrapper.classList.remove("node-active","node-selected","node-dragging"),this.wrapper.classList.add("node-"+e),this._state=e}get state(){return this._state}handleMouseDown(e){var o,r,c,d;if(this.system.view.keyMap.space||e.button===2||e.target!==e.currentTarget)return;e.stopImmediatePropagation(),e.stopPropagation(),this.node.system.view.setActive(this.node,e);const{rmx:n,rmy:s}=this.system.view;this.mDownX=n,this.mDownY=s,this.downX=((r=(o=this.node.attributes)==null?void 0:o.pos)==null?void 0:r.x)||0,this.downY=((d=(c=this.node.attributes)==null?void 0:c.pos)==null?void 0:d.y)||0,this.active=!0,this.system.view.selectedNodes.length&&this.system.view.selectedNodes.forEach(u=>{u.view.active=!0,u.view.mDownX=n,u.view.mDownY=s,u.view.downX=u.view.x,u.view.downY=u.view.y})}handleMouseUp(){this.active=!1,this.hoveredConnection&&(this.hoveredConnection.connection.joinNode(this.node),delete this.hoveredConnection)}handleMouseMove({mx:e,my:n,keys:s}){if(this.active){this.state="dragging";const o=s.ctrlKey?.02:1;let r=this.mDownX-e,c=this.mDownY-n;s.shiftKey&&(Math.abs(r)>Math.abs(c)?c=0:r=0);const d=Math.round((this.downX-r/this.system.view.s)*o)/o,u=Math.round((this.downY-c/this.system.view.s)*o)/o;this.setPosition(d,u)}}updateViewPosition(e=(r=>(r=(o=>(o=(s=>(s=this.node.attributes)==null?void 0:s.pos)())==null?void 0:o.x)())!=null?r:this.x)(),n=(u=>(u=(d=>(d=(c=>(c=this.node.attributes)==null?void 0:c.pos)())==null?void 0:d.y)())!=null?u:this.y)()){this.wrapper.style.left=e+"px",this.wrapper.style.top=n+"px",Object.values(this.node.states).forEach(h=>{var f;return(f=h==null?void 0:h.view)==null?void 0:f.updatePosition()}),this.node.outputs.forEach(h=>h.view.updatePosition())}setPosition(e,n){this.x=e,this.y=n,this.node.setAttributes({pos:{x:e,y:n}}),this.updateViewPosition()}remove(){this.removeEventListeners(),this.wrapper.remove()}}class DebugNode extends Node{constructor(e,n){super(e,n);this.states={input:new NodeState(this,"input",{type:"*"})},this.outputs=[]}compute({input:e}){return e}}class DebugView extends NodeView{constructor(e){super(e);const n=document.createElement("div");e.on("computedData",s=>{n.innerHTML="";const o=document.createElement("p");o.innerHTML=JSON.stringify(s,null," "),n.append(o)}),this.wrapper.appendChild(n)}}var DebugNode$1={title:"Debug",meta:{description:"Outputs any inputs for debug purposes"},node:DebugNode,view:DebugView};class OutputNode extends Node{constructor(e,n){super(e,n);this.states={input:new NodeState(this,"input",{type:"*",external:!0,label:!1})},this.outputs=[]}compute({input:e}){return e}}class OutputView extends NodeView{constructor(e){super(e);const n=document.createElement("p");n.style.margin="0px",n.style.padding="4px",n.style.color="white",n.style.fontWeight="bold",e.on("computedData",s=>{n.innerHTML=JSON.stringify(s,null,2)}),this.wrapper.appendChild(n)}}var OutputNode$1={title:"Output",meta:{description:"Outputs the final value"},node:OutputNode,view:OutputView};const types={BooleanNode,MathNode:node,NumberNode,DebugNode:DebugNode$1,OutputNode:OutputNode$1};var AddMenu="";let longestModuleName=0;class Logger{constructor(e,n="system"in e?e.system.log.level:2){this.isGrouped=!1,this.output=log$8("logger"),this.module=e,this.name=e.constructor.name,this.length=this.name.length,longestModuleName=Math.max(longestModuleName,this.length),this.level=n,this.output=log$8(this.getModuleName())}getModuleName(){return this.isGrouped?"":`${this.name.padEnd(longestModuleName," ")}`}handle(e,n,s){s&&s.length?(console.groupCollapsed(`${this.getModuleName()} ${n}`),e(...s),console.groupEnd()):e(`${this.getModuleName()} ${n}`)}info(e,...n){this.level>=3&&this.output(e,...n)}log(e,...n){this.level>=2&&this.output(e,...n)}warn(e,...n){this.level>=1&&this.output.warn(e,...n)}error(e,...n){this.level>=0&&(this.output.error(e),this.output(...n))}group(e){this.output.group(e),this.isGrouped=!0}groupEnd(){console.groupEnd(),this.isGrouped=!1}}class SearchContainer{constructor(e,n,s){this.children=[],this.menu=e,this.type=n,s&&this.children.push(...s),this.wrapper=document.createElement("div"),this.wrapper.classList.add("search-container");const o=document.createElement("p");o.innerHTML=this.type.title,this.wrapper.appendChild(o);const r=[n.title];this.type.meta&&(this.type.meta.description&&r.push(this.type.meta.description.split(" ").join(":")),this.type.meta.tags&&r.push(...this.type.meta.tags)),this.searchString=r.join(":").toLowerCase(),this.menu.wrapper.appendChild(this.wrapper)}show(){this.wrapper.style.display=""}hide(){this.wrapper.style.display="none"}blur(){this.wrapper.classList.remove("focused")}focus(){this.menu.activeContainer&&this.menu.activeContainer.blur(),this.menu.activeContainer=this,this.wrapper.classList.add("focused")}showIfSearch(e){return this.searchString.includes(e.toLowerCase())?(this.show(),!0):(this.hide(),!1)}destroy(){this.wrapper.remove()}}class RightClickMenu{constructor(e){this.x=0,this.y=0,this.visible=!1,this.possibleContainers=[],this.filteredContainers=[],this.containers=[],this.view=e,this.system=e.system,this.log=new Logger(this),this.wrapper=document.createElement("div"),this.wrapper.classList.add("context-wrapper"),this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.placeholder="Search",this.wrapper.appendChild(this.searchInput),this.view.wrapper.append(this.wrapper),this.bindEventListeners(),this.view.on("keydown",({key:n})=>n==="Escape"&&this.hide())}updateTypes(e){this.containers.forEach(n=>n.destroy()),this.containers.push(...e.map(n=>new SearchContainer(this,n)))}setActive(e){const{length:n}=this.filteredContainers;if(!n)return;const o=(((this.activeContainer?this.filteredContainers.indexOf(this.activeContainer):0)+e)%n+n)%n;this.filteredContainers[o].focus(),this.log.info(`Set active entry ${o}`)}bindEventListeners(){window.addEventListener("mousedown",e=>this.handleWindowClick(e)),this.view.system.store.on("types",e=>this.updateTypes(e),20),this.view.on("keydown",({key:e})=>{switch(e){case"escape":this.reject();break;case"arrowdown":this.setActive(1);break;case"arrowup":this.setActive(-1);break}}),this.searchInput.addEventListener("input",()=>{const{value:e=""}=this.searchInput;this.search(e)}),this.searchInput.addEventListener("keydown",({keyCode:e})=>{e===13&&this.activeContainer&&this.resolve()})}handleWindowClick(e){const n=e.composedPath();this.visible&&!n.includes(this.wrapper)&&this.reject()}search(e){if(e&&e.length){const n=this.possibleContainers.filter(s=>s.showIfSearch(e));n.length===0?(this.filteredContainers=[...this.possibleContainers],this.filteredContainers.forEach(s=>s.show())):(this.filteredContainers=[...n],n[0].focus()),this.log.info(`Found ${n.length} entries for search:${e}`)}else this.filteredContainers=[...this.possibleContainers],this.filteredContainers.forEach(n=>n.show())}reject(){this.rej&&this.rej(),this.hide()}resolve(){var c;const e=(c=this.activeContainer)==null?void 0:c.type,{x:n,y:s}=this.view.projectWindowToLocal(this.x,this.y),o=n-this.view.width/2,r=s-this.view.height/2;e?this.res({attributes:{pos:{x:o,y:r},id:"",name:e.title,type:e.title,refs:[]},state:{value:void 0}}):this.reject(),this.hide()}hide(){this.visible=!1,this.wrapper.classList.remove("context-visible"),this.wrapper.blur(),this.res=e=>e,this.reject=()=>{},this.searchInput.disabled=!0}show({x:e,y:n,socket:s}){return this.x=e,this.y=n,this.socket=s,this.visible=!0,this.wrapper.style.left=e+"px",this.wrapper.style.top=n+"px",setTimeout(()=>{this.searchInput.disabled=!1,this.wrapper.classList.add("context-visible"),this.searchInput.value="",this.searchInput.focus(),this.search()},10),this.containers.forEach(o=>o.hide()),this.possibleContainers=s?this.containers.filter(o=>{var r,c,d;if(s instanceof NodeInput){const{type:u}=s;return!o.type.outputs||!o.type.outputs.length?!1:u.includes("*")?!0:(r=o.type.outputs)==null?void 0:r.some(h=>u.includes(h))}else{const{type:u}=s;return!o.type.inputs||!o.type.inputs.length?!1:u==="*"?!0:((c=o.type.inputs)==null?void 0:c.includes("*"))||((d=o.type.inputs)==null?void 0:d.includes(u))}}):this.containers,this.possibleContainers.forEach(o=>o.show()),this.possibleContainers.length&&this.possibleContainers[0].focus(),this.filteredContainers=[...this.possibleContainers],new Promise((o,r)=>{this.res=o,this.rej=r})}}var BoxSelection="";class BoxSelectionView extends EventEmitter{constructor(e){super();this.mDownX=0,this.mDownY=0,this.downX=0,this.downY=0,this.isShiftKey=!1,this.view=e,this.wrapper=document.createElement("div"),this.wrapper.classList.add("box-selection-wrapper"),this.view.wrapper.append(this.wrapper),this.view.on("mousedown",({target:n,mx:s,x:o,my:r,y:c,keys:d})=>{var u;d.space||d.shiftKey||d.button===2||!d.ctrlKey||n&&!((u=n==null?void 0:n.className)==null?void 0:u.includes("nodesystem"))||(this.mDownX=s,this.mDownY=r,this.downX=o,this.downY=c,this.wrapper.style.left=s+"px",this.wrapper.style.top=r+"px",this.wrapper.style.width="0px",this.wrapper.style.height="0px",this.isShiftKey=d.shift,this.show())})}show(){this.wrapper.classList.add("box-selection-visible");const e=this.view.system.nodes.map(o=>{const{width:r,height:c}=o.view,{x:d,y:u}=o.view,h=d+this.view.width/2,f=u+this.view.height/2,m=h+r,_=f+c;return{n:o,state:o.view.state,x1:h,y1:f,x2:m,y2:_}});let n=[];const s=this.view.on("mousemove",({mx:o,my:r,x:c,y:d})=>{const{mDownX:u,mDownY:h,downX:f,downY:m,isShiftKey:_}=this,g={x1:Math.min(o,u),x2:Math.max(o,u),y1:Math.min(r,h),y2:Math.max(r,h)};this.wrapper.style.left=g.x1+"px",this.wrapper.style.top=g.y1+"px",this.wrapper.style.width=Math.abs(u-o)+"px",this.wrapper.style.height=Math.abs(h-r)+"px";const v={x1:Math.min(c,f),x2:Math.max(c,f),y1:Math.min(d,m),y2:Math.max(d,m)};n=e.filter(y=>rectanglesIntersect(v,y)?!0:(_||(y.state="normal",y.n.view.state="normal"),!1)).map(({n:y,state:b})=>(b!=="active"&&(b="selected",y.view.state="selected"),y))},5);this.view.once("mouseup",()=>{s(),this.hide(),this.emit("selection",n)})}projectBox(e){const{x:n,y:s}=this.view.projectWindowToLocal(e.x1,e.y1),{x:o,y:r}=this.view.projectWindowToLocal(e.x2,e.y2);return{x1:n,y1:s,x2:o,y2:r}}hide(){this.wrapper.classList.remove("box-selection-visible")}}var NodeOutputView$1="";class NodeOutputView{constructor(e){this.connections=[],this.output=e,this.node=e.node,this.wrapper=document.createElement("div"),this.wrapper.classList.add("node-output-wrapper"),this.wrapper.classList.add(`socket-type-${e.type}`),e.node.view.outputWrapper.appendChild(this.wrapper),this.wrapper.addEventListener("mousedown",n=>{n.stopPropagation(),n.preventDefault(),this.node.system.view.createFloatingConnection(this.output)},!1),this.node.system.view.colorStore.on(e.type,n=>{const s=window.getComputedStyle(this.wrapper,null).getPropertyValue("background-color");this.wrapper.style.backgroundColor=s!=="rgba(0, 0, 0, 0)"&&s!=="rgb(0,0,0)"?s:n})}remove(){this.wrapper.remove(),this.connections.forEach(e=>e.remove())}set state(e){this.wrapper.classList.forEach(n=>{n.includes("socket-state-")&&this.wrapper.classList.remove(n)}),e&&e.length&&this.wrapper.classList.add("socket-state-"+e)}updatePosition(){this.rect=this.wrapper.getBoundingClientRect(),this.output.connections.forEach(e=>e.view.setPosition({x1:this.x,y1:this.y}))}get x(){return this.node.view.x+this.node.view.width+3}get y(){const e=this.node.system.view;return(this.rect.y+this.rect.height/2-e.y-e.top)/e.s-e.height/2}}class NodeOutput{constructor(e,n){if(this.connections=[],this.node=e,this.type=n,Array.isArray(n))throw new Error("Output can only output one type, not "+n)}bindView(){this.view=new NodeOutputView(this)}connectTo(e){const n=this.node.outputs.indexOf(this);return this.node.connectTo(e.node,n,e.key)}removeConnection(e){const n=this.connections.indexOf(e);this.connections.splice(n,1),this.node.disconnectFrom(e.input.node,e.indexIn,e.indexOut),this.view&&this.view.connections.splice(n,1)}setConnection(e){this.connections.push(e),this.view&&this.view.connections.push(e.view)}remove(){this.connections.forEach(e=>e.remove())}}class FloatingConnectionView extends aggregate(ConnectionView,EventEmitter){constructor(e,n={}){const{system:s}=e.node;super({},e);this.view=s.view,this.path.style.zIndex="999";const o=Array.isArray(e.type)?e.type[0]:e.type;s.view.colorStore.on(o,m=>{this.path.style.stroke=m}),e.view.updatePosition();const r=e.view.x,c=e.view.y;let d=r,u=c;n&&(d=n.x-s.view.width/2,u=n.y-s.view.height/2),this.setPosition({x1:r,y1:c,x2:d,y2:u}),this.dx2=this.x2,this.dy2=this.y2,this.isInput=e instanceof NodeInput,this.allSockets=e instanceof NodeInput?s.getOutputs(e.type):s.getInputs(e.type),this.allSockets.forEach(m=>m.view.state="potential");let h=this.allSockets.filter(m=>m.node.attributes.id!==e.node.attributes.id);h.forEach(m=>m.view.state="middle");const f="connection"in e?[e.connection]:e.connections;if(f&&!!f.length){const m=f.map(_=>[_.input,_.output]).flat();h=h.filter(_=>!m.includes(_))}this.potentialSockets=h,this.potentialSockets.forEach(m=>m.view.updatePosition()),this.potentialSockets.forEach(m=>m.view.state="highlight"),this._unsubMouseUp=this.view.on("mouseup",this.handleMouseUp.bind(this)),this._unsubMouseMove=this.view.on("mousemove",this.handleMouseMove.bind(this)),this.mdx=this.view.mx,this.mdy=this.view.my,this.socket=e}handleMouseUp(e){const{x:n,y:s,keys:o}=e;this._unsubMouseUp(),this._unsubMouseMove(),this.allSockets.forEach(d=>d.view.state="");let r,c=0;this.socket instanceof NodeInput&&this.hoveredSocket instanceof NodeOutput?(r=this.socket.key,c=this.hoveredSocket.node.outputs.indexOf(this.hoveredSocket)):this.socket instanceof NodeOutput&&this.hoveredSocket instanceof NodeInput&&(r=this.hoveredSocket.key,c=this.socket.node.outputs.indexOf(this.socket)),this.hoveredSocket?(this.emit("connection",{keyIn:r,indexOut:c,inputNode:this.isInput?this.socket.node:this.hoveredSocket.node,outputNode:this.isInput?this.hoveredSocket.node:this.socket.node}),this.remove()):o.ctrlKey?this.view.addMenu.show({x:n,y:s,socket:this.socket}).then(d=>this.view.system.createNode(d)).then(d=>{this.socket instanceof NodeOutput?this.socket.node.connectTo(d,c,r):d.connectTo(this.socket.node,c,r)}).catch(()=>{}).finally(()=>{this.remove()}):this.remove()}handleMouseMove(e){const{x:n,y:s}=e;this.mdx||(this.mdx=n,this.mdy=s);const o=this.dx2+(n-this.mdx),r=this.dy2+(s-this.mdy),c=20,d=this.potentialSockets.map(u=>{const{x:h,y:f}=u.view;return{socket:u,distance:Math.abs(o-h)+Math.abs(r-f)}}).filter(u=>u.distance<c).sort((u,h)=>u.distance>h.distance?-1:1).map(u=>u.socket);if(d.length){const{x:u,y:h}=d[0].view;this.hoveredSocket=d[0],this.setPosition({x2:u,y2:h})}else this.hoveredSocket=void 0,this.setPosition({x2:o,y2:r})}remove(){super.remove()}}var NodeSystemView$1="";const COLORS=[{color:"#a52a2a",name:"brown"},{color:"#008000",name:"green"},{color:"#4b0082",name:"indigo"},{color:"#f0e68c",name:"khaki"},{color:"#add8e6",name:"lightblue"},{color:"#e0ffff",name:"lightcyan"},{color:"#90ee90",name:"lightgreen"},{color:"#d3d3d3",name:"lightgrey"},{color:"#ffb6c1",name:"lightpink"},{color:"#ffffe0",name:"lightyellow"},{color:"#00ff00",name:"lime"},{color:"#ff00ff",name:"magenta"},{color:"#800000",name:"maroon"},{color:"#000080",name:"navy"},{color:"#808000",name:"olive"},{color:"#ffa500",name:"orange"},{color:"#ffc0cb",name:"pink"},{color:"#800080",name:"purple"},{color:"#800080",name:"violet"},{color:"#ff0000",name:"red"},{color:"#c0c0c0",name:"silver"},{color:"#ffffff",name:"white"}];class ColorStore extends EventEmitter{constructor(){super();this.colors={boolean:"#f00",number:"#fff",plant:"#65e2a0",vec3:"#6363C7"},this.index=0}setType(e){e in this.colors||(this.colors[e]=COLORS[this.index].color,this.index++),this.emit(e,this.colors[e])}on(e,n){return this.setType(e),n(this.colors[e]),super.on(e,n)}}class NodeSystemView extends EventEmitter{constructor(e){super();var n,s,o,r;this.colorStore=new ColorStore,this.width=0,this.height=0,this.top=0,this.left=0,this.x=window.innerWidth/2,this.y=window.innerHeight/2,this.s=1,this.mx=0,this.my=0,this.mdx=0,this.mdy=0,this.rmx=0,this.rmy=0,this.mouseDown=!1,this.keyMap={},this.selectedNodes=[],this.selectedNodesDown=[],this.clipboard=[],this.system=e,this.wrapper=(s=(n=e.options)==null?void 0:n.wrapper)!=null?s:document.createElement("div"),this.wrapper.classList.add("nodesystem-wrapper"),e.options.parent&&e.options.parent.appendChild(this.wrapper),this.transformWrapper=document.createElement("div"),this.transformWrapper.classList.add("nodesystem-transform"),this.wrapper.appendChild(this.transformWrapper),this.nodeContainer=document.createElement("div"),this.nodeContainer.classList.add("nodes-container"),this.transformWrapper.append(this.nodeContainer),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("viewBox","0 0 1 1"),this.svg.setAttribute("height","1"),this.svg.setAttribute("width","1"),this.svg.setAttribute("preserveAspectRatio","none"),this.svg.style.transform=`scale(${(o=window.devicePixelRatio)!=null?o:1})`,this.transformWrapper.appendChild(this.svg),this.addMenu=new RightClickMenu(this),this.boxSelection=new BoxSelectionView(this),this.boxSelection.on("selection",c=>{this.selectedNodes=c}),this.dpr=(r=window.devicePixelRatio)!=null?r:1,this.bindEventListeners(),this.handleResize(),setTimeout(()=>{this.setTransform({x:0,y:0,s:1})},1)}createFloatingConnection(e){new FloatingConnectionView(e,{x:this.mx,y:this.my}).once("connection",({inputNode:s,outputNode:o,keyIn:r,indexOut:c})=>{o.connectTo(s,c,r)})}setActive(e,{shiftKey:n=!1,ctrlKey:s=!1}={}){if(!e)this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.selectedNodes.forEach(o=>o.view.state="normal"),this.selectedNodes=[];else if(n&&s){if(this.activeNode&&(this.activeNode.view.state="normal",this.activeNode=void 0),this.activeNode=e,this.activeNode.view.state="active",this.activeNode.outputs.length){const o=this.system.createNode({state:{},attributes:{type:"debug",id:"0",name:"debug",refs:[],pos:{x:this.activeNode.view.x+this.activeNode.view.width+10,y:this.activeNode.view.y}}});o.enableUpdates=!0,this.activeNode.connectTo(o,0,"input")}}else n?this.activeNode?(this.selectedNodes.push(this.activeNode),this.activeNode.view.state="selected",this.activeNode=e,this.activeNode.view.state="active"):(this.activeNode=e,this.activeNode.view.state="active"):this.activeNode?(this.selectedNodes.forEach(o=>o.view.state="normal"),this.selectedNodes=[],this.activeNode!==e&&(this.activeNode.view.state="normal",this.activeNode=e,this.activeNode.view.state="active")):(this.activeNode=e,this.activeNode.view.state="active")}getSelectedNodes(){return this.activeNode&&this.selectedNodes.includes(this.activeNode)?this.selectedNodes:this.activeNode?[...this.selectedNodes,this.activeNode]:[...this.selectedNodes]}projectLocalToWindow(e,n){const s=e+this.x,o=n+this.y,r=s*this.s,c=o*this.s;return{x:r,y:c}}projectWindowToLocal(e,n){const s=e-this.x,o=n-this.y,r=s/this.s,c=o/this.s;return{x:r,y:c}}setTransform({x:e=this.x,y:n=this.y,s=this.s}={}){this.x=e,this.y=n,this.s=s/this.dpr,this.panzoom.setTransform(e,n,s/this.dpr)}bindEventListeners(){window.addEventListener("keydown",e=>this.handleKeyDown(e)),window.addEventListener("keyup",e=>this.handleKeyUp(e)),this.wrapper.addEventListener("mousemove",e=>this.handleMouseMove(e)),this.wrapper.addEventListener("mousedown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("touchdown",e=>this.handleMouseDown(e)),this.wrapper.addEventListener("mouseup",e=>this.handleMouseUp(e)),window.addEventListener("resize",throttle(()=>this.handleResize(),10)),this.panzoom=createPanZoom(this.transformWrapper,{minZoom:.2,maxZoom:5,onTransform:({x:e,y:n,scale:s})=>{this.x=e,this.y=n,this.s=s,this.wrapper.style.backgroundPosition=`${e}px ${n}px`,this.wrapper.style.backgroundSize=s*this.height*.02+"% "+s*this.width*.02+"%",this.wrapper.style.backgroundOrigin=`${e}px ${n}px`,window.t={x:e,y:n,s},this.system.setMetaData({transform:{x:e,y:n,s}})}})}handleResize(){const{width:e,height:n,top:s,left:o}=this.wrapper.getBoundingClientRect();this.width=e,this.height=n,this.top=s,this.left=o,this.emit("resize",{width:e,height:n})}handleMouseMove(e){this.ev=e;const{clientX:n,clientY:s,shiftKey:o,ctrlKey:r}=e;this.rmx=n-this.left,this.rmy=s-this.top;const{x:c,y:d}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=c,this.my=d,this.emit("mousemove",{x:c,y:d,mx:this.rmx,my:this.rmy,keys:z(A({},this.keyMap),{shiftKey:o,ctrlKey:r})})}handleMouseDown(e){const{shiftKey:n,ctrlKey:s,clientX:o,clientY:r,button:c,target:d}=e;n||this.setActive(),this.mouseDown=!0,this.rmx=o-this.left,this.rmy=r-this.top;const{x:u,y:h}=this.projectWindowToLocal(this.rmx,this.rmy);this.mx=u,this.my=h,this.selectedNodesDown=this.selectedNodes.map(f=>[f.view.x,f.view.y]),this.emit("mousedown",{x:u,y:h,mx:this.rmx,my:this.rmy,target:d,keys:z(A({},this.keyMap),{shiftKey:n,ctrlKey:s,button:c})})}handleMouseUp({clientX:e,clientY:n,shiftKey:s,ctrlKey:o}){this.mouseDown=!1;const r=e-this.left,c=n-this.top;this.emit("mouseup",{x:r,y:c,keys:z(A({},this.keyMap),{shiftKey:s,ctrlKey:o})})}handleKeyUp({key:e}){e===" "&&(e="space"),delete this.keyMap[e&&e.toLowerCase()],this.emit("keyup",{key:e,keys:this.keyMap})}handleKeyDown({key:e,ctrlKey:n,shiftKey:s}){switch(e=e===" "?"space":e.toLowerCase(),this.keyMap[e&&e.toLowerCase()]=!0,e==="space"&&this.ev&&this.handleMouseDown(this.ev),e){case"a":s&&this.addMenu.show({x:this.rmx,y:this.rmy}).then(o=>{this.system.createNode(o)}).catch();break;case"c":if(s&&n)localStorage.clear(),window.location.reload();else if(n){const o=this.selectedNodes.splice(0);this.activeNode&&!o.includes(this.activeNode)&&o.push(this.activeNode),this.clipboard=o.map(r=>r.deserialize())}else this.selectedNodes.length&&this.activeNode&&this.selectedNodes[0].connectTo(this.activeNode);break;case"f":this.setTransform({x:0,y:0,s:1});break;case"g":this.keyMap.g||(this.mdx=this.mx,this.mdy=this.my,this.selectedNodesDown=this.selectedNodes.map(o=>[o.view.x,o.view.y]));break;case"x":this.activeNode&&(n?this.system.spliceNode(this.activeNode):this.system.removeNode(this.activeNode)),this.selectedNodes.forEach(o=>o.remove());break;case"y":this.system.history&&n&&this.system.history.redo();break;case"z":this.system.history&&n&&this.system.history.undo();break;case"l":this.activeNode&&(console.log(this.activeNode),console.log(this.activeNode.deserialize()));break;case"v":if(n){const o=this.clipboard.sort((h,f)=>{const{pos:{x:m=0,y:_=0}={}}=h.attributes,{pos:{x:g=0,y:v=0}={}}=f.attributes;return m+_<g+v?-1:1});let{pos:{x:r=0,y:c=0}={}}=o[0].attributes;const{x:d,y:u}=this.projectWindowToLocal(this.mx,this.my);r-=d,c-=u,this.clipboard.map(h=>{const{pos:{x:f=0,y:m=0}={}}=h.attributes;return h.attributes.pos={x:f-r,y:m-c},h}).forEach(h=>this.system.createNode(h))}break}this.emit("keydown",{key:e,keys:z(A({},this.keyMap),{ctrlKey:n})})}}class NodeFactory{constructor(e){this.id=genId(),this.system=e,this.log=new Logger(this),this.log.info("Initialized")}reset(){this.id.reset(),this.log.info("Reset id generator")}create(e){const{attributes:n}=e,s=n.type.toLowerCase(),o=this.system.store.getByName(s);n.id=this.id(+n.id);const r=new o.node(this.system,e);if(this.system.options.view&&o.view){const c=new o.view(r);r.bindView(c)}return s==="output"&&this.system.setOutputNode(r),this.log.info(`Created node with type ${n.type}`,e),r}}class NodeHistory{constructor(e){this.system=e,this.history=[],this.historyIndex=-1,this.isApplyingChanges=!1,this.log=new Logger(this),this.log.info("Instantiated"),this.addAction=(()=>{let n;return()=>{!this.system.isLoaded||this.isApplyingChanges||(n?clearTimeout(n):this.prevState=this.system.serialize().nodes,n=setTimeout(()=>{this._addAction(),n=!1},200))}})().bind(this)}_addAction(){if(this.log.info("Register History Step"),this.isApplyingChanges)return;this.historyIndex!==this.history.length-1&&(this.history.length=this.historyIndex+1);const e=this.system.serialize().nodes,[n,s]=diffBoth(this.prevState,e);!s||!n||(this.history.push({previous:s,next:n}),this.history.length>60&&(this.history=this.history.reverse().slice(0,60).reverse()),this.historyIndex=this.history.length-1)}serialize(){return{steps:this.history,index:this.historyIndex}}deserialize(e){this.historyIndex=e.index,this.history=e.steps}undo(){if(this.isApplyingChanges)return;if(this.isApplyingChanges=!0,this.historyIndex<0){this.log.info("Reached beginning of Stack"),this.isApplyingChanges=!1;return}const{previous:e}=this.history[this.historyIndex],n=this.system.serialize(),s=mergeObjects(n.nodes,e);n.nodes=s,this.system.load(n),this.historyIndex--,this.isApplyingChanges=!1}redo(){if(this.isApplyingChanges)return;if(this.isApplyingChanges=!0,this.historyIndex>=this.history.length-1){this.log.info("Reached end of Stack"),this.isApplyingChanges=!1;return}const{next:e}=this.history[this.historyIndex+1],n=this.system.serialize(),s=mergeObjects(n.nodes,e);n.nodes=s,this.system.load(n),this.historyIndex++,this.isApplyingChanges=!1}}class NodeParser{constructor(i){this.system=i}parseSystem(i){const{nodes:e}=i,n=new Map,s=e.map(o=>{const r=this.system.factory.create(o);return r.enableUpdates=!1,n.set(r.id,r),r});return s.forEach(o=>{o.attributes.refs&&o.attributes.refs.forEach(r=>{const c=n.get(r.id);if(!c)throw new Error(`Failed ref: from ${o.attributes.name||o.attributes.id} to ${r.id} `);o.connectTo(c,r.out,r.in)})}),s.forEach(o=>{o.enableUpdates=!0,o.update()}),s}parseType(typeData){const{compute,meta,outputs,title:name,parameters}=typeData,TempNode=eval(`(outputs, compute) => class ${name} extends Node {
      constructor(system, props) {
        super(system, props);
        if (compute) this.compute = compute;

        if (outputs) {
          const _outputs = Array.isArray(outputs) ? outputs : [outputs];
          this.outputs = _outputs.map((s) => new NodeOutput(this, s));
        }

        Object.entries(parameters).forEach(([key, template]) => {
          this.states[key] = new NodeState(this, key, template);
        });
      }
    }`)(outputs,compute,NodeState,NodeOutput,Node),inputs=Object.values(parameters).filter(i=>i.internal!==!0).map(i=>i.type);if(this.system.options.view){const i=class extends NodeView{constructor(n){super(n)}};return z(A({},typeData),{inputs,title:name,meta,node:TempNode,view:i})}return z(A({inputs},typeData),{title:name,meta,node:TempNode})}getData(){return{meta:this.system.meta,nodes:this.system.nodes.map(i=>i.deserialize())}}}const log$4=log$8("NodeTypeStore");class NodeTypeStore extends EventEmitter{constructor(){super();this.types=[],this.typeMap={}}add(e){log$4("register new type "+e.title,e),this.types=[...this.types.filter(n=>n.title.toLowerCase()!==e.title.toLowerCase()),e],this.typeMap[e.title.toLowerCase()]=e,this.emit("types",this.types),this.emit("type",e)}getByName(e){if(e in this.typeMap)return this.typeMap[e];throw new Error("NodeTypeStore: type "+e+" does not exist")}}var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(i,e,n,s)=>{for(var o=s>1?void 0:s?__getOwnPropDesc(e,n):e,r=i.length-1,c;r>=0;r--)(c=i[r])&&(o=(s?c(e,n,o):c(o))||o);return s&&o&&__defProp(e,n,o),o};let systemID=0;class NodeSystem extends EventEmitter{constructor(e={}){super();this.parser=new NodeParser(this),this.meta={lastSaved:Date.now()},this.isLoaded=!1,this.isPaused=!1,this.nodes=[],this.states=[],this.id=systemID++;const{view:n=!1,wrapper:s,defaultNodes:o=!1,registerNodes:r=!1,logLevel:c=5}=e;this.options={view:n,wrapper:s};try{if(this.log=new Logger(this,c),this.log.group(`Instantiated id:${this.id}`),this.store=new NodeTypeStore,this.factory=new NodeFactory(this),this.history=new NodeHistory(this),n&&(this.view=new NodeSystemView(this)),o){const d=[];o===!0?d.push(...Object.entries(types).map(u=>u[1])):Array.isArray(o)&&o.length&&o.forEach(u=>{typeof u=="string"&&u in types&&d.push(types[u])}),d.forEach(u=>this.registerNodeType(u))}r&&r.length&&r.forEach(this.registerNodeType.bind(this)),this.log.groupEnd()}catch(d){this.emit("error",{type:"init",error:d})}}get result(){return this._result}set result(e){this._result=e,this.isLoaded&&this.emit("result",e)}setMetaData(e){this.meta=A(A({},this.meta),e),this.save()}load(e){try{this.isLoaded=!1,this.isPaused=!0,this.nodes.forEach(s=>s.enableUpdates=!1),this.nodes.forEach(s=>s.remove()),this.factory.reset();const n=this.parser.parseSystem(e);return this.addNodes(n),this.meta=e.meta||{lastSaved:0},this.meta.lastSaved=Date.now(),this.view&&this.view.setTransform(this.meta.transform),this.log.info(`Loaded NodeSystemData with ${n.length} Nodes`,e),"history"in e&&this.history.deserialize(e.history),this.isPaused=!1,this.isLoaded=!0,this.result=this._result,this}catch(n){this.emit("error",{type:"loading",error:n})}}serialize(){return z(A({},this.parser.getData()),{history:this.history.serialize(),meta:this.meta})}save(){this.isLoaded&&(this.meta.lastSaved=Date.now(),this.log.info("save system",this.serialize()),this.emit("save",this.serialize()))}setOutputNode(e){this.outputNode&&this.outputNode.remove(),this.outputNode=e,e.on("computedData",n=>this.result=n)}addNodes(e){e.forEach(n=>this.addNode(n))}addNode(e){this.history.addAction(),this.nodes.push(e),this.save()}removeNode(e){this.history.addAction(),e.enableUpdates=!1,e.view.remove(),Object.values(e.states).forEach(n=>n.remove()),e.outputs.forEach(n=>n.remove()),e.getInputs().forEach(n=>n.remove()),this.nodes=this.nodes.filter(n=>n!==e),this.save(),this.log.info(`Removed Node id:${e.id} type:${e.attributes.type}`,e.deserialize())}spliceNode(e){const n=e.getInputs().map(o=>{var r;return(r=o==null?void 0:o.connection)==null?void 0:r.output}),s=e.outputs.map(o=>o.connections).flat().map(o=>o.input);for(let o=0;o<n.length;o++){const r=n[o],c=s[o];!c||!r||r.connectTo(c)}return this.removeNode(e)}getSockets(e){const n=this.nodes.map(s=>[...s.getSockets()]).flat();return e?n.filter(s=>s.type===e):n}getInputs(e){const n=this.nodes.map(s=>s.getInputs()).flat();return!e||e==="*"?n:n.filter(s=>s.type.includes("*")||s.type.includes(e))}getOutputs(e){const n=this.nodes.map(s=>s.outputs).flat();return!e||e.includes("*")?n:n.filter(s=>s.type==="*"||e.includes(s.type))}createNode(e){const n=this.factory.create(e);return this.addNode(n),this.save(),this.log.info(`Created new node id:${e.attributes.id} type:${e.attributes.type}`,e),n}getNodes(){return this.nodes}findNodeById(e){return this.nodes.filter(n=>n.id===e)[0]}getNodeTypes(){return this.store.types}registerNodeType(e){if("node"in e)this.store.add(e);else{const n=this.parser.parseType(e);this.store.add(n)}this.log.info(`Registered new nodeType type:${e.title}`,e)}}__decorateClass([Debounce(1e3)],NodeSystem.prototype,"save",1);const savedState=JSON.parse(localStorage.getItem("pt_local_state")),state=A({},savedState),set=debounce((i,e)=>{state[i]=e,localStorage.setItem("pt_local_state",JSON.stringify(state))},100,!1);var localState={get(i,e){var n;return state[i]=(n=state[i])!=null?n:e,state[i]},set},isNode=i=>typeof i=="object"&&"type"in i,uniqID=(()=>{let i=Math.random();return()=>(i=i>0?i-Math.random():i+Math.random(),i.toString().split(".")[1])})();const nodes={};_nodes.forEach(i=>{nodes[i.type]=i,"computeSkeleton"in i&&(i.computeSkeleton=memo(i.computeSkeleton)),"computeGeometry"in i&&(i.computeGeometry=memo(i.computeGeometry)),"computeValue"in i&&(i.computeValue=memo(i.computeValue))});function executeSkeletonNode(i,e){return i.type in nodes&&nodes[i.type].computeSkeleton?nodes[i.type].computeSkeleton(i.computedParameters,e):i.computedParameters}function executeGeometryNode(i,e){return i.type in nodes&&nodes[i.type].computeGeometry?nodes[i.type].computeGeometry(i.computedParameters,i.result,e):i.computedParameters}function executeValueNode(i,e,n){return i.type in nodes&&nodes[i.type].computeValue?nodes[i.type].computeValue(i.computedParameters,e,n):i.computedParameters}const walkSkeletonNode=(i,e)=>(i.computedParameters={},Object.entries(i.parameters).forEach(([n,s])=>{isNode(s)?i.computedParameters[n]=walkSkeletonNode(s,e):i.computedParameters[n]=s}),i.result=executeSkeletonNode(i,e),i),walkGeometryNode=(i,e)=>(i.computedParameters={},Object.entries(i.parameters).forEach(([n,s])=>{isNode(s)?i.computedParameters[n]=walkGeometryNode(s,e):i.computedParameters[n]=s}),i.result=A(A({},i.result),executeGeometryNode(i,e)),i),walkValueNode=(i,e,n)=>{var s;return i.computedParameters=(s=i.computedParameters)!=null?s:{},Object.entries(i.parameters).forEach(([o,r])=>{isNode(r)?i.computedParameters[o]=walkValueNode(r,e,n):i.computedParameters[o]=r}),executeValueNode(i,e,n)};let lastSettings="",lastCtx,currentNoise=0;const createContext=i=>{let e=0;noise.seed=0;let n=uniqID();return{handleParameter(s,o=1){return typeof s=="number"?s:isNode(s)?walkValueNode(s,this,o):s},n1d(s){return noise.n1d(currentNoise++*s)},getSetting(s){return i[s]},get settings(){return i},get seed(){return e},refresh(){currentNoise=0,(i==null?void 0:i.useRandomSeed)&&(e=Math.floor(Math.random()*1e5),noise.seed=e),n=uniqID()}}};var createContext$1=i=>{const e=JSON.stringify(i);return e!==lastSettings&&(lastSettings=e,lastCtx=createContext(i)),lastCtx.refresh(),lastCtx};const log$3=log$8("gen.plant");function plant(i,e){var d;log$3("-------- ~generator started~ --------");const n=performance.now(),s=createContext$1(e),o=walkSkeletonNode(i,s);log$3("final skeleton",o.result);const r=walkGeometryNode(o,s);log$3("final geometry",r);const{result:c}=r;if(c.instances){const u=(d=c.instances)==null?void 0:d.map(h=>convertInstancedGeometry(h)).flat();c.geometry=join(c.geometry,...u)}return log$3("generated in ",Math.floor((performance.now()-n)*10)/10,"ms"),c}function WorkerWrapper(){return new Worker("assets/webWorker.873ef830.js",{type:"module"})}var worker=()=>{const i=WorkerWrapper(),e=wrap(i);let n=!1;async function s(o,r){if(n)return;n=!0;const c=await e.plant(o,r);return n=!1,c}return{plant:s}};let a=0;class Renderer extends EventEmitter{constructor({canvas:e,width:n,height:s,clearColor:o="ffffff",alpha:r=!1,camPos:c=[0,2,4]}={}){super();if(this.scene=new Transform,this.lastCamPos=new Vec3(0,0,0),this.canvas=e,(!n||!s)&&e){const d=e.getBoundingClientRect();n=d.width,s=d.height}this.renderer=new Renderer$1({canvas:e,width:n,premultipliedAlpha:!0,height:s,alpha:r,antialias:!0,dpr:1}),this.gl=this.renderer.gl,this.gl.clearColor(...convertHexToRGB(o),0),this.renderer.gl.canvas&&(this.canvas=this.renderer.gl.canvas),this.camera=new Camera(this.gl,{fov:70,aspect:n/s}),this.lastCamPos.set(c),this.camera.position.set(c),this.camera.lookAt(new Vec3(0,0,0)),e&&(this.controls=new Orbit(this.camera,{element:e,target:new Vec3(0,.2,0),maxPolarAngle:1.6,minDistance:.2,maxDistance:15,ease:.7,rotateSpeed:.5,inertia:.5})),this.bindEventlisteners(),e&&this.render()}setControlTarget(e){Number.isNaN(e.x)||(this.controlTarget||(this.controls.target=e),this.controlTarget=e)}setClearColor(e){this.gl.clearColor(...convertHexToRGB(e),1)}renderScene(e){this.renderer.render({scene:e,camera:this.camera})}render(){requestAnimationFrame(this.render.bind(this)),this.lastCamPos.equals(this.camera.position)||(this.lastCamPos.set(this.camera.position),this.emit("camPos",this.camera.position.toArray())),this.controlTarget&&(this.controlTarget.squaredDistance(this.controls.target)<5e-5?this.controls.target=this.controlTarget:this.controls.target.lerp(this.controlTarget,.05)),window.target=this.controls.target,this.controls.update(),this.renderer.render({scene:this.scene,camera:this.camera}),this.emit("perf",performance.now()-a),a=performance.now()}bindEventlisteners(){const e=throttle(()=>this.handleResize(),500);window.addEventListener("resize",()=>{this.canvas.classList.add("resizing"),e()})}handleResize(){let e=this.canvas.parentElement;e||(e=this.canvas);const{width:n,height:s}=e.getBoundingClientRect();this.renderer.setSize(n,s),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height}),this.canvas.classList.remove("resizing")}}var GroundShaderFrag=`precision highp float;precision highp int;
#define GLSLIFY 1
uniform float uTime;uniform sampler2D tMap;uniform vec3 uFogColor;uniform float uFogNear;uniform float uFogFar;uniform float texScale;varying vec2 vUv;varying vec4 vMVPos;varying vec3 vPos;void main(){vec3 tex=texture2D(tMap,vUv*texScale).rgb;float dist=length(vMVPos);float fog=smoothstep(uFogNear,uFogFar,dist);tex=mix(tex,uFogColor,fog);tex=mix(tex,uFogColor,smoothstep(0.0,-1.0,vPos.y));gl_FragColor.rgb=tex;}`,GroundShaderVert=`precision highp float;precision highp int;
#define GLSLIFY 1
attribute vec2 uv;attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform float uTime;varying vec2 vUv;varying vec4 vMVPos;varying vec3 vPos;void main(){vUv=uv;vec3 pos=position;vPos=pos;vMVPos=modelViewMatrix*vec4(pos,1.0);gl_Position=projectionMatrix*vMVPos;}`,MatCapFrag=`#version 300 es
precision highp float;
#define varying in
#define texture2D texture
#define gl_FragColor FragColor
out vec4 FragColor;precision highp float;
#define GLSLIFY 1
uniform sampler2D tMap;varying vec4 vMVPos;vec3 normals(vec3 pos){vec3 fdx=dFdx(pos);vec3 fdy=dFdy(pos);return normalize(cross(fdx,fdy));}vec2 matcap(vec3 eye,vec3 normal){vec3 reflected=reflect(eye,normal);float m=2.8284271247461903*sqrt(reflected.z+1.0);return reflected.xy/m+0.5;}void main(){vec3 normal=normals(vMVPos.xyz);vec3 mat=texture2D(tMap,matcap(normalize(vMVPos.xyz),normal)).rgb;gl_FragColor.rgb=mat;gl_FragColor.a=1.0;}`,MatCapVert=`#version 300 es
#define GLSLIFY 1
#define attribute in
#define varying out
attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;varying vec4 vMVPos;void main(){vMVPos=modelViewMatrix*vec4(position,1.0);gl_Position=projectionMatrix*vMVPos;}`,ParticleFrag=`precision highp float;
#define GLSLIFY 1
float pointSize=0.02;varying float distToCamera;void main(){vec2 uv=gl_PointCoord.xy;float dist=2.0-distToCamera;float circle=pointSize*dist>length(uv-0.5)?0.8:0.0;float xMask=min(abs(uv.x-0.5),abs(uv.y-0.5));circle=xMask>0.003?0.0:circle;gl_FragColor.rgb=vec3(0.0,0.0,0.0);gl_FragColor.a=circle;}`,ParticleVert=`#define GLSLIFY 1
attribute vec3 position;uniform mat4 modelMatrix;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;varying float distToCamera;void main(){vec4 mPos=modelMatrix*vec4(position,1.0);vec4 mvPos=viewMatrix*mPos;gl_PointSize=300.0/length(mvPos.xyz);distToCamera=-mvPos.z/10.0+1.0;gl_Position=projectionMatrix*mvPos;}`,WireFrameFrag=`precision highp float;precision highp int;
#define GLSLIFY 1
void main(){gl_FragColor=vec4(1.,.9,.4,.7);}`,WireFrameVert=`precision highp float;precision highp int;
#define GLSLIFY 1
attribute vec2 uv;attribute vec3 position;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`;const GroundShader={fragment:GroundShaderFrag,vertex:GroundShaderVert},WireFrameShader={fragment:WireFrameFrag,vertex:WireFrameVert},ParticleShader={fragment:ParticleFrag,vertex:ParticleVert},MatCapShader=i=>{const e=new Texture(i),n=new Image;return n.onload=()=>e.image=n,n.src="assets/matcap_green.jpg",new Program(i,{vertex:MatCapVert,fragment:MatCapFrag,uniforms:{tMap:{value:e}},cullFace:null})},webWorker=worker(),renderer=new Renderer({width:100,height:100,alpha:!0,clearColor:"000"}),nodeSystem$1=new NodeSystem({view:!1,defaultNodes:!1,registerNodes:_nodes}),mesh=new Mesh(renderer.gl,{geometry:new Box(renderer.gl,{width:0,height:0,depth:0}),program:MatCapShader(renderer.gl)}),renderCanvas=document.createElement("canvas");renderCanvas.width=renderCanvas.height=100;const ctx=renderCanvas.getContext("2d");mesh.setParent(renderer.scene);async function renderProject({pd:i,geo:e}){nodeSystem$1.load(i);const n=nodeSystem$1.result;let s;if(e&&(s=e),i&&!s&&(s=(await(await webWorker).plant(n,{stemResX:12,stemResY:12})).geometry),!s)return;mesh.geometry=transferToGeometry(renderer.gl,s),mesh.geometry.computeBoundingBox(),renderer.camera.position.x=mesh.geometry.bounds.center.x,renderer.camera.position.y=mesh.geometry.bounds.center.y;const r=(mesh.geometry.bounds.max.y-mesh.geometry.bounds.center.y)*2/2/Math.tan(Math.PI*renderer.camera.fov/360);renderer.camera.position.z=r,renderer.camera.lookAt(mesh.geometry.bounds.center),renderer.renderScene(renderer.scene),ctx.clearRect(0,0,100,100);for(let c=0;c<1;c++)ctx.drawImage(renderCanvas,0,0),ctx.drawImage(renderer.canvas,0,0),ctx.filter="blur(7px) opacity(0.6) brightness(0.95)";return ctx.filter="blur(0px) drop-shadow(0px 0px 10px rgba(0, 0, 0, 0.8))",ctx.drawImage(renderer.canvas,0,0),renderCanvas.toDataURL("image/webp",1)}class BrowserInfo{constructor(e,n,s){this.name=e,this.version=n,this.os=s,this.type="browser"}}class NodeInfo{constructor(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}}class SearchBotDeviceInfo{constructor(e,n,s,o){this.name=e,this.version=n,this.os=s,this.bot=o,this.type="bot-device"}}class BotInfo{constructor(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}}class ReactNativeInfo{constructor(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}}const SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(i){return i?parseUserAgent(i):typeof document=="undefined"&&typeof navigator!="undefined"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator!="undefined"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(i){return i!==""&&userAgentRules.reduce((e,[n,s])=>{if(e)return e;const o=s.exec(i);return!!o&&[n,o]},!1)}function parseUserAgent(i){const e=matchUserAgent(i);if(!e)return null;const[n,s]=e;if(n==="searchbot")return new BotInfo;let o=s[1]&&s[1].split(".").join("_").split("_").slice(0,3);o?o.length<REQUIRED_VERSION_PARTS&&(o=[...o,...createVersionParts(REQUIRED_VERSION_PARTS-o.length)]):o=[];const r=o.join("."),c=detectOS(i),d=SEARCHBOT_OS_REGEX.exec(i);return d&&d[1]?new SearchBotDeviceInfo(n,r,c,d[1]):new BrowserInfo(n,r,c)}function detectOS(i){for(let e=0,n=operatingSystemRules.length;e<n;e++){const[s,o]=operatingSystemRules[e];if(o.exec(i))return s}return null}function getNodeVersion(){return typeof process!="undefined"&&process.version?new NodeInfo(process.version.slice(1)):null}function createVersionParts(i){const e=[];for(let n=0;n<i;n++)e.push("0");return e}function getBrowser(){return"window"in globalThis}let _user={};(()=>{"sessionStorage"in globalThis||(globalThis.sessionStorage={getItem:i=>{},setItem:(i,e)=>{}})})();if("user"in sessionStorage)try{_user=JSON.parse(sessionStorage.getItem("user"))}catch{}const user$1=writable(_user);user$1.subscribe(i=>{sessionStorage.setItem("user",JSON.stringify(i))});const userStore=user$1,{VITE_API_URL="http://localhost:3000"}={VITE_API_URL:"https://plant-api.jim-fx.com",BASE_URL:"",MODE:"production",DEV:!1,PROD:!0};function parseJwt(i){const n=i.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(n).split("").map(function(o){return"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(s)}const browser=getBrowser(),store$1=(()=>{let i=browser&&localStorage.getItem("token");function e(){if(!i||i.length<10){userStore.set({});return}const n=parseJwt(i);userStore.set({username:n.username,id:n.sub})}return e(),{set token(n){i=n,browser&&localStorage.setItem("token",n),e()},get token(){return i}}})();async function send({method:i,path:e,data:n,isJSON:s=!0}){const o={method:i,headers:{}};n&&(o.headers["Content-Type"]="application/json",o.body=JSON.stringify(n)),store$1.token&&(o.headers["access-token"]=`Bearer ${store$1.token}`);const r=await fetch(`${VITE_API_URL}/${e}`,o);if(r.ok){if(s)try{return await r.json()}catch(d){console.error("Response from "+e+" failed to parse"),console.error(d)}return r.text()}const c=await r.json();return console.error(c),c}function get(i,e={}){return send(A({method:"GET",path:i},e))}function del(i){return send({method:"DELETE",path:i})}function post(i,e){return send({method:"POST",path:i,data:e})}function getReport(i){return send({method:"GET",path:`api/report/${i}`})}function publishReport(i){return send({method:"PUT",path:`api/report/${i}/publish`})}function unpublishReport(i){return send({method:"PUT",path:`api/report/${i}/unpublish`})}function getAvailableLabels(){return send({method:"GET",path:"api/report/labels"})}function setReportLabels(i,e){return send({method:"PUT",path:`api/report/${i}`,data:{labels:e}})}var admin=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getReport,publishReport,unpublishReport,getAvailableLabels,setReportLabels});async function login(i,e){const n=await post("api/auth/login",{username:i,password:e});store$1.token=n.access_token}function logout(){store$1.token=""}function submitReport(i){return send({method:"POST",path:"api/report",data:i})}function deleteReport(i){return del(`api/report/${i}`)}async function getRole(){const i=await get("api/user/role",{isJSON:!1});return userStore.update(e=>(e.role=i,e)),i}async function getPermission(){const i=await get("api/user/permission");return userStore.update(e=>(e.permissions=i,e)),i}var user=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",login,logout,submitReport,deleteReport,getRole,getPermission});A(A({},admin),user);const log$2=log$8("ProjectManager"),PTP_PREFIX="pt_project_";class ProjectManager extends EventEmitter{constructor(){super();this.activeProject=writable(),this.projects={},this.store=writable([]),this.loadProjects()}createNewProject(){const e=Object.values(this.projects).filter(s=>/^DefaultProject((\d)+)?/.test(s.meta.name)).length,n={meta:{name:"DefaultProject"+(e||""),id:shortid(),transform:{x:0,y:0,s:1}},nodes:[{attributes:{pos:{x:-100,y:0},type:"stem",id:"1",refs:[{id:"0",in:"main",out:0}]}},{attributes:{pos:{x:0,y:0},type:"output",id:"0",refs:[]}}]};return log$2("created new plant",n),n}createNew(){const e=this.createNewProject();this.emit("new",e),this.saveProject(e)}async updateProjectMeta(e,n){const s=await this.getProject(e);s.meta=A(A({},s.meta),n),log$2("update meta",e),this.emit("update",s),this.saveProject(s)}async saveProject(e){var s;const n=JSON.parse(JSON.stringify(e));this.projects[n.meta.id]=n,this.emit("save",n),((s=n==null?void 0:n.meta)==null?void 0:s.thumbnail)||this.renderThumbnail({project:n}),await storage.setItem("pt_project_ids",Object.keys(this.projects)),await storage.setItem(PTP_PREFIX+n.meta.id,n),log$2("saved plant id: ",n.meta.id),this.store.set(Object.values(this.projects))}async getProject(e){if(e in this.projects)return this.projects[e];const n=await storage.getItem(PTP_PREFIX+e);return this.projects[e]=n,n}async deleteProject(e){e in this.projects?(delete this.projects[e],await storage.removeItem(PTP_PREFIX+e),await storage.setItem("pt_project_ids",Object.keys(this.projects)),this.store.set(Object.values(this.projects)),this.emit("delete",e),log$2("deleted project with id: "+e)):log$2.warn("cant delete project with id: "+e)}async setActiveProject(e){if(this.loadingActiveProject&&await this.loadingActiveProject,e===this.activeProjectId)return;this.activeProjectId=e,this.loadingActiveProject=this.getProject(e);const n=await this.loadingActiveProject;this.loadingActiveProject?(this.activeProjectId=e,this.saveProject(n),this.activeProject.set(n),await storage.setItem("pt_active_id",e),log$2("set active project to id: "+e),this.emit("load",n),delete this.loadingActiveProject):log$2.warn("cant find plant with id: "+e)}async renderThumbnail({project:e,geo:n}){var d;const s=((d=e==null?void 0:e.meta)==null?void 0:d.id)||this.activeProjectId;if(!(s in this.projects))return;const o=performance.now(),r=await renderProject(n?{geo:n}:{pd:e}),c=performance.now()-o;this.projects[s].meta.thumbnail=r,log$2("generated thumbnail for "+s+" in "+Math.floor(c)+"ms"),this.saveProject(this.projects[s]),this.store.set(Object.values(this.projects))}async loadProjects(){const e=await storage.getItem("pt_project_ids")||[];log$2("loaded project ids",e);const n=await storage.getItem("pt_active_id");if(!e.length){const s=this.createNewProject();e.push(s.meta.id),await this.saveProject(s)}await Promise.all(e.map(async s=>{const o=await this.getProject(s);log$2("loaded ",s),this.projects[s]=o})),n&&e.includes(n)?this.setActiveProject(n):this.setActiveProject(e[0]),this.store.set(Object.values(this.projects))}setProject(e){this.plant=e,this.emit("plant",e)}getActiveProject(){return this.plant}setSettings(e){this.emit("settings",e)}}var Project_svelte_svelte_type_style_lang="";function create_fragment$f(i){let e,n,s,o,r,c,d,u,h,f=time(Date.now()-i[0].meta.lastSaved)+"",m,_,g,v,y,b,w,S,k;return{c(){e=element("div"),n=element("div"),s=space(),o=element("div"),r=element("div"),c=element("input"),u=space(),h=element("p"),m=text(f),_=text(" ago"),g=space(),v=element("div"),y=space(),b=element("div"),w=element("button"),w.textContent="delete",attr(n,"class","project-image svelte-cu2aw0"),set_style(n,"background-image","url("+i[0].meta.thumbnail+")"),attr(c,"contenteditable",""),c.value=d=i[0].meta.name,attr(c,"class","svelte-cu2aw0"),attr(h,"class","svelte-cu2aw0"),attr(r,"class","project-content-header svelte-cu2aw0"),attr(v,"class","project-content-main svelte-cu2aw0"),attr(w,"class","delete svelte-cu2aw0"),attr(b,"class","project-content-footer svelte-cu2aw0"),attr(o,"class","project-content svelte-cu2aw0"),attr(e,"class","project-wrapper svelte-cu2aw0"),toggle_class(e,"active",i[0].meta.id===projectManager.activeProjectId||i[1])},m($,P){insert($,e,P),append(e,n),append(e,s),append(e,o),append(o,r),append(r,c),append(r,u),append(r,h),append(h,m),append(h,_),append(o,g),append(o,v),append(o,y),append(o,b),append(b,w),S||(k=[listen(c,"blur",i[3]),listen(c,"keydown",i[4]),listen(w,"click",stop_propagation(i[5])),listen(e,"resize",alert),listen(e,"click",i[6])],S=!0)},p($,[P]){P&1&&set_style(n,"background-image","url("+$[0].meta.thumbnail+")"),P&1&&d!==(d=$[0].meta.name)&&c.value!==d&&(c.value=d),P&1&&f!==(f=time(Date.now()-$[0].meta.lastSaved)+"")&&set_data(m,f),P&3&&toggle_class(e,"active",$[0].meta.id===projectManager.activeProjectId||$[1])},i:noop,o:noop,d($){$&&detach(e),S=!1,run_all(k)}}}function instance$c(i,e,n){let{project:s}=e,o=!1;function r(){return n(1,o=!0),setTimeout(()=>{n(1,o=!1)},100),!0}const c=function(){const f=this.value.split(`
`).join("").trim();projectManager.updateProjectMeta(s.meta.id,{name:f})},d=function(f){if(f.key==="Enter"){const m=this.value.split(`
`).join("").trim();this.blur(),f.preventDefault(),projectManager.updateProjectMeta(s.meta.id,{name:m})}},u=()=>projectManager.deleteProject(s.meta.id),h=()=>r()&&projectManager.setActiveProject(s.meta.id);return i.$$set=f=>{"project"in f&&n(0,s=f.project)},[s,o,r,c,d,u,h]}class Project extends SvelteComponent{constructor(e){super();init(this,e,instance$c,create_fragment$f,safe_not_equal,{project:0})}}var ProjectManagerView_svelte_svelte_type_style_lang="";function get_each_context$4(i,e,n){const s=i.slice();return s[9]=e[n],s}function create_else_block$2(i){let e;return{c(){e=element("div"),attr(e,"class","svelte-7wgw1o")},m(n,s){insert(n,e,s)},p:noop,d(n){n&&detach(e)}}}function create_if_block_2$3(i){let e,n,s;return{c(){e=element("input"),attr(e,"type","text"),attr(e,"class","search svelte-7wgw1o"),attr(e,"placeholder","Search")},m(o,r){insert(o,e,r),set_input_value(e,i[1]),n||(s=listen(e,"input",i[8]),n=!0)},p(o,r){r&2&&e.value!==o[1]&&set_input_value(e,o[1])},d(o){o&&detach(e),n=!1,s()}}}function create_if_block$5(i){let e,n,s=i[2],o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$4(get_each_context$4(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){e=element("div");for(let c=0;c<o.length;c+=1)o[c].c();attr(e,"class","project-list svelte-7wgw1o")},m(c,d){insert(c,e,d);for(let u=0;u<o.length;u+=1)o[u].m(e,null);n=!0},p(c,d){if(d&6){s=c[2];let u;for(u=0;u<s.length;u+=1){const h=get_each_context$4(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$4(h),o[u].c(),transition_in(o[u],1),o[u].m(e,null))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){c&&detach(e),destroy_each(o,c)}}}function create_if_block_1$4(i){let e,n;return e=new Project({props:{project:i[9]}}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&4&&(r.project=s[9]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_each_block$4(i){let e=showProject(i[1],i[9]),n,s,o=e&&create_if_block_1$4(i);return{c(){o&&o.c(),n=empty()},m(r,c){o&&o.m(r,c),insert(r,n,c),s=!0},p(r,c){c&6&&(e=showProject(r[1],r[9])),e?o?(o.p(r,c),c&6&&transition_in(o,1)):(o=create_if_block_1$4(r),o.c(),transition_in(o,1),o.m(n.parentNode,n)):o&&(group_outros(),transition_out(o,1,1,()=>{o=null}),check_outros())},i(r){s||(transition_in(o),s=!0)},o(r){transition_out(o),s=!1},d(r){o&&o.d(r),r&&detach(n)}}}function create_fragment$e(i){let e,n,s,o,r,c,d,u,h,f;n=new ResizeObserver_1({}),n.$on("resize",i[6]);function m(y,b){return y[2].length>3?create_if_block_2$3:create_else_block$2}let _=m(i),g=_(i),v=i[0]&&create_if_block$5(i);return{c(){e=element("div"),create_component(n.$$.fragment),s=space(),o=element("div"),r=element("button"),r.innerHTML='<p class="svelte-7wgw1o">new</p>',c=space(),g.c(),d=space(),v&&v.c(),attr(r,"class","add-new svelte-7wgw1o"),attr(o,"class","header svelte-7wgw1o"),attr(e,"class","project-manager-wrapper svelte-7wgw1o"),attr(e,"style",`width: ${i[4]}px; height: ${i[5]}px;`)},m(y,b){insert(y,e,b),mount_component(n,e,null),append(e,s),append(e,o),append(o,r),append(o,c),g.m(o,null),append(e,d),v&&v.m(e,null),u=!0,h||(f=listen(r,"click",i[7]),h=!0)},p(y,[b]){_===(_=m(y))&&g?g.p(y,b):(g.d(1),g=_(y),g&&(g.c(),g.m(o,null))),y[0]?v?(v.p(y,b),b&1&&transition_in(v,1)):(v=create_if_block$5(y),v.c(),transition_in(v,1),v.m(e,null)):v&&(group_outros(),transition_out(v,1,1,()=>{v=null}),check_outros())},i(y){u||(transition_in(n.$$.fragment,y),transition_in(v),u=!0)},o(y){transition_out(n.$$.fragment,y),transition_out(v),u=!1},d(y){y&&detach(e),destroy_component(n),g.d(),v&&v.d(),h=!1,f()}}}function showProject(i,e){if(!i||i.length<1)return!0;const n=e.meta.name.toLowerCase();return i=i.toLowerCase(),!!(n.includes(i)||i.includes(n))}function instance$b(i,e,n){let s;const{store:o}=projectManager;component_subscribe(i,o,_=>n(2,s=_));let{visible:r}=e,c;const{width:d,height:u}=localState.get("projectManagerSize",{width:300,height:window.innerHeight/2}),h=_=>{r&&localState.set("projectManagerSize",{width:_.detail.clientWidth,height:_.detail.clientHeight})},f=()=>projectManager.createNew();function m(){c=this.value,n(1,c)}return i.$$set=_=>{"visible"in _&&n(0,r=_.visible)},[r,c,s,o,d,u,h,f,m]}class ProjectManagerView extends SvelteComponent{constructor(e){super();init(this,e,instance$b,create_fragment$e,safe_not_equal,{visible:0})}}var index$1="";const template={enableSync:{type:"boolean",defaultValue:!1},useRandomSeed:{type:"boolean",defaultValue:!1},theme:{type:"select",values:["dark","light"],defaultValue:"dark"},debug:{onlyDev:!0,options:{renderPerf:{type:"boolean",defaultValue:!1},generatePerf:{type:"boolean",defaultValue:!1},pd:{type:"boolean",defaultValue:!1},skeleton:{type:"boolean",defaultValue:!1},wireframe:{type:"boolean",defaultValue:!1},logLevel:{type:"number",min:0,max:2,defaultValue:1}}},background:{options:{grid:{label:"Show Grid",type:"boolean",defaultValue:!1},ground:{label:"Show Ground",type:"boolean",defaultValue:!0},resX:{onlyDev:!0,type:"number",min:8,max:64,step:1,defaultValue:8},resY:{onlyDev:!0,type:"number",min:8,max:64,step:1,defaultValue:16},scale:{type:"number",min:0,max:5,step:.1,defaultValue:1}}},leafRes:{onlyDev:!0,type:"number",min:3,max:12,step:1,defaultValue:2},stemResX:{onlyDev:!0,type:"number",min:3,max:32,step:1,defaultValue:3},stemResY:{onlyDev:!0,type:"number",min:3,max:64,step:1,defaultValue:32},isDev:{label:"Advanced",type:"boolean",defaultValue:!1}},log$1=log$8("SettingsManager"),templateToSettings=(i,e)=>{const n={};return Object.entries(i).forEach(([s,o])=>{var c;const r=e&&s in e?e[s]:void 0;"options"in o?n[s]=templateToSettings(o.options,r):n[s]=(c=r!=null?r:o.defaultValue)!=null?c:o.value}),n},resolveDeep=(i,e)=>{const n=e.shift();if(n&&n in i)return e.length?resolveDeep(i[n],e):i[n]},keyToPath=i=>i.includes(".")?i.split("."):[i];class SettingsManager extends EventEmitter{constructor(){super();this.settings={},this.store=writable(this.settings),this._save=debounce(()=>{storage.setItem("pt_settings",this.settings)},500,!1)}save(){var e,n,s;this.emit("settings",this.settings),log$8.setLevel((s=(n=(e=this.settings)==null?void 0:e.debug)==null?void 0:n.logLevel)!=null?s:2),this.store.set(this.settings),log$1("save settings",this.settings),this._save()}async loadFromLocal(){var n,s,o;const e=await storage.getItem("pt_settings")||{};this.settings=templateToSettings(template,e),log$8.setLevel((o=(s=(n=this.settings)==null?void 0:n.debug)==null?void 0:s.logLevel)!=null?o:2),this.store.set(this.settings),log$1("loaded settings from local",this.settings),this.emit("settings",this.settings)}set(e,n){const s=keyToPath(e);if(s.length>1){const o=s.pop(),r=resolveDeep(this.settings,s);r&&(r[o]=n)}else this.settings[s[0]]=n;log$1(`Set ${s}`,n),this.emit(s+".update",n),this.save()}get(e){return resolveDeep(this.settings,keyToPath(e))}getSettings(){return JSON.parse(JSON.stringify(this.settings))}}let index=0;const sections=localState.get("sections")||[];var sectionOpen=()=>{const i=index++;return{get(){return sections[i]||!1},set(e){sections[i]=e,localState.set("sections",sections)}}},SettingsSection_svelte_svelte_type_style_lang="";function get_each_context$3(i,e,n){const s=i.slice();return s[11]=e[n][0],s[12]=e[n][1],s}function create_if_block$4(i){let e,n,s,o;const r=[create_if_block_1$3,create_else_block_1],c=[];function d(u,h){return u[3].options?0:1}return n=d(i),s=c[n]=r[n](i),{c(){e=element("div"),s.c(),attr(e,"class","wrapper svelte-1glihwf")},m(u,h){insert(u,e,h),c[n].m(e,null),o=!0},p(u,h){let f=n;n=d(u),n===f?c[n].p(u,h):(group_outros(),transition_out(c[f],1,1,()=>{c[f]=null}),check_outros(),s=c[n],s?s.p(u,h):(s=c[n]=r[n](u),s.c()),transition_in(s,1),s.m(e,null))},i(u){o||(transition_in(s),o=!0)},o(u){transition_out(s),o=!1},d(u){u&&detach(e),c[n].d()}}}function create_else_block_1(i){let e,n=(i[3].label||i[2])+"",s,o,r,c,d;const u=[{value:i[1]},i[8](i[6])];var h=stateToComponent(i[6],i[1]);function f(m){let _={};for(let g=0;g<u.length;g+=1)_=assign(_,u[g]);return{props:_}}return h&&(r=new h(f()),r.$on("change",i[10])),{c(){e=element("p"),s=text(n),o=space(),r&&create_component(r.$$.fragment),c=empty()},m(m,_){insert(m,e,_),append(e,s),insert(m,o,_),r&&mount_component(r,m,_),insert(m,c,_),d=!0},p(m,_){(!d||_&12)&&n!==(n=(m[3].label||m[2])+"")&&set_data(s,n);const g=_&322?get_spread_update(u,[_&2&&{value:m[1]},_&320&&get_spread_object(m[8](m[6]))]):{};if(h!==(h=stateToComponent(m[6],m[1]))){if(r){group_outros();const v=r;transition_out(v.$$.fragment,1,0,()=>{destroy_component(v,1)}),check_outros()}h?(r=new h(f()),r.$on("change",m[10]),create_component(r.$$.fragment),transition_in(r.$$.fragment,1),mount_component(r,c.parentNode,c)):r=null}else h&&r.$set(g)},i(m){d||(r&&transition_in(r.$$.fragment,m),d=!0)},o(m){r&&transition_out(r.$$.fragment,m),d=!1},d(m){m&&detach(e),m&&detach(o),m&&detach(c),r&&destroy_component(r,m)}}}function create_if_block_1$3(i){let e,n;return e=new Section({props:{name:i[2],open:i[7].get(),$$slots:{default:[create_default_slot$2]},$$scope:{ctx:i}}}),e.$on("toggle",i[9]),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&4&&(r.name=s[2]),o&32779&&(r.$$scope={dirty:o,ctx:s}),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_else_block$1(i){let e;return{c(){e=element("p"),e.textContent="error"},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}function create_if_block_2$2(i){let e,n;return e=new SettingsSection({props:{path:i[0],value:i[12],key:i[11],template:i[3].options[i[11]]}}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&1&&(r.path=s[0]),o&2&&(r.value=s[12]),o&2&&(r.key=s[11]),o&10&&(r.template=s[3].options[s[11]]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_each_block$3(i){let e,n,s,o;const r=[create_if_block_2$2,create_else_block$1],c=[];function d(u,h){return u[11]in u[3].options?0:1}return e=d(i),n=c[e]=r[e](i),{c(){n.c(),s=empty()},m(u,h){c[e].m(u,h),insert(u,s,h),o=!0},p(u,h){let f=e;e=d(u),e===f?c[e].p(u,h):(group_outros(),transition_out(c[f],1,1,()=>{c[f]=null}),check_outros(),n=c[e],n?n.p(u,h):(n=c[e]=r[e](u),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(u){o||(transition_in(n),o=!0)},o(u){transition_out(n),o=!1},d(u){c[e].d(u),u&&detach(s)}}}function create_default_slot$2(i){let e,n,s=Object.entries(i[1]),o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$3(get_each_context$3(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=empty()},m(c,d){for(let u=0;u<o.length;u+=1)o[u].m(c,d);insert(c,e,d),n=!0},p(c,d){if(d&11){s=Object.entries(c[1]);let u;for(u=0;u<s.length;u+=1){const h=get_each_context$3(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$3(h),o[u].c(),transition_in(o[u],1),o[u].m(e.parentNode,e))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){destroy_each(o,c),c&&detach(e)}}}function create_fragment$d(i){let e,n,s=(i[4].isDev||!i[3].onlyDev)&&create_if_block$4(i);return{c(){s&&s.c(),e=empty()},m(o,r){s&&s.m(o,r),insert(o,e,r),n=!0},p(o,[r]){o[4].isDev||!o[3].onlyDev?s?(s.p(o,r),r&24&&transition_in(s,1)):(s=create_if_block$4(o),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(o){n||(transition_in(s),n=!0)},o(o){transition_out(s),n=!1},d(o){s&&s.d(o),o&&detach(e)}}}function instance$a(i,e,n){let s;const o=settingsManager.store;component_subscribe(i,o,v=>n(4,s=v));let{value:r}=e,{key:c}=e,{path:d=""}=e;d=d+(d.length?".":"")+c;let{template:u}=e,h=u;const f=sectionOpen(),m=v=>{const y=A({},v);return delete y.defaultValue,delete y.type,y},_=({detail:v})=>f.set(v),g=v=>settingsManager.set(d,v.detail);return i.$$set=v=>{"value"in v&&n(1,r=v.value),"key"in v&&n(2,c=v.key),"path"in v&&n(0,d=v.path),"template"in v&&n(3,u=v.template)},[d,r,c,u,s,o,h,f,m,_,g]}class SettingsSection extends SvelteComponent{constructor(e){super();init(this,e,instance$a,create_fragment$d,safe_not_equal,{value:1,key:2,path:0,template:3})}}function get_each_context$2(i,e,n){const s=i.slice();return s[2]=e[n][0],s[3]=e[n][1],s}function create_each_block$2(i){let e,n;return e=new SettingsSection({props:{key:i[2],value:i[3],template:template[i[2]]}}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,o){const r={};o&1&&(r.key=s[2]),o&1&&(r.value=s[3]),o&1&&(r.template=template[s[2]]),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_fragment$c(i){let e,n,s=Object.entries(i[0]),o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$2(get_each_context$2(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=empty()},m(c,d){for(let u=0;u<o.length;u+=1)o[u].m(c,d);insert(c,e,d),n=!0},p(c,[d]){if(d&1){s=Object.entries(c[0]);let u;for(u=0;u<s.length;u+=1){const h=get_each_context$2(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$2(h),o[u].c(),transition_in(o[u],1),o[u].m(e.parentNode,e))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){destroy_each(o,c),c&&detach(e)}}}function instance$9(i,e,n){let s;const o=settingsManager.store;return component_subscribe(i,o,r=>n(0,s=r)),[s,o]}class SettingsManagerView extends SvelteComponent{constructor(e){super();init(this,e,instance$9,create_fragment$c,safe_not_equal,{})}}var Final_svelte_svelte_type_style_lang="";function create_fragment$b(i){let e;return{c(){e=element("p"),e.textContent=`\u{1F389} Now you have all the knowledge to use the Plantarium. Have some fun with
  it.`,attr(e,"class","svelte-1h3eb6p")},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}class Final extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment$b,safe_not_equal,{})}}var Greeting_svelte_svelte_type_style_lang="";function create_fragment$a(i){let e,n,s,o,r,c,d,u;return o=new Icon({props:{name:"hand"}}),{c(){e=element("p"),n=text("Hey there "),s=element("span"),r=element("div"),create_component(o.$$.fragment),c=space(),d=element("p"),d.innerHTML=`Welcome to <b>Plantarium</b>, a tool for creating parametrized, procedural 3D
  plants.`,set_style(r,"display","contents"),set_style(r,"--stroke","#1a1a1a"),attr(s,"class","svelte-1tutruj"),attr(e,"class","svelte-1tutruj"),attr(d,"class","svelte-1tutruj")},m(h,f){insert(h,e,f),append(e,n),append(e,s),append(s,r),mount_component(o,r,null),insert(h,c,f),insert(h,d,f),u=!0},p:noop,i(h){u||(transition_in(o.$$.fragment,h),u=!0)},o(h){transition_out(o.$$.fragment,h),u=!1},d(h){h&&detach(e),destroy_component(o),h&&detach(c),h&&detach(d)}}}class Greeting extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment$a,safe_not_equal,{})}}const steps=[{title:"Tutorial",description:Greeting,options:{"lets go":()=>{}},type:"alert"},{description:`This is the <b>Plant View</b>, here you can explore the generated 3D model of your plant. 
      Try to change the view by:`,selector:".scene-wrapper",checks:[{description:"Clicking and dragging",setup:function(i,{c:e}){const n=document.querySelector(e.selector);n.getAttribute("setup")!=="true"&&(n.setAttribute("setup","true"),n.addEventListener("click",i,{once:!0}))}},{description:"Scrolling / Zooming",setup:(i,{c:e})=>{const n=document.querySelector(e.selector+"> canvas");n.getAttribute("setup")!=="true"&&(n.setAttribute("setup","true"),n.addEventListener("wheel",i,{once:!0,passive:!0}))}}]},{selector:"#nodesystem-view",description:"This is the <b>Node View</b>, here you define the way your plant looks. Try playing with some of the settings. If you are not so sure how this works, maybe visit the NodeTutorial"},{description:"This Button opens the project view",clickSelector:"header > div.left > div > div"},{description:"This is the ProjectView, here you can create/rename/delete projects.",selector:".project-manager-wrapper",checks:[{description:"create a new project",setup:(i,{pm:e})=>{e.once("new",i)}},{description:"rename the project",setup:(i,{pm:e})=>{e.once("update",i)}},{description:"delete the project",setup:(i,{pm:e})=>{e.once("delete",i)}}]},{description:"This Button opens the <b>Settings View</b>",clickSelector:"header > div.right > div:nth-child(2) .icon-wrapper"},{description:"This is the <b>SettingView</b>, here you can change some general settings.",selector:"header > div.right > div:nth-child(2) > div > div > div.wrapper.right.visible"},{description:"When you encounter something which doesnt work or you have an Idea for a new feature, use this button to report it.",clickSelector:"header > div.right > div:nth-child(1) > div"},{title:"Tutorial",description:Final,options:{"lets go":()=>{}},type:"alert"}];var store=writable(void 0),Tutor_svelte_svelte_type_style_lang="";function get_each_context$1(i,e,n){const s=i.slice();return s[14]=e[n],s[15]=e,s[16]=n,s}function create_if_block$3(i){let e,n,s,o,r,c,d,u,h=i[6].description+"",f,m,_,g,v,y=i[3]&&create_if_block_4(i);r=new Button({props:{icon:"cross"}}),r.$on("click",i[11]);let b=i[1]&&create_if_block_3(i),w=!i[4]&&create_if_block_2$1(i),S=i[0]&&i[5]&&create_if_block_1$2(i);return{c(){e=element("span"),y&&y.c(),n=space(),s=element("div"),o=element("div"),c=element("div"),create_component(r.$$.fragment),d=space(),u=element("p"),f=space(),b&&b.c(),m=space(),w&&w.c(),g=space(),S&&S.c(),set_style(c,"display","contents"),set_style(c,"--bg","transparent"),attr(o,"class","close-wrapper svelte-zb5b7g"),attr(u,"class","svelte-zb5b7g"),attr(s,"class","wrapper svelte-zb5b7g"),attr(s,"style",_=`left: ${i[8]}px; top: ${i[0].top+20}px;`),attr(e,"class","svelte-zb5b7g"),toggle_class(e,"isLeft",i[2]),toggle_class(e,"hasElement",!!i[5]),toggle_class(e,"hasClick",!!i[3])},m(k,$){insert(k,e,$),y&&y.m(e,null),append(e,n),append(e,s),append(s,o),append(o,c),mount_component(r,c,null),append(s,d),append(s,u),u.innerHTML=h,append(s,f),b&&b.m(s,null),append(s,m),w&&w.m(s,null),append(e,g),S&&S.m(e,null),v=!0},p(k,$){k[3]?y?(y.p(k,$),$&8&&transition_in(y,1)):(y=create_if_block_4(k),y.c(),transition_in(y,1),y.m(e,n)):y&&(group_outros(),transition_out(y,1,1,()=>{y=null}),check_outros()),(!v||$&64)&&h!==(h=k[6].description+"")&&(u.innerHTML=h),k[1]?b?(b.p(k,$),$&2&&transition_in(b,1)):(b=create_if_block_3(k),b.c(),transition_in(b,1),b.m(s,m)):b&&(group_outros(),transition_out(b,1,1,()=>{b=null}),check_outros()),k[4]?w&&(group_outros(),transition_out(w,1,1,()=>{w=null}),check_outros()):w?(w.p(k,$),$&16&&transition_in(w,1)):(w=create_if_block_2$1(k),w.c(),transition_in(w,1),w.m(s,null)),(!v||$&257&&_!==(_=`left: ${k[8]}px; top: ${k[0].top+20}px;`))&&attr(s,"style",_),k[0]&&k[5]?S?S.p(k,$):(S=create_if_block_1$2(k),S.c(),S.m(e,null)):S&&(S.d(1),S=null),$&4&&toggle_class(e,"isLeft",k[2]),$&32&&toggle_class(e,"hasElement",!!k[5]),$&8&&toggle_class(e,"hasClick",!!k[3])},i(k){v||(transition_in(y),transition_in(r.$$.fragment,k),transition_in(b),transition_in(w),v=!0)},o(k){transition_out(y),transition_out(r.$$.fragment,k),transition_out(b),transition_out(w),v=!1},d(k){k&&detach(e),y&&y.d(),destroy_component(r),b&&b.d(),w&&w.d(),S&&S.d()}}}function create_if_block_4(i){let e,n,s,o,r;return n=new Icon({props:{name:"pointing"}}),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--fill","#303030"),attr(e,"class","click-wrapper svelte-zb5b7g"),attr(e,"style",o=`top: ${i[0].top+20}px; left: ${i[8]-(i[2]?20:-0)}px;`)},m(c,d){insert(c,e,d),append(e,s),mount_component(n,s,null),r=!0},p(c,d){(!r||d&261&&o!==(o=`top: ${c[0].top+20}px; left: ${c[8]-(c[2]?20:-0)}px;`))&&attr(e,"style",o)},i(c){r||(transition_in(n.$$.fragment,c),r=!0)},o(c){transition_out(n.$$.fragment,c),r=!1},d(c){c&&detach(e),destroy_component(n)}}}function create_if_block_3(i){let e,n,s=i[1],o=[];for(let c=0;c<s.length;c+=1)o[c]=create_each_block$1(get_each_context$1(i,s,c));const r=c=>transition_out(o[c],1,1,()=>{o[c]=null});return{c(){e=element("div");for(let c=0;c<o.length;c+=1)o[c].c();attr(e,"class","checks-wrapper svelte-zb5b7g")},m(c,d){insert(c,e,d);for(let u=0;u<o.length;u+=1)o[u].m(e,null);n=!0},p(c,d){if(d&2){s=c[1];let u;for(u=0;u<s.length;u+=1){const h=get_each_context$1(c,s,u);o[u]?(o[u].p(h,d),transition_in(o[u],1)):(o[u]=create_each_block$1(h),o[u].c(),transition_in(o[u],1),o[u].m(e,null))}for(group_outros(),u=s.length;u<o.length;u+=1)r(u);check_outros()}},i(c){if(!n){for(let d=0;d<s.length;d+=1)transition_in(o[d]);n=!0}},o(c){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)transition_out(o[d]);n=!1},d(c){c&&detach(e),destroy_each(o,c)}}}function create_each_block$1(i){let e,n,s,o,r,c=i[14].description+"",d,u,h;function f(_){i[12](_,i[14])}let m={};return i[14]._isCompleted!==void 0&&(m.value=i[14]._isCompleted),n=new InputCheckbox({props:m}),binding_callbacks.push(()=>bind(n,"value",f)),{c(){e=element("div"),create_component(n.$$.fragment),o=space(),r=element("p"),d=text(c),u=space(),attr(r,"class","svelte-zb5b7g"),attr(e,"class","check-wrapper svelte-zb5b7g"),toggle_class(e,"is-completed",i[14]._isCompleted)},m(_,g){insert(_,e,g),mount_component(n,e,null),append(e,o),append(e,r),append(r,d),append(e,u),h=!0},p(_,g){i=_;const v={};!s&&g&2&&(s=!0,v.value=i[14]._isCompleted,add_flush_callback(()=>s=!1)),n.$set(v),(!h||g&2)&&c!==(c=i[14].description+"")&&set_data(d,c),g&2&&toggle_class(e,"is-completed",i[14]._isCompleted)},i(_){h||(transition_in(n.$$.fragment,_),h=!0)},o(_){transition_out(n.$$.fragment,_),h=!1},d(_){_&&detach(e),destroy_component(n)}}}function create_if_block_2$1(i){let e,n,s,o;return n=new Button({props:{name:"next"}}),n.$on("click",i[13]),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),set_style(s,"display","contents"),set_style(s,"--text","white"),set_style(s,"--bg","#303030"),attr(e,"class","next-wrapper svelte-zb5b7g")},m(r,c){insert(r,e,c),append(e,s),mount_component(n,s,null),o=!0},p:noop,i(r){o||(transition_in(n.$$.fragment,r),o=!0)},o(r){transition_out(n.$$.fragment,r),o=!1},d(r){r&&detach(e),destroy_component(n)}}}function create_if_block_1$2(i){let e,n;return{c(){e=element("span"),attr(e,"class","highlighter  svelte-zb5b7g"),attr(e,"style",n=`width: ${i[0].width}px; height: ${i[0].height}px; left: ${i[0].left}px; top: ${i[0].top}px;`)},m(s,o){insert(s,e,o)},p(s,o){o&1&&n!==(n=`width: ${s[0].width}px; height: ${s[0].height}px; left: ${s[0].left}px; top: ${s[0].top}px;`)&&attr(e,"style",n)},d(s){s&&detach(e)}}}function create_fragment$9(i){let e,n,s=i[7]&&create_if_block$3(i);return{c(){s&&s.c(),e=empty()},m(o,r){s&&s.m(o,r),insert(o,e,r),n=!0},p(o,[r]){o[7]?s?(s.p(o,r),r&128&&transition_in(s,1)):(s=create_if_block$3(o),s.c(),transition_in(s,1),s.m(e.parentNode,e)):s&&(group_outros(),transition_out(s,1,1,()=>{s=null}),check_outros())},i(o){n||(transition_in(s),n=!0)},o(o){transition_out(s),n=!1},d(o){s&&s.d(o),o&&detach(e)}}}function instance$8(i,e,n){let s,o,r,c,d,u,h,f,m,_,g;component_subscribe(i,store,w=>n(6,g=w));const v=()=>{n(7,_=!1)};function y(w,S){i.$$.not_equal(S._isCompleted,w)&&(S._isCompleted=w,n(1,m),n(6,g))}const b=()=>set_store_value(store,g._isCompleted=!0,g);return i.$$.update=()=>{if(i.$$.dirty&64&&g&&g.clickSelector){const w=document.querySelector(g.clickSelector);w&&w.getAttribute("setup")!=="true"&&(w.setAttribute("setup","true"),w.addEventListener("click",()=>{setTimeout(()=>{set_store_value(store,g._isCompleted=!0,g)},20)},{once:!0}))}i.$$.dirty&64&&n(10,s=g&&g.selector),i.$$.dirty&1024&&n(5,o=s&&document.querySelector(s)),i.$$.dirty&32&&n(9,r=o&&o.getBoundingClientRect()),i.$$.dirty&64&&n(4,c=g&&g.clickSelector&&document.querySelector(g.clickSelector)),i.$$.dirty&16&&n(3,d=c&&c.getBoundingClientRect()),i.$$.dirty&520&&n(0,u=r||d),i.$$.dirty&1&&n(2,h=u&&u.left+u.width>window.innerWidth-100),i.$$.dirty&5&&n(8,f=u&&(h?u.left-10:u.left+u.width+10)),i.$$.dirty&64&&n(1,m=g&&g.checks),i.$$.dirty&66&&m&&m.forEach((w,S)=>(w._isSetup||(w._isSetup=!0,w.setup(()=>{n(1,m[S]._isCompleted=!0,m),n(1,m),n(6,g)},{pm:projectManager,c:g})),w)),i.$$.dirty&1&&n(7,_=!!u)},[u,m,h,d,c,o,g,_,f,r,s,v,y,b]}class Tutor$1 extends SvelteComponent{constructor(e){super();init(this,e,instance$8,create_fragment$9,safe_not_equal,{})}}const affirmatives=["yes","next","lets go","okay"];let pm;const Tutor={handleReject:()=>{localState.set("hasViewedTutorial",!0),createToast("The tutorial is accessable under...")},currentIndex:0,previous:async function(){},next:async function(){var n;const i=steps[this.currentIndex];if(this.currentIndex===steps.length)return;if(i.setup&&await i.setup({pm}),store.set(i),this.currentIndex++,this.currentIndex>2&&localState.set("hasViewedTutorial",!0),i.title=(n=i.title)!=null?n:`Tutorial (${this.currentIndex}/${steps.length})`,i.type==="alert"){const s=await createAlert(i.description,{title:i.title,type:"success",values:i.options?Object.keys(i.options):void 0,timeout:0});if(affirmatives.includes(s.toString()))return this.next()}if(i.type==="toast"){const s=await createToast(i.description,{values:i.options?Object.keys(i.options):void 0,timeout:0});if(affirmatives.includes(s.toString()))return this.next()}const e=store.subscribe(s=>{s._isCompleted&&(e(),this.next())})},init:function({projectManager:i}){if(localState.get("hasViewedTutorial"))return;pm=i;const e=`It looks like this is your first time here...
    Want to take a little tour? `;setTimeout(async()=>{await createToast(e,{title:"",timeout:8e3,values:["nah","yes"]})==="yes"?this.next():this.handleReject()},1e4)},restart:function(){localState.set("hasViewedTutorial",!1),this.currentIndex=0,this.next()}},renderPerf=writable([]),generatePerf=writable([]),timers={},enabled={render:!1,generate:!1},times={render:renderPerf,generate:generatePerf};function start(i){timers[i]=performance.now()}function setSettings(i){var e,n;enabled.render=!!((e=i==null?void 0:i.debug)==null?void 0:e.renderPerf),enabled.generate=!!((n=i==null?void 0:i.debug)==null?void 0:n.generatePerf)}function add(i,e){(i in times?times[i]:writable([])).update(s=>(s.push(e),s.length>200&&s.shift(),s)),i in canvasUpdates&&canvasUpdates[i]()}function stop(i){var n;if(!enabled[i])return;const e=performance.now()-((n=timers[i])!=null?n:0);add(i,e)}const canvases={},canvasUpdates={};function createCanvas(i,e){e=e||canvases[i]||document.createElement("canvas"),canvases[i]=e;const n=200,s=100;e.width=n,e.height=s;const o=e.getContext("2d");canvasUpdates[i]=()=>{const r=[...get_store_value(times[i])],c=Math.max(...r);let d=0;const u=n/200;o.clearRect(0,0,n,s),o.fillStyle="rgba(255, 255, 255, 0.5)",o.fillRect(0,0,n,s);for(let h=0;h<r.length;h++){d+=r[h];const f=r[h]*(s/c);o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(h*u,s-f,u,f)}o.fillStyle="black",o.textAlign="left",o.fillText(i+"",10,10),o.textAlign="right",o.fillText(`avg: ${Math.floor(d/r.length*10)/10}ms max: ${Math.floor(c*10)/10}ms`,180,10)}}const settingsManager=new SettingsManager,projectManager=new ProjectManager;setTheme(settingsManager.get("theme"));setSettings(settingsManager.getSettings());settingsManager.on("enableSync.update",i=>{createToast(`${i?"Enabled":"Disabled"} sync`,{type:"success"})});settingsManager.on("theme.update",i=>{setTheme(i)});const nodeSystem=new NodeSystem({view:!0,defaultNodes:!1,registerNodes:_nodes});projectManager.on("load",i=>nodeSystem.load(i));nodeSystem.on("result",i=>projectManager.setProject(i),50);nodeSystem.on("save",i=>projectManager.saveProject(i));settingsManager.on("settings",i=>{projectManager.setSettings(i),setSettings(i)},50);Tutor.init({projectManager});const createGround=(i,e)=>{const{background:{scale:n=1,resX:s=16,resY:o=16}={}}=e||{},r=n!=null?n:0,c=s!=null?s:8,d=o!=null?o:8,u=ground(r,c,d);return transferToGeometry(i,u)};class BackgroundScene{constructor(e,n){this.scene=e,this.gl=e.renderer.gl,this.initMeshes(),n.on("settings",this.setSettings.bind(this)),this.setSettings(settingsManager.getSettings())}initMeshes(){const e=new Plane(this.gl),n=loader.texture(this.gl,"assets/rocky_dirt1-albedo.jpg",{wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT}),s=new Program(this.gl,{vertex:GroundShader.vertex,fragment:GroundShader.fragment,uniforms:{uTime:{value:0},tMap:{value:n},uFogColor:{value:new Color("#ffffff")},uFogNear:{value:10},uFogFar:{value:30},texScale:{value:1}}});this.ground=this.scene.addMesh({geometry:e,program:s});const o=(r=0)=>{requestAnimationFrame(o),s.uniforms.uTime.value=r};o()}setSettings(e){var n,s;this.settings=e,((n=e==null?void 0:e.background)==null?void 0:n.ground)&&(this.ground.geometry=createGround(this.gl,e)),this.ground.visible=!!((s=e==null?void 0:e.background)==null?void 0:s.ground)}}function create_fragment$8(i){let e,n,s=(i[1]?"<b>[NEW]</b>":"")+"",o,r=i[0].subject+"",c;return{c(){e=element("p"),n=new HtmlTag,o=space(),c=text(r),n.a=o},m(d,u){insert(d,e,u),n.m(s,e),append(e,o),append(e,c)},p(d,[u]){u&2&&s!==(s=(d[1]?"<b>[NEW]</b>":"")+"")&&n.p(s),u&1&&r!==(r=d[0].subject+"")&&set_data(c,r)},i:noop,o:noop,d(d){d&&detach(e)}}}function instance$7(i,e,n){let{commit:s}=e,{isNew:o=!1}=e;return i.$$set=r=>{"commit"in r&&n(0,s=r.commit),"isNew"in r&&n(1,o=r.isNew)},[s,o]}class Commit extends SvelteComponent{constructor(e){super();init(this,e,instance$7,create_fragment$8,safe_not_equal,{commit:0,isNew:1})}}const commits=writable([]);let lastUpdated=localState.get("lastUpdated",Date.now());function parseCommit(i){const e=Date.parse(i.date);return z(A({},i),{date:e,new:lastUpdated<e})}let commitPromise;async function _fetchCommits(){const e=await(await fetch("commits.json")).json();return lastUpdated=Date.now(),localState.set("lastUpdated",lastUpdated),e.map(n=>parseCommit(n))}const fetchCommits=async()=>{if(commitPromise)return commitPromise;commitPromise=_fetchCommits();const i=await commitPromise;commits.set(i)};var ChangeLog_svelte_svelte_type_style_lang="";function get_each_context(i,e,n){const s=i.slice();return s[4]=e[n],s}function create_if_block$2(i){let e,n=i[2](i[4].date)+"",s;return{c(){e=element("h3"),s=text(n),attr(e,"class","svelte-13vbnbr")},m(o,r){insert(o,e,r),append(e,s)},p(o,r){r&1&&n!==(n=o[2](o[4].date)+"")&&set_data(s,n)},d(o){o&&detach(e)}}}function create_each_block(i){let e=i[1](i[4]),n,s,o,r=e&&create_if_block$2(i);return s=new Commit({props:{commit:i[4]}}),{c(){r&&r.c(),n=space(),create_component(s.$$.fragment)},m(c,d){r&&r.m(c,d),insert(c,n,d),mount_component(s,c,d),o=!0},p(c,d){d&1&&(e=c[1](c[4])),e?r?r.p(c,d):(r=create_if_block$2(c),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null);const u={};d&1&&(u.commit=c[4]),s.$set(u)},i(c){o||(transition_in(s.$$.fragment,c),o=!0)},o(c){transition_out(s.$$.fragment,c),o=!1},d(c){r&&r.d(c),c&&detach(n),destroy_component(s,c)}}}function create_fragment$7(i){let e,n,s,o,r=i[0],c=[];for(let u=0;u<r.length;u+=1)c[u]=create_each_block(get_each_context(i,r,u));const d=u=>transition_out(c[u],1,1,()=>{c[u]=null});return{c(){e=element("h1"),e.textContent="Changelog",n=space(),s=element("div");for(let u=0;u<c.length;u+=1)c[u].c();attr(s,"class","svelte-13vbnbr")},m(u,h){insert(u,e,h),insert(u,n,h),insert(u,s,h);for(let f=0;f<c.length;f+=1)c[f].m(s,null);o=!0},p(u,[h]){if(h&7){r=u[0];let f;for(f=0;f<r.length;f+=1){const m=get_each_context(u,r,f);c[f]?(c[f].p(m,h),transition_in(c[f],1)):(c[f]=create_each_block(m),c[f].c(),transition_in(c[f],1),c[f].m(s,null))}for(group_outros(),f=r.length;f<c.length;f+=1)d(f);check_outros()}},i(u){if(!o){for(let h=0;h<r.length;h+=1)transition_in(c[h]);o=!0}},o(u){c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)transition_out(c[h]);o=!1},d(u){u&&detach(e),u&&detach(n),u&&detach(s),destroy_each(c,u)}}}function instance$6(i,e,n){let s;component_subscribe(i,commits,d=>n(0,s=d)),fetchCommits();let o=s.length&&new Date(s[0].date).getDay();return[s,d=>{const u=new Date(d.date);return u.getDay()!=o?(o=u.getDay(),!0):!1},d=>new Date(d).toLocaleDateString()]}class ChangeLog extends SvelteComponent{constructor(e){super();init(this,e,instance$6,create_fragment$7,safe_not_equal,{})}}var HoverWindow_svelte_svelte_type_style_lang="";function create_default_slot$1(i){let e,n,s,o,r,c,d,u,h;function f(v){i[6](v)}let m={useActive:!0,icon:i[3],name:i[1]};i[0]!==void 0&&(m.active=i[0]),n=new Button({props:m}),binding_callbacks.push(()=>bind(n,"active",f));var _=i[4];function g(v){return{props:{visible:v[0]}}}return _&&(u=new _(g(i))),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),c=space(),d=element("div"),u&&create_component(u.$$.fragment),set_style(s,"display","contents"),set_style(s,"--bg","transparent"),set_style(s,"--text",r=i[5]["text-color"]),attr(d,"class","wrapper svelte-1e2gb7"),toggle_class(d,"visible",i[0]),toggle_class(d,"right",i[2]),attr(e,"class","icon-wrapper svelte-1e2gb7"),toggle_class(e,"active",i[0])},m(v,y){insert(v,e,y),append(e,s),mount_component(n,s,null),append(e,c),append(e,d),u&&mount_component(u,d,null),h=!0},p(v,y){y&32&&r!==(r=v[5]["text-color"])&&set_style(s,"--text",r);const b={};y&8&&(b.icon=v[3]),y&2&&(b.name=v[1]),!o&&y&1&&(o=!0,b.active=v[0],add_flush_callback(()=>o=!1)),n.$set(b);const w={};if(y&1&&(w.visible=v[0]),_!==(_=v[4])){if(u){group_outros();const S=u;transition_out(S.$$.fragment,1,0,()=>{destroy_component(S,1)}),check_outros()}_?(u=new _(g(v)),create_component(u.$$.fragment),transition_in(u.$$.fragment,1),mount_component(u,d,null)):u=null}else _&&u.$set(w);y&1&&toggle_class(d,"visible",v[0]),y&4&&toggle_class(d,"right",v[2]),y&1&&toggle_class(e,"active",v[0])},i(v){h||(transition_in(n.$$.fragment,v),u&&transition_in(u.$$.fragment,v),h=!0)},o(v){transition_out(n.$$.fragment,v),u&&transition_out(u.$$.fragment,v),h=!1},d(v){v&&detach(e),destroy_component(n),u&&destroy_component(u)}}}function create_fragment$6(i){let e,n;return e=new Src({props:{$$slots:{default:[create_default_slot$1]},$$scope:{ctx:i}}}),e.$on("clickoutside",i[7]),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},p(s,[o]){const r={};o&319&&(r.$$scope={dirty:o,ctx:s}),e.$set(r)},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function instance$5(i,e,n){let s;component_subscribe(i,store$4,m=>n(5,s=m));let{name:o}=e,{right:r=!1}=e,{icon:c}=e,{component:d}=e,{visible:u=!1}=e;function h(m){u=m,n(0,u)}const f=()=>n(0,u=!1);return i.$$set=m=>{"name"in m&&n(1,o=m.name),"right"in m&&n(2,r=m.right),"icon"in m&&n(3,c=m.icon),"component"in m&&n(4,d=m.component),"visible"in m&&n(0,u=m.visible)},[u,o,r,c,d,s,h,f]}class HoverWindow extends SvelteComponent{constructor(e){super();init(this,e,instance$5,create_fragment$6,safe_not_equal,{name:1,right:2,icon:3,component:4,visible:0})}}var Report_svelte_svelte_type_style_lang="";function create_else_block(i){let e,n,s,o,r,c,d,u,h,f,m,_,g,v,y,b,w,S=i[0]==="bug"&&create_if_block_1$1(i);return g=new Button({props:{name:"Submit"}}),g.$on("click",i[9]),{c(){e=element("section"),n=element("label"),n.textContent="Title",s=space(),o=element("input"),r=space(),c=element("section"),d=element("label"),d.textContent="Description",u=space(),h=element("textarea"),m=space(),S&&S.c(),_=space(),v=element("div"),create_component(g.$$.fragment),attr(n,"for","title"),attr(n,"class","svelte-1725buf"),attr(o,"type","text"),attr(o,"id","title"),attr(o,"placeholder","Simple Title"),attr(o,"class","svelte-1725buf"),attr(e,"class","svelte-1725buf"),attr(d,"for","description"),attr(d,"class","svelte-1725buf"),attr(h,"type","text"),attr(h,"id","description"),attr(h,"rowspan","5"),attr(h,"placeholder",f=i[0]==="bug"?"Please provide a detailed description of what happened.":"Please describe the feature."),attr(h,"class","svelte-1725buf"),attr(c,"class","svelte-1725buf"),set_style(v,"display","contents"),set_style(v,"--bg","white"),set_style(v,"--text-color","#303030")},m(k,$){insert(k,e,$),append(e,n),append(e,s),append(e,o),set_input_value(o,i[2]),insert(k,r,$),insert(k,c,$),append(c,d),append(c,u),append(c,h),set_input_value(h,i[3]),insert(k,m,$),S&&S.m(k,$),insert(k,_,$),insert(k,v,$),mount_component(g,v,null),y=!0,b||(w=[listen(o,"keydown",stop_propagation(i[11])),listen(o,"input",i[12]),listen(h,"keydown",stop_propagation(i[10])),listen(h,"input",i[13])],b=!0)},p(k,$){$&4&&o.value!==k[2]&&set_input_value(o,k[2]),(!y||$&1&&f!==(f=k[0]==="bug"?"Please provide a detailed description of what happened.":"Please describe the feature."))&&attr(h,"placeholder",f),$&8&&set_input_value(h,k[3]),k[0]==="bug"?S?(S.p(k,$),$&1&&transition_in(S,1)):(S=create_if_block_1$1(k),S.c(),transition_in(S,1),S.m(_.parentNode,_)):S&&(group_outros(),transition_out(S,1,1,()=>{S=null}),check_outros())},i(k){y||(transition_in(S),transition_in(g.$$.fragment,k),y=!0)},o(k){transition_out(S),transition_out(g.$$.fragment,k),y=!1},d(k){k&&detach(e),k&&detach(r),k&&detach(c),k&&detach(m),S&&S.d(k),k&&detach(_),k&&detach(v),destroy_component(g,k),b=!1,run_all(w)}}}function create_if_block$1(i){let e,n,s,o={ctx:i,current:null,token:null,hasCatch:!0,pending:create_pending_block$1,then:create_then_block$1,catch:create_catch_block$1,value:16,error:17,blocks:[,,,]};return handle_promise(n=i[6],o),{c(){e=empty(),o.block.c()},m(r,c){insert(r,e,c),o.block.m(r,o.anchor=c),o.mount=()=>e.parentNode,o.anchor=e,s=!0},p(r,c){i=r,o.ctx=i,c&64&&n!==(n=i[6])&&handle_promise(n,o)||update_await_block_branch(o,i,c)},i(r){s||(transition_in(o.block),s=!0)},o(r){for(let c=0;c<3;c+=1){const d=o.blocks[c];transition_out(d)}s=!1},d(r){r&&detach(e),o.block.d(r),o.token=null,o=null}}}function create_if_block_1$1(i){let e,n,s,o,r,c,d,u,h,f,m,_=i[7]&&create_if_block_2(i);function g(y){i[15](y)}let v={};return i[4]!==void 0&&(v.value=i[4]),o=new InputCheckbox({props:v}),binding_callbacks.push(()=>bind(o,"value",g)),f=new Section({props:{name:"What is that?",$$slots:{default:[create_default_slot]},$$scope:{ctx:i}}}),{c(){_&&_.c(),e=space(),n=element("section"),s=element("div"),create_component(o.$$.fragment),c=space(),d=element("p"),d.textContent="Include Browser Info",u=space(),h=element("div"),create_component(f.$$.fragment),set_style(d,"margin-left","5px"),set_style(s,"display","flex"),set_style(s,"align-items","center"),attr(h,"class","info svelte-1725buf"),attr(n,"class","svelte-1725buf")},m(y,b){_&&_.m(y,b),insert(y,e,b),insert(y,n,b),append(n,s),mount_component(o,s,null),append(s,c),append(s,d),append(n,u),append(n,h),mount_component(f,h,null),m=!0},p(y,b){y[7]?_?(_.p(y,b),b&128&&transition_in(_,1)):(_=create_if_block_2(y),_.c(),transition_in(_,1),_.m(e.parentNode,e)):_&&(group_outros(),transition_out(_,1,1,()=>{_=null}),check_outros());const w={};!r&&b&16&&(r=!0,w.value=y[4],add_flush_callback(()=>r=!1)),o.$set(w);const S={};b&262144&&(S.$$scope={dirty:b,ctx:y}),f.$set(S)},i(y){m||(transition_in(_),transition_in(o.$$.fragment,y),transition_in(f.$$.fragment,y),m=!0)},o(y){transition_out(_),transition_out(o.$$.fragment,y),transition_out(f.$$.fragment,y),m=!1},d(y){_&&_.d(y),y&&detach(e),y&&detach(n),destroy_component(o),destroy_component(f)}}}function create_if_block_2(i){let e,n,s,o,r,c,d,u,h,f;function m(g){i[14](g)}let _={};return i[5]!==void 0&&(_.value=i[5]),s=new InputCheckbox({props:_}),binding_callbacks.push(()=>bind(s,"value",m)),h=new Section({props:{name:"What is that?",$$slots:{default:[create_default_slot_1]},$$scope:{ctx:i}}}),{c(){e=element("section"),n=element("div"),create_component(s.$$.fragment),r=space(),c=element("p"),c.textContent="Include StackTrace",d=space(),u=element("div"),create_component(h.$$.fragment),set_style(c,"margin-left","5px"),set_style(n,"display","flex"),set_style(n,"align-items","center"),attr(u,"class","info svelte-1725buf"),attr(e,"class","svelte-1725buf")},m(g,v){insert(g,e,v),append(e,n),mount_component(s,n,null),append(n,r),append(n,c),append(e,d),append(e,u),mount_component(h,u,null),f=!0},p(g,v){const y={};!o&&v&32&&(o=!0,y.value=g[5],add_flush_callback(()=>o=!1)),s.$set(y);const b={};v&262146&&(b.$$scope={dirty:v,ctx:g}),h.$set(b)},i(g){f||(transition_in(s.$$.fragment,g),transition_in(h.$$.fragment,g),f=!0)},o(g){transition_out(s.$$.fragment,g),transition_out(h.$$.fragment,g),f=!1},d(g){g&&detach(e),destroy_component(s),destroy_component(h)}}}function create_default_slot_1(i){let e,n,s=i[1].stack+"",o;return{c(){e=element("pre"),n=element("code"),o=text(s)},m(r,c){insert(r,e,c),append(e,n),append(n,o)},p(r,c){c&2&&s!==(s=r[1].stack+"")&&set_data(o,s)},d(r){r&&detach(e)}}}function create_default_slot(i){let e,n,s,o,r,c,d,u,h,f,m,_,g,v,y,b,w,S;return{c(){e=element("p"),e.textContent=`This information makes it easier for a developer to track down what
            might have caused the bug.`,n=space(),s=element("ul"),o=element("li"),r=text("OS "),c=element("i"),c.textContent=`(${i[8].os})`,d=space(),u=element("li"),h=text("Browser "),f=element("i"),f.textContent=`(${i[8].name} / ${i[8].version})`,m=space(),_=element("li"),g=text("Screen Resolution "),v=element("i"),v.textContent=`(${window.innerWidth}x${window.innerHeight})`,y=space(),b=element("li"),w=text("Screen DPI "),S=element("i"),S.textContent=`(${window.devicePixelRatio})`},m(k,$){insert(k,e,$),insert(k,n,$),insert(k,s,$),append(s,o),append(o,r),append(o,c),append(s,d),append(s,u),append(u,h),append(u,f),append(s,m),append(s,_),append(_,g),append(_,v),append(s,y),append(s,b),append(b,w),append(b,S)},p:noop,d(k){k&&detach(e),k&&detach(n),k&&detach(s)}}}function create_catch_block$1(i){let e,n,s,o=JSON.stringify(i[17],null,2)+"",r;return{c(){e=element("p"),e.textContent="Errror",n=space(),s=element("code"),r=text(o)},m(c,d){insert(c,e,d),insert(c,n,d),insert(c,s,d),append(s,r)},p(c,d){d&64&&o!==(o=JSON.stringify(c[17],null,2)+"")&&set_data(r,o)},i:noop,o:noop,d(c){c&&detach(e),c&&detach(n),c&&detach(s)}}}function create_then_block$1(i){let e,n,s,o=JSON.stringify(i[16],null,2)+"",r,c;return e=new Button({props:{name:"Done",icon:"checkmark"}}),{c(){create_component(e.$$.fragment),n=space(),s=element("code"),r=text(o)},m(d,u){mount_component(e,d,u),insert(d,n,u),insert(d,s,u),append(s,r),c=!0},p(d,u){(!c||u&64)&&o!==(o=JSON.stringify(d[16],null,2)+"")&&set_data(r,o)},i(d){c||(transition_in(e.$$.fragment,d),c=!0)},o(d){transition_out(e.$$.fragment,d),c=!1},d(d){destroy_component(e,d),d&&detach(n),d&&detach(s)}}}function create_pending_block$1(i){let e;return{c(){e=text("Submitting Reprot")},m(n,s){insert(n,e,s)},p:noop,i:noop,o:noop,d(n){n&&detach(e)}}}function create_fragment$5(i){let e,n,s,o;const r=[create_if_block$1,create_else_block],c=[];function d(u,h){return u[6]?0:1}return e=d(i),n=c[e]=r[e](i),{c(){n.c(),s=empty()},m(u,h){c[e].m(u,h),insert(u,s,h),o=!0},p(u,[h]){let f=e;e=d(u),e===f?c[e].p(u,h):(group_outros(),transition_out(c[f],1,1,()=>{c[f]=null}),check_outros(),n=c[e],n?n.p(u,h):(n=c[e]=r[e](u),n.c()),transition_in(n,1),n.m(s.parentNode,s))},i(u){o||(transition_in(n),o=!0)},o(u){transition_out(n),o=!1},d(u){c[e].d(u),u&&detach(s)}}}function instance$4(i,e,n){let s,{mode:o="bug"}=e,r=detect(),c,d,u=!1,{error:h}=e,f=!0,m;function _(){const k={type:o,title:c,description:d};f&&(k.stacktrace=s),u&&(k.browser=detect(),k.browser.screen={width:window.innerWidth,height:window.innerHeight,dpi:window.devicePixelRatio}),n(6,m=submitReport(k))}onMount(async()=>{s&&n(2,c=s.type+": "+s.title)});function g(k){bubble.call(this,i,k)}function v(k){bubble.call(this,i,k)}function y(){c=this.value,n(2,c)}function b(){d=this.value,n(3,d)}function w(k){f=k,n(5,f)}function S(k){u=k,n(4,u)}return i.$$set=k=>{"mode"in k&&n(0,o=k.mode),"error"in k&&n(1,h=k.error)},i.$$.update=()=>{i.$$.dirty&2&&n(7,s=h&&parseStackTrace(h.stack))},[o,h,c,d,u,f,m,s,r,_,g,v,y,b,w,S]}class Report extends SvelteComponent{constructor(e){super();init(this,e,instance$4,create_fragment$5,safe_not_equal,{mode:0,error:1})}}class DebugScene{constructor(e,n){this.scene=e,this.pm=n,this.m={},this.gl=e.renderer.gl,this.initGeometry(),this.setSettings(settingsManager.getSettings()),n.on("settings",this.setSettings.bind(this))}initGeometry(){this.m.skeleton=this.scene.addMesh({geometry:new Geometry(this.gl,{position:{size:3,data:new Float32Array([0,0,0])},uv:{size:2,data:new Float32Array([0,0])},index:{size:1,data:new Uint16Array([0])}}),program:new Program(this.gl,{vertex:WireFrameShader.vertex,fragment:WireFrameShader.fragment,depthTest:!1}),mode:this.gl.LINES}),this.m.vertices=this.scene.addMesh({mode:this.gl.POINTS,geometry:new Geometry(this.gl,{position:{size:3,data:new Float32Array(3)}}),program:new Program(this.gl,{vertex:ParticleShader.vertex,fragment:ParticleShader.fragment,depthTest:!1,transparent:!0})})}setSettings(e){var n,s;this.settings=JSON.parse(JSON.stringify(e)),this.m.skeleton.visible=!!((n=this.settings.debug)==null?void 0:n.skeleton),this.m.vertices.visible=!!((s=this.settings.debug)==null?void 0:s.skeleton),this.update()}setPlant(e){this.plant=e,this.update()}update(e=this.plant,n=this.settings){var s,o;if(!(!e||!n)&&(e.allSkeletons||e.skeletons)&&((s=n.debug)==null?void 0:s.skeleton)){const r=(o=e.allSkeletons)!=null?o:e.skeletons;let c=0;for(const f of r)c+=f.length/4*3;const d=new Float32Array(c),u=new Uint32Array((c/3-1)*2);let h=0;r.forEach(f=>{const m=f.length/4;for(let _=0;_<m;_++)d[h*3+_*3+0]=f[_*4+0],d[h*3+_*3+1]=f[_*4+1],d[h*3+_*3+2]=f[_*4+2];for(let _=0;_<m-1;_++)u[h*2+_*2]=h+_,u[h*2+_*2+1]=h+_+1;h+=m}),this.m.skeleton.geometry=new Geometry(this.gl,{position:{size:3,data:d},index:{size:1,data:u}}),this.m.vertices.geometry=new Geometry(this.gl,{position:{size:3,data:d}})}}}const updateThumbnail=throttle(i=>{projectManager.renderThumbnail({geo:i})},5e3),log=log$8("scene.foreground");class ForegroundScene{constructor(e,n){this.scene=e,this.pm=n,this.worker=worker(),this.gl=e.renderer.gl,this.initGeometry(),this.dbg=new DebugScene(e,n),this.setSettings(settingsManager.getSettings()),this.setPlant(n.getActiveProject()),this.pm.on("settings",this.setSettings.bind(this)),this.pm.on("plant",this.setPlant.bind(this))}initGeometry(){const e=new Box(this.scene.gl,{width:0,height:0,depth:0});this.mesh=this.scene.addMesh({geometry:e,program:MatCapShader(this.gl)})}setSettings(e){this.settings=JSON.parse(JSON.stringify(e)),this.update()}setPlant(e){!e||(this.plant=JSON.parse(JSON.stringify(e)),this.update())}async update(e=this.plant,n=this.settings){var s;if(!(!e||!n)){this.scene.isLoading.set(!0);try{start("generate");const o=await this.worker.plant(e,n);if(stop("generate"),!o)return;updateThumbnail(o.geometry),this.scene.isLoading.set(!1),this.mesh.mode=((s=n==null?void 0:n.debug)==null?void 0:s.wireframe)?this.gl.LINES:this.gl.TRIANGLES,this.dbg.setPlant(o),this.mesh.geometry=transferToGeometry(this.gl,o.geometry),this.mesh.geometry.computeBoundingBox(),this.scene.renderer.setControlTarget(this.mesh.geometry.bounds.center)}catch(o){log.error(o),await createToast(o,{title:"Error [Generator]",values:["report"]})==="report"&&createAlert(Report,{timeout:0,title:"Report Bug",type:"error",props:{mode:"bug",error:o}})}}}}class Scene{constructor(e,n){this.isLoading=writable(!1),this.renderer=new Renderer({canvas:n,camPos:localState.get("camPos")}),this.renderer.on("camPos",s=>localState.set("camPos",s)),this.renderer.on("perf",s=>add("render",s),40),this.renderer.handleResize(),this.scene=this.renderer.scene,this.gl=this.renderer.gl,this.wrapper=n.parentElement,this.bg=new BackgroundScene(this,e),this.fg=new ForegroundScene(this,e)}addMesh(e){const n=new Mesh(this.gl,e);return n.setParent(this.scene),n}}var Scene_svelte_svelte_type_style_lang="";function create_if_block_1(i){let e,n,s=JSON.stringify(i[1],null,2)+"",o;return{c(){e=element("pre"),n=element("code"),o=text(s),attr(n,"class","svelte-jamjfg"),attr(e,"class","svelte-jamjfg")},m(r,c){insert(r,e,c),append(e,n),append(n,o)},p(r,c){c&2&&s!==(s=JSON.stringify(r[1],null,2)+"")&&set_data(o,s)},d(r){r&&detach(e)}}}function create_if_block(i){let e;return{c(){e=element("div"),e.innerHTML='<p class="svelte-jamjfg">Is Loading</p>',attr(e,"class","is-loading svelte-jamjfg")},m(n,s){insert(n,e,s)},d(n){n&&detach(e)}}}function create_fragment$4(i){var v,y;let e,n,s,o,r,c,d,u,h,f,m,_=((y=(v=i[6])==null?void 0:v.debug)==null?void 0:y.pd)&&i[1]&&create_if_block_1(i),g=i[7]&&create_if_block();return{c(){var b,w,S,k;e=element("div"),_&&_.c(),n=space(),s=element("div"),o=element("canvas"),c=space(),d=element("canvas"),h=space(),f=element("canvas"),m=space(),g&&g.c(),attr(o,"style",r=`display: ${((w=(b=i[6])==null?void 0:b.debug)==null?void 0:w.generatePerf)?"visible":"none"}`),attr(o,"class","svelte-jamjfg"),attr(d,"style",u=`display: ${((k=(S=i[6])==null?void 0:S.debug)==null?void 0:k.renderPerf)?"visible":"none"}`),attr(d,"class","svelte-jamjfg"),attr(s,"class","performance-wrapper svelte-jamjfg"),attr(f,"class","svelte-jamjfg"),attr(e,"class","scene-wrapper svelte-jamjfg")},m(b,w){insert(b,e,w),_&&_.m(e,null),append(e,n),append(e,s),append(s,o),i[10](o),append(s,c),append(s,d),i[11](d),append(e,h),append(e,f),i[12](f),append(e,m),g&&g.m(e,null)},p(b,[w]){var S,k,$,P,x,T;((k=(S=b[6])==null?void 0:S.debug)==null?void 0:k.pd)&&b[1]?_?_.p(b,w):(_=create_if_block_1(b),_.c(),_.m(e,n)):_&&(_.d(1),_=null),w&64&&r!==(r=`display: ${((P=($=b[6])==null?void 0:$.debug)==null?void 0:P.generatePerf)?"visible":"none"}`)&&attr(o,"style",r),w&64&&u!==(u=`display: ${((T=(x=b[6])==null?void 0:x.debug)==null?void 0:T.renderPerf)?"visible":"none"}`)&&attr(d,"style",u),b[7]?g||(g=create_if_block(),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:noop,o:noop,d(b){b&&detach(e),_&&_.d(),i[10](null),i[11](null),i[12](null),g&&g.d()}}}function instance$3(i,e,n){let s,o,r=noop,c=()=>(r(),r=subscribe(v,$=>n(6,o=$)),v),d,u=noop,h=()=>(u(),u=subscribe(s,$=>n(7,d=$)),s);i.$$.on_destroy.push(()=>r()),i.$$.on_destroy.push(()=>u());let f,m,_,g,v,y,b;onMount(()=>{createCanvas("render",b),createCanvas("generate",y)});function w($){binding_callbacks[$?"unshift":"push"](()=>{y=$,n(3,y)})}function S($){binding_callbacks[$?"unshift":"push"](()=>{b=$,n(4,b)})}function k($){binding_callbacks[$?"unshift":"push"](()=>{f=$,n(0,f)})}return i.$$.update=()=>{i.$$.dirty&257&&f&&projectManager&&!m&&n(8,m=new Scene(projectManager,f)),i.$$.dirty&256&&h(n(5,s=m&&m.isLoading)),i.$$.dirty&512&&projectManager&&(g&&g(),n(9,g=projectManager.on("save",$=>n(1,_=$))))},settingsManager&&c(n(2,v=settingsManager.store)),[f,_,v,y,b,s,o,d,m,g,w,S,k]}class Scene_1 extends SvelteComponent{constructor(e){super();init(this,e,instance$3,create_fragment$4,safe_not_equal,{})}}var Help_svelte_svelte_type_style_lang="";function create_fragment$3(i){let e,n,s,o,r,c,d,u,h,f,m,_,g;return n=new Button({props:{name:"Tutorial",icon:"hand"}}),n.$on("click",i[0]),r=new Button({props:{name:"Report Bug",icon:"exclamation"}}),r.$on("click",i[1]),u=new Button({props:{name:"Request Feature"}}),u.$on("click",i[2]),m=new Button({props:{name:"Changelog"}}),m.$on("click",i[3]),{c(){e=element("div"),s=element("div"),create_component(n.$$.fragment),o=space(),c=element("div"),create_component(r.$$.fragment),d=space(),h=element("div"),create_component(u.$$.fragment),f=space(),_=element("div"),create_component(m.$$.fragment),set_style(s,"display","contents"),set_style(s,"--bg","#303030"),set_style(s,"--text","white"),set_style(c,"display","contents"),set_style(c,"--bg","#303030"),set_style(c,"--text","white"),set_style(h,"display","contents"),set_style(h,"--bg","#303030"),set_style(h,"--text","white"),set_style(_,"display","contents"),set_style(_,"--bg","#303030"),set_style(_,"--text","white"),attr(e,"class","svelte-4ypi13")},m(v,y){insert(v,e,y),append(e,s),mount_component(n,s,null),append(e,o),append(e,c),mount_component(r,c,null),append(e,d),append(e,h),mount_component(u,h,null),append(e,f),append(e,_),mount_component(m,_,null),g=!0},p:noop,i(v){g||(transition_in(n.$$.fragment,v),transition_in(r.$$.fragment,v),transition_in(u.$$.fragment,v),transition_in(m.$$.fragment,v),g=!0)},o(v){transition_out(n.$$.fragment,v),transition_out(r.$$.fragment,v),transition_out(u.$$.fragment,v),transition_out(m.$$.fragment,v),g=!1},d(v){v&&detach(e),destroy_component(n),destroy_component(r),destroy_component(u),destroy_component(m)}}}function instance$2(i){return[()=>Tutor.restart(),()=>createAlert(Report,{timeout:0,title:"Report Bug",type:"error",props:{mode:"bug"}}),()=>createAlert(Report,{timeout:0,title:"Request Feature",props:{mode:"feat"}}),()=>createAlert(ChangeLog,{timeout:0})]}class Help extends SvelteComponent{constructor(e){super();init(this,e,instance$2,create_fragment$3,safe_not_equal,{})}}var Header_svelte_svelte_type_style_lang="";function create_fragment$2(i){var y,b;let e,n,s,o,r,c=((b=(y=i[0])==null?void 0:y.meta.name)!=null?b:"")+"",d,u,h,f,m,_,g,v;return s=new HoverWindow({props:{icon:"folder",name:"Projects",component:ProjectManagerView}}),f=new HoverWindow({props:{icon:"question",component:Help,right:!0}}),_=new HoverWindow({props:{icon:"cog",component:SettingsManagerView,right:!0}}),{c(){e=element("header"),n=element("div"),create_component(s.$$.fragment),o=space(),r=element("h3"),d=text(c),u=space(),h=element("div"),create_component(f.$$.fragment),m=space(),g=element("div"),create_component(_.$$.fragment),attr(n,"class","left svelte-1dyrwb1"),attr(r,"class","svelte-1dyrwb1"),set_style(g,"display","contents"),set_style(g,"--min-width","250px"),attr(h,"class","right svelte-1dyrwb1"),attr(e,"class","svelte-1dyrwb1")},m(w,S){insert(w,e,S),append(e,n),mount_component(s,n,null),append(e,o),append(e,r),append(r,d),append(e,u),append(e,h),mount_component(f,h,null),append(h,m),append(h,g),mount_component(_,g,null),v=!0},p(w,[S]){var k,$;(!v||S&1)&&c!==(c=(($=(k=w[0])==null?void 0:k.meta.name)!=null?$:"")+"")&&set_data(d,c)},i(w){v||(transition_in(s.$$.fragment,w),transition_in(f.$$.fragment,w),transition_in(_.$$.fragment,w),v=!0)},o(w){transition_out(s.$$.fragment,w),transition_out(f.$$.fragment,w),transition_out(_.$$.fragment,w),v=!1},d(w){w&&detach(e),destroy_component(s),destroy_component(f),destroy_component(_)}}}function instance$1(i,e,n){let s;const o=projectManager.activeProject;return component_subscribe(i,o,r=>n(0,s=r)),[s,o]}class Header extends SvelteComponent{constructor(e){super();init(this,e,instance$1,create_fragment$2,safe_not_equal,{})}}var App_svelte_svelte_type_style_lang="";function create_fragment$1(i){let e,n,s,o,r,c,d,u,h,f,m,_,g,v,y;return e=new ThemeProvider({}),s=new AlertWrapper({}),r=new ToastWrapper({}),d=new Tutor$1({}),h=new Header({}),_=new Scene_1({}),{c(){create_component(e.$$.fragment),n=space(),create_component(s.$$.fragment),o=space(),create_component(r.$$.fragment),c=space(),create_component(d.$$.fragment),u=space(),create_component(h.$$.fragment),f=space(),m=element("main"),create_component(_.$$.fragment),g=space(),v=element("div"),attr(v,"id","nodesystem-view"),attr(v,"class","svelte-1hr3zx4"),attr(m,"class","svelte-1hr3zx4")},m(b,w){mount_component(e,b,w),insert(b,n,w),mount_component(s,b,w),insert(b,o,w),mount_component(r,b,w),insert(b,c,w),mount_component(d,b,w),insert(b,u,w),mount_component(h,b,w),insert(b,f,w),insert(b,m,w),mount_component(_,m,null),append(m,g),append(m,v),i[1](v),y=!0},p:noop,i(b){y||(transition_in(e.$$.fragment,b),transition_in(s.$$.fragment,b),transition_in(r.$$.fragment,b),transition_in(d.$$.fragment,b),transition_in(h.$$.fragment,b),transition_in(_.$$.fragment,b),y=!0)},o(b){transition_out(e.$$.fragment,b),transition_out(s.$$.fragment,b),transition_out(r.$$.fragment,b),transition_out(d.$$.fragment,b),transition_out(h.$$.fragment,b),transition_out(_.$$.fragment,b),y=!1},d(b){destroy_component(e,b),b&&detach(n),destroy_component(s,b),b&&detach(o),destroy_component(r,b),b&&detach(c),destroy_component(d,b),b&&detach(u),destroy_component(h,b),b&&detach(f),b&&detach(m),destroy_component(_),i[1](null)}}}function instance(i,e,n){let s;onMount(async()=>{s.append(nodeSystem.view.wrapper),nodeSystem.view.handleResize()});function o(r){binding_callbacks[r?"unshift":"push"](()=>{s=r,n(0,s)})}return[s,o]}class App extends SvelteComponent{constructor(e){super();init(this,e,instance,create_fragment$1,safe_not_equal,{})}}function create_catch_block(i){return{c:noop,m:noop,i:noop,o:noop,d:noop}}function create_then_block(i){let e,n;return e=new App({}),{c(){create_component(e.$$.fragment)},m(s,o){mount_component(e,s,o),n=!0},i(s){n||(transition_in(e.$$.fragment,s),n=!0)},o(s){transition_out(e.$$.fragment,s),n=!1},d(s){destroy_component(e,s)}}}function create_pending_block(i){let e;return{c(){e=element("p"),e.textContent="Loading"},m(n,s){insert(n,e,s)},i:noop,o:noop,d(n){n&&detach(e)}}}function create_fragment(i){let e,n,s={ctx:i,current:null,token:null,hasCatch:!1,pending:create_pending_block,then:create_then_block,catch:create_catch_block,value:0,blocks:[,,,]};return handle_promise(settingsManager.loadFromLocal(),s),{c(){e=empty(),s.block.c()},m(o,r){insert(o,e,r),s.block.m(o,s.anchor=r),s.mount=()=>e.parentNode,s.anchor=e,n=!0},p(o,[r]){i=o},i(o){n||(transition_in(s.block),n=!0)},o(o){for(let r=0;r<3;r+=1){const c=s.blocks[r];transition_out(c)}n=!1},d(o){o&&detach(e),s.block.d(o),s.token=null,s=null}}}class Loader extends SvelteComponent{constructor(e){super();init(this,e,null,create_fragment,safe_not_equal,{})}}let l;try{l=new Loader({target:document.body})}catch(i){console.log(i)}
//# sourceMappingURL=index.34c4d72a.js.map
