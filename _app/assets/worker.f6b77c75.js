var g0=Object.defineProperty,w0=Object.defineProperties;var b0=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var z0=Object.prototype.hasOwnProperty,A0=Object.prototype.propertyIsEnumerable;var Ze=(C,F,T)=>F in C?g0(C,F,{enumerable:!0,configurable:!0,writable:!0,value:T}):C[F]=T,E1=(C,F)=>{for(var T in F||(F={}))z0.call(F,T)&&Ze(C,T,F[T]);if(Ye)for(var T of Ye(F))A0.call(F,T)&&Ze(C,T,F[T]);return C},Qe=(C,F)=>w0(C,b0(F));(function(){"use strict";const C=class extends Error{constructor(e,n={}){super(e),this.detail=e,this.meta=n}static fromParent(e,n,r,t){return new C(r,Object.assign({cause:e},t))}getCause(){return this.meta.cause||void 0}unwrapChain(e=this){return C.unwrapChain(e)}};let F=C;F.unwrapChain=e=>{const n=[e];let r=e.getCause();for(;r;)n.push(r),r=r.getCause();return n};const T=.4;function ke(e,n,r,t,a,s,i,c,l,o){const h=a-r,f=i-a,v=l-i,p=s-t,y=c-s,m=o-c;let u,x,g,M,w=-1e4,b=-1e4;const d=[{x:r,y:t}];for(let S=1;S<e;S++){const z=S/e;u=r+h*z,g=a+f*z;const D=i+v*z;u+=(g-u)*z,g+=(D-g)*z,x=t+p*z,M=s+y*z;const E=c+m*z;x+=(M-x)*z,M+=(E-M)*z;const N=u+(g-u)*z,A=x+(M-x)*z,O=N-w,_=A-b;O*O+_*_>n&&(d.push({x:N,y:A}),w=N,b=A)}return d.push({x:l,y:o}),d}function We(e){const n=e.length-1;return e.map((r,t,a)=>{if(t===0)return{rx:a[t+1].x*T*0,ry:r.y+(a[t+1].y-r.y)*T*0};if(t===n)return{lx:a[t-1].x+(r.x-a[t-1].x)*T*2,ly:a[t-1].y+(r.y-a[t-1].y)*T*2};if(r.y>a[t+1].y&&r.y>a[t-1].y||r.y<a[t+1].y&&r.y<a[t-1].y)return{lx:a[t-1].x+(r.x-a[t-1].x)*T,ly:r.y,rx:r.x+(a[t+1].x-r.x)*T,ry:r.y};{const i={x:a[t-1].x-a[t+1].x,y:a[t-1].y-a[t+1].y},c=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));i.x/=c,i.y/=c;const l=a[t+1].x-r.x,o=r.x-a[t-1].x;return{lx:r.x+i.x*o*T,ly:r.y+i.y*o*T,rx:r.x-i.x*l*T,ry:r.y-i.y*l*T}}})}function Je(e){const n=e.length-1,r={},t=We(e);return e.map((a,s,i)=>{if(s<n)return ke(n*20,0,a.x,a.y,t[s].rx,t[s].ry,t[s+1].lx,t[s+1].ly,i[s+1].x,i[s+1].y)}).flat().filter(a=>!a||a.x in r?!1:(r[a.x]=!0,!0))}var a1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Xe={exports:{}};(function(e,n){(function(r,t){t()})(a1,function(){function r(o,h){return typeof h=="undefined"?h={autoBom:!1}:typeof h!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),h={autoBom:!h}),h.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function t(o,h,f){var v=new XMLHttpRequest;v.open("GET",o),v.responseType="blob",v.onload=function(){l(v.response,h,f)},v.onerror=function(){console.error("could not download file")},v.send()}function a(o){var h=new XMLHttpRequest;h.open("HEAD",o,!1);try{h.send()}catch{}return 200<=h.status&&299>=h.status}function s(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var h=document.createEvent("MouseEvents");h.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(h)}}var i=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof a1=="object"&&a1.global===a1?a1:void 0,c=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=i.saveAs||(typeof window!="object"||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(o,h,f){var v=i.URL||i.webkitURL,p=document.createElement("a");h=h||o.name||"download",p.download=h,p.rel="noopener",typeof o=="string"?(p.href=o,p.origin===location.origin?s(p):a(p.href)?t(o,h,f):s(p,p.target="_blank")):(p.href=v.createObjectURL(o),setTimeout(function(){v.revokeObjectURL(p.href)},4e4),setTimeout(function(){s(p)},0))}:"msSaveOrOpenBlob"in navigator?function(o,h,f){if(h=h||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(r(o,f),h);else if(a(o))t(o,h,f);else{var v=document.createElement("a");v.href=o,v.target="_blank",setTimeout(function(){s(v)})}}:function(o,h,f,v){if(v=v||open("","_blank"),v&&(v.document.title=v.document.body.innerText="downloading..."),typeof o=="string")return t(o,h,f);var p=o.type==="application/octet-stream",y=/constructor/i.test(i.HTMLElement)||i.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||p&&y||c)&&typeof FileReader!="undefined"){var u=new FileReader;u.onloadend=function(){var M=u.result;M=m?M:M.replace(/^data:[^;]*;/,"data:attachment/file;"),v?v.location.href=M:location=M,v=null},u.readAsDataURL(o)}else{var x=i.URL||i.webkitURL,g=x.createObjectURL(o);v?v.location=g:location.href=g,v=null,setTimeout(function(){x.revokeObjectURL(g)},4e4)}});i.saveAs=l.saveAs=l,e.exports=l})})(Xe);const Ke={amountEmitters:0,amountCallbacks:0,emitters:[]};typeof self!="undefined"&&"window"in self&&(globalThis.debug=Ke);function O1(e){let n,r={length:NaN};const t=(a,s)=>a===r[s];return function(...s){return(s.length!==r.length||!s.every(t))&&(r=s,n=e.apply(this,s)),n}}function re(e){let n=e[0],r=e[1],t=e[2];return Math.sqrt(n*n+r*r+t*t)}function R1(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function en(e,n,r,t){return e[0]=n,e[1]=r,e[2]=t,e}function te(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function ae(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e}function nn(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e}function rn(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e}function P1(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e}function tn(e,n){let r=n[0]-e[0],t=n[1]-e[1],a=n[2]-e[2];return Math.sqrt(r*r+t*t+a*a)}function an(e,n){let r=n[0]-e[0],t=n[1]-e[1],a=n[2]-e[2];return r*r+t*t+a*a}function se(e){let n=e[0],r=e[1],t=e[2];return n*n+r*r+t*t}function sn(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e}function cn(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e}function $1(e,n){let r=n[0],t=n[1],a=n[2],s=r*r+t*t+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e}function ie(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function ce(e,n,r){let t=n[0],a=n[1],s=n[2],i=r[0],c=r[1],l=r[2];return e[0]=a*l-s*c,e[1]=s*i-t*l,e[2]=t*c-a*i,e}function ln(e,n,r,t){let a=n[0],s=n[1],i=n[2];return e[0]=a+t*(r[0]-a),e[1]=s+t*(r[1]-s),e[2]=i+t*(r[2]-i),e}function on(e,n,r){let t=n[0],a=n[1],s=n[2],i=r[3]*t+r[7]*a+r[11]*s+r[15];return i=i||1,e[0]=(r[0]*t+r[4]*a+r[8]*s+r[12])/i,e[1]=(r[1]*t+r[5]*a+r[9]*s+r[13])/i,e[2]=(r[2]*t+r[6]*a+r[10]*s+r[14])/i,e}function fn(e,n,r){let t=n[0],a=n[1],s=n[2],i=r[3]*t+r[7]*a+r[11]*s+r[15];return i=i||1,e[0]=(r[0]*t+r[4]*a+r[8]*s)/i,e[1]=(r[1]*t+r[5]*a+r[9]*s)/i,e[2]=(r[2]*t+r[6]*a+r[10]*s)/i,e}function vn(e,n,r){let t=n[0],a=n[1],s=n[2],i=r[0],c=r[1],l=r[2],o=r[3],h=c*s-l*a,f=l*t-i*s,v=i*a-c*t,p=c*v-l*f,y=l*h-i*v,m=i*f-c*h,u=o*2;return h*=u,f*=u,v*=u,p*=2,y*=2,m*=2,e[0]=t+h+p,e[1]=a+f+y,e[2]=s+v+m,e}const hn=function(){const e=[0,0,0],n=[0,0,0];return function(r,t){R1(e,r),R1(n,t),$1(e,e),$1(n,n);let a=ie(e,n);return a>1?0:a<-1?Math.PI:Math.acos(a)}}();function pn(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}const un=e=>!!e.length;class U extends Array{constructor(n=0,r=n,t=n){return super(n,r,t),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(n){this[0]=n}set y(n){this[1]=n}set z(n){this[2]=n}set(n,r=n,t=n){return un(n)?this.copy(n):(en(this,n,r,t),this)}copy(n){return R1(this,n),this}add(n,r){return r?te(this,n,r):te(this,this,n),this}sub(n,r){return r?ae(this,n,r):ae(this,this,n),this}multiply(n){return n.length?nn(this,this,n):P1(this,this,n),this}divide(n){return n.length?rn(this,this,n):P1(this,this,1/n),this}inverse(n=this){return cn(this,n),this}len(){return re(this)}distance(n){return n?tn(this,n):re(this)}squaredLen(){return se(this)}squaredDistance(n){return n?an(this,n):se(this)}negate(n=this){return sn(this,n),this}cross(n,r){return r?ce(this,n,r):ce(this,this,n),this}scale(n){return P1(this,this,n),this}normalize(){return $1(this,this),this}dot(n){return ie(this,n)}equals(n){return pn(this,n)}applyMatrix4(n){return on(this,this,n),this}scaleRotateMatrix4(n){return fn(this,this,n),this}applyQuaternion(n){return vn(this,this,n),this}angle(n){return hn(this,n)}lerp(n,r){return ln(this,this,n,r),this}clone(){return new U(this[0],this[1],this[2])}fromArray(n,r=0){return this[0]=n[r],this[1]=n[r+1],this[2]=n[r+2],this}toArray(n=[],r=0){return n[r]=this[0],n[r+1]=this[1],n[r+2]=this[2],n}transformDirection(n){const r=this[0],t=this[1],a=this[2];return this[0]=n[0]*r+n[4]*t+n[8]*a,this[1]=n[1]*r+n[5]*t+n[9]*a,this[2]=n[2]*r+n[6]*t+n[10]*a,this.normalize()}}function T1(){}function mn(e,n){return e!=e?n==n:e!==n||e&&typeof e=="object"||typeof e=="function"}Promise.resolve();const X=[];function yn(e,n=T1){let r;const t=new Set;function a(c){if(mn(e,c)&&(e=c,r)){const l=!X.length;for(const o of t)o[1](),X.push(o,e);if(l){for(let o=0;o<X.length;o+=2)X[o][0](X[o+1]);X.length=0}}}function s(c){a(c(e))}function i(c,l=T1){const o=[c,l];return t.add(o),t.size===1&&(r=n(a)||T1),c(e),()=>{t.delete(o),t.size===0&&(r(),r=null)}}return{set:a,update:s,subscribe:i}}const dn=typeof globalThis.WorkerGlobalScope!="undefined"&&self instanceof globalThis.WorkerGlobalScope;let u1=[],m1=2,K=0,le=0;const L1="plant.log.history",q1="localStorage"in globalThis,e1=q1?L1 in localStorage?JSON.parse(localStorage.getItem(L1)):[]:[];q1&&(m1=parseInt(localStorage.getItem("pt-log-level"))||2);function xn(){q1&&localStorage.setItem(L1,JSON.stringify(e1))}let n1;function Z(e){K=Math.max(K,e.length);const n=le;le++;const r=(a,s)=>{if(!dn&&(e1.push({scope:e,args:a,level:m1,date:Date.now()}),e1.length=Math.min(100,e1.length),n1&&n1.set(e1),xn(),(!u1.length||u1.includes(e))&&s<=m1)){if(a instanceof Error){console.error(`[${e.padEnd(K," ")}]`,a);return}if(Array.isArray(a)&&typeof a[0]=="string"&&typeof a[1]=="object"){console.groupCollapsed(`%c[${e.padEnd(K," ")}]`,`color: hsl(${n*30}deg 68% 64%); font-weight: bold;`,a[0]),console.log(...a.slice(1)),console.groupEnd();return}s===0&&console.log(`%c[${e.padEnd(K," ")}]`,`color: hsl(${n*30}deg 68% 64%); font-weight: bold;`,...a),s===1&&console.warn(`[${e.padEnd(K," ")}]`,...a)}},t=(...a)=>r(a,2);return t.warn=(...a)=>r(a,1),t.error=a=>r(a,0),t}Z.getStore=function(){return n1||(n1=yn([]),n1)},Z.getHistory=function(){return[...e1]},Z.setFilter=(...e)=>{u1=e,console.log("[log] set filter",{filters:u1})},Z.setLevel=(e=0)=>{m1=e,localStorage.setItem("pt-log-level",""+e)};let oe;function Mn(e){const n=e.position,r=e.index,t=e.normal;for(let a=0;a<r.length/3;a++){const s=new U(n[r[a*3+0]*3+0],n[r[a*3+0]*3+1],n[r[a*3+0]*3+2]),i=new U(n[r[a*3+1]*3+0]-s.x,n[r[a*3+1]*3+1]-s.y,n[r[a*3+1]*3+2]-s.z),c=new U(n[r[a*3+2]*3+0]-s.x,n[r[a*3+2]*3+1]-s.y,n[r[a*3+2]*3+2]-s.z);let l=new U().cross(i,c).normalize();l[0]===0&&l[1]===0&&l[3]===0&&(l=oe);for(let o=0;o<3;o++)t[r[a*3+o]*3+0]=l.x,t[r[a*3+o]*3+1]=l.y,t[r[a*3+o]*3+2]=l.z;oe=l}return e}function gn(e,n=[0,0,0],r=[0,0,0],t=[1,1,1]){const a=new Float32Array(e.position.length),s=e.position.length,i=e.position;for(let c=0;c<s;c+=3){const l=i[c+0]*t[0],o=i[c+1]*t[1],h=i[c+2]*t[2],f=l,v=Math.cos(r[0])*o-Math.sin(r[0])*h,p=Math.sin(r[0])*o+Math.cos(r[0])*h,y=Math.cos(r[1])*f-Math.sin(r[1])*p,m=v,u=Math.sin(r[1])*f+Math.cos(r[1])*p;a[c+0]=y+n[0],a[c+1]=m+n[1],a[c+2]=u+n[2]}return{position:a,uv:e.uv,normal:e.normal,index:e.index}}function wn(e){const n=[],r={position:e.position,normal:e.normal,uv:e.uv,index:e.index},t=e.offset,a=e.rotation,s=e.scale,i=e.offset.length;for(let c=0;c<i;c+=3)n.push(gn(r,[t[c+0],t[c+1],t[c+2]],[a[c+0],a[c+1],a[c+2]],[s[c+0],s[c+1],s[c+2]]));return n}var $=1e-6,B=typeof Float32Array!="undefined"?Float32Array:Array,fe=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function bn(){var e=new B(16);return B!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function zn(e){var n=new B(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function An(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function _n(e,n,r,t,a,s,i,c,l,o,h,f,v,p,y,m){var u=new B(16);return u[0]=e,u[1]=n,u[2]=r,u[3]=t,u[4]=a,u[5]=s,u[6]=i,u[7]=c,u[8]=l,u[9]=o,u[10]=h,u[11]=f,u[12]=v,u[13]=p,u[14]=y,u[15]=m,u}function Sn(e,n,r,t,a,s,i,c,l,o,h,f,v,p,y,m,u){return e[0]=n,e[1]=r,e[2]=t,e[3]=a,e[4]=s,e[5]=i,e[6]=c,e[7]=l,e[8]=o,e[9]=h,e[10]=f,e[11]=v,e[12]=p,e[13]=y,e[14]=m,e[15]=u,e}function ve(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Nn(e,n){if(e===n){var r=n[1],t=n[2],a=n[3],s=n[6],i=n[7],c=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=t,e[9]=s,e[11]=n[14],e[12]=a,e[13]=i,e[14]=c}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function Dn(e,n){var r=n[0],t=n[1],a=n[2],s=n[3],i=n[4],c=n[5],l=n[6],o=n[7],h=n[8],f=n[9],v=n[10],p=n[11],y=n[12],m=n[13],u=n[14],x=n[15],g=r*c-t*i,M=r*l-a*i,w=r*o-s*i,b=t*l-a*c,d=t*o-s*c,S=a*o-s*l,z=h*m-f*y,D=h*u-v*y,E=h*x-p*y,N=f*u-v*m,A=f*x-p*m,O=v*x-p*u,_=g*O-M*A+w*N+b*E-d*D+S*z;return _?(_=1/_,e[0]=(c*O-l*A+o*N)*_,e[1]=(a*A-t*O-s*N)*_,e[2]=(m*S-u*d+x*b)*_,e[3]=(v*d-f*S-p*b)*_,e[4]=(l*E-i*O-o*D)*_,e[5]=(r*O-a*E+s*D)*_,e[6]=(u*w-y*S-x*M)*_,e[7]=(h*S-v*w+p*M)*_,e[8]=(i*A-c*E+o*z)*_,e[9]=(t*E-r*A-s*z)*_,e[10]=(y*d-m*w+x*g)*_,e[11]=(f*w-h*d-p*g)*_,e[12]=(c*D-i*N-l*z)*_,e[13]=(r*N-t*D+a*z)*_,e[14]=(m*M-y*b-u*g)*_,e[15]=(h*b-f*M+v*g)*_,e):null}function En(e,n){var r=n[0],t=n[1],a=n[2],s=n[3],i=n[4],c=n[5],l=n[6],o=n[7],h=n[8],f=n[9],v=n[10],p=n[11],y=n[12],m=n[13],u=n[14],x=n[15];return e[0]=c*(v*x-p*u)-f*(l*x-o*u)+m*(l*p-o*v),e[1]=-(t*(v*x-p*u)-f*(a*x-s*u)+m*(a*p-s*v)),e[2]=t*(l*x-o*u)-c*(a*x-s*u)+m*(a*o-s*l),e[3]=-(t*(l*p-o*v)-c*(a*p-s*v)+f*(a*o-s*l)),e[4]=-(i*(v*x-p*u)-h*(l*x-o*u)+y*(l*p-o*v)),e[5]=r*(v*x-p*u)-h*(a*x-s*u)+y*(a*p-s*v),e[6]=-(r*(l*x-o*u)-i*(a*x-s*u)+y*(a*o-s*l)),e[7]=r*(l*p-o*v)-i*(a*p-s*v)+h*(a*o-s*l),e[8]=i*(f*x-p*m)-h*(c*x-o*m)+y*(c*p-o*f),e[9]=-(r*(f*x-p*m)-h*(t*x-s*m)+y*(t*p-s*f)),e[10]=r*(c*x-o*m)-i*(t*x-s*m)+y*(t*o-s*c),e[11]=-(r*(c*p-o*f)-i*(t*p-s*f)+h*(t*o-s*c)),e[12]=-(i*(f*u-v*m)-h*(c*u-l*m)+y*(c*v-l*f)),e[13]=r*(f*u-v*m)-h*(t*u-a*m)+y*(t*v-a*f),e[14]=-(r*(c*u-l*m)-i*(t*u-a*m)+y*(t*l-a*c)),e[15]=r*(c*v-l*f)-i*(t*v-a*f)+h*(t*l-a*c),e}function On(e){var n=e[0],r=e[1],t=e[2],a=e[3],s=e[4],i=e[5],c=e[6],l=e[7],o=e[8],h=e[9],f=e[10],v=e[11],p=e[12],y=e[13],m=e[14],u=e[15],x=n*i-r*s,g=n*c-t*s,M=n*l-a*s,w=r*c-t*i,b=r*l-a*i,d=t*l-a*c,S=o*y-h*p,z=o*m-f*p,D=o*u-v*p,E=h*m-f*y,N=h*u-v*y,A=f*u-v*m;return x*A-g*N+M*E+w*D-b*z+d*S}function he(e,n,r){var t=n[0],a=n[1],s=n[2],i=n[3],c=n[4],l=n[5],o=n[6],h=n[7],f=n[8],v=n[9],p=n[10],y=n[11],m=n[12],u=n[13],x=n[14],g=n[15],M=r[0],w=r[1],b=r[2],d=r[3];return e[0]=M*t+w*c+b*f+d*m,e[1]=M*a+w*l+b*v+d*u,e[2]=M*s+w*o+b*p+d*x,e[3]=M*i+w*h+b*y+d*g,M=r[4],w=r[5],b=r[6],d=r[7],e[4]=M*t+w*c+b*f+d*m,e[5]=M*a+w*l+b*v+d*u,e[6]=M*s+w*o+b*p+d*x,e[7]=M*i+w*h+b*y+d*g,M=r[8],w=r[9],b=r[10],d=r[11],e[8]=M*t+w*c+b*f+d*m,e[9]=M*a+w*l+b*v+d*u,e[10]=M*s+w*o+b*p+d*x,e[11]=M*i+w*h+b*y+d*g,M=r[12],w=r[13],b=r[14],d=r[15],e[12]=M*t+w*c+b*f+d*m,e[13]=M*a+w*l+b*v+d*u,e[14]=M*s+w*o+b*p+d*x,e[15]=M*i+w*h+b*y+d*g,e}function Rn(e,n,r){var t=r[0],a=r[1],s=r[2],i,c,l,o,h,f,v,p,y,m,u,x;return n===e?(e[12]=n[0]*t+n[4]*a+n[8]*s+n[12],e[13]=n[1]*t+n[5]*a+n[9]*s+n[13],e[14]=n[2]*t+n[6]*a+n[10]*s+n[14],e[15]=n[3]*t+n[7]*a+n[11]*s+n[15]):(i=n[0],c=n[1],l=n[2],o=n[3],h=n[4],f=n[5],v=n[6],p=n[7],y=n[8],m=n[9],u=n[10],x=n[11],e[0]=i,e[1]=c,e[2]=l,e[3]=o,e[4]=h,e[5]=f,e[6]=v,e[7]=p,e[8]=y,e[9]=m,e[10]=u,e[11]=x,e[12]=i*t+h*a+y*s+n[12],e[13]=c*t+f*a+m*s+n[13],e[14]=l*t+v*a+u*s+n[14],e[15]=o*t+p*a+x*s+n[15]),e}function Pn(e,n,r){var t=r[0],a=r[1],s=r[2];return e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e[3]=n[3]*t,e[4]=n[4]*a,e[5]=n[5]*a,e[6]=n[6]*a,e[7]=n[7]*a,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=n[11]*s,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function $n(e,n,r,t){var a=t[0],s=t[1],i=t[2],c=Math.hypot(a,s,i),l,o,h,f,v,p,y,m,u,x,g,M,w,b,d,S,z,D,E,N,A,O,_,R;return c<$?null:(c=1/c,a*=c,s*=c,i*=c,l=Math.sin(r),o=Math.cos(r),h=1-o,f=n[0],v=n[1],p=n[2],y=n[3],m=n[4],u=n[5],x=n[6],g=n[7],M=n[8],w=n[9],b=n[10],d=n[11],S=a*a*h+o,z=s*a*h+i*l,D=i*a*h-s*l,E=a*s*h-i*l,N=s*s*h+o,A=i*s*h+a*l,O=a*i*h+s*l,_=s*i*h-a*l,R=i*i*h+o,e[0]=f*S+m*z+M*D,e[1]=v*S+u*z+w*D,e[2]=p*S+x*z+b*D,e[3]=y*S+g*z+d*D,e[4]=f*E+m*N+M*A,e[5]=v*E+u*N+w*A,e[6]=p*E+x*N+b*A,e[7]=y*E+g*N+d*A,e[8]=f*O+m*_+M*R,e[9]=v*O+u*_+w*R,e[10]=p*O+x*_+b*R,e[11]=y*O+g*_+d*R,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Tn(e,n,r){var t=Math.sin(r),a=Math.cos(r),s=n[4],i=n[5],c=n[6],l=n[7],o=n[8],h=n[9],f=n[10],v=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=s*a+o*t,e[5]=i*a+h*t,e[6]=c*a+f*t,e[7]=l*a+v*t,e[8]=o*a-s*t,e[9]=h*a-i*t,e[10]=f*a-c*t,e[11]=v*a-l*t,e}function Ln(e,n,r){var t=Math.sin(r),a=Math.cos(r),s=n[0],i=n[1],c=n[2],l=n[3],o=n[8],h=n[9],f=n[10],v=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=s*a-o*t,e[1]=i*a-h*t,e[2]=c*a-f*t,e[3]=l*a-v*t,e[8]=s*t+o*a,e[9]=i*t+h*a,e[10]=c*t+f*a,e[11]=l*t+v*a,e}function qn(e,n,r){var t=Math.sin(r),a=Math.cos(r),s=n[0],i=n[1],c=n[2],l=n[3],o=n[4],h=n[5],f=n[6],v=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=s*a+o*t,e[1]=i*a+h*t,e[2]=c*a+f*t,e[3]=l*a+v*t,e[4]=o*a-s*t,e[5]=h*a-i*t,e[6]=f*a-c*t,e[7]=v*a-l*t,e}function jn(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Vn(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fn(e,n,r){var t=r[0],a=r[1],s=r[2],i=Math.hypot(t,a,s),c,l,o;return i<$?null:(i=1/i,t*=i,a*=i,s*=i,c=Math.sin(n),l=Math.cos(n),o=1-l,e[0]=t*t*o+l,e[1]=a*t*o+s*c,e[2]=s*t*o-a*c,e[3]=0,e[4]=t*a*o-s*c,e[5]=a*a*o+l,e[6]=s*a*o+t*c,e[7]=0,e[8]=t*s*o+a*c,e[9]=a*s*o-t*c,e[10]=s*s*o+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Cn(e,n){var r=Math.sin(n),t=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function In(e,n){var r=Math.sin(n),t=Math.cos(n);return e[0]=t,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Un(e,n){var r=Math.sin(n),t=Math.cos(n);return e[0]=t,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pe(e,n,r){var t=n[0],a=n[1],s=n[2],i=n[3],c=t+t,l=a+a,o=s+s,h=t*c,f=t*l,v=t*o,p=a*l,y=a*o,m=s*o,u=i*c,x=i*l,g=i*o;return e[0]=1-(p+m),e[1]=f+g,e[2]=v-x,e[3]=0,e[4]=f-g,e[5]=1-(h+m),e[6]=y+u,e[7]=0,e[8]=v+x,e[9]=y-u,e[10]=1-(h+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Bn(e,n){var r=new B(3),t=-n[0],a=-n[1],s=-n[2],i=n[3],c=n[4],l=n[5],o=n[6],h=n[7],f=t*t+a*a+s*s+i*i;return f>0?(r[0]=(c*i+h*t+l*s-o*a)*2/f,r[1]=(l*i+h*a+o*t-c*s)*2/f,r[2]=(o*i+h*s+c*a-l*t)*2/f):(r[0]=(c*i+h*t+l*s-o*a)*2,r[1]=(l*i+h*a+o*t-c*s)*2,r[2]=(o*i+h*s+c*a-l*t)*2),pe(e,n,r),e}function Gn(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function ue(e,n){var r=n[0],t=n[1],a=n[2],s=n[4],i=n[5],c=n[6],l=n[8],o=n[9],h=n[10];return e[0]=Math.hypot(r,t,a),e[1]=Math.hypot(s,i,c),e[2]=Math.hypot(l,o,h),e}function Hn(e,n){var r=new B(3);ue(r,n);var t=1/r[0],a=1/r[1],s=1/r[2],i=n[0]*t,c=n[1]*a,l=n[2]*s,o=n[4]*t,h=n[5]*a,f=n[6]*s,v=n[8]*t,p=n[9]*a,y=n[10]*s,m=i+h+y,u=0;return m>0?(u=Math.sqrt(m+1)*2,e[3]=.25*u,e[0]=(f-p)/u,e[1]=(v-l)/u,e[2]=(c-o)/u):i>h&&i>y?(u=Math.sqrt(1+i-h-y)*2,e[3]=(f-p)/u,e[0]=.25*u,e[1]=(c+o)/u,e[2]=(v+l)/u):h>y?(u=Math.sqrt(1+h-i-y)*2,e[3]=(v-l)/u,e[0]=(c+o)/u,e[1]=.25*u,e[2]=(f+p)/u):(u=Math.sqrt(1+y-i-h)*2,e[3]=(c-o)/u,e[0]=(v+l)/u,e[1]=(f+p)/u,e[2]=.25*u),e}function Yn(e,n,r,t){var a=n[0],s=n[1],i=n[2],c=n[3],l=a+a,o=s+s,h=i+i,f=a*l,v=a*o,p=a*h,y=s*o,m=s*h,u=i*h,x=c*l,g=c*o,M=c*h,w=t[0],b=t[1],d=t[2];return e[0]=(1-(y+u))*w,e[1]=(v+M)*w,e[2]=(p-g)*w,e[3]=0,e[4]=(v-M)*b,e[5]=(1-(f+u))*b,e[6]=(m+x)*b,e[7]=0,e[8]=(p+g)*d,e[9]=(m-x)*d,e[10]=(1-(f+y))*d,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Zn(e,n,r,t,a){var s=n[0],i=n[1],c=n[2],l=n[3],o=s+s,h=i+i,f=c+c,v=s*o,p=s*h,y=s*f,m=i*h,u=i*f,x=c*f,g=l*o,M=l*h,w=l*f,b=t[0],d=t[1],S=t[2],z=a[0],D=a[1],E=a[2],N=(1-(m+x))*b,A=(p+w)*b,O=(y-M)*b,_=(p-w)*d,R=(1-(v+x))*d,L=(u+g)*d,P=(y+M)*S,j=(u-g)*S,V=(1-(v+m))*S;return e[0]=N,e[1]=A,e[2]=O,e[3]=0,e[4]=_,e[5]=R,e[6]=L,e[7]=0,e[8]=P,e[9]=j,e[10]=V,e[11]=0,e[12]=r[0]+z-(N*z+_*D+P*E),e[13]=r[1]+D-(A*z+R*D+j*E),e[14]=r[2]+E-(O*z+L*D+V*E),e[15]=1,e}function Qn(e,n){var r=n[0],t=n[1],a=n[2],s=n[3],i=r+r,c=t+t,l=a+a,o=r*i,h=t*i,f=t*c,v=a*i,p=a*c,y=a*l,m=s*i,u=s*c,x=s*l;return e[0]=1-f-y,e[1]=h+x,e[2]=v-u,e[3]=0,e[4]=h-x,e[5]=1-o-y,e[6]=p+m,e[7]=0,e[8]=v+u,e[9]=p-m,e[10]=1-o-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function kn(e,n,r,t,a,s,i){var c=1/(r-n),l=1/(a-t),o=1/(s-i);return e[0]=s*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*l,e[6]=0,e[7]=0,e[8]=(r+n)*c,e[9]=(a+t)*l,e[10]=(i+s)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*s*2*o,e[15]=0,e}function me(e,n,r,t,a){var s=1/Math.tan(n/2),i;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(i=1/(t-a),e[10]=(a+t)*i,e[14]=2*a*t*i):(e[10]=-1,e[14]=-2*t),e}var Wn=me;function Jn(e,n,r,t,a){var s=1/Math.tan(n/2),i;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(i=1/(t-a),e[10]=a*i,e[14]=a*t*i):(e[10]=-1,e[14]=-t),e}function Xn(e,n,r,t){var a=Math.tan(n.upDegrees*Math.PI/180),s=Math.tan(n.downDegrees*Math.PI/180),i=Math.tan(n.leftDegrees*Math.PI/180),c=Math.tan(n.rightDegrees*Math.PI/180),l=2/(i+c),o=2/(a+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=-((i-c)*l*.5),e[9]=(a-s)*o*.5,e[10]=t/(r-t),e[11]=-1,e[12]=0,e[13]=0,e[14]=t*r/(r-t),e[15]=0,e}function ye(e,n,r,t,a,s,i){var c=1/(n-r),l=1/(t-a),o=1/(s-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*o,e[11]=0,e[12]=(n+r)*c,e[13]=(a+t)*l,e[14]=(i+s)*o,e[15]=1,e}var Kn=ye;function er(e,n,r,t,a,s,i){var c=1/(n-r),l=1/(t-a),o=1/(s-i);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=o,e[11]=0,e[12]=(n+r)*c,e[13]=(a+t)*l,e[14]=s*o,e[15]=1,e}function nr(e,n,r,t){var a,s,i,c,l,o,h,f,v,p,y=n[0],m=n[1],u=n[2],x=t[0],g=t[1],M=t[2],w=r[0],b=r[1],d=r[2];return Math.abs(y-w)<$&&Math.abs(m-b)<$&&Math.abs(u-d)<$?ve(e):(h=y-w,f=m-b,v=u-d,p=1/Math.hypot(h,f,v),h*=p,f*=p,v*=p,a=g*v-M*f,s=M*h-x*v,i=x*f-g*h,p=Math.hypot(a,s,i),p?(p=1/p,a*=p,s*=p,i*=p):(a=0,s=0,i=0),c=f*i-v*s,l=v*a-h*i,o=h*s-f*a,p=Math.hypot(c,l,o),p?(p=1/p,c*=p,l*=p,o*=p):(c=0,l=0,o=0),e[0]=a,e[1]=c,e[2]=h,e[3]=0,e[4]=s,e[5]=l,e[6]=f,e[7]=0,e[8]=i,e[9]=o,e[10]=v,e[11]=0,e[12]=-(a*y+s*m+i*u),e[13]=-(c*y+l*m+o*u),e[14]=-(h*y+f*m+v*u),e[15]=1,e)}function rr(e,n,r,t){var a=n[0],s=n[1],i=n[2],c=t[0],l=t[1],o=t[2],h=a-r[0],f=s-r[1],v=i-r[2],p=h*h+f*f+v*v;p>0&&(p=1/Math.sqrt(p),h*=p,f*=p,v*=p);var y=l*v-o*f,m=o*h-c*v,u=c*f-l*h;return p=y*y+m*m+u*u,p>0&&(p=1/Math.sqrt(p),y*=p,m*=p,u*=p),e[0]=y,e[1]=m,e[2]=u,e[3]=0,e[4]=f*u-v*m,e[5]=v*y-h*u,e[6]=h*m-f*y,e[7]=0,e[8]=h,e[9]=f,e[10]=v,e[11]=0,e[12]=a,e[13]=s,e[14]=i,e[15]=1,e}function tr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ar(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function sr(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function de(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function ir(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function cr(e,n,r,t){return e[0]=n[0]+r[0]*t,e[1]=n[1]+r[1]*t,e[2]=n[2]+r[2]*t,e[3]=n[3]+r[3]*t,e[4]=n[4]+r[4]*t,e[5]=n[5]+r[5]*t,e[6]=n[6]+r[6]*t,e[7]=n[7]+r[7]*t,e[8]=n[8]+r[8]*t,e[9]=n[9]+r[9]*t,e[10]=n[10]+r[10]*t,e[11]=n[11]+r[11]*t,e[12]=n[12]+r[12]*t,e[13]=n[13]+r[13]*t,e[14]=n[14]+r[14]*t,e[15]=n[15]+r[15]*t,e}function lr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function or(e,n){var r=e[0],t=e[1],a=e[2],s=e[3],i=e[4],c=e[5],l=e[6],o=e[7],h=e[8],f=e[9],v=e[10],p=e[11],y=e[12],m=e[13],u=e[14],x=e[15],g=n[0],M=n[1],w=n[2],b=n[3],d=n[4],S=n[5],z=n[6],D=n[7],E=n[8],N=n[9],A=n[10],O=n[11],_=n[12],R=n[13],L=n[14],P=n[15];return Math.abs(r-g)<=$*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(t-M)<=$*Math.max(1,Math.abs(t),Math.abs(M))&&Math.abs(a-w)<=$*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-b)<=$*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(i-d)<=$*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(c-S)<=$*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-z)<=$*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(o-D)<=$*Math.max(1,Math.abs(o),Math.abs(D))&&Math.abs(h-E)<=$*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-N)<=$*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(v-A)<=$*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(p-O)<=$*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(y-_)<=$*Math.max(1,Math.abs(y),Math.abs(_))&&Math.abs(m-R)<=$*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(u-L)<=$*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(x-P)<=$*Math.max(1,Math.abs(x),Math.abs(P))}var fr=he,vr=de,hr=Object.freeze({__proto__:null,create:bn,clone:zn,copy:An,fromValues:_n,set:Sn,identity:ve,transpose:Nn,invert:Dn,adjoint:En,determinant:On,multiply:he,translate:Rn,scale:Pn,rotate:$n,rotateX:Tn,rotateY:Ln,rotateZ:qn,fromTranslation:jn,fromScaling:Vn,fromRotation:Fn,fromXRotation:Cn,fromYRotation:In,fromZRotation:Un,fromRotationTranslation:pe,fromQuat2:Bn,getTranslation:Gn,getScaling:ue,getRotation:Hn,fromRotationTranslationScale:Yn,fromRotationTranslationScaleOrigin:Zn,fromQuat:Qn,frustum:kn,perspectiveNO:me,perspective:Wn,perspectiveZO:Jn,perspectiveFromFieldOfView:Xn,orthoNO:ye,ortho:Kn,orthoZO:er,lookAt:nr,targetTo:rr,str:tr,frob:ar,add:sr,subtract:de,multiplyScalar:ir,multiplyScalarAndAdd:cr,exactEquals:lr,equals:or,mul:fr,sub:vr});function xe(){var e=new B(3);return B!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function pr(e){var n=new B(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Me(e){var n=e[0],r=e[1],t=e[2];return Math.hypot(n,r,t)}function ur(e,n,r){var t=new B(3);return t[0]=e,t[1]=n,t[2]=r,t}function mr(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function yr(e,n,r,t){return e[0]=n,e[1]=r,e[2]=t,e}function dr(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function ge(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e}function we(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e}function be(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e}function xr(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e}function Mr(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e}function gr(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e}function wr(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e}function br(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e}function zr(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e}function Ar(e,n,r,t){return e[0]=n[0]+r[0]*t,e[1]=n[1]+r[1]*t,e[2]=n[2]+r[2]*t,e}function ze(e,n){var r=n[0]-e[0],t=n[1]-e[1],a=n[2]-e[2];return Math.hypot(r,t,a)}function Ae(e,n){var r=n[0]-e[0],t=n[1]-e[1],a=n[2]-e[2];return r*r+t*t+a*a}function _e(e){var n=e[0],r=e[1],t=e[2];return n*n+r*r+t*t}function _r(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e}function Sr(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e}function Nr(e,n){var r=n[0],t=n[1],a=n[2],s=r*r+t*t+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e}function Se(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Dr(e,n,r){var t=n[0],a=n[1],s=n[2],i=r[0],c=r[1],l=r[2];return e[0]=a*l-s*c,e[1]=s*i-t*l,e[2]=t*c-a*i,e}function Er(e,n,r,t){var a=n[0],s=n[1],i=n[2];return e[0]=a+t*(r[0]-a),e[1]=s+t*(r[1]-s),e[2]=i+t*(r[2]-i),e}function Or(e,n,r,t,a,s){var i=s*s,c=i*(2*s-3)+1,l=i*(s-2)+s,o=i*(s-1),h=i*(3-2*s);return e[0]=n[0]*c+r[0]*l+t[0]*o+a[0]*h,e[1]=n[1]*c+r[1]*l+t[1]*o+a[1]*h,e[2]=n[2]*c+r[2]*l+t[2]*o+a[2]*h,e}function Rr(e,n,r,t,a,s){var i=1-s,c=i*i,l=s*s,o=c*i,h=3*s*c,f=3*l*i,v=l*s;return e[0]=n[0]*o+r[0]*h+t[0]*f+a[0]*v,e[1]=n[1]*o+r[1]*h+t[1]*f+a[1]*v,e[2]=n[2]*o+r[2]*h+t[2]*f+a[2]*v,e}function Pr(e,n){n=n||1;var r=fe()*2*Math.PI,t=fe()*2-1,a=Math.sqrt(1-t*t)*n;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=t*n,e}function $r(e,n,r){var t=n[0],a=n[1],s=n[2],i=r[3]*t+r[7]*a+r[11]*s+r[15];return i=i||1,e[0]=(r[0]*t+r[4]*a+r[8]*s+r[12])/i,e[1]=(r[1]*t+r[5]*a+r[9]*s+r[13])/i,e[2]=(r[2]*t+r[6]*a+r[10]*s+r[14])/i,e}function Tr(e,n,r){var t=n[0],a=n[1],s=n[2];return e[0]=t*r[0]+a*r[3]+s*r[6],e[1]=t*r[1]+a*r[4]+s*r[7],e[2]=t*r[2]+a*r[5]+s*r[8],e}function Lr(e,n,r){var t=r[0],a=r[1],s=r[2],i=r[3],c=n[0],l=n[1],o=n[2],h=a*o-s*l,f=s*c-t*o,v=t*l-a*c,p=a*v-s*f,y=s*h-t*v,m=t*f-a*h,u=i*2;return h*=u,f*=u,v*=u,p*=2,y*=2,m*=2,e[0]=c+h+p,e[1]=l+f+y,e[2]=o+v+m,e}function qr(e,n,r,t){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[0],s[1]=a[1]*Math.cos(t)-a[2]*Math.sin(t),s[2]=a[1]*Math.sin(t)+a[2]*Math.cos(t),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function jr(e,n,r,t){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[2]*Math.sin(t)+a[0]*Math.cos(t),s[1]=a[1],s[2]=a[2]*Math.cos(t)-a[0]*Math.sin(t),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Vr(e,n,r,t){var a=[],s=[];return a[0]=n[0]-r[0],a[1]=n[1]-r[1],a[2]=n[2]-r[2],s[0]=a[0]*Math.cos(t)-a[1]*Math.sin(t),s[1]=a[0]*Math.sin(t)+a[1]*Math.cos(t),s[2]=a[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Fr(e,n){var r=e[0],t=e[1],a=e[2],s=n[0],i=n[1],c=n[2],l=Math.sqrt(r*r+t*t+a*a),o=Math.sqrt(s*s+i*i+c*c),h=l*o,f=h&&Se(e,n)/h;return Math.acos(Math.min(Math.max(f,-1),1))}function Cr(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ir(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ur(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function Br(e,n){var r=e[0],t=e[1],a=e[2],s=n[0],i=n[1],c=n[2];return Math.abs(r-s)<=$*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(t-i)<=$*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(a-c)<=$*Math.max(1,Math.abs(a),Math.abs(c))}var Gr=ge,Hr=we,Yr=be,Zr=ze,Qr=Ae,kr=Me,Wr=_e,Jr=function(){var e=xe();return function(n,r,t,a,s,i){var c,l;for(r||(r=3),t||(t=0),a?l=Math.min(a*r+t,n.length):l=n.length,c=t;c<l;c+=r)e[0]=n[c],e[1]=n[c+1],e[2]=n[c+2],s(e,e,i),n[c]=e[0],n[c+1]=e[1],n[c+2]=e[2];return n}}(),Xr=Object.freeze({__proto__:null,create:xe,clone:pr,length:Me,fromValues:ur,copy:mr,set:yr,add:dr,subtract:ge,multiply:we,divide:be,ceil:xr,floor:Mr,min:gr,max:wr,round:br,scale:zr,scaleAndAdd:Ar,distance:ze,squaredDistance:Ae,squaredLength:_e,negate:_r,inverse:Sr,normalize:Nr,dot:Se,cross:Dr,lerp:Er,hermite:Or,bezier:Rr,random:Pr,transformMat4:$r,transformMat3:Tr,transformQuat:Lr,rotateX:qr,rotateY:jr,rotateZ:Vr,angle:Fr,zero:Cr,str:Ir,exactEquals:Ur,equals:Br,sub:Gr,mul:Hr,div:Yr,dist:Zr,sqrDist:Qr,len:kr,sqrLen:Wr,forEach:Jr});function j1(e,n,r){for(let t=0;t<r.length;t++)e[n+t]=r[t]}const{identity:Kr,rotate:et}=hr,{add:nt,cross:rt,dot:tt,mul:Ne,normalize:De,subtract:V1,transformMat4:at}=Xr;function st(e){const n=2*Math.PI/e;return new Array(e).fill(null).map((r,t)=>[Math.cos(n*t),Math.sin(n*t)])}function it(e,n=1){const r=new Uint16Array(e*(Math.max(n,1)-1)*6);for(let t=0;t<n;t++){const a=t*e*6,s=t*e;for(let i=0;i<e;i++){const c=a+i*6,l=s+i;r[c+0]=l,r[c+1]=l-e+1,r[c+2]=l+1,r[c+3]=l+1,r[c+4]=l+e,r[c+5]=l,i===e-1?(r[c+0]=l,r[c+1]=l-e+1,r[c+2]=l+1,r[c+3]=l+1,r[c+4]=l+e,r[c+5]=l):(r[c+0]=l,r[c+1]=l+1,r[c+2]=l+e+1,r[c+3]=l+e+1,r[c+4]=l+e,r[c+5]=l)}}return r}function ct(e,n=3){const r=[],t=[],a=[],s=e.length/4,i=s*n,c=new Float32Array(i*3),l=new Float32Array(i*3),o=new Float32Array(i*2),h=it(n,s),f=st(n);for(let v=0;v<s;v++){const p=[0,0,1],y=e.slice(v*4,v*4+3),m=e.slice((v+1)*4,(v+1)*4+3),u=e.slice((v-1)*4,(v-1)*4+3),x=e[v*4+3];v===0?V1(t,y,m):v===s-1?V1(t,u,y):V1(t,u,m),De(t,t),rt(a,p,t);const g=Math.acos(tt(p,t));Kr(r),et(r,r,g,a);for(let M=0;M<n;M++){const w=[...f[M],0];Ne(w,w,[x,x,1]),at(w,w,r);const b=[];De(b,w);const d=v*n*3+M*3;j1(l,d,b),Ne(b,b,[-1,-1,-1]),nt(w,w,y),j1(c,d,w),j1(o,v*n*2+M*2,[M/n,v/s])}}return{position:c,normal:l,uv:o,index:h}}function s1(e,n,r){return e*(1-r)+n*r}function lt(e,n=0){const r=(e.length-1)*n,t=Math.floor(r),a=Math.ceil(r);return s1(e[a],e[t],a-r)}function Ee(e,n){const r=(e.length/4-1)*n,t=Math.floor(r),a=Math.ceil(r),s=a-r;return[s1(e[a*4+0],e[t*4+0],s),s1(e[a*4+1],e[t*4+1],s),s1(e[a*4+2],e[t*4+2],s),s1(e[a*4+3],e[t*4+3],s)]}function F1(e,n){const r=(e.length/4-1)*n,t=Math.floor(r),a=Math.ceil(r);return[e[a*4+0]-e[t*4+0],e[a*4+1]-e[t*4+1],e[a*4+2]-e[t*4+2],e[a*4+3]+e[t*4+3]/2]}function Oe(e,n=!1){const r=e.normal.includes(NaN);r&&console.warn("Normals has NaN");const t=e.index.includes(NaN);t&&console.warn("Index has NaN");const a=e.position.includes(NaN);a&&console.warn("Position has NaN");const s=e.uv.includes(NaN);s&&console.warn("UV has NaN");const i=e.position.length/3;e.position.length!==e.normal.length&&console.warn("position and normal amount not eqal"),e.uv.length!==i*2&&(console.groupCollapsed("uv amount not correct, should be "+i*2+" is "+e.uv.length),console.trace(),console.groupEnd()),(r||t||a||s||n)&&console.log("Check",{p:e.position.length,pn:a,n:e.normal.length,nn:r,i:e.index.length,in:t,u:e.uv.length,un:s})}function y1(...e){const n=e.filter(p=>!!p);if(n.length===1)return n[0];n.forEach(p=>Oe(p));let r=0,t=0,a=0;for(const{position:p,index:y,uv:m}of n)r+=p.length,t+=m.length,a+=y.length;const s=new Float32Array(t),i=new Float32Array(r),c=new Float32Array(r),l=a>65536?new Uint32Array(a):new Uint16Array(a);let o=0,h=0,f=0,v=0;for(let p=0;p<n.length;p++){const y=n[p].normal,m=y.length;for(let d=0;d<m;d++)c[h+d]=y[d];h+=m;const u=n[p].uv,x=u.length;for(let d=0;d<x;d++)s[f+d]=u[d];f+=x;const g=n[p].index,M=g.length;for(let d=0;d<M;d++)l[d+v]=g[d]+o/3;v+=M;const w=n[p].position,b=w.length;for(let d=0;d<b;d++)i[o+d]=w[d];o+=b}return{position:i,normal:c,uv:s,index:l}}var ot=(e,n)=>Math.sqrt(e*e+n*n),ft=(e,n,r)=>Math.sqrt(e*e+n*n+r*r),i1={},d1={},c1={};Object.defineProperty(c1,"__esModule",{value:!0});function vt(e){var n=new Uint32Array(1);return n[0]=e[0]*1664525+1013904223,n}c1.default=vt,Object.defineProperty(d1,"__esModule",{value:!0}),d1.makeNoise2D=void 0;var x1=c1,ht=1/47,C1=(Math.sqrt(2+1)-1)/2,pt=(1/Math.sqrt(2+1)-1)/2;function Re(e,n,r){return{dx:-n-e*C1,dy:-r-e*C1,xsb:n,ysb:r}}function ut(e){for(var n=[],r=0;r<l1.length;r+=4){for(var t=mt[l1[r]],a=null,s=null,i=0;i<t.length;i+=3)s=Re(t[i],t[i+1],t[i+2]),a===null?n[r/4]=s:a.next=s,a=s;s.next=Re(l1[r+1],l1[r+2],l1[r+3])}for(var c=[],r=0;r<I1.length;r+=2)c[I1[r]]=n[I1[r+1]];for(var l=new Uint8Array(256),o=new Uint8Array(256),h=new Uint8Array(256),r=0;r<256;r++)h[r]=r;var f=new Uint32Array(1);f[0]=e,f=x1.default(x1.default(x1.default(f)));for(var r=255;r>=0;r--){f=x1.default(f);var v=new Uint32Array(1);v[0]=(f[0]+31)%(r+1),v[0]<0&&(v[0]+=r+1),l[r]=h[v[0]],o[r]=l[r]&14,h[v[0]]=h[r]}return function(p,y){for(var m=(p+y)*pt,u=p+m,x=y+m,g=Math.floor(u),M=Math.floor(x),w=(g+M)*C1,b=p-(g+w),d=y-(M+w),S=u-g,z=x-M,D=S+z,E=S-z+1|D<<1|D+z<<2|D+S<<4,N=0,A=c[E];A!==void 0;A=A.next){var O=b+A.dx,_=d+A.dy,R=2-O*O-_*_;if(R>0){var L=g+A.xsb,P=M+A.ysb,j=l[L&255],V=o[j+P&255],J=Pe[V]*O+Pe[V+1]*_;N+=R*R*R*R*J}}return N*ht}}d1.makeNoise2D=ut;var mt=[[1,1,0,1,0,1,0,0,0],[1,1,0,1,0,1,2,1,1]],Pe=[5,2,2,5,-5,2,-2,5,5,-2,2,-5,-5,-2,-2,-5],I1=[0,1,1,0,4,1,17,0,20,2,21,2,22,5,23,5,26,4,39,3,42,4,43,3],l1=[0,0,1,-1,0,0,-1,1,0,2,1,1,1,2,2,0,1,2,0,2,1,0,0,0],M1={};Object.defineProperty(M1,"__esModule",{value:!0}),M1.makeNoise3D=void 0;var g1=c1,yt=1/103,w1=(Math.sqrt(3+1)-1)/3,dt=(1/Math.sqrt(3+1)-1)/3;function U1(e,n,r,t){return{dx:-n-e*w1,dy:-r-e*w1,dz:-t-e*w1,xsb:n,ysb:r,zsb:t}}function xt(e){for(var n=[],r=0;r<G.length;r+=9){for(var t=Mt[G[r]],a=null,s=null,i=0;i<t.length;i+=4)s=U1(t[i],t[i+1],t[i+2],t[i+3]),a===null?n[r/9]=s:a.next=s,a=s;s.next=U1(G[r+1],G[r+2],G[r+3],G[r+4]),s.next.next=U1(G[r+5],G[r+6],G[r+7],G[r+8])}for(var c=[],r=0;r<G1.length;r+=2)c[G1[r]]=n[G1[r+1]];for(var l=new Uint8Array(256),o=new Uint8Array(256),h=new Uint8Array(256),r=0;r<256;r++)h[r]=r;var f=new Uint32Array(1);f[0]=e,f=g1.default(g1.default(g1.default(f)));for(var r=255;r>=0;r--){f=g1.default(f);var v=new Uint32Array(1);v[0]=(f[0]+31)%(r+1),v[0]<0&&(v[0]+=r+1),l[r]=h[v[0]],o[r]=l[r]%24*3,h[v[0]]=h[r]}return function(p,y,m){for(var u=(p+y+m)*dt,x=p+u,g=y+u,M=m+u,w=Math.floor(x),b=Math.floor(g),d=Math.floor(M),S=(w+b+d)*w1,z=p-(w+S),D=y-(b+S),E=m-(d+S),N=x-w,A=g-b,O=M-d,_=N+A+O,R=A-O+1|N-A+1<<1|N-O+1<<2|_<<3|_+O<<5|_+A<<7|_+N<<9,L=0,P=c[R];P!==void 0;P=P.next){var j=z+P.dx,V=D+P.dy,J=E+P.dz,Y=2-j*j-V*V-J*J;if(Y>0){var I=w+P.xsb,f1=b+P.ysb,v1=d+P.zsb,h1=l[I&255],p1=l[h1+f1&255],H=o[p1+v1&255],ne=B1[H]*j+B1[H+1]*V+B1[H+2]*J;L+=Y*Y*Y*Y*ne}}return L*yt}}M1.makeNoise3D=xt;var Mt=[[0,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1],[2,1,1,0,2,1,0,1,2,0,1,1,3,1,1,1],[1,1,0,0,1,0,1,0,1,0,0,1,2,1,1,0,2,1,0,1,2,0,1,1]],B1=[-11,4,4,-4,11,4,-4,4,11,11,4,4,4,11,4,4,4,11,-11,-4,4,-4,-11,4,-4,-4,11,11,-4,4,4,-11,4,4,-4,11,-11,4,-4,-4,11,-4,-4,4,-11,11,4,-4,4,11,-4,4,4,-11,-11,-4,-4,-4,-11,-4,-4,-4,-11,11,-4,-4,4,-11,-4,4,-4,-11],G1=[0,2,1,1,2,2,5,1,6,0,7,0,32,2,34,2,129,1,133,1,160,5,161,5,518,0,519,0,546,4,550,4,645,3,647,3,672,5,673,5,674,4,677,3,678,4,679,3,680,13,681,13,682,12,685,14,686,12,687,14,712,20,714,18,809,21,813,23,840,20,841,21,1198,19,1199,22,1226,18,1230,19,1325,23,1327,22,1352,15,1353,17,1354,15,1357,17,1358,16,1359,16,1360,11,1361,10,1362,11,1365,10,1366,9,1367,9,1392,11,1394,11,1489,10,1493,10,1520,8,1521,8,1878,9,1879,9,1906,7,1910,7,2005,6,2007,6,2032,8,2033,8,2034,7,2037,6,2038,7,2039,6],G=[0,0,1,-1,0,0,1,0,-1,0,0,-1,1,0,0,0,1,-1,0,0,-1,0,1,0,0,-1,1,0,2,1,1,0,1,1,1,-1,0,2,1,0,1,1,1,-1,1,0,2,0,1,1,1,-1,1,1,1,3,2,1,0,3,1,2,0,1,3,2,0,1,3,1,0,2,1,3,0,2,1,3,0,1,2,1,1,1,0,0,2,2,0,0,1,1,0,1,0,2,0,2,0,1,1,0,0,1,2,0,0,2,2,0,0,0,0,1,1,-1,1,2,0,0,0,0,1,-1,1,1,2,0,0,0,0,1,1,1,-1,2,3,1,1,1,2,0,0,2,2,3,1,1,1,2,2,0,0,2,3,1,1,1,2,0,2,0,2,1,1,-1,1,2,0,0,2,2,1,1,-1,1,2,2,0,0,2,1,-1,1,1,2,0,0,2,2,1,-1,1,1,2,0,2,0,2,1,1,1,-1,2,2,0,0,2,1,1,1,-1,2,0,2,0],b1={};Object.defineProperty(b1,"__esModule",{value:!0}),b1.makeNoise4D=void 0;var z1=c1,gt=1/30,o1=(Math.sqrt(4+1)-1)/4,wt=(1/Math.sqrt(4+1)-1)/4;function A1(e,n,r,t,a){return{dx:-n-e*o1,dy:-r-e*o1,dz:-t-e*o1,dw:-a-e*o1,xsb:n,ysb:r,zsb:t,wsb:a}}function bt(e){for(var n=[],r=0;r<q.length;r+=16){for(var t=zt[q[r]],a=null,s=null,i=0;i<t.length;i+=5)s=A1(t[i],t[i+1],t[i+2],t[i+3],t[i+4]),a===null?n[r/16]=s:a.next=s,a=s;s.next=A1(q[r+1],q[r+2],q[r+3],q[r+4],q[r+5]),s.next.next=A1(q[r+6],q[r+7],q[r+8],q[r+9],q[r+10]),s.next.next.next=A1(q[r+11],q[r+12],q[r+13],q[r+14],q[r+15])}for(var c=[],r=0;r<H1.length;r+=2)c[H1[r]]=n[H1[r+1]];for(var l=new Uint8Array(256),o=new Uint8Array(256),h=new Uint8Array(256),r=0;r<256;r++)h[r]=r;var f=new Uint32Array(1);f[0]=e,f=z1.default(z1.default(z1.default(f)));for(var r=255;r>=0;r--){f=z1.default(f);var v=new Uint32Array(1);v[0]=(f[0]+31)%(r+1),v[0]<0&&(v[0]+=r+1),l[r]=h[v[0]],o[r]=l[r]&252,h[v[0]]=h[r]}return function(p,y,m,u){for(var x=(p+y+m+u)*wt,g=p+x,M=y+x,w=m+x,b=u+x,d=Math.floor(g),S=Math.floor(M),z=Math.floor(w),D=Math.floor(b),E=(d+S+z+D)*o1,N=p-(d+E),A=y-(S+E),O=m-(z+E),_=u-(D+E),R=g-d,L=M-S,P=w-z,j=b-D,V=R+L+P+j,J=P-j+1|L-P+1<<1|L-j+1<<2|R-L+1<<3|R-P+1<<4|R-j+1<<5|V<<6|V+j<<8|V+P<<11|V+L<<14|V+R<<17,Y=0,I=c[J];I!==void 0;I=I.next){var f1=N+I.dx,v1=A+I.dy,h1=O+I.dz,p1=_+I.dw,H=2-f1*f1-v1*v1-h1*h1-p1*p1;if(H>0){var ne=d+I.xsb,p0=S+I.ysb,u0=z+I.zsb,m0=D+I.wsb,y0=l[ne&255],d0=l[y0+p0&255],x0=l[d0+u0&255],D1=o[x0+m0&255],M0=_1[D1]*f1+_1[D1+1]*v1+_1[D1+2]*h1+_1[D1+3]*p1;Y+=H*H*H*H*M0}}return Y*gt}}b1.makeNoise4D=bt;var zt=[[0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,4,1,1,1,1],[1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1]],_1=[3,1,1,1,1,3,1,1,1,1,3,1,1,1,1,3,-3,1,1,1,-1,3,1,1,-1,1,3,1,-1,1,1,3,3,-1,1,1,1,-3,1,1,1,-1,3,1,1,-1,1,3,-3,-1,1,1,-1,-3,1,1,-1,-1,3,1,-1,-1,1,3,3,1,-1,1,1,3,-1,1,1,1,-3,1,1,1,-1,3,-3,1,-1,1,-1,3,-1,1,-1,1,-3,1,-1,1,-1,3,3,-1,-1,1,1,-3,-1,1,1,-1,-3,1,1,-1,-1,3,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,3,1,1,-1,1,3,1,-1,1,1,3,-1,1,1,1,-3,-3,1,1,-1,-1,3,1,-1,-1,1,3,-1,-1,1,1,-3,3,-1,1,-1,1,-3,1,-1,1,-1,3,-1,1,-1,1,-3,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,3,1,-1,-1,1,3,-1,-1,1,1,-3,-1,1,1,-1,-3,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3],H1=[0,3,1,2,2,3,5,2,6,1,7,1,8,3,9,2,10,3,13,2,16,3,18,3,22,1,23,1,24,3,26,3,33,2,37,2,38,1,39,1,41,2,45,2,54,1,55,1,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,256,3,258,3,264,3,266,3,272,3,274,3,280,3,282,3,2049,2,2053,2,2057,2,2061,2,2081,2,2085,2,2089,2,2093,2,2304,9,2305,9,2312,9,2313,9,16390,1,16391,1,16406,1,16407,1,16422,1,16423,1,16438,1,16439,1,16642,8,16646,8,16658,8,16662,8,18437,6,18439,6,18469,6,18471,6,18688,9,18689,9,18690,8,18693,6,18694,8,18695,6,18696,9,18697,9,18706,8,18710,8,18725,6,18727,6,131128,0,131129,0,131130,0,131131,0,131132,0,131133,0,131134,0,131135,0,131352,7,131354,7,131384,7,131386,7,133161,5,133165,5,133177,5,133181,5,133376,9,133377,9,133384,9,133385,9,133400,7,133402,7,133417,5,133421,5,133432,7,133433,5,133434,7,133437,5,147510,4,147511,4,147518,4,147519,4,147714,8,147718,8,147730,8,147734,8,147736,7,147738,7,147766,4,147767,4,147768,7,147770,7,147774,4,147775,4,149509,6,149511,6,149541,6,149543,6,149545,5,149549,5,149558,4,149559,4,149561,5,149565,5,149566,4,149567,4,149760,9,149761,9,149762,8,149765,6,149766,8,149767,6,149768,9,149769,9,149778,8,149782,8,149784,7,149786,7,149797,6,149799,6,149801,5,149805,5,149814,4,149815,4,149816,7,149817,5,149818,7,149821,5,149822,4,149823,4,149824,37,149825,37,149826,36,149829,34,149830,36,149831,34,149832,37,149833,37,149842,36,149846,36,149848,35,149850,35,149861,34,149863,34,149865,33,149869,33,149878,32,149879,32,149880,35,149881,33,149882,35,149885,33,149886,32,149887,32,150080,49,150082,48,150088,49,150098,48,150104,47,150106,47,151873,46,151877,45,151881,46,151909,45,151913,44,151917,44,152128,49,152129,46,152136,49,152137,46,166214,43,166215,42,166230,43,166247,42,166262,41,166263,41,166466,48,166470,43,166482,48,166486,43,168261,45,168263,42,168293,45,168295,42,168512,31,168513,28,168514,31,168517,28,168518,25,168519,25,280952,40,280953,39,280954,40,280957,39,280958,38,280959,38,281176,47,281178,47,281208,40,281210,40,282985,44,282989,44,283001,39,283005,39,283208,30,283209,27,283224,30,283241,27,283256,22,283257,22,297334,41,297335,41,297342,38,297343,38,297554,29,297558,24,297562,29,297590,24,297594,21,297598,21,299365,26,299367,23,299373,26,299383,23,299389,20,299391,20,299584,31,299585,28,299586,31,299589,28,299590,25,299591,25,299592,30,299593,27,299602,29,299606,24,299608,30,299610,29,299621,26,299623,23,299625,27,299629,26,299638,24,299639,23,299640,22,299641,22,299642,21,299645,20,299646,21,299647,20,299648,61,299649,60,299650,61,299653,60,299654,59,299655,59,299656,58,299657,57,299666,55,299670,54,299672,58,299674,55,299685,52,299687,51,299689,57,299693,52,299702,54,299703,51,299704,56,299705,56,299706,53,299709,50,299710,53,299711,50,299904,61,299906,61,299912,58,299922,55,299928,58,299930,55,301697,60,301701,60,301705,57,301733,52,301737,57,301741,52,301952,79,301953,79,301960,76,301961,76,316038,59,316039,59,316054,54,316071,51,316086,54,316087,51,316290,78,316294,78,316306,73,316310,73,318085,77,318087,77,318117,70,318119,70,318336,79,318337,79,318338,78,318341,77,318342,78,318343,77,430776,56,430777,56,430778,53,430781,50,430782,53,430783,50,431e3,75,431002,72,431032,75,431034,72,432809,74,432813,69,432825,74,432829,69,433032,76,433033,76,433048,75,433065,74,433080,75,433081,74,447158,71,447159,68,447166,71,447167,68,447378,73,447382,73,447386,72,447414,71,447418,72,447422,71,449189,70,449191,70,449197,69,449207,68,449213,69,449215,68,449408,67,449409,67,449410,66,449413,64,449414,66,449415,64,449416,67,449417,67,449426,66,449430,66,449432,65,449434,65,449445,64,449447,64,449449,63,449453,63,449462,62,449463,62,449464,65,449465,63,449466,65,449469,63,449470,62,449471,62,449472,19,449473,19,449474,18,449477,16,449478,18,449479,16,449480,19,449481,19,449490,18,449494,18,449496,17,449498,17,449509,16,449511,16,449513,15,449517,15,449526,14,449527,14,449528,17,449529,15,449530,17,449533,15,449534,14,449535,14,449728,19,449729,19,449730,18,449734,18,449736,19,449737,19,449746,18,449750,18,449752,17,449754,17,449784,17,449786,17,451520,19,451521,19,451525,16,451527,16,451528,19,451529,19,451557,16,451559,16,451561,15,451565,15,451577,15,451581,15,451776,19,451777,19,451784,19,451785,19,465858,18,465861,16,465862,18,465863,16,465874,18,465878,18,465893,16,465895,16,465910,14,465911,14,465918,14,465919,14,466114,18,466118,18,466130,18,466134,18,467909,16,467911,16,467941,16,467943,16,468160,13,468161,13,468162,13,468163,13,468164,13,468165,13,468166,13,468167,13,580568,17,580570,17,580585,15,580589,15,580598,14,580599,14,580600,17,580601,15,580602,17,580605,15,580606,14,580607,14,580824,17,580826,17,580856,17,580858,17,582633,15,582637,15,582649,15,582653,15,582856,12,582857,12,582872,12,582873,12,582888,12,582889,12,582904,12,582905,12,596982,14,596983,14,596990,14,596991,14,597202,11,597206,11,597210,11,597214,11,597234,11,597238,11,597242,11,597246,11,599013,10,599015,10,599021,10,599023,10,599029,10,599031,10,599037,10,599039,10,599232,13,599233,13,599234,13,599235,13,599236,13,599237,13,599238,13,599239,13,599240,12,599241,12,599250,11,599254,11,599256,12,599257,12,599258,11,599262,11,599269,10,599271,10,599272,12,599273,12,599277,10,599279,10,599282,11,599285,10,599286,11,599287,10,599288,12,599289,12,599290,11,599293,10,599294,11,599295,10],q=[0,0,1,-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,-1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,-1,0,0,-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,2,1,1,0,0,1,1,1,-1,0,1,1,1,0,-1,0,2,1,0,1,0,1,1,-1,1,0,1,1,0,1,-1,0,2,0,1,1,0,1,-1,1,1,0,1,0,1,1,-1,0,2,1,0,0,1,1,1,-1,0,1,1,1,0,-1,1,0,2,0,1,0,1,1,-1,1,0,1,1,0,1,-1,1,0,2,0,0,1,1,1,-1,0,1,1,1,0,-1,1,1,1,4,2,1,1,0,4,1,2,1,0,4,1,1,2,0,1,4,2,1,0,1,4,1,2,0,1,4,1,1,0,2,1,4,2,0,1,1,4,1,0,2,1,4,1,0,1,2,1,4,0,2,1,1,4,0,1,2,1,4,0,1,1,2,1,2,1,1,0,0,3,2,1,0,0,3,1,2,0,0,1,2,1,0,1,0,3,2,0,1,0,3,1,0,2,0,1,2,0,1,1,0,3,0,2,1,0,3,0,1,2,0,1,2,1,0,0,1,3,2,0,0,1,3,1,0,0,2,1,2,0,1,0,1,3,0,2,0,1,3,0,1,0,2,1,2,0,0,1,1,3,0,0,2,1,3,0,0,1,2,2,3,1,1,1,0,2,1,1,1,-1,2,2,0,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,2,0,0,0,2,3,1,0,1,1,2,1,-1,1,1,2,2,0,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,2,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,2,0,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,2,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,0,2,0,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,2,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,2,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,0,0,2,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,0,2,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,0,2,2,1,1,1,-1,0,1,1,1,0,-1,0,0,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,0,0,0,0,0,2,1,-1,1,1,0,1,0,1,1,-1,0,0,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,0,0,0,0,0,2,1,-1,1,0,1,1,0,1,-1,1,0,0,0,0,0,2,1,-1,0,1,1,1,0,-1,1,1,0,0,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,2,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,2,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,2,2,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,0,2,0,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,2,0,0,2,1,-1,1,0,1,1,0,1,-1,1,2,0,2,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,0,0,2,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,0,2,0,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,2,0,2,1,1,-1,0,1,1,1,0,-1,1,2,0,0,0,2,2,1,-1,1,0,1,1,0,1,-1,1,2,0,0,0,2,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,0,2,3,1,1,0,0,0,2,2,0,0,0,2,1,1,1,-1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,1,-1,3,1,0,0,1,0,2,0,0,2,0,2,1,1,1,-1,3,1,1,0,0,0,2,2,0,0,0,2,1,1,-1,1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,-1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,1,-1,1,3,1,1,0,0,0,2,2,0,0,0,2,1,-1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,1,-1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,-1,1,1,3,1,0,1,0,0,2,0,2,0,0,2,-1,1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,-1,1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,-1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,4,1,1,1,1,3,3,2,0,1,0,3,1,0,2,0,4,1,1,1,1,3,3,0,2,1,0,3,0,1,2,0,4,1,1,1,1,3,3,2,0,0,1,3,1,0,0,2,4,1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,4,1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,4,1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,1,-1,3,3,2,0,1,0,3,1,0,2,0,2,1,1,1,-1,3,3,0,2,1,0,3,0,1,2,0,2,1,1,1,-1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,-1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,1,-1,1,3,3,0,2,0,1,3,0,1,0,2,2,1,1,-1,1,3,3,2,0,1,0,3,1,0,2,0,2,1,-1,1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,-1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,1,-1,1,1,3,3,0,2,1,0,3,0,1,2,0,2,-1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,2,-1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,-1,1,1,1];(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.makeNoise4D=e.makeNoise3D=e.makeNoise2D=void 0;var n=d1;Object.defineProperty(e,"makeNoise2D",{enumerable:!0,get:function(){return n.makeNoise2D}});var r=M1;Object.defineProperty(e,"makeNoise3D",{enumerable:!0,get:function(){return r.makeNoise3D}});var t=b1;Object.defineProperty(e,"makeNoise4D",{enumerable:!0,get:function(){return t.makeNoise4D}})})(i1);let Q=0,Y1=i1.makeNoise2D(Q),$e=i1.makeNoise3D(Q);var k={n1d:e=>Y1(e,0),n2d:(e,n)=>Y1(e,n),n3d:(e,n,r)=>$e(e,n,r),get seed(){return Q},set seed(e){e!==Q&&(Q=e,Y1=i1.makeNoise2D(Q),$e=i1.makeNoise3D(Q))}},Te=([e,n])=>{const r=ot(e,n);return r===0?[1,0]:[e/r,n/r]},Z1=([e,n,r])=>{const t=ft(e,n,r);return[e/t,n/t,r/t]};function At(e,{offset:n,scale:r,rotation:t}){const a=Math.max(...[n==null?void 0:n.length,r==null?void 0:r.length,t==null?void 0:t.length].filter(l=>!!l)),s=new Array(a).fill(null).map(l=>0),i=new Array(a).fill(null).map(l=>1),c=new Array(a).fill(null).map(l=>0);return n!=null&&n.length&&s.splice(0,n.length,...n),r!=null&&r.length&&i.splice(0,r.length,...r),t!=null&&t.length&&c.splice(0,t.length,...t),Qe(E1({},e),{offset:Float32Array.from(s),scale:Float32Array.from(i),rotation:Float32Array.from(c)})}var Le=(e,n,r)=>[e*Math.cos(r)-n*Math.sin(r),e*Math.sin(r)+n*Math.cos(r)];function S1(e,n,r){const[t,a,s]=e,[i,c,l]=Z1(n),o=Math.cos(r),h=Math.sin(r);return new U((o+(1-o)*i*i)*t+((1-o)*i*c-l*h)*a+((1-o)*i*l+c*h)*s,((1-o)*i*c+l*h)*t+(o+(1-o)*c*c)*a+((1-o)*c*l-i*h)*s,((1-o)*i*l-c*h)*t+((1-o)*c*l+i*h)*a+(o+(1-o)*l*l)*s)}function _t([e,n,r]){return e===0&&r===0?[1,0,0]:[1,1,-((e+n)/r)]}function St(e,{res:n=1,xCurvature:r=.5,yCurvature:t=.2}={}){const a=e.length,s=3+n*2,i=s*a,c=(s-1)*(a-1)*2,l=new Float32Array(i*3),o=new Float32Array(i*3),h=new Float32Array(i*2),f=new Uint16Array(c*3);return e.forEach((v,p)=>{const y=p*s;for(let m=0;m<s;m++){const u=2-m/(s-1)*2-1,x=-(1-v.y)*(1-v.y)*.5,g=Math.sin(Math.abs(u)*Math.PI)*.01;if(l[y*3+m*3+0]=(v.x-1)*u*.5,l[y*3+m*3+1]=g*r+x*t,l[y*3+m*3+2]=v.y-1,h[y*2+m*2+0]=l[y*3+m*3+0]+1/2,h[y*2+m*2+1]=l[y*3+m*3+2],p<e.length-1){const M=p*(s-1);f[M*6+m*6+0]=y+m+0,f[M*6+m*6+1]=y+m+1,f[M*6+m*6+2]=y+m+s,f[M*6+m*6+3]=y+m+1,f[M*6+m*6+4]=y+m+s,f[M*6+m*6+5]=y+m+s+1}}}),Mn({position:l,normal:o,index:f,uv:h})}function qe(e,n=8){return ct(e,n)}function Nt(e,n=1,r=1,t=0,a=!0){var u,x,g,M,w,b;const s=Array.isArray(r)?1:r,i=((u=r[0])!=null?u:s)*10,c=((x=r[1])!=null?x:s)*10,l=((g=r[2])!=null?g:s)*10,o=Array.isArray(t)?0:t,h=(M=t[0])!=null?M:o,f=(w=t[1])!=null?w:o,v=(b=t[2])!=null?b:o,p=e.length/4,y=[e[0],e[1],e[2]];let m=0;for(let d=0;d<p;d++){const S=d/p;m+=(Math.abs(y[0]-e[d*4+0])+Math.abs(y[1]-e[d*4+1])+Math.abs(y[2]-e[d*4+2]))/3,y[0]=e[d*4+0],y[1]=e[d*4+1],y[2]=e[d*4+2];const z=a?n*S:n,[D,E,N]=e.slice(d*4,d*4+3);e[d*4+0]=D+k.n1d(1e3+h+m*i)*z,e[d*4+1]=E+k.n1d(2e3+f+m*c)*z,e[d*4+2]=N+k.n1d(3e3+v+m*l)*z}return e}function je(e,[n,r,t]){let a=e.length/4,s=-1;for(;s++<a-1;)e[s*4+0]=e[s*4+0]+n,e[s*4+1]=e[s*4+1]+r,e[s*4+2]=e[s*4+2]+t;return e}function Ve(e,n,r=1,t,a=!1){const[s=0,i=0,c=0]=t||e;s&&i&&c&&je(e,[-s,-i,-c]);const l=e.length/4;let o=-1;for(;o++<l-1;){const h=e.slice(o*4,o*4+3),f=o/l,v=S1([...h],n,a?r*f:r);e[o*4+0]=v[0],e[o*4+1]=v[1],e[o*4+2]=v[2]}return s&&i&&c&&je(e,[s,i,c]),e}function Dt(e,n=.5,r=2,t=1){const a=Math.max(Math.min(n,1),0),s=Math.floor(Math.max(0,r));if(s<2)return[e];const i=e.length/4,c=Math.floor(i*a),l=Z1(F1(e,a)),o=Z1(_t(l));return[...c<0?[]:[e.slice(0,c*4)],...new Array(s).fill(null).map((h,f)=>{const v=e.slice((c-2)*4),p=f/r;return Ve(v,o,t,void 0,!0),Ve(v,l,p*6),v})].filter(h=>h.length>4)}function _0(e){return e}var Et={title:"Branches",type:"branches",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0,required:!0},length:{type:"number",min:0,max:3,step:.05,value:.8},thiccness:{type:"number",min:0,max:1,step:.01,value:.8},offsetSingle:{type:"number",min:0,max:1,step:.01,value:.5},lowestBranch:{type:"number",min:0,max:1,step:.01,value:.2},amount:{type:"number",min:0,max:64,value:10}},computeStem(e,n){if(!e.input)return{stems:[]};const{stems:r}=e.input(),t=n.getSetting("stemResY"),a=Math.max(...r.map(i=>i.depth)),s=r.map(i=>{const c=[];if(a!==i.depth)return[];const l=e.amount(),o=e.lowestBranch();for(let h=0;h<l;h++){const f=h/l,v=e.length(f)*(1-f),p=e.thiccness(f),y=e.offsetSingle(f),m=h%2===0;let u=o+(1-o)*f;u-=1/l*y*(m?-1:1);const[x,,g]=F1(i.skeleton,u),M=Te([x,g]),[w,b]=Le(M[0],M[1],m?-Math.PI/2:Math.PI/2),[d,S,z,D]=Ee(i.skeleton,u),E=Math.max(Math.floor(t),4),N=new Float32Array(E*4);for(let A=0;A<E*4;A++){const O=A/E;N[A*4+0]=d+w*O*v,N[A*4+1]=S,N[A*4+2]=z+b*O*v,N[A*4+3]=D*p*(1-O)}c.push(N)}return c.map(h=>({skeleton:h,id:i.id,depth:i.depth+1}))}).flat();return{stems:[...r,...s]}}},Ot={title:"Random",type:"random",outputs:["number"],parameters:{min:{type:"number",value:0,min:0,max:1,step:.05},max:{type:"number",value:1,min:0,max:1,step:.05}},computeValue(e,n,r){const t=e.max(),a=e.min();return t?a+n.n1dn(200+r*1e3)*Math.abs(t-a):0}},Rt={title:"Curve",type:"curve",outputs:["number"],parameters:{value:{type:"curve",internal:!0,label:!1,value:[{x:0,y:1,pinned:!0},{x:1,y:0,pinned:!0}]}},computeValue(e,n,r){const t=Je(e.value).map(a=>a.y);return lt(t,1-r)}},Pt={title:"Gravity",type:"gravity",outputs:["plant"],parameters:{input:{type:"plant",required:!0,external:!0},type:{internal:!0,type:"select",values:["simple","verlet","test"],value:"simple"},strength:{type:"number",min:0,max:2,step:.05,value:1}},computeStem(e){const{input:n,type:r,strength:t}=e,{stems:a}=n(),s=Math.max(...a.map(i=>i.depth));return r==="simple"&&a.forEach(({skeleton:i,depth:c})=>{if(c!==s)return;const l=i.length/4;for(let o=1;o<l;o++){const h=o/l,f=i[o*4+1],v=t(h);i[o*4+1]=f-f*h*h*h*v}return i}),r==="test"&&a.forEach(({skeleton:i})=>{const c=i.length/4;for(let l=1;l<c;l++){const o=l/c,h=t(o),f=i[l*4+0],v=i[l*4+1],p=i[l*4+2],y=i[(l-1)*4+0],m=i[(l-1)*4+1],u=i[(l-1)*4+2],x=y-f,g=m-v,M=m-p,[w,b]=Le(x,M,90);for(let d=l;d<c;d++){const S=i[d*4+0],z=i[d*4+1],D=i[d*4+2],E=S-y,N=z-m,A=D-u;let[O,_,R]=S1([E,N,A],[w,g,b],h*o);const L=O+y,P=_+m,j=R+u;i[d*4+0]=L,i[d*4+1]=P,i[d*4+2]=j}}return i}),r==="verlet"&&a.forEach(({skeleton:i})=>{const c=i.length/4;for(let l=1;l<c;l++){const o=i[l*4+0],h=i[l*4+1],f=i[l*4+2],v=new U(5,0,0).cross(new U(o,h,f),new U(0,1,0)),p=l/c,y=t(p);for(let m=l;m<c;m++){const u=S1([o,h,f],v,p*y);i[m*4+0]=u[0],i[m*4+1]=u[1],i[m*4+2]=u[2]}}return i}),{stems:a}},computeGeometry(e){return e.input()}};const Q1=Z("nodes.join");var $t={title:"Join",type:"join",outputs:["plant"],parameters:{inputA:{type:"plant",label:"plant",required:!0,external:!0},inputB:{type:"plant",label:"plant",external:!0}},computeStem(e,n){Q1("compute skeleton",e,n);const{inputA:r,inputB:t}=e;if(!r||!t)return r?r():t();const{stems:a}=r(),{stems:s}=t();return Q1(a,s),{stems:[...a,...s]}},computeGeometry(e){const{inputA:n,inputB:r}=e;if(!n||!r)return n?n():r();const{geometry:t,instances:a}=n(),{geometry:s,instances:i}=r(),c=y1(t,s),l=[];return a&&l.push(a),i&&l.push(i),Q1("compute geometry",{geometryA:t,geometryB:s,result:c}),{geometry:c,instances:l}}},Tt={title:"Leaf",type:"leaf",outputs:["plant"],parameters:{input:{type:"plant",required:!0,external:!0},size:{type:"number",min:0,max:3,step:.05,value:.2},shape:{type:"shape",external:!0,value:[{x:.8,y:1,pinned:!0},{x:.62,y:.84,pinned:!1},{x:.54,y:.63,pinned:!1},{x:.38,y:.41,pinned:!0},{x:.44,y:.23,pinned:!1},{x:.64,y:.12,pinned:!1},{x:.98,y:.02,pinned:!0}]},lowestLeaf:{type:"number",min:0,max:1,step:.01,value:.5},curvature:{external:!0,type:"vec2",value:{x:.5,y:.2}},amount:{type:"number",min:0,max:20,value:10}},computeStem(e){const{stems:n}=e.input(),r=Math.max(...n.map(a=>a.depth)),t=n.map((a,s)=>{const i=s/n.length;if(a.depth!==r)return;const c=e.amount(i),l=new Float32Array(c*3),o=new Float32Array(c*3),h=new Float32Array(c*3);for(let f=0;f<c;f++){const v=f/(c-1),p=e.size(1-v),y=e.lowestLeaf(v),m=y+(1-y)*v-.001,[u,x,g]=Ee(a.skeleton,m),[M,,w]=F1(a.skeleton,m),b=Te([M,w]),d=Math.atan2(-b[0],b[1]);l[f*3+0]=u,l[f*3+1]=x,l[f*3+2]=g,o[f*3+0]=p,o[f*3+1]=1,o[f*3+2]=p,h[f*3+0]=0,h[f*3+1]=d-Math.PI/2*(f%2===0?-1:1),h[f*3+2]=0}return{offset:l,scale:o,rotation:h}}).filter(a=>!!a);return{stems:n,instances:t}},computeGeometry(e,n,r){const{shape:t,input:a,curvature:s}=e,{instances:i}=n,c=s(),l=St(t(),{res:r.getSetting("leafRes")||2,xCurvature:c.x,yCurvature:c.y});return{geometry:a().geometry,instances:i.map(o=>At(l,o))}}},Lt={title:"Math",type:"math",outputs:["number"],parameters:{mode:{type:"select",internal:!0,label:!1,value:"add",values:["add","multiply","subtract"]},a:{type:"number",value:0,label:!1},b:{type:"number",value:0,label:!1}},computeValue(e,n,r){const{mode:t}=e,a=e.a(r),s=e.b(r);switch(t){case"multiply":return a*s;case"subtract":return a-s;default:return a+s}}};const qt=Z("nodes.noise");var jt={title:"Noise",type:"noise",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",external:!0,required:!0},size:{type:"number",min:0,max:2,step:.05,value:1},strength:{type:"number",min:0,max:2,step:.01,value:.5}},computeStem(e){qt("computeSkeleton",e);const{stems:n}=e.input(),r=e.size(),t=e.strength(),a=Math.max(...n.map(s=>s.depth));return n.forEach((s,i)=>{s.depth===a&&Nt(s.skeleton,t,r,i*200)}),{stems:n}},computeGeometry(e,n,r){var i;const t=r.getSetting("stemResX"),a=(i=e==null?void 0:e.input)==null?void 0:i.call(e),{stems:s}=n;return{geometry:y1(a?a.geometry:null,...s.map(({skeleton:c})=>qe(c,t)))}}},Vt={title:"Output",type:"output",outputs:[],parameters:{input:{type:"plant",required:!0,label:"plant",external:!0}}},Ft={title:"Parameter",type:"parameter",outputs:["number"],parameters:{value:{type:"number",inputType:"float",value:0},variation:{type:"number",value:0,min:0,max:1,step:.05}},computeValue(e,n,r=1){const t=e.value(),a=e.variation();return a?t+n.n1d(200*r)*a*Math.max(t,1):t}};const Ct=e=>e==="x"?[1,0,0]:e==="z"?[0,0,1]:[0,1,0];var It={title:"Rotate",type:"rotate",outputs:["plant"],parameters:{input:{type:"plant",required:!0,external:!0},axis:{type:"select",internal:!0,label:!1,inputType:"tab",values:["x","y","z"],value:"x"},spread:{internal:!0,type:"boolean",value:!0},angle:{type:"number",min:0,max:Math.PI*2,step:.05,value:0}},computeStem(e){const{input:n,axis:r,spread:t}=e,{stems:a}=n(),s=Ct(r),{depth:i}=a[a.length-1];return a.forEach((c,l)=>{if(c.depth!==i)return;const o=c.skeleton,h=c.skeleton.length/4,f=o[0],v=o[1],p=o[2],y=l/a.length,m=e.angle(y)*(t?y:1);for(let u=1;u<h;u++){let x=o[u*4+0],g=o[u*4+1],M=o[u*4+2];x-=f,g-=v,M-=p,[x,g,M]=S1([x,g,M],s,m),x+=f,g+=v,M+=p,o[u*4+0]=x,o[u*4+1]=g,o[u*4+2]=M}}),{stems:a}}},Ut={title:"Shape",type:"shape",outputs:["shape"],parameters:{value:{type:"shape",internal:!0,label:!1,value:[{x:1,y:0,pinned:!0},{x:.5,y:.5,pinned:!0},{x:1,y:1,pinned:!0}]}},computeValue(e){return e.value}},Bt={title:"Slider",type:"slider",outputs:["number"],parameters:{value:{type:"number",label:!1,internal:!0,min:0,max:1,step:.01,value:0}},computeValue(e){return e.value}};const Gt=Z("nodes.stem");var Ht={title:"Stem",type:"stem",outputs:["plant"],parameters:{origin:{type:"vec3",external:!0,value:{x:0,y:0,z:0}},height:{type:"number",min:0,max:5,step:.05,value:2},thiccness:{type:"number",min:0,max:.2,step:.01,value:.06},amount:{type:"number",min:0,max:20,value:1}},computeStem(e,n){Gt("computeSkeleton",e);const r=e.amount(),t=n.getSetting("stemResY"),a=[];for(let s=0;s<r;s++){const{x:i,y:c,z:l}=e.origin(s),o=e.height(),h=new Float32Array(t*4);for(let f=0;f<t;f++){const v=f/t,p=e.thiccness(v)*(1-v),y=i,m=c+v*o,u=l;h[f*4+0]=y,h[f*4+1]=m,h[f*4+2]=u,h[f*4+3]=p}a.push({depth:0,skeleton:h,id:"stem"+n.getId()})}return{stems:a}}},Yt={title:"Vec2",type:"vec2",outputs:["vec2"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0}}},Zt={title:"Vec3",type:"vec3",outputs:["vec3"],parameters:{x:{label:!1,type:"number",value:0,defaultValue:0},y:{label:!1,type:"number",value:0,defaultValue:0},z:{label:!1,type:"number",value:0,defaultValue:0}}},Qt={title:"Vec3Length",type:"vec3length",outputs:["number"],parameters:{vec:{type:"vec3",label:!1,value:{x:0,y:0,z:0}}},computeValue(e){const n=e.vec();return n?Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)+Math.pow(n.z,2)):0}},kt={title:"Split",type:"split",outputs:["plant"],parameters:{input:{type:"plant",label:"plant",required:!0,external:!0},height:{type:"number",min:0,max:1,step:.05,value:.7},angle:{type:"number",min:0,max:2,step:.01,value:.5},amount:{type:"number",min:2,max:20,value:2}},computeStem(e){const n=e.height(),r=e.angle(),t=e.amount(),{stems:a}=e.input(),s=Math.max(...a.map(c=>c.depth));return{stems:a.map(c=>c.depth===s?Dt(c.skeleton,n,t,r).map((o,h)=>({skeleton:o,id:c.id,depth:c.depth+(h===0?0:1)})):c).flat().filter(c=>!!c)}}},Wt={title:"Number",type:"number",outputs:["number"],parameters:{value:{type:"number",internal:!0,label:!1,value:0}},computeValue({value:e=0}){return e}},Jt=Object.freeze({__proto__:null,Branch:Et,Random:Ot,Curve:Rt,Gravity:Pt,Join:$t,Leaf:Tt,Math:Lt,Noise:jt,Output:Vt,Parameter:Ft,Rotate:It,Shape:Ut,Slider:Bt,Stem:Ht,Vec2:Yt,Vec3:Zt,VecLength:Qt,Split:kt,Number:Wt}),Xt=Object.values(Jt);const r1=new Map;for(const e of Xt)e.computeStem&&(e.computeStem=O1(e.computeStem)),e.computeGeometry&&(e.computeGeometry=O1(e.computeGeometry)),e.computeValue&&(e.computeValue=O1(e.computeValue)),r1.set(e.type,e);let Fe="",k1,W1=2;const Kt=e=>{let n=0;return k.seed=0,{_id:"",getId(){return this._id},n1d(r){return k.n1d(W1++*r)},n1dn(r){return 1+k.n1d(W1++*r)/2},getSetting(r){return e[r]},get settings(){return e},get seed(){return n},refresh(){W1=2,e!=null&&e.useRandomSeed&&(n=Math.floor(Math.random()*1e5),k.seed=n)}}};var e0=e=>{const n=JSON.stringify(e);return n!==Fe&&(Fe=n,k1=Kt(e)),k1.refresh(),k1};function n0({nodes:e},n){const r=e0(n),t=new Map,a=new Map,s=f=>{var v;return(v=a.get(f))!=null?v:[]},i=f=>{var v;return(v=t.get(f))!=null?v:[]};let c=[];for(const{attributes:f,state:v}of e){const p=r1.get(f.type);if(!p)return console.log("Existing node types: ",{nodeMap:r1}),{errors:["Missing NodeType "+f.type]};c.push({attributes:f,state:v,exec:p,type:f.type,id:f.id,level:-1,results:[]})}let l;if(c.forEach(f=>{t.set(f.id,f),!l&&f.type==="output"&&(l=f,l.level=0),f.attributes.refs.forEach(v=>{a.has(v.id)?a.set(v.id,[...a.get(v.id),{n:f,in:v.in,out:v.out}]):a.set(v.id,[{n:f,in:v.in,out:v.out}])})}),!l)return{errors:["Missing output node"]};function o(f){if(f!=null&&f.buckets)return f.buckets;let v=[f],p=[f];for(;v.length;){const m=v.shift(),u=s(m.id);if(u!=null&&u.length)for(const{n:x}of u)x.level=m.level+1,p.includes(x)||p.push(x),v.push(x)}const y=[];for(const m of p)y[m.level]?y[m.level].push(m):y[m.level]=[m];return f.buckets=y,y}function h(f){var y,m,u,x;if("parameters"in f)return f.parameters;let v={};const p=r1.get(f.type);for(const g of s(f.id)){const M=g.n;M.exec.outputs[0]==="plant"?v[g.in]=()=>g.n.results[0]:(y=M.exec)!=null&&y.computeValue?v[g.in]=(w=1)=>{const b=h(g.n);return M.exec.computeValue(b,r,w)}:v[g.in]=(w=1)=>{const b={},d=h(g.n);return Object.keys(d).forEach(z=>{b[z]=d[z](w)}),b}}for(const g of Object.keys(p.parameters))if((m=p.parameters[g])!=null&&m.internal)v[g]=f.state[g];else if(v[g]===void 0){if((u=p.parameters[g])!=null&&u.required&&v[g]===void 0)return{errors:["Missing Input ["+(((x=p.parameters[g])==null?void 0:x.label)||g)+"] in "+p.type]};v[g]=()=>f.state[g]}return f.parameters=v,v}return{nodes:c,outputNode:l,getNodeRef:s,getNode:i,getBucketsForNode:o,constructParametersForNode:h,ctx:r}}async function r0(e,n){var o,h;const r=n0(e,n);if(r.errors)return{errors:r.errors};const t=r.ctx,a=r.getBucketsForNode(r.outputNode);for(const f of a.reverse())for(const v of f){const p=r1.get(v.type);if(p){let y=r.constructParametersForNode(v);if(y!=null&&y.errors)return{errors:y.errors};if(p!=null&&p.computeStem){t._id=v.id;const m=p.computeStem(y,t);v.results=Array.isArray(m)?m:[m]}if(p!=null&&p.computeGeometry){const m=p.computeGeometry(y,v.results[0],t);v.results[0]=E1(E1({},v.results[0]),m)}}else console.warn("Missing Type",v.type),console.log(r1)}if(!((h=(o=r==null?void 0:r.outputNode)==null?void 0:o.parameters)!=null&&h.input))return{errors:["Missing input connection to output node"]};const s=r.outputNode.parameters.input();if(!s)return{errors:["DUnno?"]};const{stems:i,instances:c}=s;let l=y1(...i.map(f=>qe(f.skeleton,t.getSetting("stemResX"))));if(c){const f=c==null?void 0:c.map(v=>wn(v)).flat();l=y1(l,...f)}return Oe(l),{stems:i,geometry:l}}const Ce=Symbol("Comlink.proxy"),t0=Symbol("Comlink.endpoint"),a0=Symbol("Comlink.releaseProxy"),J1=Symbol("Comlink.thrown"),Ie=e=>typeof e=="object"&&e!==null||typeof e=="function",s0={canHandle:e=>Ie(e)&&e[Ce],serialize(e){const{port1:n,port2:r}=new MessageChannel;return X1(e,n),[r,[r]]},deserialize(e){return e.start(),l0(e)}},i0={canHandle:e=>Ie(e)&&J1 in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},Ue=new Map([["proxy",s0],["throw",i0]]);function X1(e,n=self){n.addEventListener("message",function r(t){if(!t||!t.data)return;const{id:a,type:s,path:i}=Object.assign({path:[]},t.data),c=(t.data.argumentList||[]).map(W);let l;try{const o=i.slice(0,-1).reduce((f,v)=>f[v],e),h=i.reduce((f,v)=>f[v],e);switch(s){case"GET":l=h;break;case"SET":o[i.slice(-1)[0]]=W(t.data.value),l=!0;break;case"APPLY":l=h.apply(o,c);break;case"CONSTRUCT":{const f=new h(...c);l=v0(f)}break;case"ENDPOINT":{const{port1:f,port2:v}=new MessageChannel;X1(e,v),l=f0(f,[f])}break;case"RELEASE":l=void 0;break;default:return}}catch(o){l={value:o,[J1]:0}}Promise.resolve(l).catch(o=>({value:o,[J1]:0})).then(o=>{const[h,f]=ee(o);n.postMessage(Object.assign(Object.assign({},h),{id:a}),f),s==="RELEASE"&&(n.removeEventListener("message",r),Be(n))})}),n.start&&n.start()}function c0(e){return e.constructor.name==="MessagePort"}function Be(e){c0(e)&&e.close()}function l0(e,n){return K1(e,[],n)}function N1(e){if(e)throw new Error("Proxy has been released and is not useable")}function K1(e,n=[],r=function(){}){let t=!1;const a=new Proxy(r,{get(s,i){if(N1(t),i===a0)return()=>t1(e,{type:"RELEASE",path:n.map(c=>c.toString())}).then(()=>{Be(e),t=!0});if(i==="then"){if(n.length===0)return{then:()=>a};const c=t1(e,{type:"GET",path:n.map(l=>l.toString())}).then(W);return c.then.bind(c)}return K1(e,[...n,i])},set(s,i,c){N1(t);const[l,o]=ee(c);return t1(e,{type:"SET",path:[...n,i].map(h=>h.toString()),value:l},o).then(W)},apply(s,i,c){N1(t);const l=n[n.length-1];if(l===t0)return t1(e,{type:"ENDPOINT"}).then(W);if(l==="bind")return K1(e,n.slice(0,-1));const[o,h]=Ge(c);return t1(e,{type:"APPLY",path:n.map(f=>f.toString()),argumentList:o},h).then(W)},construct(s,i){N1(t);const[c,l]=Ge(i);return t1(e,{type:"CONSTRUCT",path:n.map(o=>o.toString()),argumentList:c},l).then(W)}});return a}function o0(e){return Array.prototype.concat.apply([],e)}function Ge(e){const n=e.map(ee);return[n.map(r=>r[0]),o0(n.map(r=>r[1]))]}const He=new WeakMap;function f0(e,n){return He.set(e,n),e}function v0(e){return Object.assign(e,{[Ce]:!0})}function ee(e){for(const[n,r]of Ue)if(r.canHandle(e)){const[t,a]=r.serialize(e);return[{type:"HANDLER",name:n,value:t},a]}return[{type:"RAW",value:e},He.get(e)||[]]}function W(e){switch(e.type){case"HANDLER":return Ue.get(e.name).deserialize(e.value);case"RAW":return e.value}}function t1(e,n,r){return new Promise(t=>{const a=h0();e.addEventListener("message",function s(i){!i.data||!i.data.id||i.data.id!==a||(e.removeEventListener("message",s),t(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},n),r)})}function h0(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}X1({executeNodeSystem:r0})})();
