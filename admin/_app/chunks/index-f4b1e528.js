var T=Object.defineProperty;var f=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var h=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t)=>{for(var r in t||(t={}))E.call(t,r)&&h(e,r,t[r]);if(f)for(var r of f(t))R.call(t,r)&&h(e,r,t[r]);return e};import{w as I}from"./index-027e0f56.js";function S(){return"window"in globalThis}let g={};const l=(()=>{if(!("sessionStorage"in globalThis)){const e={getItem:t=>{},setItem:(t,r)=>{e[t]=r}};return e}return globalThis.sessionStorage})();if("user"in l)try{g=JSON.parse(l.getItem("user"))}catch{}const m=I(g);m.subscribe(e=>l.setItem("user",JSON.stringify(e)));const i=m,{VITE_API_URL:P="http://localhost:3000"}={VITE_API_URL:"https://plantarium.fly.dev",VITE_SVELTEKIT_APP_VERSION:"1653002786612",VITE_SVELTEKIT_APP_VERSION_FILE:"_app/version.json",VITE_SVELTEKIT_APP_VERSION_POLL_INTERVAL:"0",VITE_SVELTEKIT_AMP:"",VITE_GH_ORG:"jim-fx",VITE_GH_REPO:"plantarium",BASE_URL:"/admin/_app/",MODE:"production",DEV:!1,PROD:!0};function O(e){const r=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),u=decodeURIComponent(atob(r).split("").map(function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(u)}const d=S(),p=(()=>{let e=d&&localStorage.getItem("token");function t(){if(!e||e.length<10){i.set({});return}const r=O(e);i.set({username:r.username,id:r.sub})}return t(),{set token(r){e=r,d&&localStorage.setItem("token",r),t()},get token(){return e}}})();async function o({method:e,path:t,data:r,isJSON:u=!0}){const n={method:e,headers:{}};r&&(n.headers["Content-Type"]="application/json",n.body=JSON.stringify(r)),p.token&&(n.headers["access-token"]=`Bearer ${p.token}`);const s=await fetch(`${P}/${t}`,n);if(s.ok){if(u)try{return await s.json()}catch(b){console.error("Response from "+t+" failed to parse"),console.error(b)}return s.text()}const c=await s.json();return console.error(c),c}function _(e,t={}){return o(a({method:"GET",path:e},t))}function V(e,t){return o({method:"POST",path:e,data:t})}function y(e){return o({method:"GET",path:`api/report/${e}`})}function L(e){return o({method:"PUT",path:`api/report/${e}/publish`})}function k(e){return o({method:"DELETE",path:`api/report/${e}`})}function w(e){return o({method:"PUT",path:`api/report/${e}/unpublish`})}function j(){return o({method:"GET",path:"api/report/labels"})}function A(e,t){return o({method:"PUT",path:`api/report/${e}`,data:{labels:t}})}function U(e,t){return o({method:"PUT",path:`api/report/${e}`,data:t})}var $=Object.freeze(Object.defineProperty({__proto__:null,getReport:y,publishReport:L,deleteReport:k,unpublishReport:w,getAvailableLabels:j,setReportLabels:A,updateReport:U},Symbol.toStringTag,{value:"Module"}));async function v(e,t){const r=await V("api/auth/login",{username:e,password:t});p.token=r.access_token}function N(){p.token=""}function G(e){return o({method:"POST",path:"api/report",data:e})}function J(){return o({method:"GET",path:"api/report"})}async function D(){const e=await _("api/user/role",{isJSON:!1});return i.update(t=>(t.role=e,t)),e}async function K(){const e=await _("api/user/permission");return i.update(t=>(t.permissions=e,t)),e}var M=Object.freeze(Object.defineProperty({__proto__:null,login:v,logout:N,submitReport:G,getReports:J,getRole:D,getPermission:K},Symbol.toStringTag,{value:"Module"})),C=a(a({},$),M);export{C as a,N as b,y as c,j as d,K as e,w as f,_ as g,k as h,U as i,v as l,L as p,A as s,i as u};
